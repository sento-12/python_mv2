var guid;(e=>{(e.NSSS=e.NSSS||{}).searchGlobal=((o,l)=>{var i={},s=o.logger;let r=l.trackerLogger;var E=l.helperUtils,n=o.utils.isNil,t=o.utils.isntNil,S=(o.utils.isBoolean,l.constants),d=l.globalSettings;let c=o.extensionAdapter,g=l.NSSSHelper,{constants:a,uiConstants:T,uiConstants:{MESSAGES:_},nsssDarkModeHandlerBG:u}=(o.utils.isString,o.constants.BROWSER_TYPE,l);return i.settingsContainer=null,i.isWindowsOS=!1,i.IS_HP=!0,i.handleOmniSearchEvent=function(r){return new Promise(async n=>{if(o.globals.BROWSER!==o.constants.BROWSER_TYPE.FIREFOX||l.privacyPromptSettings.getPrivacyConsent()){var a=r.url,a=(g.isDuplicateRequest(a)||l.activeUserSearch.incrementSearchCount(),E.getQueryString("q",a));let e=E.getSearchURLTemplate(l.ocodeMgr.getDSOCode()).replace("$$TEMPLATE$$",a);var a=await E.getSettingsFromHomePageExtension(),s=E.getDarkModeThemeForDS(a),i=s===T.THEMES.DARK_THEME;let t;a?(t=a[T.SAME_TAB_LAUNCH_SERP_PARAM],d.setPreviousHPDarkModeTheme(s)):t=!1;a=i?"true":"false",s=(e=e.concat(`&${T.DARK_MODE_PARAM}=`+a),t?"true":"false");n({redirectUrl:e=e.concat(`&${T.SAME_TAB_LAUNCH_SERP_PARAM}=`+s)})}else i=c.getExtensionURL(l.uiConstants.PRIVACY_PROMPT_SCREEN.HTML),c.updateTabUrl(r.tabId,i),n({cancel:!0})})},i._switchFocusToPortal=async function(){if(o.globals.BROWSER===o.constants.BROWSER_TYPE.EDGE_CHROMIUM){var e=l.constants.NORTON_SW_EXTENSION_IDS;let t=await E.getExtensionInstalledAndEnabledStatus(e);Object.keys(t).some(e=>!0===t[e])||(e=await E.getLandingPage(),n(e))||c.activateTab(e.id)}},i.handleInstall=async function(e){e=e.reason;l.isFreshInstall=!1;let t;"install"===e&&(l.isFreshInstall=!0,l.main.injectWebCommunication(),i._switchFocusToPortal());try{await l.init.ready();var n=l.telemetryWrapper,a=l.telemetryTrackerClient;switch(e){case"install":E.flavorizeExtension(),await g.findAndSaveUrlParamsFromChromeWebStore(),l.helperUtils.isMediaDotNetExtension()||i.findAndStoreDateOfAssociation(),n.sendExtensionInstall(),a.sendExtensionInstall(),l.globalSettings.getInstallDate(),l.uninstallSurveyHelper&&l.uninstallSurveyHelper.initializeUninstallSurveyURL(),l.init.updateAntiTrackerStatus(),t=T.THEMES.BROWSER_THEME;break;case"update":l.helperUtils.isMediaDotNetExtension()||i.findAndStoreDateOfAssociation(),n.sendExtensionUpdate(),a.sendExtensionUpdate(),l.NSSSHelper.isVendorMigrationDoneFFEdge()&&n.sendVendorMigrationPing(),l.globalSettings.getInstallDate(),l.uninstallSurveyHelper&&l.uninstallSurveyHelper.initializeUninstallSurveyURL(),l.init.updateAntiTrackerStatus(),t=T.THEMES.LIGHT_THEME,l.NSSSHelper.cleanUpTrackValue()}l.globalSettings.isNewUserForHPNewFeatures()||(l.globalSettings.setIsNewUserForHPNewFeatures(!0),l.globalSettings.setDefaultDarkModeTheme(t),T.EXTENSION_TYPE===T.DEFAULT_SEARCH_EXTENSION&&l.globalSettings.setPreviousHPDarkModeTheme(T.THEMES.BROWSER_THEME),T.EXTENSION_TYPE===T.HOMEPAGE_EXTENSION&&u.notifyOtherExtensions())}catch(e){s.error(e),r.logEvent(r.LOG_TYPE.ERROR,""+r.errorToString(e)),l.NSSSHelper._resolveOnUrlParamsSet&&l.NSSSHelper._resolveOnUrlParamsSet()}},i.handleMessage=function(e,t,n){var a=t.tab,s=e.message;switch(e.name){case"flavor-retrieved":E.setFlavor(a.url,s);break;case _.EXTN_SETTINGS_PAGE_LOADED_TELEMETRY:l.telemetryWrapper.sendSettingsPageLoadEvent(),l.telemetryTrackerClient.sendSettingsPageLoadEvent();break;case _.UPDATE_EXTENSION_ICON:c.setBrowserIcon(e.options)}},i.actionCallback=async function(e){if(await l.init.ready(),o.globals.BROWSER!==o.constants.BROWSER_TYPE.FIREFOX||l.privacyPromptSettings.getPrivacyConsent()){let e;e=E.isDS()?c.getExtensionURL(S.SETTINGS_PAGE):c.getExtensionURL(S.HOME_PAGE),e+="?"+S.LAUNCHED_ON_EXTENSION_CLICK,c.createTab(e),l.telemetryWrapper.sendActionClickEvent(),l.telemetryTrackerClient.sendActionClickEvent()}},i.handleHPSettingsChangedExternal=async function(e){var t=e.payload[T.DARK_MODE_PARAM],e=e.payload[T.SAME_TAB_LAUNCH_SERP_PARAM];E.updateSERPTabUrls(t,e),await E.handleOmniSearch()},i.handleExternalMessage=function(e,t,n){var a=e.name,t=t.id;if(S.NORTON_EXTENSION_IDS.includes(t))switch(a){case S.GET_INSTALL_DATE:n({doi:d.getInstallDate()});break;case S.GET_ASSOCIATION_DATE:n({doa:d.getDateOfAssociation()});break;case l.uiConstants.MESSAGES.GET_INTERNAL_IDENTIFIER:var s=l.NSSSHelper.getCurrentExtensionIdentifier();""!==s&&n({internalIdentifier:s});break;case l.uiConstants.HP_SETTINGS_CHANGED_EXTERNAL:E.isDS()&&(c.isManifestV3Extension()?i.handleHPSettingsChangedExternal(e):g.updateUrlParamsOfAllMatchingUrls([c.getExtensionURL("/*")],e.payload))}},i._getSendersExtensionId=function(){var e=o.globals.BROWSER,t=S.PRODUCT_NAME;return n(e)||n(t)?null:S.EXTENSION_PAIR_IDS[t][e][S.VENDOR]},i._dateOfAssociationHelper=function(e){c.sendMessageExternal(e,{name:S.GET_INSTALL_DATE},e=>{let t=null;t=chrome.runtime.lastError||n(e)||n(e.doi)?(s.debug("getInstallDate - receiving end does not exists or response is null"),r.logger.debug("getInstallDate - receiving end does not exists or response is null"),E.getNormalizedDateString(new Date)):e.doi;e=d.getInstallDate();d.setDateOfAssociation(e,t)})},i.isHPDarkModeHandler=function(){let e=S.NORTON_HP_EXTENSION_IDS[0];return new Promise(t=>{c.sendMessageExternal(e,{name:T.IS_HP_DARK_MODE_HANDLER},e=>{chrome.runtime.lastError||n(e)?(s.debug("isHPDarkModeHandler - receiving end does not exists or response is invalid"),r.logger.debug("isHPDarkModeHandler - receiving end does not exists or response is invalid"),t(null)):t(e)})})},i.findAndStoreDateOfAssociation=function(){var e=l.globalSettings.getDateOfAssociation();if(!t(e)){let t=i._getSendersExtensionId();n(t)||c.sendMessageExternal(t,{name:S.GET_ASSOCIATION_DATE},e=>{chrome.runtime.lastError||n(e)||n(e.doa)?(s.debug("getAssociationDate - receiving end does not exists or response is null"),r.logger.debug("getAssociationDate - receiving end does not exists or response is null"),i._dateOfAssociationHelper(t)):d.setDateOfAssociation(e.doa,e.doa)})}},i.initialize=async function(){!l.isFreshInstall&&l.NSSSHelper._resolveOnUrlParamsSet&&l.NSSSHelper._resolveOnUrlParamsSet(),c.isManifestV3Extension()&&!1===i.IS_HP&&(await E.handleOmniSearch(),chrome.webRequest.onBeforeRequest.addListener(l.NSSSHelper.handleOmniSearchMv3,{urls:[l.constants.SEARCH_URL+"?omnisearch=yes*"]})),chrome.runtime.getPlatformInfo(function(e){"win"===e.os&&(i.isWindowsOS=!0)}),l.main.initVendorConstants(),i._canHandleTelemetryOptOut()&&l.main.handleTelemetryOptOut(),chrome.runtime.onMessage.addListener(i.handleMessage),c.addMessageExternalListener(i.handleExternalMessage),i._sendExtensionIdToSW(),c.isManifestV3Extension()||(chrome.browserAction.onClicked.addListener(i.actionCallback),l.isFreshInstall||l.init.updateAntiTrackerStatus(),!1===i.IS_HP&&chrome.webRequest.onBeforeRequest.addListener(i.handleOmniSearchEvent,{urls:[l.constants.SEARCH_URL+"?omnisearch=yes*"]},["blocking"]))},i._canHandleTelemetryOptOut=()=>o.globals.BROWSER!==o.constants.BROWSER_TYPE.FIREFOX||![T.HOMEPAGE_EXTENSION,T.DEFAULT_SEARCH_EXTENSION,T.THREE_IN_ONE].includes(T.EXTENSION_TYPE),i._sendExtensionIdToSW=function(){var e=l.NSSSHelper.getCurrentExtensionIdentifier();""!==e&&(e={name:l.uiConstants.MESSAGES.SEND_INTERNAL_IDENTIFIER,internalIdentifier:e},o.extensionAdapter.sendMessageExternal(S.NORTON_SW_EXTENSION_IDS[0],e,()=>{t(o.extensionAdapter.getLastError())&&(s.debug("safeweb extension is not installed"),r.logger.debug("safeweb extension is not installed"))}))},i._alarmHandler=async function(e){switch(await l.init.ready(),e){case a.ALARM_NAMES.TWITTER_FEEDS:l.twitterFeeds.fetchAndSaveTwitterFeeds();break;case a.ALARM_NAMES.TELEMETRY_NOTIFICATION:l.main.setTelemetryNotification();break;case S.ALARM_NAMES.TELEMETRY_NOTIFICATION_AUTOHIDE:l.main.hideTelemetryNotifcation();break;case S.ALARM_NAMES.TELEMETRY_NOTIFICATION_DUE_CHECK_WAKEUP:l.main.checkTelemetryNotificationDueElapsed();break;case a.ALARM_NAMES.FETCH_ANTI_TRACKER_STATUS:case a.ALARM_NAMES.PERIODIC_ANTI_TRACKER_SCHEDULER:l.antiTrackerStatusProvider.handleAntiTrackerScheduler(e)}},i._alarmCallback=e=>{i._alarmHandler(e.name)},i.load=async function(){c.isManifestV3Extension()&&chrome.action.onClicked.addListener(i.actionCallback),o.alarmHelper.registerAlarmListener(i._alarmCallback);try{await l.init.ready()}catch(e){s.error(e),r.logEvent(r.LOG_TYPE.ERROR,""+r.errorToString(e))}await i.initialize()},i.loadExtension=async()=>{c.isManifestV3Extension()||await g.waitForWindowLoadEvent(),await i.load()},i})(e.SymBfw,e.NSSS)})(executionContext),SymBfw.utils.isntNil(chrome.runtime.onInstalled)?chrome.runtime.onInstalled.addListener(NSSS.searchGlobal.handleInstall):(guid=NSSS.globalSettings.getValue(NSSS.constants.NSSS_INSTALLDATEKEY),SymBfw.utils.isNil(guid)&&setTimeout(function(){NSSS.searchGlobal.handleInstall({reason:"install"})},5e3)),NSSS.searchGlobal.loadExtension(),(e=>{{var _=e.SymBfw,u=e.NSSS;let{logger:a,utils:{isNil:t,isntNil:i,isObject:r}}=_,{constants:s,globalSettings:o,helperUtils:l,NSSSHelper:E,uiConstants:S,telemetryTrackerClient:d,trackerLogger:c,nsssDarkModeHandlerBG:g}=u,n={_getGlobalObject:()=>i(u.searchGlobal)?u.searchGlobal:u.main,flavorizeExtension:async()=>{var e,t=await l.getLandingPage();i(t)?(e=["content/libs/uri.min.js","ContextInit.js","content/scripts/SymBfwCS.js","content/scripts/flavorParser.js"],await l.executeContentScriptsToFlavorizeExtn(t.id,e)):(await n.setURLParametersFromRepetitiveExtension(),await n.setURLParametersFromLegacyExtension())},setURLParametersFromRepetitiveExtension:async()=>{if(!o.getFlavorized()){var e=await u.migratorDestination.getAllParamsFromRepetitiveExtension();if(r(e)){var t,n,a=new Set(Object.keys(u.migratorConstants.GLOBAL_SETTINGS_KEY_TO_URL_PARAMS_KEY_MAP));for([t,n]of Object.entries(e))a.has(t)&&i(n)&&o.setValue(t,n);e=e[s.PARAMSTRINGKEY];i(e)&&o.setParamsString(e),o.setFlavorized(!0)}}},setURLParametersFromLegacyExtension:async()=>{if(!o.getFlavorized()){var e=await u.migratorDestination.getAllParamsFromLegacyExtension();if(r(e)){var t,n,a=new Set(Object.keys(u.migratorConstants.GLOBAL_SETTINGS_KEY_TO_URL_PARAMS_KEY_MAP)),s=[];for([t,n]of Object.entries(e))a.has(t)&&i(n)?o.setValue(t,n):i(n)&&s.push(t.toLowerCase()+"="+n);0<s.length&&(e=s.join("&"),o.setParamsString(e)),o.setFlavorized(!0)}}},_getMigrationPageUrl:function(){var e=u.vendorSetup.getMigrationUrl();return t(e)?"":e},handleStartup:async()=>{await u.init.ready();var e=u.globalSettings.getVendor();_.globals.BROWSER===_.constants.BROWSER_TYPE.CHROME&&(!t(e)&&""!==e||(await u.vendorSetup._setVendorInfo("browserlaunch"),u.main.initVendorConstants()),E.isValidVendor(u.globalSettings.getVendor())&&u.migratorDestination.uninstallExtensions(),u.init.updateAntiTrackerStatus())},_isHomePageOrDefaultSearchExtn:()=>S.EXTENSION_TYPE===S.HOMEPAGE_EXTENSION||S.EXTENSION_TYPE===S.DEFAULT_SEARCH_EXTENSION,handleInstall:async e=>{var t=e.reason;u.isFreshInstall=!1,"install"===t&&(u.isFreshInstall=!0,u.main.injectWebCommunication());try{await u.init.ready();var n=u.telemetryWrapper;let e;switch(t){case"install":u.globalSettings.setVendor(u.constants.IAC),await T.flavorizeExtension(),await E.findAndSaveUrlParamsFromChromeWebStore(),u.main.initVendorConstants();await u.migratorDestination.uninstallRepetitiveExtension(),await u.migratorDestination.uninstallLegacyExtension();T._isHomePageOrDefaultSearchExtn()&&(T.findAndStoreDateOfAssociation(),u.uninstallSurveyHelper.initializeUninstallSurveyURL()),n.sendExtensionInstall(),d.sendExtensionInstall(),u.globalSettings.getInstallDate(),u.init.updateAntiTrackerStatus(),e=S.THEMES.BROWSER_THEME;break;case"update":await u.vendorSetup._setVendorInfo(t),u.main.initVendorConstants(),T._isHomePageOrDefaultSearchExtn()&&(T.findAndStoreDateOfAssociation(),u.uninstallSurveyHelper.initializeUninstallSurveyURL()),n.sendExtensionUpdate(),d.sendExtensionUpdate(),u.globalSettings.getInstallDate(),l.removeTestEligibilityParam(),u.init.updateAntiTrackerStatus(),e=S.THEMES.LIGHT_THEME,u.NSSSHelper.cleanUpTrackValue()}u.globalSettings.isNewUserForHPNewFeatures()||(u.globalSettings.setIsNewUserForHPNewFeatures(!0),u.globalSettings.setDefaultDarkModeTheme(e),S.EXTENSION_TYPE===S.DEFAULT_SEARCH_EXTENSION&&u.globalSettings.setPreviousHPDarkModeTheme(S.THEMES.BROWSER_THEME),S.EXTENSION_TYPE===S.HOMEPAGE_EXTENSION&&g.notifyOtherExtensions())}catch(e){a.error(e),c.logEvent(c.LOG_TYPE.ERROR,""+c.errorToString(e)),u.NSSSHelper._resolveOnUrlParamsSet&&u.NSSSHelper._resolveOnUrlParamsSet()}}},T=n._getGlobalObject();chrome.runtime.onInstalled.removeListener(T.handleInstall),Object.assign(T,n),chrome.runtime.onInstalled.addListener(T.handleInstall),chrome.runtime.onStartup.addListener(T.handleStartup)}})(executionContext);