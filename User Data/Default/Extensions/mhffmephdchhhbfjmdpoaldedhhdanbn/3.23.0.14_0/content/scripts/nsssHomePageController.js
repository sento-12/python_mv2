(e=>{let o=NSSS.constants.SEARCH_SUGGESTION_METADATA,{extensionAdapter:r,utils:{isNil:s}}=SymBfw,a=NSSS.uiConstants.MESSAGES;(e.NSSS=e.NSSS||{}).homePageController=new class{constructor(){this._preCachedSuggestion={},this._homePageMetadata=null}_constructHomePageMetaData(){return new Promise(function(t,a){SymBfw.extensionAdapter.sendMessage({name:NSSS.uiConstants.MESSAGES.GET_HOME_PAGE_METADATA},e=>{(r.getLastError()||s(e))&&a(null),t(e)})})}async init(){try{this._homePageMetadata=await this._constructHomePageMetaData(),SymBfw.globals.BROWSER!==SymBfw.constants.BROWSER_TYPE.FIREFOX&&NSSS.bookmarksController&&(this._homePageMetadata.bookmarks=await NSSS.bookmarksController.getBookmarksData()),NSSS.mostVisitedSitesController&&(this._homePageMetadata.mostVisitedSites=await NSSS.mostVisitedSitesController.getTopSites(this._homePageMetadata.chickeletsDataJson.quicklinksData))}catch(e){return SymBfw.logger.debug("Error in getting homepage metadata  - "+e),void NSSS.trackerLogger.logger.debug("Error in getting homepage metadata  - "+NSSS.trackerLogger.errorToString(e))}s(this._homePageMetadata.navigatorLanguage)&&(SymBfw.logger.debug("navigator Language from BG is null"),NSSS.trackerLogger.logger.debug("navigator Language from BG is null"),this._homePageMetadata.navigatorLanguage=o.defaultLangCode),this._populateSuggestionParams()}getHomePageMetadata(){return this._homePageMetadata}_populateSuggestionParams(){var e=o[NSSS.constants.VENDOR];if(SymBfw.utils.isNil(e))throw new Error("Unsupported vendor name");var t=e.suggestionUrl,e=new URLSearchParams(e.queryParams),[a,r]=this._homePageMetadata.navigatorLanguage.split("-");NSSS.constants.VENDOR===NSSS.constants.IAC&&(a=s(r)?a:a+"_"+r.toLocaleUpperCase(),e.set(NSSS.constants.URL_PARAMS_KEY.HL,a)),this._searchAPIUrl=t,this._queryParams=e}_getSuggestionUrlByVendor(e){return NSSS.constants.VENDOR===NSSS.constants.IAC&&this._queryParams.set(NSSS.constants.URL_PARAMS_KEY.IAC_QUERY,e),""+this._searchAPIUrl+this._queryParams.toString()}async fetchSuggestions(e){if(SymBfw.utils.isNil(this._homePageMetadata))return SymBfw.logger.debug("HomePageController is not initialized. Please call init before calling fetchSuggestions"),NSSS.trackerLogger.logger.debug("HomePageController is not initialized. Please call init before calling fetchSuggestions"),[];if(this._preCachedSuggestion[e])return this._preCachedSuggestion[e];try{var t=this._getSuggestionUrlByVendor(e),[,a]=await(await SymBfw.utils.safeFetch(t)).json();return this._preCachedSuggestion[e]=a}catch(e){return SymBfw.logger.error("Unable to fetch the suggestion result due to "+e),NSSS.trackerLogger.logEvent(NSSS.trackerLogger.LOG_TYPE.ERROR,"Unable to fetch the suggestion result due to "+NSSS.trackerLogger.errorToString(e)),[]}}async launchSearchTab(e){var t;SymBfw.utils.isNil(e)||(this._homePageMetadata=await this._constructHomePageMetaData(),t=this._homePageMetadata.isDarkModeSet,SymBfw.extensionAdapter.sendMessage({name:a.LAUNCH_SEARCH_TAB_WITH_URL,query:e,isDarkModeSet:t}))}}})(executionContext);