(self.webpackChunk=self.webpackChunk||[]).push([[5739],{70632:(e,t,n)=>{var r=n(98544),i="chrome-extension://__MSG_@@extension_id__/",a="moz-extension://__MSG_@@extension_id__/",s="safari-web-extension://__MSG_@@extension_id__/",o=self.GR_RESOURCE_ROOT||i,l=self.GR_RESOURCE_ROOT||a,c=self.GR_RESOURCE_ROOT||s;e.exports={__css:r.toString().replace(new RegExp(i,"g"),o).replace(new RegExp(a,"g"),l).replace(new RegExp(s,"g"),c),...r.locals}},5768:(e,t,n)=>{n.d(t,{QU:()=>i,Uv:()=>r,XW:()=>o,_f:()=>a,_p:()=>h,bd:()=>c,dL:()=>s,dd:()=>d,yg:()=>l,ym:()=>u});const r=2,i=20,a=92,s=10,o=["chat.openai.com","gemini.google.com","www.perplexity.ai","perplexity.ai","chatgpt.com","claude.ai","www.wikipedia.org",".wikipedia.org"],l=["docs.google.com"],c=1e4,d=300,h=600,u={howItWorks:"https://grammarly.com",learnMoreTransparency:"https://grammarly.com",learnMoreSafety:"https://grammarly.com",learnMoreControl:"https://grammarly.com",reportAnIssue:"https://support.grammarly.com/hc/en-us"}},47322:(e,t,n)=>{n.r(t),n.d(t,{EditsTrackingControllerImpl:()=>mr});var r=n(90023),i=n(32073),a=n(74822),s=n(59179),o=n(63532),l=n(90572),c=n(20161),d=n(84178),h=n(36344),u=n(66878),m=n(17613),p=n(13391),g=n(58303),_=n(52341),f=n(72257),k=n(7849),v=n(36334),b=n(4603),y=n(5669),C=n(33874),S=n(34967),w=n(1124),x=n(28440),E=n(48546),I=n(3492),T=n(69088),D=n(44071),A=n(32734),R=n(10883),L=n(97092),M=n(31403),B=n(18827),P=n(29416),U=n(17543),G=n(84714),F=n(954),O=n(18519),N=n(64715),H=n(8065),$=n(79256),z=n(31789),W=n(37636),K=n(14969),Z=n(99836),Y=n(70932);const j="document_state",V="document_state_enc";class q extends Error{constructor(e,t){super(e),this._reason=t}get reason(){return this._reason}}class Q extends q{}class J extends q{}class X extends q{}class ee extends q{}class te extends q{}class ne extends ee{}function re(e,t=ee){return e instanceof q?e:new t(e.message,e)}var ie,ae,se,oe;!function(e){let t;!function(e){e.create=function(e){return{timestamp:e.timestamp,delta:e.delta,copyContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return t.timestamp&&!isNaN(t.timestamp)&&t.delta?{timestamp:Number(t.timestamp),delta:t.delta,sourceContentId:t.copyContentId?String(t.copyContentId):void 0,isSelfAuthored:t.isSelfAuthored}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(ie||(ie={})),function(e){let t,n;!function(e){e.create=function(e){return{timestamp:e.timestamp,text:e.char,copiedContentId:void 0!==e.sourceContentId&&null!==e.sourceContentId&&""!==e.sourceContentId?e.sourceContentId:void 0,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return void 0!==t.text&&t.text.length&&t.timestamp&&void 0!==t.isSelfAuthored?{char:String(t.text),timestamp:Number(t.timestamp),sourceContentId:t.copiedContentId?String(t.copiedContentId):void 0,isSelfAuthored:Boolean(t.isSelfAuthored)}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e){return{character:e.char,timestamp:e.timestamp,sourceContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}}}(n=e.Backend||(e.Backend={})),e.is=function(e){return null!==e}}(ae||(ae={})),function(e){let t;e.create=function(e,t,n,r,i){let a=[],s=[],o=[];return r&&((0,m.kG)(n.length==r.length,`Expected that the text length ${n.length} be the same as the Char[] length ${r.length}`),a=r.map((e=>e.timestamp)),s=r.map((e=>e.isSelfAuthored)),o=r.map((e=>e.sourceContentId||null))),{id:crypto.randomUUID(),url:e,sourceName:t,text:n,timestamps:a,isSelfAuthoredTags:s,originalSourceContentIds:o,prompt:i}},function(e){e.create=function(e){return{id:e.id,url:e.url,sourceName:e.sourceName,text:e.text,timestamps:e.timestamps,isSelfAuthoredTags:e.isSelfAuthoredTags,originalCopiedContentIds:e.originalSourceContentIds,prompt:e.prompt||null}},e.parse=function(e){try{const t=e;if(t.id&&t.url&&t.sourceName&&t.text&&Array.isArray(t.timestamps)&&Array.isArray(t.isSelfAuthoredTags)&&Array.isArray(t.originalCopiedContentIds)){const e=t.timestamps.filter((e=>!isNaN(e))),n=t.isSelfAuthoredTags.map(Boolean),r=t.originalCopiedContentIds.filter((e=>null===e||"string"==typeof e));return e.length===n.length&&n.length===r.length?{id:t.id,url:t.url,sourceName:t.sourceName,text:t.text,timestamps:e,isSelfAuthoredTags:n,originalSourceContentIds:r,prompt:t.prompt||void 0}:null}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(se||(se={})),function(e){let t,n;e.empty=function(e){return{id:e,chars:[],sourcedContentStore:{kind:"internal",data:[]},deltaEdits:[]}},function(e){e.create=function(e){return{id:e.id,chararray:e.chars.map(ae.Legacy.create),copyStore:{storeType:e.sourcedContentStore.kind,data:e.sourcedContentStore.data.map(se.Legacy.create)},deltas:e.deltaEdits.map(ie.Legacy.create)}},e.parse=function(e){try{const t=e;if(t.id&&Array.isArray(t.chararray)&&t.copyStore&&t.copyStore.storeType&&Array.isArray(t.copyStore.data)&&Array.isArray(t.deltas)){const e=t.chararray.map(ae.Legacy.parse).filter(ae.is),n=t.copyStore.data.map(se.Legacy.parse).filter(se.is),r=t.deltas.map(ie.Legacy.parse).filter(ie.is);return e.length!==t.chararray.length||n.length!==t.copyStore.data.length||r.length!==t.deltas.length?null:{id:t.id,chars:e,sourcedContentStore:{kind:t.copyStore.storeType,data:n},deltaEdits:r}}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e,t){return{documentId:e.id,chars:e.chars.map(ae.Backend.create),sourcedContentStore:{kind:e.sourcedContentStore.kind,data:e.sourcedContentStore.data},deltaEdits:e.deltaEdits,title:t}}}(n=e.Backend||(e.Backend={}))}(oe||(oe={}));const le="AES-GCM",ce={name:le},de={length:256,...ce};function he(e){return{iv:e,...ce}}function ue(){if(!self.crypto)throw new ee("Crypto API is not supported in this browser")}async function me(e){ue();const t=await self.crypto.subtle.exportKey("raw",e);return new Uint8Array(t)}var pe=n(94631);class ge{static ofRequest(e){return new Promise(((t,n)=>{e.onsuccess=n=>t(e.result),e.onerror=t=>n(e.error)}))}static ofTransaction(e){return new Promise(((t,n)=>{e.oncomplete=e=>t(),e.onerror=t=>n(e.error)}))}}function _e(e){return t=>`${e}-${t}`}function fe(e){return function(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n].toString(16).padStart(2,"0");return t.join("")}((0,pe.Bk)((new TextEncoder).encode(e)))}class ke{serialize(e){return Promise.resolve(oe.Legacy.create(e))}deserialize(e){const t=oe.Legacy.parse(e);return t?Promise.resolve(t):Promise.reject(new J("Document could not be parsed"))}}class ve{constructor(e,t){this.keychain=t,this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder,this.uniqId=_e(e),this.userId=e}async serialize(e){try{const t=await this.keychain.getOrProvisionKey(e.id,this.userId),n=JSON.stringify(e),r=this.textEncoder.encode(n),i=await async function(e,t){ue();const n=self.crypto.getRandomValues(new Uint8Array(12));return{iv:n,encrypted:await self.crypto.subtle.encrypt(he(n),t,e)}}(r,t);return{id:this.uniqId(e.id),documentId:e.id,data:i}}catch(e){throw re(e,ee)}}async deserialize(e){const{documentId:t,data:n}=e,r=await this.keychain.getKey(t,this.userId);if(!r)throw new J("Key not found for document");try{const e=await function(e,t){ue();const{iv:n,encrypted:r}=e;return self.crypto.subtle.decrypt(he(n),t,r)}(n,r);return JSON.parse(this.textDecoder.decode(e))}catch(e){throw re(e,J)}}}class be{constructor(e,t,n,r,i,a){this.userId=e,this.documentId=t,this.keychain=n,this._onReadCallback=r,this._onReadErrorCallback=i,this._onWriteResultCallback=a,this._initialized=p.h.create(!1),this._initialHistoryLength=null,this._encryptionSerializer=new ve(this.userId,this.keychain),this._legacySerializer=new ke,this._log=Y.Y.create("HWRStorage"),this.uniqId=_e(e)}async reload(){if(this._log.info("reload"),this._db=await this._openDb(),!this._db)return this._log.error("Cannot open db"),void this._onReadErrorCallback(new ne);try{const e=await this._fetchFromEncrypted(this._db);if(e)return void this._onReadSuccess(e);const t=await this._fetchFromLegacy(this._db);t?(await this._migrateToEncrypted(this._db,t),this._onReadSuccess(t)):this._onReadErrorCallback(new Q)}catch(e){this._onReadErrorCallback(re(e))}finally{this._initialized.set(!0)}}async writeDocumentState(e){if(await this._isInitialized(),!this._db)return void this._onWriteResultCallback("error",new ne);const t=(0,Z.Tb)().humanWritingReport;if(null!==this._initialHistoryLength&&this._initialHistoryLength>e.deltaEdits.length){const n=`Document history was lost: ${this._initialHistoryLength} -> ${e.deltaEdits.length}`;t.error("storageError",n)}try{const t=await this._encryptionSerializer.serialize(e),n=this._db.transaction([V],"readwrite");n.objectStore(V).put(t),await ge.ofTransaction(n),this._onWriteResultCallback("success")}catch(e){return void this._onWriteResultCallback("error",re(e))}}async _fetchFromEncrypted(e){const t=this.uniqId(this.documentId),n=e.transaction([V],"readonly"),r=n.objectStore(V),i=await ge.ofRequest(r.get(t));return await ge.ofTransaction(n),i?await this._encryptionSerializer.deserialize(i):null}async _fetchFromLegacy(e){if(!e.objectStoreNames.contains(j))return null;const t=this.documentId,n=e.transaction([j],"readonly"),r=n.objectStore(j),i=await ge.ofRequest(r.get(t));return await ge.ofTransaction(n),i?await this._legacySerializer.deserialize(i):null}async _migrateToEncrypted(e,t){this._log.info("Migrating document to encrypted storage");try{const n=t.id,r=await this._encryptionSerializer.serialize(t),i=e.transaction([V,j],"readwrite");i.objectStore(V).put(r),i.objectStore(j).delete(n),await ge.ofTransaction(i)}catch(e){const t=(0,Z.Tb)().humanWritingReport,n=(null==e?void 0:e.message)||"Unknown error";throw t.error("storageError",`Couldn't migrate document to encrypted storage: ${n}`),re(e)}}_isInitialized(){return(0,E.n)(this._initialized.pipe(l.h((e=>e)),K.P()))}async _openDb(){const e=indexedDB.open("human_writing_report",2);e.onupgradeneeded=this._onUpgradeNeeded.bind(this);try{return await ge.ofRequest(e)}catch(e){return null}}_onUpgradeNeeded(e){const t=e.target,n=t.result;if(t.result&&t.transaction)try{n.objectStoreNames.contains(V)||n.createObjectStore(V,{keyPath:"id",autoIncrement:!1})}catch(e){this._onReadErrorCallback(re(e))}else this._onReadErrorCallback(new ne)}_onReadSuccess(e){this._onReadCallback(e),null===this._initialHistoryLength&&(this._initialHistoryLength=e.deltaEdits.length)}}var ye=n(97521);class Ce{constructor(e){this._client=e}async getKey(e,t){const n=Ce.createKeyId(e),r=await this.fetchKey(n,t);if(!r)return null;const i=(0,ye.K9)(r);return await function(e,t=!1,n=["encrypt","decrypt"]){return ue(),self.crypto.subtle.importKey("raw",e,le,t,n)}(i)}async getOrProvisionKey(e,t){let n=0;for(;n<=3;)try{return await this.getKey(e,t)||await this.provisionKey(e,t)}catch(e){if(e instanceof te){if(n++<=2)continue;if(e.reason)throw re(e.reason,ee);throw new ee("Too many retries")}throw re(e)}throw new ee("Too many retries")}async provisionKey(e,t){const n=Ce.createKeyId(e),r=await(ue(),self.crypto.subtle.generateKey(de,!0,["encrypt","decrypt"]));return await this.storeKeys([{keyId:n,key:r}],t),r}static createKeyId(e){return fe("key-"+e)}async fetchKey(e,t){const n=await this._client.getEncryptionKey({keyId:e,userId:t});return null==n?void 0:n.keyMaterial}async storeKeys(e,t){const n=[];for(const t of e){const e=await me(t.key);n.push({id:t.keyId,keyMaterial:(0,ye.J2)(e)})}await this._client.createEncryptionKeys({keys:n,userId:t})}}var Se=n(93018),we=n(5768),xe=n(79992),Ee=n(36482),Ie=n(11456),Te=n(68485),De=n(38508);function Ae(e){return"Enter"===e.key?"\n":"Tab"===e.key?"\t":"Backspace"===e.key||"Delete"===e.key?"":e.key}function Re(e,t,n=3){var r;let i=0;const a=Math.min(e.length,t.length,n)-1;for(let n=a;n>=0&&e[e.length-1-n]===(null===(r=t[a-n])||void 0===r?void 0:r.key);n--)i++;return i}function Le(e,t,n){if(0===t.length)return 0;const r=(0,k.k4)(n,e,t);return r>0?r:e.ops.reduce(((e,r,i,a)=>{if(e.eventsIndex>=t.length)return i!==a.length-1||!("delete"in r)||"insert"in r&&""!==r.insert?{...e,matched:0,eventsIndex:e.eventsIndex}:e;if("retain"in r){const s=function(e,t,n,r,i,a){const s=Re(a.substring(0,t.textIndex+n.retain),e);if(s){let n=t.eventsIndex+s,o=t.textIndex+s;r.slice(i+1).every((t=>{var r;if("retain"in t){if(!(0,k.fo)(a.substring(o,o+t.retain),e.slice(n)))return!1;n+=t.retain,o+=t.retain}if("delete"in t){if(""!==(null===(r=e[n])||void 0===r?void 0:r.key)&&void 0!==e[n])return!1;n+=t.delete}if("insert"in t){const r=t.insert;if(!(0,k.fo)(r,e.slice(n)))return!1;n+=r.length}return!0}))&&(t.matched+=s,t.eventsIndex+=s)}return t.textIndex+=n.retain,t}(t,e,r,a,i,n);e.eventsIndex=s.eventsIndex,e.matched=s.matched,e.textIndex=s.textIndex}if("delete"in r&&r.delete>0){const n=function(e,t,n){t.textIndex+=n.delete;for(;t.eventsIndex<e.length&&""===e[t.eventsIndex].key;)t.matched+=1,t.eventsIndex+=1;return t}(t,e,r);e.eventsIndex=n.eventsIndex,e.matched=n.matched,e.textIndex=n.textIndex}if("insert"in r){const n=function(e,t,n){const r=n.insert,i=e.slice(t.eventsIndex);if(!(0,k.fo)(r,i))return{...t,matched:0,eventsIndex:1/0};{let e=0;if(i[0].repeat){let t=i.shift();const n=null==t?void 0:t.key;for(;t&&(t.repeat&&t.key===n||/^\d$/.test(t.key));)e++,t=i.shift()}else e=r.length;t.matched+=e,t.eventsIndex+=e}return t}(t,e,r);e.eventsIndex=n.eventsIndex,e.matched=n.matched,e.textIndex=n.textIndex}return e}),{matched:0,eventsIndex:0,textIndex:0}).matched}const Me=n(72138);function Be(e,t,n){var r;let i=null,a=0;try{if(t.length&&e.inserted.length===t.length+1&&1===e.deleted.length&&e.deleted.toUpperCase()===e.inserted[0]&&t.some((e=>/^\s$/.test(e.key)))&&Re(e.inserted.slice(1),t,t.length))i=se.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),a=Re(e.maximalReplacement,t);else if(t.length&&e.deleted.length>0&&e.deleted.length<=we.QU&&e.maximalReplacement.startsWith(`${e.deleted[0].toUpperCase()}${e.deleted.substring(1)}`)){const n=e.maximalReplacement.substring(e.deleted.length),r=n.split("").filter(((e,n)=>e===t[n].key)).length;r===n.length&&(i=se.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),a=r)}else t.length&&e.inserted.length<=we.QU&&/\S[\s)."'?!]$/.test(e.inserted)&&(Me(e.maximalReplacement,e.deleted)<=e.deleted.length/1.5||e.inserted.length+e.deleted.length<e.retained.length/1.5)&&e.maximalReplacement[e.maximalReplacement.length-1]===t[0].key?(i=se.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),a=1):0==e.deleted.length&&e.inserted.length<=we._f&&e.inserted.trim().length>0&&"\t"===(null===(r=t[0])||void 0===r?void 0:r.key)&&(i=se.create("hwr://delta/rewrite/google/completion/","Google Docs Smart Compose Suggestions",e.maximalReplacement),a=1)}catch(e){n.error("getMatch has thrown",e)}return i&&n.debug(`[GoogleDocsSuggestionStore] getMatch('${e.maximalReplacement}') returning:`,i),i?{sourcedContent:i,matchedTrustedEventsCount:a}:null}class Pe{constructor(){this._log=Y.Y.create("GoogleDocsSourcedContentStore")}getMatch(e,t){return Promise.resolve(Be(e,t,this._log))}getSyncMatch(e,t){return Be(e,t,this._log)}}var Ue,Ge=n(96837);!function(e){e.Internal="internal",e.Selection="selection",e.GrammarlyPrevious="grammarly-previous",e.GrammarlyCurrent="grammarly-current",e.GrammarlyApplied="grammarly-applied",e.External="external",e.GDocs="gdocs",e.Startup="startup",e.Temporary="temporary",e.Test="test"}(Ue||(Ue={}));class Fe{constructor(e,t=[],n=1/0){this.kind=e,this.data=t,this._maxRecordsCount=n,this._sourcedContentById=new Map,this.data.forEach((e=>{this._sourcedContentById.set(e.id,e)})),this._log=Y.Y.create(`[${this.kind}] ${Fe.name}`),this._keepLastN()}getMatch(e,t){var n;let r=this.data;t&&(r=this.data.filter(t));const i=e.inserted.length&&e.inserted===e.deleted?e.inserted.trim():e.maximalReplacement.trim(),a=r.find((({text:e})=>e.trim()===i))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getMatch('${(0,k.aS)(e.maximalReplacement,40)}') returning:`,a),a}getFuzzyMatch(e,t){var n;const r=e.maximalReplacement,i=(1-t)*r.length,a=this.data.find((e=>{var t,n;const a=(0,k.$2)(e.text),s=Ge.zI.diffAsChanges(a,r);return null===(t=this._log)||void 0===t||t.info(`[FuzzyMatch] text length: ${r.length}, amount changed: ${s.amount}`),null===(n=this._log)||void 0===n||n.info("Delta",s),s.amount<=i&&!k.Hq.hasPerLetterTags(e)}))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getFuzzyMatch('${(0,k.aS)(r,40)}') returning:`,a),a}getContentById(e){return this._sourcedContentById.get(e)||null}addContent(e){var t;null===(t=this._log)||void 0===t||t.debug("addContent",e),this._sourcedContentById.has(e.id)||(this.data.push(e),this._sourcedContentById.set(e.id,e),this._keepLastN())}_keepLastN(){this.data.length<=this._maxRecordsCount||(this.data.slice(0,this.data.length-this._maxRecordsCount).forEach((({id:e})=>{this._sourcedContentById.delete(e)})),this.data=this.data.slice(-this._maxRecordsCount))}}class Oe{constructor(e,t,n,r,i){this.text=e,this.delta=t,this.timestamp=n,this.sourcedContent=r,this.isWholeDeltaSelfAuthored=i,null!=r&&r.timestamps.length>0&&((0,m.kG)(e.length==r.timestamps.length),(0,m.kG)(e.length==r.isSelfAuthoredTags.length),(0,m.kG)(e.length==r.originalSourceContentIds.length))}getCharAt(e){var t,n,r;const i=null!=this.sourcedContent?this.sourcedContent.timestamps:[],a=(null===(t=this.sourcedContent)||void 0===t?void 0:t.isSelfAuthoredTags)||[],s=(null===(n=this.sourcedContent)||void 0===n?void 0:n.originalSourceContentIds)||[];let o=this.timestamp;const l=this.isWholeDeltaSelfAuthored||!!this.sourcedContent&&Boolean(a[e]);let c=(null===(r=this.sourcedContent)||void 0===r?void 0:r.id)||null;return i.length>0&&(o=i[e],c=s[e]||c),{char:this.text[e],timestamp:o,sourceContentId:c||void 0,isSelfAuthored:l}}}class Ne{constructor(e,t,n,r,a){this._documentId=e,this._sessionId=t,this._events=n,this._trustedEvents=r,this._initialized=p.h.create(!1),this._chars=[],this._deltaEdits=[],this._log=Y.Y.create("ChangeTrackerImpl"),this._lastClientInfo=null,this._lastSessionId=null,this._subs=new i.w0,this._felog=(0,k.Cc)({variant:"legacy tracking",documentId:e});const{buildInfo:s,appConfig:o}=a.config;this._currentClientInfo={clientName:o.gnar.appName,version:s.version},this._internalCopyStore=new Fe(Ue.Internal,[]),this._internalSelectionStore=new Fe(Ue.Selection,[],2),this._prevGrammarlyAlerts=new Fe(Ue.GrammarlyPrevious),this._currentGrammarlyAlerts=new Fe(Ue.GrammarlyCurrent),this._externalCopyStore=new Fe(Ue.External,[],4),this._googleDocsSourcedContentStore=new Pe,this.startupCopyStore=new Fe(Ue.Startup,[],4),this._subs.add(this._events.pipe(l.h((e=>"genAIResultCopied"===e.kind))).subscribe((e=>this._handleGenAICopyEvents(e.text,e.prompt))))}async updateKnownDocumentState(e,t){if(this._deltaEdits.length>0&&e.deltaEdits.length<this._deltaEdits.length)return this._felog.error("storageError","Document in the storage is older than the current one",void 0,{documentId:this._documentId,currentHistoryLength:this._deltaEdits.length,storageHistoryLength:e.deltaEdits.length,lastCurrentDeltaEdit:this._deltaEdits[this._deltaEdits.length-1],lastStorageDeltaEdit:e.deltaEdits[e.deltaEdits.length-1]}),void this._log.error("Document in the storage is older than the current one");if(this._initialized.get()&&this._documentId!==e.id){const t="Document id mismatch in state update";this._felog.error("changeTracking",t,void 0,{incomingDocumentId:e.id}),this._log.error(t)}this._chars=e.chars,this._internalCopyStore=new Fe(Ue.Internal,e.sourcedContentStore.data),this._deltaEdits=e.deltaEdits;const n=this._deltaEdits.reduce(((e,t)=>{let n=e;return t.clientInfo&&(n={...n,clientInfo:t.clientInfo}),t.sessionId&&(n={...n,sessionId:t.sessionId}),n}),{clientInfo:null,sessionId:null});this._lastClientInfo=n.clientInfo,this._lastSessionId=n.sessionId,this._initialized.set(!0);const r=k.QY.singleDelta(e.chars.map((e=>e.char)).join(""),t);if(k.QY.isNoTextChangesDelta(r))this._log.info("No changes since last known state."),this._events.next({kind:"knownStateMatch"});else{this._log.info("Known document state is different from current",r);const e=Math.abs(k.QY.getNumInsertedLetters(r)+k.QY.getNumDeletedLetters(r));this._events.next({kind:"knownStateMismatch",lengthDifference:e}),this._felog.info("Untracked text found",void 0,{documentLength:t.length,untrackedDiffLength:e})}r.forEach((e=>{Se.s.isInsertString(e)&&this.startupCopyStore.addContent(se.create("hwr://delta/startup/","Delta on Document load",e.insert))})),await this.onTextChange(r)}async onTextChange(e){if(0===e.ops.length)return 0;const t=Se.s.normalizeDelta(Se.s.cleanAllAttrs(e));const n=Le(t,this._trustedEvents.get(),this._chars.map((e=>e.char)).join(""));n||this._log.debug("delta is not typed",{normalizedDelta:t,trustedEvents:this._trustedEvents.get()});const r=Date.now(),{deltaEdit:i,matchedTrustedEventsCount:a}=await this._applyDelta(t,r,n);return this._lastClientInfo=this._currentClientInfo,this._lastSessionId=g.WG(this._sessionId.get()),this._deltaEdits.push(i),n||a}onSelectionChange(e){e.forEach((e=>{if(e.start!=e.end&&e.end-e.start>1){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._internalSelectionStore.addContent(se.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",t,n)),this._events.next({kind:"sourceAdded",textLength:e.end-e.start,sourceDomain:self.location.origin,promptDetected:!1})}}))}onAlertChange(e){const t=new Fe(Ue.Temporary);for(const[n,r]of Object.entries(e)){if(void 0===r||!Ie.S.isCapiAlert(r))continue;const e=r.text;r.replacements.forEach((r=>{const i=k.QY.extractMaximalReplacementString(e,k.QY.singleDelta(e,r));i&&t.addContent(se.create("hwr://delta/rewrite/grammarly/correct/?id="+n,"Grammarly edited: ("+e+" -> "+r+")",i))}))}k.Hq.eq(t.data,this._currentGrammarlyAlerts.data)||(this._prevGrammarlyAlerts=new Fe(Ue.GrammarlyPrevious,this._currentGrammarlyAlerts.data),this._currentGrammarlyAlerts=new Fe(Ue.GrammarlyCurrent,t.data))}addCopiedTextToExternalStore(e){if(!e.valid)return;const t=e.copiedText||"";null==this._externalCopyStore.getMatch(k.QY.getSummary("",(new I.i).insert(t)))&&this._externalCopyStore.addContent(se.create(e.sourceURL||"",e.sourceName||"",t,void 0,e.userPrompt))}onReplacementApplied(e,t){if(e===Te.P.snippets||e===Te.P.oggyGenAI){let n="";void 0!==t.pos&&(n=this._chars.slice(t.pos.start,t.pos.end).map((e=>e.char)).join(""));const r=k.QY.extractMaximalReplacementString(n,"string"==typeof t.value?k.QY.singleDelta(n,t.value):t.value);r&&this._internalCopyStore.addContent(se.create("hwr://delta/rewrite/grammarly/"+e,"Grammarly generated ("+e+")",r))}}getDocumentState(){if(!this._initialized.get())throw new Error("ChangeTracker is not initialized");return{id:this._documentId,chars:this._chars,sourcedContentStore:{kind:"internal",data:this._internalCopyStore.data},deltaEdits:this._deltaEdits}}getReportableDocument(){if(!this._initialized.get())throw new Error("ChangeTracker is not initialized");return oe.Backend.create(this.getDocumentState(),document.title)}getTextInfoForAlert(e){const t=[];return(0,Ee.C)(e).forEach((e=>{if("transform"==e.meta.rangePurpose)for(let n=e.start;n<e.end;++n)t.push({...this._chars[n]})})),t}_applySingleDeletion(e,t){this._chars.splice(e,t)}_applySingleInsertion(e,t){const n=t.text.length,r=Array.from({length:n},((e,n)=>t.getCharAt(n)));this._chars.splice(e,0,...r)}async _searchAllCopyStores(e){let t=this._prevGrammarlyAlerts.getMatch(e);if(t)return{storeKind:Ue.GrammarlyPrevious,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._internalCopyStore.getMatch(e,(e=>"hwr://delta/startup/"!=e.url)),t)return{storeKind:this._internalCopyStore.kind,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._internalSelectionStore.getMatch(e),t)return{storeKind:Ue.Selection,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._externalCopyStore.getMatch(e),t)return{storeKind:Ue.External,sourcedContent:t,matchedTrustedEventsCount:0};const n=await this._googleDocsSourcedContentStore.getMatch(e,this._trustedEvents.get());return n?{storeKind:Ue.GDocs,sourcedContent:n.sourcedContent,matchedTrustedEventsCount:n.matchedTrustedEventsCount}:(t=this.startupCopyStore.getMatch(e),t?{storeKind:Ue.Startup,sourcedContent:t,matchedTrustedEventsCount:0}:(t=this._externalCopyStore.getFuzzyMatch(e,.95),t?{storeKind:Ue.External,sourcedContent:t,matchedTrustedEventsCount:0}:null))}async _applyDelta(e,t,n){let r=null,i=0;const a=this._chars.map((e=>e.char)).join(""),s=k.QY.getSummary(a,e),o=Se.s.normalizeDelta(Se.s.cleanAllAttrs(k.QY.singleDelta(a,(0,De.l)(e,a)))),l=n>0&&s.maximalReplacement.length<=we.dL;n>0&&s.maximalReplacement.length>we.dL&&this._felog.error("changeTracking","False positive typed match",void 0,{insertionLength:s.maximalReplacement.length,matchedLength:n,trustedEvents:(0,k.tg)(this._trustedEvents.get())}),this._log.debug("_applyDelta summary",s);const c=s.deleted.length&&s.deleted===s.inserted,d=c?s:k.QY.getSummary(a,o),h=c?e:o;let u=null;l||(u=d.maximalReplacement.length?await this._searchAllCopyStores(d):null),r=(null==u?void 0:u.sourcedContent.id)||null,u&&u.storeKind!=Ue.Internal&&this._internalCopyStore.addContent(u.sourcedContent);for(const e of h.ops)Se.s.isRetain(e)?i+=e.retain:Se.s.isInsertString(e)?(this._applySingleInsertion(i,new Oe(e.insert,h,t,(null==u?void 0:u.sourcedContent)||null,l)),i+=e.insert.length):Se.s.isDelete(e)&&(this._trackDeletion(i,e.delete),this._applySingleDeletion(i,e.delete));if(!l&&r){const e=this._internalCopyStore.getContentById(r);e?this._events.next({kind:"sourcedTextAdded",sourceDomain:(0,k.Xw)(e.url),textLength:d.maximalReplacement.length,promptDetected:Boolean(e.prompt)}):this._events.next({kind:"unknownSourceTextAdded",textLength:d.maximalReplacement.length})}else l||this._events.next({kind:"unknownSourceTextAdded",textLength:d.maximalReplacement.length});const m=g.WG(this._sessionId.get());return{deltaEdit:{timestamp:t,delta:h,sourceContentId:r||void 0,isSelfAuthored:l,clientInfo:(0,xe.fS)(this._currentClientInfo,this._lastClientInfo)?void 0:this._currentClientInfo,sessionId:this._lastSessionId===m?void 0:m||void 0},matchedTrustedEventsCount:(null==u?void 0:u.matchedTrustedEventsCount)||0}}_trackDeletion(e,t){const n=Array.from({length:t},((t,n)=>this._chars[e+n])),r=n.map((e=>e.char)).join("");this._onCopyDelete(r,n)}_onCopyDelete(e,t){e.length>=we.Uv&&this._internalCopyStore.addContent(se.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",e,t))}onCopy(e){e.forEach((e=>{if(e.start!=e.end){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._onCopyDelete(t,n)}}))}_getCSSFormatForLetter(e){const t="color: red;",n="color: black;",r=e.sourceContentId,i=null!=r?this._internalCopyStore.getContentById(r):null;let a;return a=null!=i?i.url.match(/delta\/rewrite\/grammarly\/(oggyGenAI|snippets)/)?"color: blue;":i.url.match("delta/rewrite/grammarly/correct")?"color: green;":i.url.match(/(chat.openai.com|chatgpt.com)/)?"color: purple;":i.url.match("gemini.google.com")?"color: orange;":i.url.match("delta/rewrite/google")?"color: teal;":i.url.match("delta/startup")?t:e.isSelfAuthored?n:t:e.isSelfAuthored?n:t,a}_logText(){const e=this._chars.map((e=>`%c${e.char}`)).join(""),t=this._chars.map((e=>this._getCSSFormatForLetter(e)));self.console.log(`HWR: ${e}`,...t)}_handleGenAICopyEvents(e,t){e.length&&this._internalCopyStore.addContent(se.create(`hwr://delta/rewrite/grammarly/${Te.P.oggyGenAI}`,`Grammarly generated (${Te.P.oggyGenAI})`,e,void 0,t))}dispose(){this._subs.unsubscribe()}}const He=4096;function $e(){const e=Y.Y.create("HWRLETEL");return function(t){let n="";if("contentChanges"===t.kind){const e=t.data;n=JSON.stringify({...e,deltaChange:{...e.deltaChange,delta:JSON.parse(JSON.stringify(e.deltaChange.delta))}})}else if("keyboardEvent"===t.kind){const e=t.data;n=JSON.stringify({isTrusted:e.isTrusted,altKey:e.altKey,charCode:e.charCode,code:e.code,composed:e.composed,ctrlKey:e.ctrlKey,isComposing:e.isComposing,key:e.key,keyCode:e.keyCode,location:e.location,metaKey:e.metaKey,repeat:e.repeat,shiftKey:e.shiftKey,type:e.type,which:e.which})}else n=JSON.stringify(t.data);for(let r=0;r<n.length/He;r++){const i={timestamp:t.timestamp,kind:t.kind,append:r>0,string:n.substring(He*r,He*(r+1))};e.info(t.kind,JSON.stringify(i))}}}class ze{constructor(e,t,n,r,i,s,o,l,c,d,h,u){this._listenerId=e,this._alertsState=t,this._textObserver=n,this._selectionSource=r,this._CSState=i,this._replacementListener=s,this._events=o,this._encryptionService=l,this._errors=c,this._keyboardEventsSource=d,this._env=h,this._sessionId=u,this._subs=new T.Lv,this._trackingState=p.h.create("dormant"),this._documentRetrievalState=p.h.create("dormant"),this._reportRequestInProcess=p.h.create(!1),this._textChangeProcessingState=p.h.create("idle"),this._log=Y.Y.create("HWRListenerImpl"),this._documentVisibilityObs=D.R(document,"visibilitychange").pipe(A.B()),this._documentStateSubj=new a.x,this._writeToStorageRequestSubj=new a.x,this._trustedEvents=p.h.create([]),this._integrationTestsEventsLogger=$e(),this._advancedLoggingEnabled=i.view("page","advancedHistoryLoggerEnabled"),this._setupKeyboardEventsHandling(),this._log.info("Document id",e);const m=new W.m;this._documentId=m.documentID||this._listenerId,this._felog=(0,k.Cc)({variant:"legacy tracking",documentId:this._documentId}),this._changeTracker=new Ne(this._documentId,this._sessionId,o,this._trustedEvents,this._env);const g=i.view("user").view("id").get();this._keychain=new Ce(this._encryptionService),this._hwrStorage=new be(g,this._documentId,this._keychain,(e=>{this._log.info("Document state read: success"),this._documentStateSubj.next(e),this._felog.info("Saved report retrieved",void 0,{historyLength:e.deltaEdits.length})}),(e=>{this._log.error("Storage read error:",e),this._handleStorageError(e)}),((e,t)=>{t?(this._log.error("Storage write error:",t),this._handleStorageError(t)):this._log.info("Storage write status",e)})),this._log.info("HWR Storage initialized"),this._setupEventHandlers(),this._felog.info("Init")}_logIntegrationTestsEvent(e){this._advancedLoggingEnabled.get()&&this._integrationTestsEventsLogger({...e,timestamp:Date.now()})}_handleStorageError(e){e instanceof Q?(this._felog.info("New report created",void 0,{documentLength:this._textObserver.getCurrentTextMap().getPlainText().length}),this._documentStateSubj.next(oe.empty(this._documentId))):e instanceof J?(this._documentStateSubj.next(oe.empty(this._documentId)),this._errors.next({kind:"databaseCorrupted"}),this._felog.error("storageError",`Database corrupted: ${e.name}, '${e.message}'`)):e instanceof X?(this._errors.next({kind:"serverError",errorMessage:e.message}),this._felog.error("storageError",`Server error: ${e.name}, '${e.message}'`)):e instanceof ee?(this._errors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Unrecoverable error: ${e.name}, '${e.message}'`)):(this._errors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Unknown error: ${e.name}, '${e.message}'`))}get changeTracker(){return this._changeTracker}get documentId(){return this._documentId}_setupEventHandlers(){this._subs.add(this._replacementListener.obs.pipe(R.M(this._trackingState),l.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._logIntegrationTestsEvent({kind:"replacement",data:e}),this._changeTracker.onReplacementApplied(e.source,e.replacement)}))),this._subs.add(this._alertsState.subscribe((e=>{this._logIntegrationTestsEvent({kind:"alertState",data:e}),this._changeTracker.onAlertChange(e)})));const e=this._textObserver.contentChanges.async.pipe(l.h((({changes:e})=>e.length>0)),o.b((e=>{this._logIntegrationTestsEvent({kind:"contentChanges",data:e})})),R.M(this._trackingState,this._documentRetrievalState),l.h((([e,t,n])=>"active"===t&&"ok"===n)),s.U((([e])=>e)),A.B());this._subs.add(e.pipe(L.f(this._textChangeProcessingState.pipe(M.a(e.pipe(B.g(0))),l.h((([e])=>"idle"===e)))),l.h((e=>e.length>0)),o.b((e=>{this._log.debug("buffer emit",e.length)}))).subscribe((e=>{this._handleTextChange(e)}))),this._subs.add(this._selectionSource.data.changes.pipe(o.b((e=>{this._logIntegrationTestsEvent({kind:"selectionChange",data:e})})),R.M(this._trackingState),l.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onSelectionChange(e)}))),this._subs.add(this._writeToStorageRequestSubj.pipe(R.M(this._documentRetrievalState),l.h((([e,t])=>"ok"===t)),P.b(1e3)).subscribe((()=>{this._writeToStorage()}))),this._documentVisibilityObs.pipe(s.U((()=>document.hidden)),c.w((e=>U.s((()=>e),G.of(!0),G.of(!1).pipe(B.g(300)))))).subscribe((e=>{e?this._stopTrackingWhenHidden():this._resumeTrackingWhenVisible()})),this._subs.add(this._documentStateSubj.pipe(F.O(null),R.M(this._documentVisibilityObs.pipe(s.U((()=>document.hidden)),F.O(document.hidden)),this._trackingState,this._reportRequestInProcess)).subscribe((([e,t,n,r])=>{t||null==e||"active"!==n&&!r||this._handleDocumentStateChange(e)}))),this._subs.add(this._CSState.view("copiedTextMessage").pipe(o.b((e=>{this._logIntegrationTestsEvent({kind:"copiedTextMessage",data:e})}))).subscribe())}_setupKeyboardEventsHandling(){const e=(0,b.OB)().config.systemInfo.os.isMac;this._subs.add(this._keyboardEventsSource.pipe(o.b((e=>{this._logIntegrationTestsEvent({kind:"keyboardEvent",data:e})})),l.h((t=>t.isTrusted&&(1===t.key.length||"Enter"===t.key||"Tab"===t.key||"Backspace"===t.key||"Delete"===t.key)&&!t.ctrlKey&&(e?!t.metaKey:!t.altKey))),R.M(this._trackingState,this._documentRetrievalState),l.h((([e,t,n])=>"active"===t&&"ok"===n))).subscribe((([e])=>{this._trustedEvents.modify((t=>t.concat({timestamp:Date.now(),key:Ae(e),repeat:e.repeat})))})))}_startTracking(){this.retreiveDocument(),this._changeTracker.addCopiedTextToExternalStore(this._CSState.view("copiedTextMessage").get())}async retreiveDocument(){this._documentRetrievalState.set("waiting"),await this._hwrStorage.reload(),this._documentRetrievalState.set("ok")}startTracking(){this._trackingState.set("active"),this._startTracking(),this._felog.info("Started tracking")}stopTracking(){this._log.info("Stopping document tracking"),this._trackingState.set("paused"),this._documentRetrievalState.set("dormant"),this._felog.info("Stopped tracking")}getReportableDocument(){return this._reportRequestInProcess.set(!0),"dormant"===this._documentRetrievalState.get()&&this.retreiveDocument(),(0,E.n)(this._documentRetrievalState.pipe(l.h((e=>"ok"===e)),d.q(1),O.V(2e3),N.a((e=>e.pipe(H.b(((e,t)=>U.s((()=>t>0),$.P((()=>(this._felog.error("reportGenerationFailed","Cannot get report, retrieval timeout"),z._(new Error("Document state is not OK after 4000ms, failing"))))),G.of(e).pipe(o.b((()=>{this._reportRequestInProcess.set(!1),this._felog.warning("reportGenerationFailed",JSON.stringify({documentId:this.documentId,warning:"Document state is not OK after 2000ms, retrying"}))}))))))))),s.U((()=>this._changeTracker.getReportableDocument())),o.b((()=>this._reportRequestInProcess.set(!1)))))}_stopTrackingWhenHidden(){this._log.info("Pausing document tracking while document is not visible"),this._trackingState.modify((e=>"active"===e?"dormant":e))}_resumeTrackingWhenVisible(){this._log.info("Resuming document tracking after document became visible"),this._trackingState.modify((e=>"paused"===e?e:"active")),"active"===this._trackingState.get()&&this._startTracking()}async _handleDocumentStateChange(e){this._log.info("Got saved or Empty document.",e),await this._changeTracker.updateKnownDocumentState(e,this._textObserver.getCurrentTextMap().getPlainText()),await this._writeToStorage()}async _writeToStorage(){try{await this._hwrStorage.writeDocumentState(this._changeTracker.getDocumentState())}catch(e){this._log.error("Error writing to storage:",e),this._handleStorageError(e)}}async _handleTextChange(e){this._textChangeProcessingState.set("processing");const t=this._CSState.view("copiedTextMessage").get();this._changeTracker.addCopiedTextToExternalStore(t);for(const t of e)if(t.deltaChange.delta.ops.length>0){const e=await this._changeTracker.onTextChange(new I.i(t.deltaChange.delta.ops));this._trustedEvents.modify((t=>t.length-e>15?(this._log.debug("too many unmatched events, clearing them up"),this._felog.error("changeTracking","Too many trusted events left unmatched",void 0,{count:t.length,max:15}),[]):(this._log.debug("cleaned up trusted events",{before:t,after:t.slice(e),matched:e}),t.slice(e))))}this._textChangeProcessingState.set("idle"),this._writeToStorageRequestSubj.next(void 0)}dispose(){this._subs.unsubscribe(),this._changeTracker.dispose(),this._writeToStorage()}}var We=n(26156),Ke=n(53976),Ze=n(2613),Ye=n(29479),je=n(94592),Ve=n(19830),qe=n(8923);class Qe{constructor({documentId:e,sessionId:t,textObserver:n,editsTrackingEvents:r,keyboardEvents:a,selectionChanges:s,alertStateChanges:o,replacementAppliedEvents:c,copiedTextMessage:d,trackingState:h,reportState:u,env:m}){this._exportableSourcedContentStore=new Fe(Ue.Internal,[]),this._internalCopyStore=new Fe(Ue.Internal,[]),this._externalCopyStore=new Fe(Ue.External,[],4),this._selectionStore=new Fe(Ue.Selection,[],2),this._grammarlyStore=new Fe(Ue.GrammarlyApplied,[],10),this._googleDocsSourcedContentStore=new Pe,this._untrackedContentStore=new Fe(Ue.Startup,[],4),this._chars=[],this._deltaEdits=[],this._trustedEvents=p.h.create([]),this._subs=new i.w0,this._log=Y.Y.create("EditsTracker"),this._knownDeltaEditMetadata=p.h.create({clientInfo:null,sessionId:null}),this._readyForEvents=p.h.create(!1),this._documentId=e,this._sessionId=t,this._felog=(0,k.Cc)({variant:"decoupled tracking",documentId:e}),this._editsTrackingEvents=r,this._env=m,this._textObserver=n,this._reportState=u,this._reportState.view((e=>{this._log.info("update",e)})).subscribe(),this._currentDeltaEditMetadata=t.view((e=>({clientInfo:{clientName:m.config.appConfig.gnar.appName,version:m.config.buildInfo.version},sessionId:g.WG(e)}))),this._validDocumentStateUpdates=u.pipe(l.h((e=>Boolean(e&&("new"===e.kind||"storage"===e.kind))))),this._isActive=p.h.combine(this._readyForEvents,h,((e,t)=>e&&"active"===t)),this._subs.add(this._validDocumentStateUpdates.pipe(K.P(),Ye.h(!0)).subscribe(je.wW(this._readyForEvents))),this._subs.add(this._setupTextChangeHandling()),this._subs.add(this._setupTrustedEventsHandling(a)),this._subs.add(this._setupSelectionChangeHandling(s)),this._subs.add(this._setupDocumentStateChangeHandling()),this._subs.add(this._setupEditsTrackingEventsHandling()),this._subs.add(this._setupAlertCollectionChangesHandling(o)),this._subs.add(this._setupReplacementEventsHandling(c)),this._subs.add(this._setupCopiedTextMessageHandling(d))}_setupTextChangeHandling(){return this._textObserver.contentChanges.async.pipe(Ve.u(this._validDocumentStateUpdates),R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((e=>{this._handleTextChange(new I.i(e.deltaChange.delta.ops))}))}_setupTrustedEventsHandling(e){const t=this._env.config.systemInfo.os.isMac;return e.pipe(l.h((e=>e.isTrusted&&(1===e.key.length||"Enter"===e.key||"Tab"===e.key||"Backspace"===e.key||"Delete"===e.key)&&!e.ctrlKey&&(t?!e.metaKey:!e.altKey))),R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((e=>{this._trustedEvents.modify((t=>t.concat({timestamp:Date.now(),key:Ae(e),repeat:e.repeat})))}))}_setupSelectionChangeHandling(e){return e.pipe(R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((e=>this._handleSelectionChange(e)))}_setupDocumentStateChangeHandling(){return this._validDocumentStateUpdates.pipe(R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((e=>this._handleDocumentUpdate(e)))}_setupEditsTrackingEventsHandling(){this._editsTrackingEvents.pipe(R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e)),l.h((e=>"genAIResultCopied"===e.kind))).subscribe((e=>this._handleGenAICopyEvents(e.text,e.prompt)))}_setupAlertCollectionChangesHandling(e){return e.pipe(R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e)),s.U((({removedAlerts:e})=>(this._log.info("removedAlerts",e),e.filter((({reason:e})=>e._tag===qe.i.alertAccepted))))),l.h((e=>e.length>0))).subscribe((e=>this._handleAppliedAlerts(e)))}_setupReplacementEventsHandling(e){return e.pipe(R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((e=>this._handleReplacementApplied(e.source,e.replacement)))}_setupCopiedTextMessageHandling(e){return e.pipe(R.M(this._isActive),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((e=>this._handleCopiedTextMessage(e)))}_handleCopiedTextMessage(e){if(!e.valid)return;const t=e.copiedText||"";null==this._externalCopyStore.getMatch(k.QY.getSummary("",(new I.i).insert(t)))&&this._externalCopyStore.addContent(se.create(e.sourceURL||"",e.sourceName||"",t,void 0,e.userPrompt))}_handleAppliedAlerts(e){for(const t of e){if(void 0===t||!Ie.S.isCapiAlert(t.alert))continue;const e=t.alert.text;t.alert.replacements.forEach((n=>{const r=k.QY.extractMaximalReplacementString(e,k.QY.singleDelta(e,n));r&&this._grammarlyStore.addContent(se.create("hwr://delta/rewrite/grammarly/correct/?id="+t.alert.id,"Grammarly edited: ("+e+" -> "+n+")",r))}))}}_handleReplacementApplied(e,t){if(e===Te.P.snippets||e===Te.P.oggyGenAI){let n="";void 0!==t.pos&&(n=this._chars.slice(t.pos.start,t.pos.end).map((e=>e.char)).join(""));const r=k.QY.extractMaximalReplacementString(n,"string"==typeof t.value?k.QY.singleDelta(n,t.value):t.value);r&&this._grammarlyStore.addContent(se.create("hwr://delta/rewrite/grammarly/"+e,"Grammarly generated ("+e+")",r))}}_pruneTrustedEvents(e){this._trustedEvents.modify((t=>t.length-e>15?(this._log.debug("too many unmatched events, clearing them up"),this._felog.error("changeTracking","Too many trusted events left unmatched",void 0,{count:t.length,max:15}),[]):(this._log.debug("cleaned up trusted events",{before:t,after:t.slice(e),matched:e}),t.slice(e))))}_handleDocumentUpdate(e){const t=e.report;if(e.report.deltaEdits.length<this._deltaEdits.length)return void this._updateDocumentState();if(this._documentId!==t.id){const t="Document id mismatch in state update";this._felog.error("changeTracking",t,void 0,{incomingDocumentId:e.report.id}),this._log.error(t)}this._chars=t.chars,this._deltaEdits=t.deltaEdits,t.sourcedContentStore.data.forEach((e=>{this._exportableSourcedContentStore.addContent(e)}));const n=t.deltaEdits.reduce(((e,t)=>{let n=e;return t.clientInfo&&(n={...n,clientInfo:t.clientInfo}),t.sessionId&&(n={...n,sessionId:t.sessionId}),n}),{clientInfo:null,sessionId:null});this._knownDeltaEditMetadata.set(n);const r=this._textObserver.getCurrentTextMap().getPlainText(),i=Ge.zI.diffAsChanges(t.chars.map((e=>e.char)).join(""),r).delta;if(k.QY.isNoTextChangesDelta(i))this._log.info("No changes since last known state."),this._editsTrackingEvents.next({kind:"knownStateMatch"});else{const e=Math.abs(k.QY.getNumInsertedLetters(i)+k.QY.getNumDeletedLetters(i));this._log.info("Known document state is different from current",i),this._editsTrackingEvents.next({kind:"knownStateMismatch",lengthDifference:e}),this._felog.info("Untracked text found",void 0,{documentLength:r.length,untrackedDiffLength:e})}this._handleTextChange(i,!0)}_handleTextChange(e,t=!1){if(0===e.ops.length)return;const n=Se.s.normalizeDelta(Se.s.cleanAllAttrs(e)),r=t?0:Le(n,this._trustedEvents.get(),this._chars.map((e=>e.char)).join(""));t?this._log.debug("got tracking start delta",{normalizedDelta:n}):r||this._log.debug("delta is not typed",{normalizedDelta:n,trustedEvents:this._trustedEvents.get()}),this._pruneTrustedEvents(r);const i=t?this._applyStartingDelta(n):this._applyDelta(n,Date.now(),r);this._deltaEdits.push(i),this._knownDeltaEditMetadata.modify((({clientInfo:e,sessionId:t})=>({clientInfo:i.clientInfo||e,sessionId:i.sessionId||t}))),this._updateDocumentState()}_updateDocumentState(){this._reportState.set({kind:"updated",report:this._getDocumentState()})}_handleSelectionChange(e){e.forEach((e=>{if(e.start!=e.end&&e.end-e.start>1){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._selectionStore.addContent(se.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",t,n)),this._editsTrackingEvents.next({kind:"sourceAdded",textLength:e.end-e.start,sourceDomain:self.location.origin,promptDetected:!1})}}))}_handleGenAICopyEvents(e,t){e.length&&this._internalCopyStore.addContent(se.create(`hwr://delta/rewrite/grammarly/${Te.P.oggyGenAI}`,`Grammarly generated (${Te.P.oggyGenAI})`,e,void 0,t))}_applyDeltaOps(e,t,n=!1){const r=Date.now();t&&this._exportableSourcedContentStore.addContent(t);let i=0;for(const a of e.ops)Se.s.isRetain(a)?i+=a.retain:Se.s.isInsertString(a)?(this._applySingleInsertion(i,new Oe(a.insert,e,r,t||null,n)),i+=a.insert.length):Se.s.isDelete(a)&&(this._trackDeletion(i,a.delete),this._applySingleDeletion(i,a.delete))}_applyStartingDelta(e){const t=this._chars.map((e=>e.char)).join(""),n=k.QY.getSummary(t,e),r=se.create("hwr://delta/startup/","Delta on Document load",n.maximalReplacement);this._applyDeltaOps(e,r);const i=this._knownDeltaEditMetadata.get(),a=this._currentDeltaEditMetadata.get();return{timestamp:Date.now(),delta:e,sourceContentId:r.id,isSelfAuthored:!1,clientInfo:(0,xe.fS)(i.clientInfo,a.clientInfo)?void 0:a.clientInfo||void 0,sessionId:i.sessionId===a.sessionId?void 0:a.sessionId||void 0}}_applyDelta(e,t,n){let r=null;const i=this._chars.map((e=>e.char)).join(""),a=k.QY.getSummary(i,e),s=n>0&&a.maximalReplacement.length<=we.dL;n>0&&a.maximalReplacement.length>we.dL&&this._felog.error("changeTracking","False positive typed match",void 0,{insertionLength:a.maximalReplacement.length,matchedLength:n,trustedEvents:(0,k.tg)(this._trustedEvents.get())}),this._log.debug("_applyDelta summary",a),this._log.debug("_applyDelta matchedLength",n);let o=null;if(s||(o=a.maximalReplacement.length?this._searchAllSourcedContentStores(a):null),r=(null==o?void 0:o.sourcedContent.id)||null,o&&this._exportableSourcedContentStore.addContent(o.sourcedContent),this._applyDeltaOps(e,null==o?void 0:o.sourcedContent,s),!s&&r){const e=this._exportableSourcedContentStore.getContentById(r);e?this._editsTrackingEvents.next({kind:"sourcedTextAdded",sourceDomain:(0,k.Xw)(e.url),textLength:a.maximalReplacement.length,promptDetected:Boolean(e.prompt)}):this._editsTrackingEvents.next({kind:"unknownSourceTextAdded",textLength:a.maximalReplacement.length})}else s||this._editsTrackingEvents.next({kind:"unknownSourceTextAdded",textLength:a.maximalReplacement.length});const l=this._knownDeltaEditMetadata.get(),c=this._currentDeltaEditMetadata.get();return(null==o?void 0:o.matchedTrustedEventsCount)&&this._pruneTrustedEvents(o.matchedTrustedEventsCount),{timestamp:t,delta:e,sourceContentId:r||void 0,isSelfAuthored:s,clientInfo:(0,xe.fS)(l.clientInfo,c.clientInfo)?void 0:c.clientInfo||void 0,sessionId:l.sessionId===c.sessionId?void 0:c.sessionId||void 0}}_trackDeletion(e,t){const n=Array.from({length:t},((t,n)=>this._chars[e+n])),r=n.map((e=>e.char)).join("");this._onCopyDelete(r,n)}_onCopyDelete(e,t){e.length>=we.Uv&&this._internalCopyStore.addContent(se.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",e,t))}_applySingleDeletion(e,t){this._chars.splice(e,t)}_applySingleInsertion(e,t){const n=t.text.length,r=Array.from({length:n},((e,n)=>t.getCharAt(n)));this._chars.splice(e,0,...r)}_searchAllSourcedContentStores(e){let t=this._grammarlyStore.getMatch(e);if(t)return{storeKind:Ue.GrammarlyApplied,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._internalCopyStore.getMatch(e,(e=>"hwr://delta/startup/"!=e.url)),t)return{storeKind:this._internalCopyStore.kind,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._selectionStore.getMatch(e),t)return{storeKind:Ue.Selection,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._externalCopyStore.getMatch(e),t)return{storeKind:Ue.External,sourcedContent:t,matchedTrustedEventsCount:0};const n=this._googleDocsSourcedContentStore.getSyncMatch(e,this._trustedEvents.get());return n?{storeKind:Ue.GDocs,sourcedContent:n.sourcedContent,matchedTrustedEventsCount:n.matchedTrustedEventsCount}:(t=this._untrackedContentStore.getMatch(e),t?{storeKind:Ue.Startup,sourcedContent:t,matchedTrustedEventsCount:0}:(t=this._externalCopyStore.getFuzzyMatch(e,.95),t?{storeKind:Ue.External,sourcedContent:t,matchedTrustedEventsCount:0}:null))}_getDocumentState(){return{id:this._documentId,chars:this._chars.slice(0),sourcedContentStore:{kind:"internal",data:this._exportableSourcedContentStore.data.slice(0)},deltaEdits:this._deltaEdits.slice(0)}}dispose(){this._subs.unsubscribe()}}class Je{constructor(e){this._reportState=p.h.create(null),this._trackingState=p.h.create("dormant"),this._storageState=p.h.create("idle"),this._log=Y.Y.create("EditsTrackingFeatureImpl"),this._subs=new i.w0,this._deps=e,this._felog=(0,k.Cc)({variant:"decoupled tracking",documentId:e.documentId}),this._advancedLoggingEnabled=e.advancedLoggingEnabled,this._editsTracker=new Qe({documentId:e.documentId,sessionId:e.sessionId,reportState:this._reportState,env:e.env,trackingState:this._trackingState.view(),textObserver:e.textObserver,keyboardEvents:e.keyboardEvents,selectionChanges:e.selectionChanges,alertStateChanges:e.alertStateChanges,replacementAppliedEvents:e.replacementAppliedEvents,editsTrackingEvents:e.editsTrackingEvents,copiedTextMessage:e.copiedTextMessage});const t=new Ce(e.encryptionService);this._hwrStorage=new be(e.userId,e.documentId,t,(e=>{this._log.info("Document state read: success"),this._handleStorageRetrieval(e)}),(e=>{this._log.error("Storage read error:",e),this._handleStorageError(e)}),((e,t)=>{t?(this._log.error("Storage write error:",t),this._handleStorageError(t)):this._log.info("Storage write status",e)})),this._subs.add(this._handleTrackingStateChange().subscribe()),this._subs.add(this._handleDocumentUpdates().subscribe()),this._setupIntegrationTestsLogging(),this._felog.info("Init")}startTracking(){this._log.info("Starting document tracking"),this._trackingState.set("active"),this._felog.info("Started tracking")}stopTracking(){this._log.info("Stopping document tracking"),this._trackingState.set("paused"),this._felog.info("Stopped tracking")}async getReportableDocument(){const e=this._reportState.get(),t=this._reportState.pipe(l.h((e=>Boolean(e))));return e?"storage"===e.kind||"updated"===e.kind||"saved"===e.kind?Promise.resolve(oe.Backend.create(e.report,document.title)):"new"===e.kind?(this._felog.warning("reportGenerationFailed","Cannot get report for an empty new document"),Promise.reject("Report Generation Failed: Empty document")):(this._felog.error("reportGenerationFailed","Cannot get report",void 0,{documentState:e.kind}),Promise.reject("Report Generation Failed: Cannot get report")):(0,E.n)(We.S([t,this._storageState.pipe(l.h((e=>"idle"===e)),K.P(),o.b((()=>{this._retreiveReportFromStorage()})),Ke.c(t),O.V(4e3),u.K((()=>(this._felog.error("reportGenerationFailed","Cannot get report, retrieval timeout"),z._(new Error("Document state is not OK after 4000ms, failing"))))))]).pipe(K.P(),s.U((e=>oe.Backend.create(e.report,document.title)))))}_handleTrackingStateChange(){return this._trackingState.pipe(c.w((e=>"active"===e?this._storageState.pipe(l.h((e=>"idle"===e)),K.P(),o.b((()=>{this._retreiveReportFromStorage()}))):"paused"===e?this._storageState.pipe(l.h((e=>"idle"===e)),R.M(this._reportState),l.h((([e,t])=>Boolean(t&&"updated"===t.kind))),K.P(),o.b((([e,t])=>{t&&this._writeReportToStorage(t.report)}))):h.E)))}_handleDocumentUpdates(){return this._reportState.view((e=>{this._log.info("report update",e)})).subscribe(),this._reportState.pipe(l.h((e=>!!e&&"updated"===e.kind)),Ze.e(2e3),R.M(this._storageState),c.w((([e,t])=>U.s((()=>"idle"===t),G.of(e),this._storageState.pipe(l.h((e=>"idle"===e)),K.P(),Ye.h(e))))),o.b((({report:e})=>{this._writeReportToStorage(e)})))}async _retreiveReportFromStorage(){this._log.info("Retrieving report from storage"),this._storageState.set("loading"),await this._hwrStorage.reload(),this._storageState.set("idle")}async _writeReportToStorage(e){this._log.info("Saving report to storage"),this._storageState.set("saving"),await this._hwrStorage.writeDocumentState(e),this._reportState.modify((e=>e?{...e,kind:"saved"}:e)),this._storageState.set("idle")}_handleStorageRetrieval(e){this._reportState.modify((t=>null===t?(this._felog.info("Saved report retrieved",void 0,{historyLength:e.deltaEdits.length}),{report:e,kind:"storage"}):t.report.deltaEdits.length>e.deltaEdits.length?(this._felog.error("storageError","Document in the storage is older than the current one",void 0,{documentId:this._deps.documentId,currentHistoryLength:t.report.deltaEdits.length,storageHistoryLength:e.deltaEdits.length,lastCurrentDeltaEdit:t.report.deltaEdits[t.report.deltaEdits.length-1],lastStorageDeltaEdit:e.deltaEdits[e.deltaEdits.length-1]}),t):(this._felog.info("Saved report retrieved",void 0,{historyLength:e.deltaEdits.length}),{report:e,kind:"storage"})))}_handleStorageError(e){e instanceof Q?this._reportState.modify((e=>null===e?(this._felog.info("New report created",void 0,{documentLength:this._deps.textObserver.getCurrentTextMap().getPlainText().length}),{report:oe.empty(this._deps.documentId),kind:"new"}):e)):e instanceof J?(this._reportState.modify((e=>null===e||"new"===e.kind?{report:oe.empty(this._deps.documentId),kind:"corrupted"}:e)),this._deps.editsTrackingErrors.next({kind:"databaseCorrupted"}),this._felog.error("storageError",`Database corrupted: ${e.name}, '${e.message}'`)):e instanceof X?(this._deps.editsTrackingErrors.next({kind:"serverError",errorMessage:e.message}),this._felog.error("storageError",`Server error: ${e.name}, '${e.message}'`)):e instanceof ee?(this._deps.editsTrackingErrors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Unrecoverable error: ${e.name}, '${e.message}'`)):(this._deps.editsTrackingErrors.next({kind:"unrecoverableError",errorMessage:e.message}),this._felog.error("storageError",`Unknown error: ${e.name}, '${e.message}'`))}_setupIntegrationTestsLogging(){const e=$e();this._subs.add(this._deps.replacementAppliedEvents.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"replacement",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.alertsState.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"alertState",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.alertStateChanges.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"alertStateChange",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.textObserver.contentChanges.async.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"contentChanges",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.selectionChanges.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"selectionChange",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.copiedTextMessage.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"copiedTextMessage",data:t,timestamp:Date.now()})}))),this._subs.add(this._deps.keyboardEvents.pipe(R.M(this._advancedLoggingEnabled),l.h((([e,t])=>t)),s.U((([e])=>e))).subscribe((t=>{e({kind:"keyboardEvent",data:t,timestamp:Date.now()})})))}dispose(){this._subs.unsubscribe(),this._editsTracker.dispose();const e=this._reportState.get();e&&"updated"===e.kind&&"saving"!==this._storageState.get()&&this._hwrStorage.writeDocumentState(e.report)}}var Xe=n(49231),et=n(3527),tt=n(90517),nt=n(24335),rt=n(64271),it=n(17705),at=n(24666),st=n(5876),ot=n(53829),lt=n(74514),ct=n(91901),dt=n(91795);const ht={offsetLeft:"20px",offsetBottom:"20px"},ut=()=>G.of(ht),mt=()=>{const e=document.querySelector(".left-sidebar-container-content .navigation-widget"),t=document.querySelector(ct.Qy),n=document.querySelector(ct.os);return e&&t&&n?dt.x.create(e,{attributes:!0,subtree:!1,childList:!1}).pipe(l.h((e=>e.some((e=>"style"===e.attributeName)))),s.U((t=>/opacity: 0/.test(e.getAttribute("style")||""))),F.O(/opacity: 0/.test(e.getAttribute("style")||"")),c.w((e=>e?G.of(ht):rt.T(dt.x.create(t,{attributes:!0,subtree:!1,childList:!1}).pipe(l.h((e=>e.some((e=>"style"===e.attributeName))))),D.R(self,"resize")).pipe(s.U((()=>n.getBoundingClientRect().x)),F.O(n.getBoundingClientRect().x),s.U((e=>({offsetLeft:`${e+20}px`,offsetBottom:"20px"}))))))):G.of(ht)};var pt=n(47387),gt=n(56424),_t=n(67741),ft=n(92782),kt=n(32080),vt=n(49405),bt=n(30302),yt=n(21428),Ct=n(87118),St=n(77365);const wt={width:gt.ux.rem(5.1875),height:gt.ux.rem(5.1875/4.61)},xt={$nest:{"& .gds-modal-content":{minWidth:"438px"},"& .gds-modal-medium":{width:"438px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:gt.ux.rem(_t.x0)},"& .gds-heading-large":{fontSize:gt.ux.rem(2.25),lineHeight:"1.11em"}}},Et=gt.ux.stylesheet({logo:[wt],modal:[xt]}),It=st.UI.Node.make((({notify:e})=>Xe.createElement(ft.u_,{isOpen:!0,onClose:e({kind:"clipboardRequestResult",result:"close"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog",className:Et.modal},Xe.createElement(ft.u_.Body,null,Xe.createElement(St.o,null,Xe.createElement(kt.k,{direction:"column",gap:10},Xe.createElement(vt.c,{className:Et.logo}),Xe.createElement(kt.k,{direction:"column",gap:3},Xe.createElement(bt.X,{as:"h1",variant:"heading-large"},"Allow clipboard",Xe.createElement("br",null),"access to track",Xe.createElement("br",null),"writing accurately"),Xe.createElement(yt.x,{as:"p"},"We need access to your clipboard so we can record the sources you use. We’ll use it to identify text you copy and paste from websites plus links to those sites.")),Xe.createElement(kt.k,{direction:"row",gap:3},Xe.createElement(Ct.z,{text:"Allow access",variant:"primary",onClick:e({kind:"clipboardRequestResult",result:"allow"})}),Xe.createElement(Ct.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardRequestResult",result:"deny"})}))))))));var Tt=n(80882);const Dt=st.UI.Node.make((({notify:e})=>Xe.createElement(ft.u_,{isOpen:!0,onClose:e({kind:"feedbackPopupClose"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog"},Xe.createElement(ft.u_.Body,null,Xe.createElement(Tt.b,{onClose:e({kind:"feedbackPopupClose"}),align:"left",onSubmit:t=>e({kind:"feedbackSubmit",feedback:t.text})(),withScore:!1,fixSubmitButtonOverflowBottomPadding:!0,hideLogo:!0,title:"How can we improve?"})))));var At=n(43832),Rt=n(26278),Lt=n(9318),Mt=n(37213),Bt=n(82450);var Pt=n(27645);const Ut=[{id:"transparency",title:Xe.createElement(kt.k,{align:"center",gap:2},Xe.createElement((()=>Xe.createElement("svg",{width:"23",height:"32",viewBox:"0 0 23 32",fill:"none"},Xe.createElement("path",{d:"M3.58829 4.35H15.2974C17.0724 4.35 18.5357 5.85744 18.5357 7.75342V23.8537C18.5357 25.7497 17.0724 27.2571 15.2974 27.2571H3.58829C1.81326 27.2571 0.35 25.7497 0.35 23.8537V7.75342C0.35 5.85744 1.81326 4.35 3.58829 4.35Z",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M4 8.5H11.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M4 17.5H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M4 13H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M13.704 24.3143C17.1757 24.3143 19.9901 21.4731 19.9901 17.9684C19.9901 14.4637 17.1757 11.6226 13.704 11.6226C10.2323 11.6226 7.41797 14.4637 7.41797 17.9684C7.41797 21.4731 10.2323 24.3143 13.704 24.3143Z",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M8 19.4951C8 19.4951 8.17677 19.4951 9.69062 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M12 19.4951C12 19.4951 12.4182 19.4951 16 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M8 15.5645H10.9419",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M13.5 15.5645H16",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Xe.createElement("path",{d:"M21.9414 26.6366C22.0781 26.7733 22.2997 26.7733 22.4364 26.6366C22.5731 26.4999 22.5731 26.2783 22.4364 26.1416L21.9414 26.6366ZM18.0523 22.7475L21.9414 26.6366L22.4364 26.1416L18.5473 22.2525L18.0523 22.7475Z",fill:"#1C1C1C"}))),null),Xe.createElement(yt.x,{variant:"text-small",as:"p",weight:"normal"},"We’re transparent about data")),Content:({learnMoreURL:e})=>Xe.createElement(kt.k,{direction:"column",gap:2},Xe.createElement(yt.x,{variant:"text-xsmall",as:"p"},"Grammarly Authorship records your writing activity when you turn it on in a document. The data it gathers includes: text you type and delete, text you paste from other websites and links to those sites, and prompts you send to generative AI tools."),Xe.createElement(At.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Xe.createElement(yt.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Xe.createElement(Rt.J,{icon:Lt.n,accessibilityLabel:"",variant:"inherit",className:Pt.linkIcon}))))},{id:"safety",title:Xe.createElement(kt.k,{align:"center",gap:2},Xe.createElement((()=>Xe.createElement("svg",{width:"21",height:"32",viewBox:"0 0 21 32",fill:"none"},Xe.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.09141 3C6.66135 3 4.69141 4.96994 4.69141 7.4V13.0256C4.69141 15.4557 6.66136 17.4256 9.09141 17.4256H11.947C14.3771 17.4256 16.347 15.4557 16.347 13.0256V7.4C16.347 4.96995 14.3771 3 11.947 3H9.09141ZM9.98539 5.49507C8.57706 5.49507 7.43539 6.63675 7.43539 8.04507V11.8101C7.43539 13.2184 8.57706 14.3601 9.98538 14.3601H11.0786C12.4869 14.3601 13.6286 13.2184 13.6286 11.8101V8.04507C13.6286 6.63675 12.4869 5.49507 11.0786 5.49507H9.98539Z",fill:"white"}),Xe.createElement("path",{d:"M5.04141 7.4C5.04141 5.16324 6.85465 3.35 9.09141 3.35V2.65C6.46805 2.65 4.34141 4.77664 4.34141 7.4H5.04141ZM5.04141 13.0256V7.4H4.34141V13.0256H5.04141ZM9.09141 17.0756C6.85466 17.0756 5.04141 15.2624 5.04141 13.0256H4.34141C4.34141 15.649 6.46806 17.7756 9.09141 17.7756V17.0756ZM11.947 17.0756H9.09141V17.7756H11.947V17.0756ZM15.997 13.0256C15.997 15.2624 14.1838 17.0756 11.947 17.0756V17.7756C14.5704 17.7756 16.697 15.649 16.697 13.0256H15.997ZM15.997 7.4V13.0256H16.697V7.4H15.997ZM11.947 3.35C14.1838 3.35 15.997 5.16325 15.997 7.4H16.697C16.697 4.77665 14.5704 2.65 11.947 2.65V3.35ZM9.09141 3.35H11.947V2.65H9.09141V3.35ZM7.78539 8.04507C7.78539 6.83005 8.77036 5.84507 9.98539 5.84507V5.14507C8.38376 5.14507 7.08539 6.44345 7.08539 8.04507H7.78539ZM7.78539 11.8101V8.04507H7.08539V11.8101H7.78539ZM9.98538 14.0101C8.77036 14.0101 7.78539 13.0251 7.78539 11.8101H7.08539C7.08539 13.4117 8.38376 14.7101 9.98538 14.7101V14.0101ZM11.0786 14.0101H9.98538V14.7101H11.0786V14.0101ZM13.2786 11.8101C13.2786 13.0251 12.2936 14.0101 11.0786 14.0101V14.7101C12.6802 14.7101 13.9786 13.4117 13.9786 11.8101H13.2786ZM13.2786 8.04507V11.8101H13.9786V8.04507H13.2786ZM11.0786 5.84507C12.2936 5.84507 13.2786 6.83004 13.2786 8.04507H13.9786C13.9786 6.44345 12.6802 5.14507 11.0786 5.14507V5.84507ZM9.98539 5.84507H11.0786V5.14507H9.98539V5.84507Z",fill:"#1C1C1C"}),Xe.createElement("rect",{x:"0.35",y:"10.5629",width:"20.3",height:"17.5082",rx:"2.41596",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeLinecap:"round"}),Xe.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.4866 20.0964C12.2255 19.7611 12.7339 19.0611 12.7339 18.2517C12.7339 17.1165 11.7338 16.1963 10.5002 16.1963C9.26654 16.1963 8.26648 17.1165 8.26648 18.2517C8.26648 19.061 8.77474 19.7611 9.51355 20.0963V22.3355C9.51355 22.8803 9.95524 23.322 10.5001 23.322C11.045 23.322 11.4866 22.8803 11.4866 22.3355V20.0964Z",fill:"white"}),Xe.createElement("path",{d:"M11.4866 20.0964L11.342 19.7776L11.1366 19.8708V20.0964H11.4866ZM9.51355 20.0963H9.86355V19.8708L9.65818 19.7776L9.51355 20.0963ZM12.3839 18.2517C12.3839 18.9067 11.9722 19.4918 11.342 19.7776L11.6313 20.4151C12.4789 20.0305 13.0839 19.2154 13.0839 18.2517H12.3839ZM10.5002 16.5463C11.5685 16.5463 12.3839 17.3367 12.3839 18.2517H13.0839C13.0839 16.8964 11.8991 15.8463 10.5002 15.8463V16.5463ZM8.61648 18.2517C8.61648 17.3367 9.43186 16.5463 10.5002 16.5463V15.8463C9.10121 15.8463 7.91648 16.8964 7.91648 18.2517H8.61648ZM9.65818 19.7776C9.02814 19.4917 8.61648 18.9066 8.61648 18.2517H7.91648C7.91648 19.2154 8.52134 20.0304 9.36892 20.415L9.65818 19.7776ZM9.86355 22.3355V20.0963H9.16355V22.3355H9.86355ZM10.5001 22.972C10.1485 22.972 9.86355 22.687 9.86355 22.3355H9.16355C9.16355 23.0736 9.76194 23.672 10.5001 23.672V22.972ZM11.1366 22.3355C11.1366 22.687 10.8517 22.972 10.5001 22.972V23.672C11.2383 23.672 11.8366 23.0736 11.8366 22.3355H11.1366ZM11.1366 20.0964V22.3355H11.8366V20.0964H11.1366Z",fill:"#1C1C1C"}))),null),Xe.createElement(yt.x,{variant:"text-small",as:"p",weight:"normal"},"We’ll keep your data safe")),Content:({learnMoreURL:e})=>Xe.createElement(kt.k,{direction:"column",gap:2},Xe.createElement(yt.x,{variant:"text-xsmall",as:"p"},"When you start Authorship, its data is stored on your device in an encrypted format. When you see or share your report, this data is sent to Grammarly over an encrypted connection."),Xe.createElement(At.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Xe.createElement(yt.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Xe.createElement(Rt.J,{icon:Lt.n,accessibilityLabel:"",variant:"inherit",className:Pt.linkIcon}))))},{id:"control",title:Xe.createElement(kt.k,{align:"center",gap:2},Xe.createElement((()=>Xe.createElement("svg",{width:"22",height:"32",viewBox:"0 0 22 32",fill:"none"},Xe.createElement("rect",{x:"0.375",y:"6.375",width:"21.25",height:"7.25",rx:"3.625",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.75"}),Xe.createElement("circle",{cx:"18",cy:"10",r:"3.625",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),Xe.createElement("rect",{x:"-0.375",y:"0.375",width:"21.25",height:"7.25",rx:"3.625",transform:"matrix(-1 0 0 1 21.25 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),Xe.createElement("circle",{cx:"4",cy:"4",r:"3.625",transform:"matrix(-1 0 0 1 8 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}))),null),Xe.createElement(yt.x,{variant:"text-small",as:"p",weight:"normal"},"You’re always in control")),Content:({learnMoreURL:e})=>Xe.createElement(kt.k,{direction:"column",gap:2},Xe.createElement(yt.x,{variant:"text-xsmall",as:"p"},"You choose when Authorship tracks your writing activity and when you share your report. You can stop sharing your report or delete your writing activity data anytime."),Xe.createElement(At.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Xe.createElement(yt.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Xe.createElement(Rt.J,{icon:Lt.n,accessibilityLabel:"",variant:"inherit",className:Pt.linkIcon}))))}],Gt={width:gt.ux.rem(5.1875),height:gt.ux.rem(5.1875/4.61)},Ft={$nest:{"& .gds-modal-content":{minWidth:"860px"},"& .gds-modal-medium":{width:"860px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:gt.ux.rem(_t.x0)},"& .gds-heading-large":{fontSize:gt.ux.rem(2.25),lineHeight:"1.11em"}}},Ot=gt.ux.stylesheet({logo:[Gt],link:[{whiteSpace:"normal"}],linkIcon:[{verticalAlign:"top"}],flip:[{transform:"rotate(180deg)"}],modal:[Ft]}),Nt=(0,Mt.xb)(At.r),Ht=(0,Mt.xb)((({learnMoreURLs:e})=>{const[t,n]=Xe.useState([]);return Xe.createElement("div",{className:Pt.accordionRoot},Xe.createElement("div",null,Ut.map((({id:r,title:i,Content:a})=>{const s=t.includes(r),o=`optInAccordion-title-${r}`,l=`optInAccordion-content-${r}`;return Xe.createElement("div",{key:r,className:`${Pt.accordionItem}`},Xe.createElement("button",{id:o,className:Pt.accordionHeader,onClick:()=>{n(s?[]:[r])},"aria-controls":l,"aria-expanded":s},Xe.createElement("div",{className:Pt.accordionTrigger},i,Xe.createElement(kt.k,{className:`${Pt.accordionIcon} ${s?Pt.rotate:""}`},Xe.createElement(Rt.J,{size:"large",icon:Bt.p,accessibilityLabel:s?"Collapse section":"Expand section"})))),Xe.createElement("div",{role:"region","aria-labelledby":o,className:`${Pt.accordionContent} ${s?Pt.shown:""}`},Xe.createElement(a,{learnMoreURL:e[r]})))}))))})),$t=st.UI.Node.make((({view:e,state:t,notify:n})=>Xe.createElement(ft.u_,{isOpen:!0,onClose:n({kind:"closeOptInPopup"}),title:"",dismissOnOutsideClick:!1,width:"medium",role:"alertdialog",className:Ot.modal},Xe.createElement(ft.u_.Body,null,Xe.createElement(St.o,null,Xe.createElement(kt.k,{direction:"row",gap:6},Xe.createElement(kt.k,{direction:"column",gap:10,flex:"1 1 50%"},Xe.createElement(vt.c,{className:Ot.logo}),Xe.createElement(kt.k,{direction:"column",gap:3},Xe.createElement(bt.X,{as:"h1",variant:"heading-large"},"Prove where your",Xe.createElement("br",null),"words come from"),Xe.createElement(yt.x,{as:"p"},"With Grammarly Authorship, you can certify what you type, copy, or generate with AI. You choose how to share this information."),Xe.createElement(Nt,{href:e("howItWorksURL"),variant:"primary",weight:"bold",target:"_blank",underline:"hover"},"See how it works"," ",Xe.createElement(Rt.J,{icon:Lt.n,accessibilityLabel:"",variant:"inherit",className:Ot.linkIcon}))),Xe.createElement(Ct.z,{text:"OK",onClick:n({kind:"optIn"})})),Xe.createElement(kt.k,{direction:"column",gap:3,flex:"1 1 50%",align:"stretch"},Xe.createElement(kt.k,{direction:"row",flex:"1 0 0%",align:"center"},Xe.createElement(Ht,{learnMoreURLs:t.pipe(s.U((({learnMoreTransparencyURL:e,learnMoreSafetyURL:t,learnMoreControlURL:n})=>({transparency:e,safety:t,control:n}))))})),Xe.createElement(yt.x,{as:"p",color:"base-subdued",variant:"text-xsmall"},"By tracking writing activity, the Beta terms in your agreement with Grammarly (",Xe.createElement(At.r,{href:"https://www.grammarly.com/terms/customer-business-agreement",variant:"secondary",className:Ot.link},"Customer Business Agreement"),", ",Xe.createElement(At.r,{href:"https://www.grammarly.com/terms",variant:"secondary",className:Ot.link},"Terms and Conditions")," ","and our"," ",Xe.createElement(At.r,{href:"https://www.grammarly.com/privacy-policy",variant:"secondary",className:Ot.link},"Privacy Policy"),", as applicable) will apply.")))))))),zt=st.UI.Union.make("kind",{optIn:$t,clipboardAccess:It,feedback:Dt}),Wt=st.UI.Union.asOption(zt);var Kt=n(69731);const Zt=gt.ux.stylesheet({toast:[{$nest:{"&&":{minWidth:"376px"}}}]}),Yt=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"success",text:"Grammarly is tracking your writing activity in this document. Click the icon to stop tracking or see your report.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),jt=(0,Mt.xb)(Kt.F),Vt=st.UI.Node.make((({state:e,notify:t})=>Xe.createElement(jt,{variant:"success",text:e.pipe(s.U((({domain:e,wasNewDocument:t})=>`Authorship ${t?"is tracking your writing activity in this doc. It will start tracking":"will start tracking your writing activity"} anytime you create a new ${"docs.google.com"===e?"Google doc":`doc on ${e}`}.`))),onClose:t({kind:"dismissToast"}),onMouseEnter:t({kind:"toastHover",hovered:!0}),onMouseLeave:t({kind:"toastHover",hovered:!1}),className:Zt.toast}))),qt=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"success",text:"Grammarly Authorship is turned off. If you want the option to track your writing activity, you can turn it on in Settings.",primaryAction:Xe.createElement(Ct.z,{text:"OK",variant:"primary",onClick:e({kind:"optOutToastOkClick"})}),onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),Qt=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"success",text:"Grammarly Authorship is now available. Start it to track your writing activity in a doc.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),Jt=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"critical",text:"Could not generate Authorship Report. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),Xt=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"critical",text:"An error occurred while saving your editing history data.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),en=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"critical",text:"Could not retrieve editing history data. Tracking will start from scratch.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),tn=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"critical",text:"An error occurred while communicating with the server. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),nn=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"warning",text:"Authorship lost access to your clipboard, so it can’t accurately record text you copy and paste. Try restarting your browser.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),rn=st.UI.Node.make((({notify:e})=>Xe.createElement(Kt.F,{variant:"warning",text:"Without clipboard access, Authorship will mark any text you paste as “Copied from unknown source.” To accurately record your sources, allow clipboard access.",primaryAction:Xe.createElement(Ct.z,{text:"Allow clipboard access",variant:"primary",onClick:e({kind:"clipboardWarningResult",result:"allow"})}),secondaryAction:Xe.createElement(Ct.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardWarningResult",result:"deny"})}),onClose:e({kind:"clipboardWarningResult",result:"close"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Zt.toast}))),an=st.UI.Union.make("kind",{documentTrackingStarted:Yt,domainTrackingStarted:Vt,domainTrackingStartedWhenAlreadyTracked:Vt,optedOut:qt,optedIn:Qt,reportGenerationFailed:Jt,clipboardWarning:rn,clipboardPermissionRequestFailed:nn,storageUnrecoverableError:Xt,storageDatabaseCorrupted:en,storageServerError:tn}),sn=st.UI.Union.asOption(an);var on=n(3143),ln=n(71050),cn=n(57129);const dn=gt.ux.keyframes({"0%":{backgroundColor:cn.Red40},"100%":{backgroundColor:cn.Red20}}),hn={width:gt.ux.rem(.5),height:gt.ux.rem(.5),borderRadius:gt.ux.rem(.25),borderWidth:gt.ux.rem(.125),borderStyle:"solid",borderColor:on.I.Background.Base.Default,backgroundColor:cn.Red40,boxShadow:ln.H8.boxShadow,animationName:dn,animationDuration:"1.5s",animationIterationCount:"infinite",animationDirection:"alternate",animationFillMode:"both",animationTimingFunction:"ease-in-out"},un=gt.ux.stylesheet({dot:[hn]}),mn=()=>Xe.createElement("div",{className:un.dot}),pn=()=>Xe.createElement("svg",{viewBox:"0 0 20 20",fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2"},Xe.createElement("path",{d:"M8.46121 16.6668V10.0641C8.46121 9.21446 9.15001 8.52567 9.99967 8.52567C10.8493 8.52567 11.5381 9.21446 11.5381 10.0641V11.6668M11.5381 14.4446V16.6668M14.1022 15.0001V10.0641C14.1022 7.79834 12.2655 5.96156 9.99967 5.96156C7.73389 5.96156 5.89711 7.79834 5.89711 10.0641V11.1112M5.89711 15.5557V13.889M3.33301 12.2223V10.0641C3.33301 6.38223 6.31778 3.39746 9.99967 3.39746C11.7507 3.39746 13.344 4.07253 14.5336 5.1766M16.6663 13.3334V10.0641C16.6663 9.26096 16.5243 8.49096 16.264 7.77789",stroke:"inherit",strokeWidth:"1.25",strokeLinecap:"round",fill:"inherit"})),gn={width:gt.ux.rem(1.5),height:gt.ux.rem(1.5),display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",borderRadius:"50%",$nest:{svg:{width:gt.ux.rem(1.25),height:gt.ux.rem(1.25),stroke:on.I.Icon.Base.Default},"&.active":{backgroundColor:on.I.Icon.Brand.Default,$nest:{svg:{stroke:on.I.Icon.Base.Inverse}}}}},_n={background:"none",border:"none",borderRadius:"50%",width:gt.ux.rem(1.5),height:gt.ux.rem(1.5),cursor:"pointer",position:"relative",boxShadow:ln.H8.boxShadow,padding:0,$nest:{"&:focus-visible":{outline:`2px solid ${on.I.Border.Brand.Default}`,outlineOffset:"2px"}}},fn={position:"absolute",right:gt.ux.rem(-.375),top:gt.ux.rem(-.375)},kn=gt.ux.stylesheet({icon:[gn],button:[_n],activityIndicator:[fn]}),vn=st.UI.Node.make((({view:e,notify:t})=>Xe.createElement(Xe.Fragment,null,Xe.createElement(pt.F.button,{className:kn.button,"aria-label":e("trackingState").pipe(s.U((e=>"tracking"===e?"Press to pause authorship tracking":"Press to start authorship tracking"))),onClick:t({kind:"trackingButtonClick"}),onMouseEnter:t({kind:"trackingButtonHover",pointerIsOn:!0}),onMouseLeave:t({kind:"trackingButtonHover",pointerIsOn:!1})},Xe.createElement(pt.F.div,{className:e("trackingState").pipe(s.U((e=>"tracking"===e?`${kn.icon} active`:`${kn.icon}`)))},Xe.createElement(pn,null),e("trackingState").pipe(s.U((e=>"tracking"===e?Xe.createElement("div",{className:kn.activityIndicator},Xe.createElement(mn,null)):null))))))));var bn=n(25081),yn=n(22389),Cn=n(48666),Sn=n(54089),wn=n(3566);const xn=()=>Xe.createElement("svg",{viewBox:"0 0 18 18",fill:"none"},Xe.createElement("rect",{y:"0.00585938",width:"18",height:"18",rx:"9",fill:"#B356B3"}),Xe.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.26851 7.71073C6.50719 7.16012 6.81849 6.6436 7.19862 6.1694C7.25292 6.1012 7.27692 6.01343 7.26429 5.92692C7.25229 5.84042 7.2043 5.76338 7.13295 5.7135C6.8166 5.49123 6.49899 5.27591 6.18074 5.05996C6.0715 4.98608 5.9288 4.98797 5.81956 5.06501C4.53711 5.98565 3.60321 7.32998 3.19088 8.85051C2.98819 9.59371 2.76656 11.0094 3.56217 12.1403C4.07995 12.8702 4.97722 13.3034 5.86439 13.3034C6.10055 13.3034 6.33607 13.2731 6.56402 13.2093C7.4714 12.9593 8.17674 12.2571 8.45015 11.3308C8.7343 10.3672 8.51456 9.35502 7.86165 8.62256C7.44551 8.1534 6.881 7.83323 6.26851 7.71073Z",fill:"white"}),Xe.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.2897 8.62294C13.8736 8.15378 13.3084 7.83363 12.6966 7.71113C12.9353 7.15926 13.2478 6.64211 13.626 6.16916C13.681 6.1016 13.705 6.01383 13.693 5.92669C13.6804 5.84081 13.6324 5.76378 13.561 5.71326C13.244 5.49163 12.927 5.27505 12.6088 5.05973C12.4989 4.98585 12.3556 4.98837 12.2476 5.06478C10.9645 5.98541 10.0313 7.33038 9.61894 8.85025C9.41562 9.59472 9.19525 11.0117 9.98897 12.14C10.5074 12.8706 11.4046 13.3038 12.2925 13.3038C12.5286 13.3038 12.7648 13.2728 12.9921 13.2097C13.8995 12.9597 14.6048 12.2581 14.8782 11.3324C15.1623 10.3689 14.9426 9.3554 14.2897 8.62294Z",fill:"white"})),En={$nest:{"&&":{paddingLeft:gt.ux.rem(_t.x),paddingRight:gt.ux.rem(_t.x)}}},In={width:gt.ux.rem(_t.Ze),$nest:{svg:{display:"inline-block",width:"18px",padding:"2px"}}},Tn=gt.ux.stylesheet({aipd:[In],button:[En]}),Dn=st.UI.Union.asOption(st.UI.Node.make((({notify:e})=>Xe.createElement(Ct.z,{onClick:e({kind:"plagiarismCheckRequest"}),variant:"tertiary",size:"2xlarge",width:"full",className:Tn.button,ref:t=>{t&&e({kind:"plagiarismCheckButtonRender"})()}},Xe.createElement(kt.k,{direction:"row",gap:3,align:"start",justify:"start",width:"100%"},Xe.createElement("div",{className:Tn.aipd},Xe.createElement(xn,null)),Xe.createElement(kt.k,{direction:"column",gap:1,width:"100%"},Xe.createElement(kt.k,{direction:"row",gap:2,justify:"space-between"},Xe.createElement(yt.x,{as:"span",color:"base-default",variant:"text-small",weight:"medium"},"Check for AI & plagiarism"),Xe.createElement(wn.O,{variant:"pro",size:"xsmall"})),Xe.createElement(yt.x,{as:"span",color:"base-subdued",variant:"text-xsmall"},"Verify originality and get citations")))))));var An=n(88457),Rn=n(96314);const Ln={pointerEvents:"none",transition:"box-shadow 0.3s",transitionTimingFunction:"ease-out",borderRadius:"11px",overflow:"visible",boxShadow:"0px 0 0 0 rgba(0,0,0,0)",$nest:{"&.active":{boxShadow:ln.H8.boxShadow},".bg":{transition:"fill 0.3s",transitionTimingFunction:"ease-out",fill:on.I.Background.Base.Subdued},".stroke":{transition:"stroke 0.3s",transitionTimingFunction:"ease-out",stroke:on.I.Border.Base.Default},"&.active .bg":{fill:on.I.Background.Brand.Default},"&.active .stroke":{stroke:on.I.Background.Brand.Default}}},Mn={transition:"all 0.3s",transitionTimingFunction:"ease-out",$nest:{"path:last-child":{stroke:on.I.Icon.Base.Default},"&.active":{transform:"translateX(10px)",$nest:{"path:last-child":{stroke:on.I.Icon.Brand.Default}}}}},Bn=gt.ux.stylesheet({root:[Ln],icon:[Mn]}),Pn=({active:e,className:t})=>Xe.createElement("svg",{width:"32",height:"22",viewBox:"0 0 32 22",fillRule:"evenodd",clipRule:"evenodd",className:`${Bn.root} ${t||""} ${e?"active":""}`},Xe.createElement("path",{className:"bg",d:"M31.75,11C31.75,5.067 26.933,0.25 21,0.25L11,0.25C5.067,0.25 0.25,5.067 0.25,11C0.25,16.933 5.067,21.75 11,21.75L21,21.75C26.933,21.75 31.75,16.933 31.75,11Z",fill:"inherit"}),Xe.createElement("path",{className:"stroke",d:"M31.75,11C31.75,5.067 26.933,0.25 21,0.25L11,0.25C5.067,0.25 0.25,5.067 0.25,11C0.25,16.933 5.067,21.75 11,21.75L21,21.75C26.933,21.75 31.75,16.933 31.75,11Z",fill:"none",stroke:"inherit",strokeWidth:"0.5px"}),Xe.createElement("g",{filter:"url(#switchVisual_filter_1)",className:`${Bn.icon} ${e?"active":""}`},Xe.createElement("path",{d:"M20,11.003C20,6.036 15.967,2.003 11,2.003C6.033,2.003 2,6.036 2,11.003C2,15.97 6.033,20.003 11,20.003C15.967,20.003 20,15.97 20,11.003Z",fill:"white"}),Xe.createElement("path",{d:"M9.615,17.003L9.615,11.061C9.615,10.296 10.235,9.676 11,9.676C11.765,9.676 12.385,10.296 12.385,11.061L12.385,12.503M12.385,15.003L12.385,17.003M14.692,15.503L14.692,11.061C14.692,9.021 13.039,7.368 11,7.368C8.961,7.368 7.308,9.021 7.308,11.061L7.308,12.003M7.308,16.003L7.308,14.503M5,13.003L5,11.061C5,7.747 7.686,5.061 11,5.061C12.576,5.061 14.01,5.668 15.081,6.662M17,14.003L17,11.061C17,10.338 16.872,9.645 16.638,9.003",fill:"none",fillRule:"nonzero",stroke:"inherit",strokeWidth:"1px",strokeLinecap:"round"})),Xe.createElement("defs",null,Xe.createElement("filter",{id:"switchVisual_filter_1",x:"0",y:"0.00891113",width:"24",height:"24",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},Xe.createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),Xe.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),Xe.createElement("feOffset",{dy:"1"}),Xe.createElement("feGaussianBlur",{stdDeviation:"1.5"}),Xe.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),Xe.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),Xe.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_9756_7855"}),Xe.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_9756_7855",result:"shape"})))),Un={position:"relative",display:"inline-block",alignSelf:"flex-start",$nest:{"label svg":{width:gt.ux.rem(_t.Ze),visibility:"hidden"}}},Gn=gt.ux.stylesheet({switch:[Un],switchVisual:[{position:"absolute",right:0,top:0,$nest:{"&.labelRight":{left:0,right:"auto"}}}]}),Fn=e=>Xe.createElement("span",{className:Gn.switch},Xe.createElement(Rn.r,{...e},e.children),Xe.createElement(Pn,{active:Boolean(e.checked),className:`${Gn.switchVisual} ${"right"===e.labelDisplay?"labelRight":""}`}));function On(e,t){switch(t){case"available":case"newDocument":return e({kind:"start"});case"paused":return e({kind:"resume"});case"tracking":return e({kind:"pause"});default:return}}function Nn(e){switch(e){case"available":case"newDocument":return"Track writing for proof of authorship";case"paused":return"Tracking is paused";case"tracking":return"Tracking is currently on";default:return}}const Hn=st.UI.Node.make((({state:e,notify:t})=>Xe.createElement(kt.k,{direction:"row",gap:2,align:"start",justify:"space-between",width:"100%"},Xe.createElement(pt.F.Fragment,null,e.pipe(s.U((({trackingState:e})=>Xe.createElement(Xe.Fragment,null,Xe.createElement(Fn,{label:"Track your work",labelDisplay:"right",defaultSelected:"tracking"===e,checked:"tracking"===e,helperMessage:Nn(e),onChange:On(t,e)}),"available"!==e&&"newDocument"!==e&&Xe.createElement(Ct.z,{iconEnd:An.l,size:"small",text:"See report",onClick:t({kind:"viewReport"})})))))))));var $n=n(96617),zn=n(99529);const Wn=st.UI.Node.make((({notify:e,view:t,state:n})=>Xe.createElement($n.v,{activator:Xe.createElement(yn.h,{accessibilityLabel:"Settings",icon:zn.a,variant:"tertiary",size:"small","aria-controls":"hwr-settings-menu"})},Xe.createElement(pt.F.Fragment,null,n.pipe(s.U((({enabledForDomain:t,domain:n})=>{const r="docs.google.com"===n?"all new Google Docs":`all new documents on ${n}`;return t?Xe.createElement(Xe.Fragment,null,Xe.createElement($n.v.Item,{key:"startAutomatically",onClick:e({kind:"resetForDomain"}),"aria-describedby":"domain_tracking_label"},"Turn off automatic tracking"),Xe.createElement(yt.x,{id:"domain_tracking_label",as:"label",variant:"text-xsmall",color:"base-subdued",marginLeft:2,marginRight:2},"Automatic tracking records proof of your writing activity for ",r)):Xe.createElement(Xe.Fragment,null,Xe.createElement($n.v.Item,{key:"startAutomatically",onClick:e({kind:"enableForDomain",isNewDocument:!1}),"aria-describedby":"domain_tracking_label"},"Turn on automatic tracking"),Xe.createElement(yt.x,{id:"domain_tracking_label",as:"label",variant:"text-xsmall",color:"base-subdued",marginLeft:2,marginRight:2},"Automatic tracking records proof of your writing activity for ",r))})))),Xe.createElement($n.v.Separator,{role:"separator"}),Xe.createElement(pt.F.Fragment,null,t("urls").pipe(s.U((e=>Xe.createElement(Xe.Fragment,null,Xe.createElement($n.v.Item,{key:"howItWorks",href:e.howItWorks,target:"_blank"},"How Authorship works?"),Xe.createElement($n.v.Item,{key:"reportAnIssue",href:e.reportAnIssue,target:"_blank"},"Report an issue")))))),Xe.createElement($n.v.Item,{key:"giveFeedback",onClick:e({kind:"giveFeedback"})},"Give feedback"),Xe.createElement($n.v.Separator,{role:"separator"}),Xe.createElement($n.v.Item,{key:"turnOfAuthorship",onClick:e({kind:"optOut"})},"Turn off Authorship")))),Kn=st.UI.Knot.make(st.UI.Grid.make((({slots:e,notify:t})=>Xe.createElement(Sn.d,{onClickAway:t({kind:"trackingButtonClickAway"})},Xe.createElement("div",{onMouseEnter:t({kind:"trackingButtonHover",pointerIsOn:!0}),onMouseLeave:t({kind:"trackingButtonHover",pointerIsOn:!1})},Xe.createElement(kt.k,{direction:"column",bgColor:"background-base-default",borderRadius:2,style:{boxShadow:ln.hw.boxShadow,borderColor:ln.hw.border,position:"relative"}},Xe.createElement(kt.k,{direction:"column",padding:2,width:"304px"},Xe.createElement(kt.k,{direction:"row",align:"center",justify:"space-between"},Xe.createElement(Rt.J,{icon:bn.H,accessibilityLabel:"Grammarly",size:"small"}),Xe.createElement(kt.k,{direction:"row",alignSelf:"end"},e.menu,Xe.createElement(yn.h,{accessibilityLabel:"Close",icon:Cn.V,variant:"tertiary",onClick:t({kind:"trackingButtonCloseClick"}),size:"small"}))),Xe.createElement(kt.k,{padding:2},e.controls),e.plagiarismCheckButton)))))),{menu:Wn,controls:Hn,plagiarismCheckButton:Dn}),Zn=st.UI.Union.make("state",{compact:vn,expanded:Kn}),Yn=st.UI.Union.asOption(Zn),jn=st.UI.Grid.make((({slots:e,view:t})=>Xe.createElement(pt.F.div,{"data-grammarly-part":"human-writing-report-button",style:{position:"fixed",left:t("offsetLeft"),bottom:t("offsetBottom"),zIndex:1e4}},e.popup,e.trackingButton,Xe.createElement("div",{style:{position:"absolute",left:"100%",bottom:0}},e.toast)))),Vn=st.UI.Knot.make(jn,{trackingButton:Yn,popup:Wt,toast:sn}),qn=st.UI.Union.asOption(Vn);function Qn(e){return st.Z.fromSideEffect((t=>{e.next(t)}),G.of(null))}function Jn(e){return st.Z.fromSideEffect((t=>{e.next(t)}),G.of(null))}function Xn(e,t){return st.Z.fromSideEffect((e=>{t.next({kind:e.kind})}),e.pipe(et.oA,s.U((({urls:e})=>({howItWorksURL:e.howItWorks,learnMoreTransparencyURL:e.learnMoreTransparency,learnMoreSafetyURL:e.learnMoreSafety,learnMoreControlURL:e.learnMoreControl})))))}function er(e,t){return st.Z.composeUnion({optIn:Xn(e,t),clipboardAccess:Qn(t),feedback:Jn(t)},(()=>e.pipe(et.oA,tt.j("popup"),et.oA,s.U((e=>({kind:e}))))))}function tr(e,t){return st.Z.composeUnion({None:()=>G.of(null),Some:st.Z.composeKnot({value:er(e,t)})},(()=>e.pipe(et.oA,tt.j("popup"))))}function nr(e,t){return st.Z.composeUnion({documentTrackingStarted:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),domainTrackingStarted:st.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(et.oA,s.U((({domain:e})=>({domain:e,wasNewDocument:!0}))))),domainTrackingStartedWhenAlreadyTracked:st.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(et.oA,s.U((({domain:e})=>({domain:e,wasNewDocument:!1}))))),optedOut:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),optedIn:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),reportGenerationFailed:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),clipboardWarning:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),clipboardPermissionRequestFailed:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),storageDatabaseCorrupted:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),storageUnrecoverableError:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),storageServerError:st.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null))},(()=>e.pipe(et.oA,tt.j("toast"),et.oA,s.U((e=>({kind:e}))))))}function rr(e,t){return st.Z.composeUnion({None:()=>G.of(null),Some:st.Z.composeKnot({value:nr(e,t)})},(()=>e.pipe(et.oA,tt.j("toast"))))}function ir(e,t){return st.Z.fromSideEffect((e=>{switch(e.kind){case"trackingButtonClick":t.next({kind:"trackingButtonClick"});break;case"trackingButtonHover":t.next({kind:"trackingButtonHover",pointerIsOn:e.pointerIsOn});break;default:(0,m.L0)(e)}}),e.pipe(et.oA))}function ar(e,t){return st.Z.composeUnion({None:()=>G.of(null),Some:st.Z.composeKnot({value:st.Z.fromSideEffect((e=>{t.next(e)}),G.of(null))})},(()=>e.pipe(et.cp((({plagiarismCheckAvailable:e})=>e?G.of(g.G(null)):G.of(g.YP))))))}function sr(e,t){return st.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(et.oA,s.U((({trackingState:e})=>({trackingState:e})))))}function or(e,t){return st.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(et.oA,s.U((({urls:e,enabledForDomain:t,domain:n})=>({urls:e,enabledForDomain:t,domain:n})))))}function lr(e,t){return st.Z.composeKnot({controls:sr(e,t),menu:or(e,t),plagiarismCheckButton:ar(e,t),root:st.Z.fromSideEffect((e=>{t.next(e)}),G.of(null))})}function cr(e,t){return st.Z.composeUnion({compact:ir(e,t),expanded:lr(e,t)},(()=>e.pipe(et.oA,s.U((({trackingButtonExpanded:e})=>({state:e?"expanded":"compact"}))))))}class dr{constructor(e,t,n,r,a,s,o=ut,l){this.actions=t,this.errors=n,this._events=r,this._documentId=a,this._gnar=s,this._createTButtonPositionSource=o,this._requestPlagiarismCheck=l,this._state=p.h.create(g.YP),this._tButtonPosition=p.h.create(ht),this.state=this._state.view(),this.tButtonPosition=this._tButtonPosition.view(),this._subs=new i.w0,this._domain=e.view("page").view("domain").get(),this._subs.add(this._handleCSStateChange(e).subscribe()),this._subs.add(this._handleActions().subscribe()),this._subs.add(this._handleErrors().subscribe()),this._subs.add(this._handleEvents().subscribe()),this._subs.add(this._handleEnabledForDomainOnce().subscribe()),this._subs.add(this._autocloseToast().subscribe()),this._subs.add(this._handleToastShow().subscribe()),this._subs.add(o().subscribe(je.wW(this._tButtonPosition))),this._subs.add(this._handleTrackingButtonHover().subscribe())}_handleCSStateChange(e){return e.pipe(s.U((e=>{this._state.modify((t=>{var n;const i=null!==(n=e.page.humanWritingReport)&&void 0!==n?n:f.wg;return e.page.enabled&&("optedOut"===i.kind||"available"===i.kind||"enabled"===i.kind)?(0,r.zG)(t,g.UI((t=>this._reducePageStateToLocalState(e,t))),g.wp((()=>g.G(this._reducePageStateToLocalState(e))))):g.YP}))})))}_reducePageStateToLocalState({page:{domain:e,humanWritingReport:t=f.wg},dynamicConfig:n},r){var i;return{trackingState:"optedOut"===t.kind?"optedOut":"available"===t.kind?"available":(0,f.MP)(this._documentId,this._domain,t)?(0,f.Ng)(this._documentId,this._domain,t)?"tracking":"paused":"newDocument",optInPopupWasClosedOnce:"available"!==t.kind||t.optInPopUpWasClosedAtLeastOnce,trackingButtonExpanded:!!r&&r.trackingButtonExpanded,enabledForDomain:(0,f.E3)(this._domain,t),domain:e,popup:r?r.popup:g.YP,toast:r?r.toast:g.YP,urls:{...we.ym,...null===(i=null==n?void 0:n.hwr)||void 0===i?void 0:i.urls},plagiarismCheckAvailable:void 0!==this._requestPlagiarismCheck}}_handleEnabledForDomainOnce(){return this.actions.pipe(l.h((e=>"enableForDomain"===e.kind)),d.q(1),o.b((({isNewDocument:e})=>this._state.modify((t=>(0,r.zG)(t,g.tS((t=>{const n={...t,toast:g.G(e?"domainTrackingStarted":"domainTrackingStartedWhenAlreadyTracked")};return g.G(n)}))))))))}_handleToastShow(){return this._state.pipe(et.oA,tt.j("toast"),et.oA,o.b((e=>{switch(e){case"documentTrackingStarted":case"domainTrackingStarted":case"domainTrackingStartedWhenAlreadyTracked":case"optedOut":case"optedIn":case"clipboardWarning":this._gnar.hwrToastShow(this._documentId,"info",e);break;case"clipboardPermissionRequestFailed":case"storageDatabaseCorrupted":case"reportGenerationFailed":case"storageUnrecoverableError":case"storageServerError":this._gnar.hwrToastShow(this._documentId,"error",e)}})))}_autocloseToast(){const e=this.actions.pipe(l.h((e=>"toastHover"===e.kind)),tt.j("hovered"),F.O(!1));return this._state.pipe(et.oA,tt.j("toast"),et.oA,c.w((t=>"clipboardWarning"===t?h.E:We.S(e.pipe(c.w((e=>e?h.E:nt.HT(we.bd)))),this.actions.pipe(l.h((e=>"dismissToast"===e.kind)))))),o.b((()=>{this._state.modify((e=>(0,r.zG)(e,g.tS((e=>g.G({...e,toast:g.YP}))))))})))}_handleTrackingButtonHover(){const e=this.actions.pipe(l.h((e=>"trackingButtonHover"===e.kind)),tt.j("pointerIsOn")),t=this.actions.pipe(l.h((e=>"trackingButtonCloseClick"===e.kind||"trackingButtonClickAway"===e.kind))),n=this.actions.pipe(l.h((e=>"trackingButtonClick"===e.kind)));return this._state.pipe(et.oA,l.h((({trackingState:e})=>"available"!==e&&"optedOut"!==e)),K.P(),Ke.c(rt.T(n,e.pipe(it.T(t.pipe(Ye.h(!1)),n.pipe(Ye.h(!1))),P.b(we.dd),at.x(),l.h((e=>e)),R.M(this._state.pipe(et.oA,tt.j("trackingButtonExpanded"))),o.b((([e,t])=>{t||this.actions.next({kind:"trackingButtonClick"})})))).pipe(Ke.c(We.S(t,e.pipe(P.b(we._p),at.x(),l.h((e=>!e)),o.b((()=>{this.actions.next({kind:"trackingButtonCloseClick"})})))).pipe(K.P())))))}_handleActions(){return this.actions.pipe(o.b((e=>{this._state.modify((t=>(0,r.zG)(t,g.tS((t=>{var n;switch(e.kind){case"trackingButtonClick":return"available"===t.trackingState?(0,r.zG)(t.popup,g.hX((e=>"optIn"===e)),g.WG)?g.G({...t,popup:g.YP,optInPopupWasClosedOnce:!0}):(this._gnar.hwrOptInPopupShow(this._documentId),g.G({...t,popup:g.G("optIn")})):g.G({...t,trackingButtonExpanded:!0,toast:g.YP});case"trackingButtonHover":return g.G(t);case"trackingButtonClickAway":case"trackingButtonCloseClick":case"viewReport":return g.G({...t,trackingButtonExpanded:!1});case"pause":return g.G({...t,trackingState:"paused"});case"resume":case"start":return g.G({...t,trackingState:"tracking"});case"closeOptInPopup":return this._gnar.hwrOptInPopupClose(this._documentId),g.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:g.YP,toast:g.G("optedIn")});case"optOut":return g.G({...t,trackingState:"optedOut",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:g.YP,toast:g.G("optedOut")});case"optIn":return g.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!0,popup:g.YP,toast:g.G("optedIn")});case"enableForDomain":return g.G({...t,trackingState:e.isNewDocument?"tracking":t.trackingState});case"resetForDomain":case"toastHover":return g.G({...t});case"plagiarismCheckButtonRender":return this._gnar.hwrPlagiarismButtonShow(this._documentId),g.G({...t});case"plagiarismCheckRequest":return this._gnar.hwrPlagiarismButtonClick(this._documentId),null===(n=this._requestPlagiarismCheck)||void 0===n||n.call(this),g.G({...t,trackingButtonExpanded:!1});case"optOutToastOkClick":case"dismissToast":case"clipboardWarningResult":return g.G({...t,toast:g.YP});case"clipboardRequestResult":return"allow"===e.result?g.G({...t,popup:g.YP}):g.G({...t,popup:g.YP,toast:g.G("clipboardWarning")});case"giveFeedback":return this._gnar.hwrGiveFeedbackButtonClick(this._documentId,this._domain),g.G({...t,popup:g.G("feedback")});case"feedbackPopupClose":return g.G({...t,popup:g.YP});case"feedbackSubmit":return this._gnar.hwrFeedbackSubmit(this._documentId,this._domain,e.feedback),g.G(t);default:(0,m.L0)(e)}})))))})))}_handleErrors(){return this.errors.pipe(o.b((e=>{this._state.modify((t=>(0,r.zG)(t,g.tS((t=>{switch(e.kind){case"reportGenerationFailed":return g.G({...t,toast:g.G("reportGenerationFailed")});case"clipboardPermissionRequestFailed":return g.G({...t,toast:g.G("clipboardPermissionRequestFailed")});case"databaseCorrupted":return g.G({...t,toast:g.G("storageDatabaseCorrupted")});case"serverError":return g.G({...t,toast:g.G("storageServerError"),trackingState:"paused"});case"unrecoverableError":return g.G({...t,toast:g.G("storageUnrecoverableError"),trackingState:"paused"})}})))))})))}_handleEvents(){return this._events.pipe(l.h((e=>"clipboardAccessRequested"===e.kind)),o.b((e=>{this._state.modify((e=>(0,r.zG)(e,g.tS((e=>g.G({...e,popup:g.G("clipboardAccess"),toast:g.YP}))))))})))}view(){return Xe.createElement(ot.w,null,Xe.createElement(lt.L,{chunkName:"humanWritingReport"},st.UI.mount(qn,(e=this,st.Z.composeUnion({None:()=>G.of(null),Some:st.Z.composeKnot({value:st.Z.composeKnot({root:()=>e.tButtonPosition,trackingButton:(t=e.state,n=e.actions,st.Z.composeUnion({None:()=>G.of(null),Some:st.Z.composeKnot({value:cr(t,n)})},(()=>t.pipe(et.cp((({trackingState:e})=>"optedOut"===e?G.of(g.YP):G.of(g.G(e)))))))),popup:tr(e.state,e.actions),toast:rr(e.state,e.actions)})})},(()=>e.state))))));var e,t,n}dispose(){this._subs.unsubscribe()}}const hr=()=>h.E,ur=()=>{const e=(0,w.CI)(document);return e?D.R(e,"keydown"):h.E};class mr{constructor(e,t="legacy"){this._deps=e,this._mode=t,this._subscriptions=new i.w0,this._disposables=p.h.create([]),this._listener=p.h.create(g.YP),this._copyContentListener=p.h.create(g.YP),this._ui=p.h.create(g.YP),this._checkPermissions=new a.x,this.isReportAvailable=p.h.create(!1),this._felog=(0,k.Cc)({variant:"legacy"===t?"legacy tracking":"decoupled tracking",documentId:e.documentId}),this._domain=e.CSState.view("page").view("domain").get(),this._subscriptions.add(this._handleCheckPermissions(this._checkPermissions).subscribe()),this._subscriptions.add(this._handleStateChanges(e.CSState).subscribe()),this._subscriptions.add(this._handleUIActions(this._deps.uiActions).subscribe()),this._subscriptions.add(this._handleFeatureEvents(this._deps.events).subscribe()),this._subscriptions.add(this._logStartedTracking(this._deps.uiActions,this._deps.events).subscribe()),this._subscriptions.add(this._handleErrors(this._deps.errors).subscribe()),this._subscriptions.add(this._deps.CSState.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe().subscribe((({enabled:e,humanWritingReport:t})=>{const n=this._deps.documentId,r=this._domain;this.isReportAvailable.set(e&&"enabled"===(null==t?void 0:t.kind)&&((0,f.MP)(n,r,t)||(0,f.Ng)(n,r,t)))})))}_handleStateChanges(e){return e.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe(s.U((({enabled:e,humanWritingReport:t})=>{if(e){if(t)switch(t.kind){case"available":case"optedOut":this._checkInitUI("optedOut"===t.kind),this._disposeListener(),this._disposeCopyContentListener();break;case"enabled":this._checkInitUI(),this._checkInitListener(),this._checkInitCopyContentListener(),(0,f.Ng)(this._deps.documentId,this._domain,t)?(this._checkPermissions.next(void 0),this._startTracking()):this._stopTracking();break;case"disabled":this._disposeListener(),this._disposeUI(),this._disposeCopyContentListener();break;default:(0,m.L0)(t)}}else this._disposeUI(),this._disposeListener(),this._disposeCopyContentListener()})))}_handleUIActions(e){return e.pipe(s.U((e=>{switch(e.kind){case"trackingButtonClick":this._deps.gnar.hwrButtonClick(this._deps.documentId);break;case"closeOptInPopup":this._deps.csToBgActions.hwrSetEnabled(!0);break;case"start":case"resume":this._deps.csToBgActions.hwrStartTracking({documentId:this._deps.documentId,domain:this._domain});break;case"enableForDomain":this._deps.gnar.hwrTrackingEnableForDomain(this._deps.documentId,this._domain),this._deps.csToBgActions.hwrStartTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"resetForDomain":this._deps.csToBgActions.hwrStopTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"pause":this._deps.gnar.hwrTrackingPause(this._deps.documentId),this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain});break;case"optOut":this._deps.gnar.hwrFeatureOptOut(this._deps.documentId),this._deps.csToBgActions.hwrOptOut();break;case"optIn":this._deps.gnar.hwrFeatureOptIn(this._deps.documentId),this._deps.csToBgActions.hwrOptIn();break;case"viewReport":this._deps.gnar.hwrReportButtonClick(this._deps.documentId),this._viewReport()}})))}_handleErrors(e){return e.pipe(o.b((e=>{switch(e.kind){case"serverError":case"unrecoverableError":this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain})}})))}_logStartedTracking(e,t){return e.pipe(l.h((({kind:e})=>"start"===e||"resume"===e)),s.U((({kind:e})=>"resume"===e)),c.w((e=>t.pipe(l.h((({kind:e})=>"knownStateMismatch"===e||"knownStateMatch"===e)),s.U((t=>({event:t,isResume:e})))))),d.q(1),o.b((({event:e,isResume:t})=>{"knownStateMismatch"===e.kind?this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,e.lengthDifference):this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,0)})))}_handleFeatureEvents(e){return e.pipe(o.b((e=>{switch(e.kind){case"sourcedTextAdded":this._deps.gnar.hwrKnownSourcePaste(this._deps.documentId,e.sourceDomain,e.textLength,e.promptDetected);break;case"unknownSourceTextAdded":this._deps.gnar.hwrUnknownSourcePaste(this._deps.documentId,e.textLength),e.textLength>=25&&this._felog.info("Large text change with unknown source detected",void 0,{changeLength:e.textLength});break;case"sourceAdded":this._deps.gnar.hwrKnownSourceDetect(e.sourceDomain,e.textLength,!1)}})))}_checkInitUI(e=!1){this._ui.modify((t=>(0,r.zG)(t,g.wp((()=>{const t=new dr(this._deps.CSState,this._deps.uiActions,this._deps.errors,this._deps.events,this._deps.documentId,this._deps.gnar,this._getTButtonPositionSource(),this._deps.requestPlagiarismCheck),n=y.V.get({monitorAs:"human-writing-report"}).inject(C.EM.fromDocument(self.document,"grammarly-human-writing-report"),C.zs.appendChild(self.document.documentElement),S.G7.showWhenLoaded(t.view()));return!e&&this._deps.gnar.hwrButtonShow(this._deps.documentId),g.G({viewModel:t,dispose:()=>{n.dispose(),t.dispose()}})})))))}_getTButtonPositionSource(){return(0,v.Lu)()?mt:ut}_getKeyboardEventsSource(){return(0,v.Lu)()?ur:hr}_startTracking(){(0,r.zG)(this._listener.get(),g.UI((e=>{e.startTracking()})))}_stopTracking(){(0,r.zG)(this._listener.get(),g.UI((e=>{e.stopTracking()})))}_checkInitListener(){this._listener.modify((e=>(0,r.zG)(e,g.wp((()=>g.G("legacy"===this._mode?new ze(this._deps.documentId,this._deps.alertsState,this._deps.textObserver,this._deps.selectionSource,this._deps.CSState,this._deps.replacementListener,this._deps.events,this._deps.encryptionClient,this._deps.errors,this._getKeyboardEventsSource()(),(0,b.OB)(),this._deps.sessionId):new Je({documentId:this._deps.documentId,sessionId:this._deps.sessionId,textObserver:this._deps.textObserver,selectionChanges:this._deps.selectionSource.data.changes,editsTrackingEvents:this._deps.events,editsTrackingErrors:this._deps.errors,encryptionService:this._deps.encryptionClient,keyboardEvents:this._getKeyboardEventsSource()(),replacementAppliedEvents:this._deps.replacementListener.obs,userId:this._deps.CSState.view("user","id").get(),copiedTextMessage:this._deps.CSState.view("copiedTextMessage"),advancedLoggingEnabled:this._deps.CSState.view("page","advancedHistoryLoggerEnabled"),alertsState:this._deps.alertsState,alertStateChanges:this._deps.alertsStateChanges,env:(0,b.OB)()})))))))}_handleCheckPermissions(e){return e.pipe(c.w((()=>(0,b.OB)().bgRpc.api.isPermissionGranted(_.d.clipboardRead))),l.h((e=>!e)),s.U((()=>{const e=this._deps.CSState.view("page","humanWritingReport").get();return"enabled"===(null==e?void 0:e.kind)&&void 0===(null==e?void 0:e.deniedClipboardAccessSince)})),l.h(Boolean),o.b((()=>{this._deps.events.next({kind:"clipboardAccessRequested"})})),c.w((()=>this._deps.uiActions.pipe(l.h((e=>"clipboardRequestResult"===e.kind&&"allow"===e.result||"clipboardWarningResult"===e.kind)),s.U((e=>"allow"===e.result)),d.q(1)))),c.w((e=>e?(this._deps.gnar.hwrClipboardPermissionRequest(this._deps.documentId),(0,b.OB)().bgRpc.api.requestGrantPermission(_.d.clipboardRead)):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess(),h.E))),u.K((()=>(this._deps.errors.next({kind:"clipboardPermissionRequestFailed"}),h.E))),o.b((e=>{e?(this._deps.gnar.hwrClipboardPermissionAllow(this._deps.documentId),this._deps.csToBgActions.hwrAllowClipboardAccess()):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess())})))}_checkInitCopyContentListener(){(0,v.Lu)()&&this._copyContentListener.modify((e=>(0,r.zG)(e,g.wp((()=>g.G(new x.CopyContentListener((0,b.OB)(),this._deps.CSState.view("page","humanWritingReport"),this._deps.gnar,this._domain,this._deps.dynamicConfig,(0,w.CI)(document)||void 0,self,(0,w.CI)(document)||void 0)))))))}_viewReport(){(0,r.zG)(this._listener.get(),g.UI((async e=>{try{const t=await e.getReportableDocument();try{const e=await this._deps.backendClient.generateReport(t);self.open(e,"_blank")}catch(e){let t="Unknown error";"string"==typeof(null==e?void 0:e.message)?t=e.message:"string"==typeof e&&(t=e),this._felog.error("reportGenerationFailed",JSON.stringify(t)),this._deps.errors.next({kind:"reportGenerationFailed"})}}catch(e){let t="Can't get reportable document from listener";"string"==typeof(null==e?void 0:e.message)?t=e.message:"string"==typeof e&&(t=e),this._felog.error("reportGenerationFailed",JSON.stringify(t)),this._deps.errors.next({kind:"reportGenerationFailed"})}})))}_disposeUI(){this._ui.modify((e=>(0,r.zG)(e,g.tS((e=>(e.dispose(),g.YP))))))}_disposeListener(){this._listener.modify((e=>(0,r.zG)(e,g.tS((e=>(e.dispose(),g.YP))))))}_disposeCopyContentListener(){this._copyContentListener.modify((e=>(0,r.zG)(e,g.tS((e=>(e.dispose(),g.YP))))))}dispose(){this._subscriptions.unsubscribe(),this._disposeUI(),this._disposeListener(),this._disposeCopyContentListener()}}},28440:(e,t,n)=>{n.r(t),n.d(t,{CopyContentListener:()=>O});var r=n(32073),i=n(36344),a=n(84308),s=n(44071),o=n(59179),l=n(954),c=n(20161),d=n(24335),h=n(90572),u=n(79256),m=n(64715),p=n(8065),g=n(17543),_=n(31789),f=n(84714),k=n(18827),v=n(66878),b=n(64271),y=n(29479),C=n(29416),S=n(63532),w=n(13391),x=n(52341),E=n(72257),I=n(70932);const T=e=>({getAll:async()=>await e.getAll(),get:async t=>await e.get(t),patch:async t=>await e.set(t),changes:e.changes});var D;!function(e){e.make=function(e,t,n,r){return{valid:!0,copiedText:n,sourceURL:e,sourceName:t,userPrompt:r}}}(D||(D={}));var A=n(37636),R=n(71351),L=n(74822),M=n(7849),B=n(91795);class P{getPromptForText(){return null}dispose(){}}class U{constructor(e,t){this._promptsSelector=e,this._responsesSelector=t,this._pairs=new Map,this._subs=new r.w0,this._prompts=new L.x,this._pairsOutdated=w.h.create(!0),this._subs.add(this._setupMutationObserver().subscribe((()=>{this._pairsOutdated.set(!0)})))}_searchForPairs(){const e=Array.from(document.querySelectorAll(this._promptsSelector));if(e){const t=Array.from(document.querySelectorAll(this._responsesSelector));t&&t.length===e.length&&e.forEach(((e,n)=>{var r,i;const a=(null===(r=e.textContent)||void 0===r?void 0:r.trim())||null;if(a){const e=(null===(i=t[n].textContent)||void 0===i?void 0:i.trim())||null;e&&this._pairs.set((0,M.Ue)(e),{prompt:a,response:e})}}))}this._pairsOutdated.set(!1)}_setupMutationObserver(){return B.x.create(document,{attributes:!1,subtree:!0,childList:!0}).pipe((0,o.U)((e=>e.filter((e=>e.addedNodes.length>0)).some((e=>Array.from(e.addedNodes).filter((e=>e instanceof HTMLElement)).some((e=>e.matches(this._responsesSelector)||e.querySelector(this._responsesSelector))))))),(0,h.h)(Boolean))}getPromptForText(e){var t;return this._pairsOutdated.get()&&this._searchForPairs(),(null===(t=this._pairs.get((0,M.Ue)(e)))||void 0===t?void 0:t.prompt)||null}dispose(){this._subs.unsubscribe()}}const G=[{name:"OpenAI",is:e=>"chat.openai.com"===e||"chatgpt.com"===e,matcher:()=>new U('div[data-message-author-role="user"]','div[data-message-author-role="assistant"]')},{name:"Google Gemini",is:e=>"gemini.google.com"===e,matcher:()=>new U("div.query-content","div.response-content")},{name:"Claude AI",is:(e,t)=>/claude.ai\/chat\//.test(t),matcher:()=>new U("div.font-user-message","div.font-claude-message")},{name:"Perplexity AI",is:e=>/^(www\.)?perplexity\.ai$/.test(e),matcher:()=>new U(".whitespace-pre-line.break-words","div.prose")}];function F(e){return e.length>25?`${e.slice(0,25)}...`:e}class O{constructor(e,t,n,u,m,p=self,g=self,_=self){this._env=e,this._featureState=t,this._gnar=n,this._domain=u,this._dynamicConfig=m,this._keyboardEventsTarget=p,this._mouseEventsTarget=g,this._copyEventsTarget=_,this._log=I.Y.create("CopyContentListener"),this._subs=new r.w0,this._clipboardText=w.h.create(""),this._genAIMatcher=function(){const{hostname:e,href:t}=self.location;for(const n of G)if(n.is(e,t))return n.matcher();return new P}(),null==e.browserApi?(this._trackingEnabled=i.E,this._log.warn("CopyContentListener cannot be initialized, browserApi is not available")):(this._store=(0,R.T)(T(e.browserApi.preferences)),this._trackingEnabled=a.a(s.R(document,"visibilitychange").pipe(o.U((()=>!document.hidden)),l.O(!document.hidden)),t,m).pipe(o.U((([e,t,n])=>e&&(0,E.YI)(u,t,n))),c.w((e=>e?this._env.bgRpc.api.isPermissionGranted(x.d.clipboardRead):Promise.resolve(!1))),d.d({bufferSize:1,refCount:!0})),this._subs.add(this._setupTrackingBecameEnabledHandler()),this._subs.add(this._clipboardText.pipe(h.h((e=>e.length>0))).subscribe((e=>this._onClipboardChange(e)))),this._log.info("CopyContentListener initialized"))}_readClipboard(){return u.P((()=>navigator.clipboard.readText())).pipe(m.a((e=>e.pipe(p.b(((e,t)=>(0===t&&this._log.debug("Error getting text, will retry",e.message),g.s((()=>t>0),_._(e),f.of(e).pipe(k.g(50))))))))),v.K((e=>(this._log.debug("Error getting text, after one retry, give up for now",e.message),i.E))))}_setupTrackingBecameEnabledHandler(){return this._trackingEnabled.pipe(c.w((e=>e?this._userActionSequenceHandler():i.E))).subscribe()}_userActionSequenceHandler(){const e={capture:!0,once:!1,passive:!0};return b.T(s.R(this._mouseEventsTarget,"mousedown",e),s.R(this._keyboardEventsTarget,"keydown",e),s.R(this._copyEventsTarget,"copy",e),s.R(this._copyEventsTarget,"cut",e)).pipe(c.w((t=>g.s((()=>"copy"===t.type||"cut"===t.type),u.P((()=>d.HT(50).pipe(c.w((()=>this._readClipboard()))))),u.P((()=>this._readClipboard().pipe(c.w((n=>{switch(t.type){case"mousedown":return s.R(this._mouseEventsTarget,"mouseup",e).pipe(y.h(n));case"keydown":return s.R(this._keyboardEventsTarget,"keyup",e).pipe(y.h(n));default:return i.E}}))))).pipe(C.b(150),c.w((e=>this._readClipboard().pipe(o.U((t=>[e,t]))))),h.h((([e,t])=>e!==t)),o.U((([e,t])=>t)))))),S.b((e=>{this._log.debug("Clipboard has changed after a user action. Saving:",F(e)),this._clipboardText.set(e)})))}_onClipboardChange(e){const t=this._genAIMatcher.getPromptForText(e);t&&this._log.debug("Found genAI prompt for text:",t);this._store.get().then((n=>{const r=n.copiedTextMessage;if(null==r||!(null==r?void 0:r.valid)||(null==r?void 0:r.valid)&&r.copiedText!=e){const n=new A.m;this._log.debug("New clipboard text:",F(e)),this._gnar.hwrKnownSourceDetect(self.location.origin,e.length,Boolean(t)),this._store.set(D.make(n.url,n.title,e,t||void 0))}}))}dispose(){this._subs.unsubscribe(),this._genAIMatcher.dispose()}}},37636:(e,t,n)=>{n.d(t,{m:()=>i});var r=n(55231);class i{constructor(){this.location=self.location,this._title=document.title}get url(){return this.location.href}get title(){return this._title}isGoogleDocs(){return"docs.google.com"==this.location.hostname}get documentID(){return this.isGoogleDocs()?(0,r.j)(this.location.href):null}}},72257:(e,t,n)=>{n.d(t,{E3:()=>o,MP:()=>s,Ng:()=>a,YI:()=>l,wg:()=>i});var r=n(5768);const i={kind:"available",optInPopUpWasClosedAtLeastOnce:!1};function a(e,t,n){if("enabled"===n.kind){const r=n.domainSettings.find((({domain:e})=>e===t));return!!r&&(r.logAllDocuments?!r.pausedDocumentIds.includes(e):r.activeDocumentIds.includes(e))}return!1}function s(e,t,n){var r;if("enabled"===n.kind){const i=n.domainSettings.find((({domain:e})=>e===t));return!!i&&(!!i.logAllDocuments||((null===(r=i.pausedDocumentIds)||void 0===r?void 0:r.includes(e))||i.activeDocumentIds.includes(e)))}return!1}function o(e,t){var n,r;return"enabled"===t.kind&&Boolean(null===(r=null===(n=t.domainSettings)||void 0===n?void 0:n.find((({domain:t})=>t===e)))||void 0===r?void 0:r.logAllDocuments)}function l(e,t,n){if("enabled"===(null==t?void 0:t.kind)&&void 0===t.deniedClipboardAccessSince){const i=void 0===t.allowedClipboardAccess?function(e){return"enabled"===(null==e?void 0:e.kind)&&e.domainSettings.some((e=>e.logAllDocuments?e.logAllDocuments:e.activeDocumentIds.length>0))}(t):t.allowedClipboardAccess,a=t.allDomainsTrackingEnabled?""!==e&&r.yg.concat((null==n?void 0:n.blockedDomains)||[]).every((t=>!new RegExp(t).test(e))):r.XW.some((t=>new RegExp(t).test(e)));return i&&a}return!1}},7849:(e,t,n)=>{n.d(t,{$2:()=>k,Cc:()=>b,Hq:()=>a,QY:()=>r,Ue:()=>d,Xw:()=>h,aS:()=>c,fo:()=>_,k4:()=>g,tg:()=>f});var r,i,a,s=n(93018),o=n(3492),l=n(99836);function c(e,t){if(e.length<=t)return e;if(t<=3)return"...";const n=Math.ceil((t-3)/2),r=Math.floor((t-3)/2);return`${e.substring(0,n)}...${e.substring(e.length-r,e.length)}`}function d(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()\s]/g,"").toLowerCase()}function h(e){var t;return(null===(t=/^(hwr:\/\/.+$|https?:\/\/[^/]+)/.exec(e))||void 0===t?void 0:t[1])||"Undetermined"}!function(e){e.getNumInsertedLetters=function(e){return e.ops.reduce(((e,t)=>s.s.isInsertString(t)?e+s.s.getInsertLength(t):e),0)},e.getNumDeletedLetters=function(e){const t=e.ops.filter((e=>s.s.isDelete(e)));let n=0;return t.forEach((e=>{s.s.isDelete(e)&&(n+=e.delete)})),n},e.getSummary=function(e,t){return t.ops.reduce(((t,n)=>{let{retained:r,retainedPrefix:i,deleted:a,inserted:o,maximalReplacement:l}=t.summary,c=t.pointer;return s.s.isRetain(n)&&(r=`${r}${e.substring(c,c+n.retain)}`,i=0===a.length&&0===o.length?`${i}${e.substring(c,c+n.retain)}`:i,l=l.length?`${l}${e.substring(t.pointer,t.pointer+n.retain)}`:l,c+=n.retain),s.s.isDelete(n)&&(a=`${a}${e.substring(c,c+n.delete)}`,c+=n.delete),s.s.isInsertString(n)&&(o=`${o}${n.insert}`,l=`${l}${n.insert}`),{pointer:c,summary:{retained:r,retainedPrefix:i,deleted:a,inserted:o,maximalReplacement:l}}}),{pointer:0,summary:{retained:"",retainedPrefix:"",deleted:"",inserted:"",maximalReplacement:""}}).summary},e.extractMaximalReplacementString=function(e,t){return t.ops.reduce(((t,n)=>(s.s.isInsertString(n)?t.text=`${t.text}${n.insert}`:s.s.isDelete(n)?t.originalTextPointer+=n.delete:s.s.isRetain(n)&&(t.text.length&&(t.text=`${t.text}${e.substring(t.originalTextPointer,t.originalTextPointer+n.retain)}`),t.originalTextPointer+=n.retain),t)),{text:"",originalTextPointer:0}).text||null},e.singleDelta=function(e,t){if(e===t)return new o.i([]);let n=0;const r=Math.min(e.length,t.length);for(;n<r&&e[n]===t[n];)n++;let i=0;for(;n+i<r&&t[t.length-i-1]===e[e.length-i-1];)i++;const a=e.length-(n+i),s=t.length-(n+i),l=[...n>0?[{retain:n}]:[],...a>0?[{delete:a}]:[],...s>0?[{insert:t.substring(n,n+s)}]:[]];return new o.i(l)},e.isNoTextChangesDelta=function(e){return e.ops.every((e=>s.s.isInsertString(e)?!e.insert.length:!s.s.isDelete(e)||!e.delete))}}(r||(r={})),function(e){e.isTextEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char)return!1;return!0},e.isContentEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char||e[n].sourceContentId!=t[n].sourceContentId||e[n].isSelfAuthored!=t[n].isSelfAuthored)return!1;return!0}}(i||(i={})),function(e){e.hasPerLetterTags=function(e){return e.isSelfAuthoredTags.length==e.text.length},e.toLoggableString=function(e){const t=c(e.text,40);return`CopiedContent [text length=${e.text.length}, has per letter tags=$hasPerLetterTags({sourcedContent)}, text=${t}]`},e.eq=function(e,t){if(e.length!==t.length)return!1;const n=e.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName))),r=t.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName)));return n.every(((e,t)=>e.text===r[t].text&&e.sourceName===r[t].sourceName))}}(a||(a={}));const u=new Set(["'","‘","’","＇","ߴ","ߵ"]),m=new Set(['"',"«","»","","“","”","„","‟","‹","›","❮","❯","❝","❞","❛","❜","〝","〞","⹂"]),p={a:new Set(["æ"]),s:new Set(["ß"])};function g(e,t,n){var i,a,s,o;const l=r.getSummary(e,t);return".."===l.deleted&&"…"===l.inserted&&"."===(null===(i=n[0])||void 0===i?void 0:i.key)||"…"===l.deleted&&"..."===l.inserted&&""===(null===(a=n[0])||void 0===a?void 0:a.key)||"-"===l.deleted&&"–"===l.inserted&&"-"===(null===(s=n[0])||void 0===s?void 0:s.key)||"–"===l.deleted&&"--"===l.inserted&&""===(null===(o=n[0])||void 0===o?void 0:o.key)?1:0}function _(e,t){return!!e.length&&e.split("").every(((e,n)=>{var r;return void 0!==(null===(r=t[n])||void 0===r?void 0:r.key)&&function(e,t){var n;return 1===e.length&&1===t.length&&(e===t||0===e.localeCompare(t,void 0,{sensitivity:"case"})||Boolean(null===(n=p[e])||void 0===n?void 0:n.has(t))||"'"===e&&u.has(t)||'"'===e&&m.has(t))}(t[n].key,e)}))}function f(e){return e.map((e=>({...e,key:/\p{Letter}/u.test(e.key)?"#":e.key})))}function k(e){try{return e.replace(/<[^>]*>/g,"").replace(/^(\s*)([*\-+]|\d+\.)\s+/gm,"").replace(/!\[(.*?)\][[(].*?[\])]/g,"$1").replace(/\[([^\]]*?)\][[(].*?[\])]/g,"$1").replace(/^(\n)?\s*#{1,6}\s*( (.+))? +#+$|^(\n)?\s*#{1,6}\s*( (.+))?$/gm,"$1$3$4$6").replace(/^[=-]{2,}\s*$/gm,"").replace(/^\s*[*\- ]+\s*$/gm,"").replace(/^(\s{0,3}>\s?)+/gm,"").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(`{3,})[\s\S]+?\1\s*/g,"").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1").replace(/ {2}\n/g,"\v ").replace(/\n{2}/g,"\n").replace(/([^\n])$/,"$1\n")}catch(t){return e}}function v(e={},t){let n={...e};return t&&(n="object"==typeof t?{...n,...t}:{...n,data:t}),n}function b(e={}){const t=(0,l.Tb)().humanWritingReport;return{error:(n,r,i,a)=>{t.error(n,r,i,v(e,a))},warning:(n,r,i,a)=>{t.warning(n,r,i,v(e,a))},info:(n,r,i)=>{t.info(n,r,v(e,i))}}}},91901:(e,t,n)=>{n.d(t,{$x:()=>s,F8:()=>g,Go:()=>i,Kt:()=>y,Lq:()=>c,QR:()=>I,Qy:()=>f,Vk:()=>C,Wp:()=>r,XG:()=>a,_m:()=>u,d0:()=>d,f:()=>l,gH:()=>_,gL:()=>S,ij:()=>E,j5:()=>b,jW:()=>p,l$:()=>m,lO:()=>x,os:()=>v,rx:()=>w,uj:()=>h,y1:()=>o,yw:()=>k});const r=".kix-appview-editor",i=".docos-input",a=".docs-texteventtarget-iframe",s=".kix-cursor",o=".kix-cursor-caret",l="#docs-revisions-sidebar",c='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',d="#docs-toolbar-mode-switcher",h="edit-mode",u="suggest-mode",m="titlebar-mode-indicator-container",p="#titlebar-mode-indicator-container .titlebar-request-access-button",g="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",_="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",f=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",k=".kix-page-paginated",v=".kix-page-paginated.canvas-first-page",b=".docs-horizontal-ruler",y=".docs-vertical-ruler",C="#fontSizeSelect input",S=".docs-ruler-background",w=".docs-ruler-background-inner",x=".docs-ruler-indent-first-line",E=".modal-dialog.docs-dialog .fatal-error-message",I='#docs-titlebar-share-client-button div[role="button"]'},55231:(e,t,n)=>{n.d(t,{j:()=>i});var r=n(67458);function i(e){const t=e.match(/d\/(.*?)\//);return t?r.createHash("superfasthash").hash(t[1]):null}},44637:(e,t,n)=>{n.d(t,{J:()=>d});var r=n(90023),i=n(49231),a=n(49225),s=n(3527),o=n(63532),l=n(37213),c=n(14482);const d=({onChange:e,labelId:t,className:n,checkboxClassName:d,labelClassName:h,checked:u,children:m,disabled:p,useDS:g,dataGrammarlyPart:_="ui-kit-checkbox",tabIndex:f=0,onMount:k=r.Q1})=>{const[v,b]=i.useState(null!=u&&u);i.useEffect((()=>{b(Boolean(u))}),[u]);const y=t=>{t.preventDefault(),t.stopPropagation(),b(!v),null==e||e(!v)},{ref:C,onMount:S}=a.P.useElWatcher();return i.useEffect((()=>{const e=C.pipe(s.oA,o.b(k)).subscribe();return()=>e.unsubscribe()}),[]),i.createElement("div",{"data-grammarly-part":_,...(0,l.Sh)(c.checkboxContainer,n)},i.createElement("div",{...(0,l.Sh)(c.checkbox,d,v?c.checkboxChecked:null,g?c.checkboxDS:null),role:"checkbox","aria-checked":v,tabIndex:f,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&y(e)},onClick:p?r.Q1:y,ref:S},v?i.createElement("div",{className:c.checkboxCheckmark}):null),i.createElement("label",{id:t,onClick:y,className:h},m))}},96130:(e,t,n)=>{n.d(t,{E:()=>s});var r=n(49231),i=n(37213),a=n(17345);const s=({options:e,onChange:t=(()=>null),ariaLabel:n,className:s})=>{const o=[],[l,c]=r.useState(null);r.useEffect((()=>{var n;null!==l&&(null===(n=o[l])||void 0===n||n.focus()),t(null!==l?e[l].value:null)}),[l]);const d=null!==l?e[l]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:s},r.createElement("div",{className:a.radioGroup,role:"radiogroup","aria-label":n,onKeyDown:t=>{if(" "!==t.key||d){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();c(((l||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const n=(l||0)-1;c(n<0?e.length-1:n)}}else t.preventDefault(),t.stopPropagation(),c(0)}},e.map(((e,t)=>{const n=(null==d?void 0:d.value)===e.value,s=0===t;return r.createElement("div",{key:e.value,...(0,i.Sh)(a.radioGroupOption,n?a.radioGroupOptionSelected:null),role:"radio",tabIndex:n||s&&!d?0:-1,"aria-checked":n,onClick:e=>{e.preventDefault(),e.stopPropagation(),c(t)},ref:e=>o.push(e)},e.render())}))))}},21136:(e,t,n)=>{n.d(t,{z:()=>u});var r=n(49231),i=n(64151);const a=({children:e,style:t,dataGrammarlyPart:n="ui-kit-iframe",...a})=>{const[s,o]=r.useState(null),l=r.useCallback((e=>{var t,n;let r=null;"contentDocument"in e.target&&(r=null!==(n=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==n?n:null),o(r),r&&(r.style.margin="0",r.style.height="100vh",r.style.overflowY="hidden")}),[]);return r.createElement("iframe",{...a,style:{border:"none",...t},onLoad:l,srcDoc:"<html><body></body></html>","data-grammarly-part":n},s&&(0,i.createPortal)(e,s))};var s=n(1208),o=n(70632),l=n.n(o),c=n(6986),d=n(4798);const h=({placeholder:e,ariaLabel:t,onChange:n})=>{const[i,a]=r.useState("");return r.useEffect((()=>{n(i)}),[i]),r.createElement(r.Fragment,null,r.createElement(s.b,null,l().__css),r.createElement("div",{role:"textbox",className:l().textBox,contentEditable:!0,onInput:e=>{a(e.target.innerText)},"data-placeholder":e,"aria-placeholder":e,"aria-label":t}))},u=({placeholder:e,onChange:t,ariaLabel:n,iframeTitle:i,className:s})=>(0,c.OB)().experimentClient.isGateEnabled(d.K.CentralizeStopEventPropagation)?r.createElement("div",{className:s,style:{width:"100%",height:"128px",maxHeight:"inherit"}},r.createElement(h,{onChange:t,ariaLabel:n,placeholder:e})):r.createElement(a,{dataGrammarlyPart:"ui-kit-textbox",className:s,style:{width:"100%",height:"100%"},title:i},r.createElement(h,{onChange:t,ariaLabel:n,placeholder:e}))},78225:(e,t,n)=>{n.d(t,{V:()=>s});var r=n(49231),i=n(63039),a=n(29357);const s=e=>e.isEnabled?r.createElement(a.T,{type:"mini",size:26,className:i.feedbackFormLogoLine}):null},80882:(e,t,n)=>{n.d(t,{b:()=>S});var r=n(49231),i=n(37213),a=n(12990),s=n(63039);const o=({fixSubmitButtonOverflowBottomPadding:e,className:t,...n})=>r.createElement(r.Fragment,null,r.createElement(a.z,{...n,className:null!=t?t:s.feedbackFormSubmitButton},n.children),r.createElement(l,{isEnabled:e})),l=e=>e.isEnabled?r.createElement("div",{className:s.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:s.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null,c=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,i.Sh)(s.feedbackFormContainer,s.feedbackFormContainerAlignCenter)},r.createElement("div",{className:s.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:s.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:s.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:s.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(o,{type:"button",kind:"success",onClick:e.onClose},"Done"));var d=n(21136),h=n(44637);const u=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:s.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(h.J,{checked:e.checked,labelId:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:s.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null;var m=n(78225);const p=e=>{var t;if(!e.isEnabled)return null;const n=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,i.Sh)(s.feedbackFormTitle,e.isCompact&&s.compact)},n)};var g=n(79992),_=n(96130),f=n(29221),k=n(45321);const v=e=>{const t=[f.B.bad,f.B.ok,f.B.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(_.E,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:k.feedbackFormOption},r.createElement("div",{...(0,i.Sh)(k.feedbackFormOptionIcon,b(e))}),r.createElement("div",null,function(e){switch(e){case f.B.bad:return"I dislike it";case f.B.ok:return"It’s OK";case f.B.good:return"I like it";default:(0,g.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,i.Sh)(s.feedbackFormScore,e.compactDisplay&&s.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:s.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function b(e){switch(e){case f.B.bad:return k.feedbackFormOptionIconDisheartening;case f.B.ok:return k.feedbackFormOptionIconNeutral;case f.B.good:return k.feedbackFormOptionIconSmiling;default:(0,g.vE)(e)}}const y=e=>{var t,n,a,l;const[c,h]=r.useState(null),[g,_]=r.useState(""),[f,k]=r.useState(null!==(t=e.domainSharedByDefault)&&void 0!==t&&t);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,i.Sh)(s.feedbackFormContainer,"center"===e.align&&s.feedbackFormContainerAlignCenter)},r.createElement("div",{className:s.feedbackFormFields},r.createElement(m.V,{isEnabled:!e.hideLogo}),r.createElement(p,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(n=e.compactDisplay)&&void 0!==n&&n}),r.createElement(v,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:h}),r.createElement(d.z,{onChange:_,placeholder:null!==(a=e.placeholderText)&&void 0!==a?a:"Your thoughts here",ariaLabel:"Feedback Text",iframeTitle:"Feedback text field",...(0,i.Sh)(s.feedbackFormTextBox,e.compactDisplay&&s.compact)}),r.createElement(u,{domain:e.domain,checked:e.domainSharedByDefault,withHelpText:!e.hideDomainHelpText,onChange:k})),r.createElement(o,{type:"submit",kind:null!==(l=e.submitButtonKind)&&void 0!==l?l:"success",disabled:e.withScore?!c:!g,fixSubmitButtonOverflowBottomPadding:e.fixSubmitButtonOverflowBottomPadding,onClick:t=>{t.preventDefault();const n=f?e.domain:void 0;e.withScore&&c?e.onSubmit({score:c,text:g,domain:n}):!e.withScore&&g&&e.onSubmit({text:g,domain:n})}},"Submit"))};var C=n(84602);const S=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:n=!1,showPostSubmitScreen:i=!0,...a})=>{const[s,o]=r.useState(!1),l=s&&i;return r.createElement("div",{style:a.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},l?r.createElement(c,{fixSubmitButtonOverflowBottomPadding:n,onClose:a.onClose}):r.createElement(y,{...a,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:n,onSubmit:e=>{a.withScore?((0,C.n8)(e),a.onSubmit(e)):((0,C.TY)(e),a.onSubmit(e)),o(!0)}}))}},29221:(e,t,n)=>{var r;n.d(t,{B:()=>r}),function(e){e.bad="bad",e.ok="ok",e.good="good"}(r||(r={}))},84602:(e,t,n)=>{function r(e){return"score"in e}function i(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function a(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}n.d(t,{TY:()=>a,dK:()=>r,n8:()=>i})},98544:(e,t,n)=>{var r=n(42663),i=n(2963)(r);i.push([e.id,"._z3YOv-textBox{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._z3YOv-textBox:empty:before{font-feature-settings:'ss03' on;font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),i.locals={textBox:"_z3YOv-textBox"},e.exports=i},27645:e=>{e.exports={accordionContent:"RZ1tY",shown:"Rodx_",accordionHeader:"zZM6o",accordionItem:"SVcPo",accordionRoot:"ieqWq",accordionTrigger:"lQxeR",linkIcon:"oS7tX",headerContainer:"iMmjP",accordionIcon:"jaZE7",rotate:"Rbcv_"}},14482:e=>{e.exports={checkboxContainer:"Te37e",checkbox:"mFHkX",checkboxDS:"DdH2q",checkboxChecked:"JhHnz",checkboxCheckmark:"zShXt",spin:"tww6q"}},17345:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},63039:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormSubmitButton:"tYYGU",feedbackFormSubmitButtonFixOverflowBottomPadding:"Opd8X",feedbackFormSubmitButtonFixOverflowBottomPaddingChild:"QKLT7",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},45321:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);