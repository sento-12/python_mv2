(self.webpackChunk=self.webpackChunk||[]).push([[4382],{99498:(e,t,i)=>{i.r(t),i.d(t,{CheetahFeatureImpl:()=>Pi,isAssistantOpened:()=>ki,isGenAIAssistantOpened:()=>Ti});var n=i(18117),s=i(92135),r=i(72106),a=i(90023),o=i(49231),l=i(61649),c=i(81850),h=i(11095),d=i(5378),u=i(76068),p=i(23920),g=i(664),m=i(32073),f=i(74822),v=i(3527),_=i(20161),b=i(64271),S=i(90572),y=i(84178),w=i(36344),A=i(94592),I=i(84308),C=i(59179),x=i(63532),E=i(84714),R=i(24666),k=i(954),T=i(78129),P=i(18827),M=i(29416),U=i(29479),O=i(37213),F=i(13391),D=i(97767),B=i(58303),z=i(52303),G=i(5876),N=i(22422);var j=i(96601),H=i(92203),L=i(74983),W=i(94525),V=i(68942),q=i(4798),Y=i(70932),K=i(76576),J=i(68607),$=i(39953),X=i(56424),Q=i(20680),Z=i(79256),ee=i(26156),te=i(24335),ie=i(27341),ne=i(32080),se=i(22389),re=i(48666),ae=i(26278),oe=i(5718),le=i(45851),ce=i(30302),he=i(21428),de=i(92782),ue=i(47387),pe=i(53829),ge=i(68485),me=i(77365),fe=i(97310);function ve({node:e}){const t=o.useContext(fe.nS.Context);return o.useEffect((()=>{if(t&&!e.isConnected)return t.host.appendChild(e),()=>e.remove()}),[e]),null}var _e=i(37717),be=i(48739);const Se="extension-assistant-visually-ready",ye="extension-assistant-interaction-ready",we=`${be.V.assistantOpenAttempt}-to-extension-assistant-visually-ready`;class Ae{constructor(e){this._params=e,this.sizeBehavior=this._params.sizeBehavior,this.dragBehavior=this._params.dragBehavior,this.hostInfo=this._params.hostInfo}static markOpenAttempt(){performance.mark(be.V.assistantOpenAttempt)}static markVisuallyReady(){performance.mark(Se)}static markInteractionReady(){performance.mark(ye)}static measureOpenAttemptToVisuallyReady(){try{return performance.measure(we,be.V.assistantOpenAttempt).duration}catch(e){return}}static measureVisuallyReadyToInteractionReady(){try{return performance.measure("extension-assistant-visually-ready-to-extension-assistant-interaction-ready",Se).duration}catch(e){return}}starting(){return Promise.resolve()}visuallyReady(){Ae.markVisuallyReady();const e=Ae.measureOpenAttemptToVisuallyReady();return this._params.gnarTracking.trackVisuallyReady(e),this._params.onVisuallyReady(),Promise.resolve()}interactionReady(e){Ae.markInteractionReady();const t=Ae.measureVisuallyReadyToInteractionReady();return this._params.gnarTracking.trackInteractionReady(e,t),Promise.resolve()}focusStateChanged(e){return this._params.onFocusStateChanged(e),Promise.resolve()}readyToDrag(e){return this._params.onReadyToDrag(e)}close(){return this._params.gnarTracking.trackClose(),this._params.onClose(),Promise.resolve()}openUrl(e){return self.open(e,"_blank","noreferrer"),Promise.resolve()}dispose(){this._params.gnarTracking.dispose()}}var Ie=i(17613),Ce=i(11456),xe=i(37285);function Ee(e){switch(e){case"revision":return"revisionOnly";case"genAI":case"genAIAndWritingExpert":return"genAIOnly";case"genAIAndRevision":return"genAIAndRevision";default:(0,Ie.L0)(e)}}function Re(e,t){var i;if("genAI"===e.assistantMode)return;if("inlineCardSource"!==(null===(i=e.source)||void 0===i?void 0:i.kind))return;const n=e.source.alertId;if(null==n)return;const s=t.alerts.getAlertById(n);if(null==s||!Ce.S.isCapiAlert(s)||!W.DD.isRegular(s))return;const r=(0,xe.UQ)(s,s.text)[0];return null!=r?{alertId:n,alertPname:s.patternName,originalText:s.text,replacementText:r.newText}:void 0}var ke=i(50750),Te=i(30646),Pe=i(15281),Me=i(86399),Ue=i(3492),Oe=i(12518),Fe=i(35947);function De(e,t,i,n){const{left:s,right:r}=(0,a.zG)(e,Me.UI((({alertId:e,alternativeIndex:i})=>Be(e,i,function(e,t){return Oe.fromOption((()=>`Alert ${e} not found`))(t(e))}(e,t)))),Me.oh);return ze(e,r,i,n,s)}function Be(e,t,i){return(0,a.zG)(i,Oe.filterOrElse(Ce.S.isCapiAlert,(t=>`Unsupported alert ${e} with type ${t._tag}`)),Oe.chain((i=>{let n;return n=L.$.isWithTransformJson(i)?(0,a.zG)(i.transformJSON.alternatives,B.tS((e=>{var i;return B.ij(null===(i=e.alternatives[t])||void 0===i?void 0:i.delta)})),Oe.fromOption((()=>`Alternative ${t} not found for WithTransformJson alert ${e}`))):L.$.isWithSubAlerts(i)?(0,a.zG)(i.subalerts.alternatives,B.tS((e=>{var i;return B.ij(null===(i=e.alternatives[t])||void 0===i?void 0:i.delta)})),Oe.fromOption((()=>`Alternative ${t} or context not found for WithSubAlerts alert ${e}`))):L.$.isWithPosition(i)?Oe.right((new Ue.i).retain(i.transformRange.start).delete(i.transformRange.end-i.transformRange.start).insert(i.transformText)):Oe.left(`Unsupported alert ${e}`),(0,a.zG)(n,Oe.map((n=>({delta:n,alert:i,alertId:e,alternativeIndex:t}))))})))}function ze(e,t,i,n,s){const{invertedReplacements:r,formattings:o,alert:l}=(e=>{if(1===e.length)return{invertedReplacements:(0,Fe.g)(e[0].delta),formattings:(0,Fe.B)(e[0].delta),alert:e[0].alert};{const t=e.reduce(((e,t)=>e.compose(t.delta)),new Ue.i);return{invertedReplacements:(0,Fe.g)(t),formattings:(0,Fe.B)(t)}}})(t);return i.performBatchReplacements(r,{alert:l}).then((()=>Oe.right(void 0))).catch((t=>Oe.left(`Replacement error for [${e.map((e=>`alertId: ${e.alertId} altIdx: ${e.alternativeIndex}`)).join(", ")}]: `+String(t)))).then((e=>(0,a.zG)(n(),B.hX((()=>o.length>0)),B.g_((()=>Promise.resolve(Oe.right(void 0))),(e=>Promise.all(o.map((({range:t,formatting:i})=>e.apply(t,i).then((()=>Oe.right(void 0))).catch((e=>Oe.left(String(e))))))).then((0,a.ls)(Me.oh,(({left:e})=>e.length>0?Oe.left(`Formatting errors [${e.join(", ")}]`):Oe.right(void 0))))))).then((t=>{const i=s.concat(Oe.isLeft(e)?[e.left]:[]).concat(Oe.isLeft(t)?[t.left]:[]);return i.length>0?Oe.left(new Error(`AlertApply - ${i.join(" - ")}`)):Oe.right(void 0)}))))}var Ge=i(8923);class Ne{constructor(e,t,i,n,s,r,a){this._events=e,this._alertProcessor=t,this._replacementService=i,this._alertStateService=n,this._highlightUpdater=s,this._highlightScroller=r,this._getFormattingService=a,this._logger=Y.Y.create("gOS:cs:Alerts"),this._deps=new m.w0,this._alertCollectionChangeSubscription=null,this._alertSelectionChangeSubscription=null,this._selectedAlertId=null,this._deps.add(this._alertStateService.getActiveAlertByClick().subscribe((e=>{var t;this._selectedAlertId=null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null})))}async subscribeToAlertCollection(e){if(this._alertCollectionChangeSubscription=this._alertProcessor.alerts.changes.subscribe((e=>{this._events.alertCollectionChanged({alertCollectionChanges:[...e.addedAlerts.filter((e=>Ce.S.isCapiAlert(e))).map((e=>({operation:"add",alertId:e.id}))),...e.removedAlerts.filter((e=>Ce.S.isCapiAlert(e.alert))).map((e=>({operation:"remove",alertId:e.id})))]}).catch((e=>this._logger.error(e)))})),e.replayState){const e=Array.from(this._alertProcessor.alerts.getAll()).filter((e=>Ce.S.isCapiAlert(e)));e.length>0&&this._events.alertCollectionChanged({alertCollectionChanges:e.map((e=>({operation:"add",alertId:e.id})))}).catch((e=>this._logger.error(e)))}}async unsubscribeToAlertCollection(){var e;null===(e=this._alertCollectionChangeSubscription)||void 0===e||e.unsubscribe(),this._alertCollectionChangeSubscription=null}async applyAlerts({applyAlertsInfo:e}){await De(e,(e=>B.ij(this._alertProcessor.alerts.getAlertById(e))),this._replacementService,this._getFormattingService)}async removeAlerts(e){e.removeAlertsInfo.forEach((({alertId:e,removalReason:t})=>{this._alertProcessor.removeAlert(e,{_tag:"alertApplied"===t?Ge.i.alertAccepted:Ge.i.ignore})}))}async subscribeToSelectedAlert({replayState:e}){if(this._alertSelectionChangeSubscription=this._alertStateService.getActiveAlertByClick().subscribe((e=>{var t,i;this._selectedAlertId=null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null;const n=null!==(i=null==e?void 0:e.alertId)&&void 0!==i?i:null;null!=n&&this._events.selectedAlertChanged({alertId:n}).catch((e=>this._logger.error(e)))})),e){const e=this._selectedAlertId;null!=e&&this._events.selectedAlertChanged({alertId:e}).catch((e=>this._logger.error(e)))}}async unsubscribeToSelectedAlert(){var e;null===(e=this._alertSelectionChangeSubscription)||void 0===e||e.unsubscribe(),this._alertSelectionChangeSubscription=null}async setAlertsVisibility({alertsVisibilityInfo:e}){this._highlightUpdater.setAlertsVisibility(e)}async updateAlertsVisibility({alertsVisibilityInfo:e}){this._highlightUpdater.updateAlertsVisibility(e)}async scrollAlertIntoView(e){this._highlightScroller.scrollAlertIntoView(e)}async getCardLayoutGroupCounts(){const e=Array.from(this._alertProcessor.alerts.getAll()).reduce(((e,t)=>{var i;if(!Ce.S.isCapiAlert(t))return e;const n=t.cardLayout.group,s=null!==(i=e[n])&&void 0!==i?i:{freeAlerts:0,premiumAlerts:0};return s.freeAlerts+=t.isFree?1:0,s.premiumAlerts+=t.isFree?0:1,e[n]=s,e}),{});return{groupCounts:Object.entries(e).map((([e,t])=>({cardLayoutGroup:e,...t})))}}dispose(){var e,t;null===(e=this._alertCollectionChangeSubscription)||void 0===e||e.unsubscribe(),null===(t=this._alertSelectionChangeSubscription)||void 0===t||t.unsubscribe(),this._deps.unsubscribe()}}var je=i(70528);class He{constructor(e,t,i,n){this._events=e,this._capi=t,this._dlp=new je.Xg,this._deps=new m.w0,this._logger=Y.Y.create("gOS:cs:CapiSocket"),this._messages=new Map,this._subscriptions=new Map;const s=this._capi.get();if((0,B.pC)(s)){const e=s.value;null!=e.initialSessionUuid&&this._events.connected({sessionUuid:e.initialSessionUuid}).catch((e=>this._logger.error(e)))}this._deps.add(i.subscribe((e=>{"session_inbound"===e.kind||"session_started"===e.kind?this._events.connected({sessionUuid:"sessionUuid"in e?e.sessionUuid:""}).catch((e=>this._logger.error(e))):"disconnect"===e.kind&&(this._messages.clear(),this._events.disconnected(null).catch((e=>this._logger.error(e))))}))),this._deps.add(n.subscribe((e=>{this._messages.set(e.action,e),this._subscriptions.has(e.action)&&this._events.messageReceived({message:e}).catch((e=>this._logger.error(e)))})))}dispose(){this._deps.unsubscribe()}async sendMessage(e){const t=this._capi.get();if(!(0,B.pC)(t))throw new Error("Capi service is not available");const i=t.value,n=await i.sendMessage(e.message.action,e.message,!1,null!=e.injectRevisionNumberAt?{kind:"default"}:void 0)();if((0,Oe.isLeft)(n))throw new Error(n.left.message);return{messageId:n.right}}async subscribeToMessage(e){e.actions.forEach((e=>this._subscriptions.set(e,!1)))}async subscribeToMessages(e){e.subscriptions.forEach((e=>{this._subscriptions.set(e.actionName,e.replayLatest);const t=this._messages.get(e.actionName);null!=t&&e.replayLatest&&this._events.messageReceived({message:t})}))}async unsanitizeText(e){return{text:this._dlp.unsanitizeText(e.text)}}async sanitizeText(e){return{text:this._dlp.sanitizeText(e.text)}}}class Le{constructor(e){this._setSelectionContext=e}async setSelectionContext(e){this._setSelectionContext({range:e.range,visibility:e.visibility})}}var We=i(97092);class Ve{constructor(e,t){this._events=e,this._source=t,this._deps=new m.w0,this._buffer=[],this._collection=this._source.pipe(C.U((e=>{switch(e.kind){case"sdui_add":return{operation:"add",operationV2:"add",itemId:e.sduiRootId,dsl:e.sdui};case"sdui_update":return{operation:"update",operationV2:"update",itemId:e.sduiRootId,dsl:e.sdui};case"sdui_remove":return{operation:"remove",operationV2:"remove",itemId:e.sduiRootId};default:return null}})),S.h((e=>null!==e)),(e=>e.pipe(We.f(e.pipe(M.b(0))))),S.h((e=>e.length>0))),this._buffering=this._collection.subscribe((e=>{this._buffer.push(...e)})),this._deps.add(this._buffering)}dispose(){this._deps.unsubscribe()}async subscribeToItemCollection({replayState:e}){this._buffering.unsubscribe(),e&&this._buffer.length>0&&this._events.itemCollectionChanged({itemCollectionChanges:[...this._buffer]}),this._deps.add(this._collection.subscribe((e=>{this._events.itemCollectionChanged({itemCollectionChanges:e})}))),this._buffer.length=0}async unsubscribeToItemCollection(){this._deps.unsubscribe()}}var qe=i(50782);var Ye=i(12776);function Ke(e){return"revision"===e.assistantMode||"genAIAndRevision"===e.assistantMode}function Je(e,t){return e instanceof Ye.P&&Ke(t)}class $e{constructor(e,t,i,n,s,r){this._params=e,this._selectionRange=t,this._highlightsUpdater=i,this._highlightsScroller=n,this._closeAssistant=s,this._contextHighlight=r,this._name="applet",this._subscriptions=new m.w0,this._dragBehavior=F.h.create({kind:"draggable",isDragging:!1}),this._sizeBehavior=F.h.create({heightBehavior:{kind:"fitContent",maxHeight:null},widthBehavior:{kind:"fitContent",maxWidth:null,minWidth:null}}),this._assistantMode=F.h.create("genAIAndRevision"),this._lastMousePosition={x:0,y:0},this._viewState=F.h.create("none"),this._isSettingsMenuShown=F.h.create(!1),this._placeholderSize=F.h.create({width:0,height:0}),this._containerElement=null,this._assistant=function(e){const t=j.C.shared,i=t.host.createContext().withEditSession((0,Pe.wr)({appletId:"assistant",replacementService:e.replacementService,selectionService:e.selectionService,textObserver:e.textObserver,selectionRange:e.selectionRange})),{promise:n,resolve:s}=(0,qe.II)(),{applet:r,start:a}=t.host.createUIAppletContainer((0,Te.SP)({id:"assistant",kind:"ui"}),{...e,onInit:t=>{var i;null===(i=e.onInit)||void 0===i||i.call(e,t),s()}},i,!1),o=new Ne(new Te.Q$(r.rpc.call.bind(r.rpc)),e.alertProcessor,e.replacementService,e.alertStateService,e.highlightUpdater,e.highlightScroller,e.getFormattingService),l=new He(new Te.tL(r.rpc.call.bind(r.rpc)),e.checkingService,e.checkingService.pipe(v.cp((e=>ke.D(e.capiEvents)))),e.capiMessages),c=new Ve(new Te.wR(r.rpc.call.bind(r.rpc)),Q.z(Z.P((()=>ke.D(e.getSDUIBuffer()))),e.checkingService.pipe(v.cp((e=>ke.D(e.capiEvents)))))),h=new Le((t=>{e.contextHighlight.set(B.G({range:t.range,visibility:t.visibility}))}));return i.registerObject(Te.Ro.objectName,new Te.Ro(h)),i.registerObject(Te.ml.objectName,new Te.ml(o)),i.registerObject(Te.Hd.objectName,new Te.Hd(l)),i.registerObject(Te.MC.objectName,new Te.MC(c)),r.onBeforeUnload((()=>{o.dispose(),l.dispose(),c.dispose()})),{applet:r,start:async e=>(await n,await a(e))}}({alertProcessor:this._params.alertProcessor,alertStateService:this._params.alertStateService,checkingService:this._params.checkingService,capiMessages:Q.z(Z.P((()=>Object.values(this._params.latestCAPIMessages.get()))),this._params.checkingService.pipe(v.oA,_.w((e=>e.capiMessages)))),getFormattingService:this._params.getFormattingService,getSDUIBuffer:this._params.getSDUIBuffer,highlightScroller:this._highlightsScroller,highlightUpdater:this._highlightsUpdater,replacementService:this._params.replacementServiceInjector.create(ge.P.gOSAssistantApplet),selectionService:this._params.selectionService,textObserver:this._params.textObserver,selectionRange:this._selectionRange,contextHighlight:this._contextHighlight,onSettingsMenu:()=>{this._isSettingsMenuShown.set(!0)},onVisuallyReady:()=>{Ae.markVisuallyReady();const e=Ae.measureOpenAttemptToVisuallyReady();this._assistant.applet.view.frame.slot=this._name,this._viewState.set("applet"),this._params.gnar.gOSAssistantAppletVisuallyReady(this._assistantMode.get(),e)},onInteractionReady:(e,t)=>{var i;null===(i=this._params.assistantDidOpen)||void 0===i||i.next(this._assistantMode.get());const n=Ae.measureOpenAttemptToVisuallyReady();this._params.gnar.gOSAssistantAppletInteractionReady(t,n,e)},onClose:()=>{this._assistant.applet.view.frame.slot="hidden",this._params.gnar.gOSAssistantAppletClose(this._assistantMode.get())},onTerminate:()=>{this._close()},onDragMove:async e=>{if(e){const t=this._assistant.applet.view.frame.getBoundingClientRect();this._lastMousePosition={x:e.x+t.left,y:e.y+t.top}}await this._handleDragging()},canResize:()=>"applet"!==this._viewState.get()||this._params.integration.canResizeAssistant(this._assistantMode.get()),handleResize:e=>this._handleResizing(e)});const a=e=>{this._lastMousePosition={x:e.clientX,y:e.clientY}};document.addEventListener("mousedown",a,{passive:!0}),document.addEventListener("mousemove",a,{passive:!0}),this._subscriptions.add((()=>{document.removeEventListener("mousedown",a),document.removeEventListener("mousemove",a)})),this._assistant.applet.view.frame.loading="eager",this._assistant.applet.view.frame.slot="hidden",this._subscriptions.add(this._dragBehavior.subscribe((e=>{const t=this._assistant.applet.view.frame.parentElement;t instanceof HTMLElement&&("draggable"===e.kind&&e.isDragging?(this._assistant.applet.view.frame.style.setProperty("pointer-events","none"),this._assistant.applet.view.frame.style.setProperty("user-select","none"),t.style.setProperty("cursor","grabbing")):(this._assistant.applet.view.frame.style.removeProperty("pointer-events"),this._assistant.applet.view.frame.style.removeProperty("user-select"),t.style.removeProperty("cursor")))}))),this._subscriptions.add((()=>{this._isSettingsMenuShown.set(!1),this._assistant.applet.view.frame.remove()}))}_close(){this._viewState.set("none"),this._closeAssistant(J.jg.closed)}get preloadUI(){return o.createElement(ve,{node:this._assistant.applet.view.frame})}render(e,t){return this._startApplet(e,t),o.createElement(pe.w,null,this._renderView())}_renderView(){return o.createElement("div",{ref:e=>{this._containerElement=e},key:"gOSAppletHost",style:{display:"grid",width:this._sizeBehavior.view((e=>"fitContent"===e.widthBehavior.kind?"fit-content":"100%")).get(),height:this._sizeBehavior.view((e=>"fitContent"===e.heightBehavior.kind?"fit-content":"100%")).get(),overflow:"hidden",borderRadius:X.ux.rem(ie.ze)}},o.createElement(ue.F.Fragment,null,this._viewState.view((e=>{switch(e){case"none":return null;case"loading":return this._renderLoadingView();case"error":return this._renderErrorView();case"applet":return o.createElement("slot",{name:this._name})}})),this._isSettingsMenuShown.view((e=>this._renderSettingsView(e)))))}_renderLoadingView(){return o.createElement(ue.F.Fragment,null,this._placeholderSize.view((e=>o.createElement(ne.k,{bgColor:"white",style:{minWidth:Math.max(300,e.width),minHeight:Math.max(200,e.height),alignItems:"center",justifyContent:"center",position:"relative"},"data-testid":"applet-loading"},o.createElement(se.h,{variant:"tertiary",icon:re.V,accessibilityLabel:"Close",onClick:()=>this._close(),style:{position:"absolute",top:"0.5rem",right:"0.5rem"}}),o.createElement(ae.J,{icon:oe.I,size:"large",accessibilityLabel:"Loading Grammarly Assistant",className:_e.spin})))))}_renderErrorView(){return o.createElement(ue.F.Fragment,null,this._placeholderSize.view((e=>o.createElement(ne.k,{bgColor:"white",style:{minWidth:Math.max(300,e.width),minHeight:Math.max(200,e.height),alignItems:"center",justifyContent:"center",position:"relative"},"data-testid":"applet-error"},o.createElement(se.h,{variant:"tertiary",icon:re.V,accessibilityLabel:"Close",onClick:()=>this._close(),style:{position:"absolute",top:"0.5rem",right:"0.5rem"}}),o.createElement(ne.k,{direction:"column",align:"center",padding:4},o.createElement(ae.J,{icon:le.F,size:"large",variant:"warning",accessibilityLabel:""}),o.createElement(ce.X,{as:"h1",variant:"heading-small"},"Something went wrong"),o.createElement(he.x,{as:"p",align:"center"},"Please"," ",o.createElement("a",{href:"https://support.grammarly.com/hc/en-us/articles/5806184637325-Error-Can-t-connect-to-Grammarly",rel:"noopener noreferrer",target:"_blank",style:{display:"inline"}},"contact support")," ","for assistance."))))))}_renderSettingsView(e){return e?o.createElement(de.u_,{isOpen:e,onClose:()=>{this._isSettingsMenuShown.set(!1)},title:"Settings",dismissOnOutsideClick:!1},o.createElement(de.u_.Body,null,o.createElement(me.o,null,this._params.settingsService.getView()))):null}_startApplet(e,t){this._subscriptions.add(ee.S(this._viewState.pipe(S.h((e=>"applet"===e))),te.HT(200).pipe(x.b((()=>this._viewState.set("loading"))))).subscribe()),this._subscriptions.add(ee.S(this._viewState.pipe(S.h((e=>"applet"===e))),te.HT(1e4).pipe(x.b((()=>this._viewState.set("error"))))).subscribe()),this._assistantMode.set(e.assistantMode),this._subscriptions.add(t.dragBehavior.subscribe({next:e=>this._dragBehavior.set(e)})),this._subscriptions.add(t.sizeBehavior.subscribe({next:e=>this._sizeBehavior.set(e)})),this._readyToDragFn=t.readyToDrag,this._assistant.applet.onBeforeUnload((()=>{this._subscriptions.unsubscribe(),this._readyToDragFn=void 0}));const i=this._selectionRange.get();const n=()=>"revision"!==e.assistantMode?"translate"===e.genAIParams.genAISessionMode||"appActionDeeplink"===e.genAIParams.genAISessionMode||"compliance"===e.genAIParams.genAISessionMode?"rewrite":e.genAIParams.genAISessionMode:"ideation";return this._assistant.start({assistantMode:Ee(e.assistantMode),entryPoint:n(),entryPoint2:n(),theme:{flatUI:!0,logoVersion:"february2024"},selectedRange:B.FS(i),selectedText:(0,$.zG)(i,B.g_(a.r5,(e=>this._params.integration.getText(e)))),pushRewriteInfo:Re(e,this._params.alertProcessor),defaultRevisionModeView:Je(this._params.integration,e)?"longForm":"shortForm",outerContext:B.FS(this._params.integration.quickReplyContext.get()),partialPageModeEnabled:!1,showPartialPageModeNotification:!1}),this._assistant.applet}async _handleDragging(){if("notDraggable"===this._dragBehavior.get().kind)return;if(null==this._readyToDragFn)return;const e=this._assistant.applet.view.frame.parentElement;e instanceof HTMLElement&&(this._assistant.applet.view.frame.style.setProperty("pointer-events","none"),await this._readyToDragFn({dragHandle:e}),e.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,button:0,buttons:1})),await new Promise((e=>{const t=setTimeout((()=>{const t=this._dragBehavior.get();"draggable"===t.kind&&t.isDragging||this._assistant.applet.view.frame.style.removeProperty("pointer-events"),this._subscriptions.remove(i),e()}),150),i=()=>clearTimeout(t);this._subscriptions.add(i)})))}_handleResizing(e){var t,i,n,s,r,a,o,l;const c="loading"===this._viewState.get(),h=this._assistant.applet.view.frame,{heightBehavior:d,widthBehavior:u}=this._sizeBehavior.get(),p=0===e.height||"fitContainer"===d.kind?null!==(i=null===(t=this._containerElement)||void 0===t?void 0:t.offsetHeight)&&void 0!==i?i:200:e.height,g=0===e.width||"fitContainer"===u.kind?null!==(s=null===(n=this._containerElement)||void 0===n?void 0:n.offsetWidth)&&void 0!==s?s:300:e.width,m="fitContainer"===d.kind?p:Math.min(null!==(r=d.maxHeight)&&void 0!==r?r:1/0,0===e.height?null!==(a=d.height)&&void 0!==a?a:0:e.height),f="fitContainer"===u.kind?g:Math.max(null!==(o=u.minWidth)&&void 0!==o?o:0,Math.min(null!==(l=u.maxWidth)&&void 0!==l?l:1/0,e.width));return this._placeholderSize.set({width:f,height:m}),c||!this._params.integration.canResizeAssistant(this._assistantMode.get())||("fitContainer"===d.kind?h.style.minHeight="0px":h.style.minHeight=`${m}px`,"fitContainer"===u.kind?h.style.minWidth="0px":h.style.minWidth=`${f}px`),{width:f,height:m}}dispose(){this._assistant.applet.gracefullyUnloadApplet()}}class Xe{constructor(e){this._params=e}scrollAlertIntoView({alertId:e}){var t;const i=null===(t=this._params.getAlertById(e))||void 0===t?void 0:t.highlightRanges[0];i&&this._params.integration.scrollHighlightIntoView(i)}}var Qe=i(66738),Ze=i(62552),et=i(21147),tt=i(52979);class it{constructor(e){this._params=e,this._subs=new m.w0,this._visibleAlerts=new Ze.X(new Set),this._emphasizedAlerts=new Ze.X(new Set),this.hasHighlights=this._visibleAlerts.pipe(C.U((e=>e.size>0)),k.O(!1),R.x(),te.d({bufferSize:1,refCount:!0})),this.alertsFilter=this._visibleAlerts.pipe(te.$f(Qe.Eh(et.yv)),M.b(0),C.U((e=>t=>e.has(t.id))),te.d({bufferSize:1,refCount:!0})),this._subs.add(this._visibleAlerts.subscribe((e=>{var t;return null===(t=this._params.logger)||void 0===t?void 0:t.debug("visible highlights",e)}))),this._subs.add(this._emphasizedAlerts.subscribe((e=>{var t;return null===(t=this._params.logger)||void 0===t?void 0:t.debug("emphasized highlights",e)})))}setAlertsVisibility(e){this.clearAll();const t=new Set(this._visibleAlerts.value),i=new Set(this._emphasizedAlerts.value);e.filter((e=>"hidden"!==e.visibility)).forEach((({alertId:e,visibility:n})=>{this._params.getAlertById(e)&&(t.add(e),"emphasized"===n&&i.add(e))})),this._visibleAlerts.next(t),this._emphasizedAlerts.next(i)}updateAlertsVisibility(e){const t=new Set(this._visibleAlerts.value),i=new Set(this._emphasizedAlerts.value);e.forEach((({alertId:e,visibility:n})=>{this._params.getAlertById(e)&&"hidden"!==n?(t.add(e),"emphasized"===n?i.add(e):i.delete(e)):(t.delete(e),i.delete(e))})),this._visibleAlerts.next(t),this._emphasizedAlerts.next(i)}clearAll(){this._visibleAlerts.next(new Set),this._emphasizedAlerts.next(new Set)}getHighlightVisualState(e){const t=this._params.alertStateService.getHighlightedAlert().pipe(C.U((t=>{var i;return!0===(null===(i=null==t?void 0:t.highlightIds)||void 0===i?void 0:i.includes(e))})),k.O(!1),R.x()),i=this._params.alertStateService.getActiveAlertByClick().pipe(C.U((t=>{var i;return!0===(null===(i=null==t?void 0:t.highlightIds)||void 0===i?void 0:i.includes(e))})),k.O(!1),R.x()),n=this._emphasizedAlerts.pipe(C.U((t=>Array.from(t).some((t=>this._params.aquaAlertsWiring.getHighlightsForAlert(t).includes(e))))),R.x());return I.a([t,i,n]).pipe(C.U((([e,t,i])=>({hovered:e,selectedByClick:t,emphasized:i}))),k.O({hovered:!1,selectedByClick:!1,emphasized:!1}),T.G(),C.U((([e,t])=>t.hovered||t.selectedByClick?tt.pc.hovered:t.emphasized?e.hovered||e.selectedByClick?tt.pc.hovered:tt.pc.hoveredNeedsAttention:tt.pc.none)),k.O(tt.pc.none),R.x(),x.b((t=>{var i;return null===(i=this._params.logger)||void 0===i?void 0:i.debug(`[${e}] visual state:`,t)})))}dispose(){this.clearAll(),this._subs.unsubscribe()}}function nt(e){var t,i;return null!==(i=null===(t=B.WG(e.get()))||void 0===t?void 0:t.sessionUuid)&&void 0!==i?i:void 0}var st=i(87234);class rt{constructor(e){var t,i;this._params=e,this._subs=new m.w0,this._source=function(e){switch(e.kind){case"gButtonSource":return"gbutton";case"emojiButtonSource":return"tone";case"inlineCardSource":return"inline-card";case"inlinePushRewriteSource":return"inline-push-rewrite";case"inlineQuickReplySource":return"inline-quick-reply";case"inlineQuickRewriteSource":return"inline-quick-rewrite";case"inlineRewriteSource":return"inline-rewrite";case"onboardingSource":return"onboarding";case"inlineTranslateSource":return"inline-translate";default:(0,Ie.L0)(e)}}(this._params.openAssistantParams.source),this._uiType=(t=this._params.openAssistantParams,i=this._params.supportedForms,Ke(t)?void 0!==i&&i.length>0&&"longForm"===i[0]?"long-form":"short-form":"cheetah"),this._startTrackingDrag()}trackVisuallyReady(e){const t=this._params.statisticsService.alertCounts.get(),i=this._params.statisticsService.wordsCount.get(),n=t.filter((e=>Ce.S.isCapiAlert(e)&&e.outcome===W.TC.clarity)).visibleCapiAlerts;if(Je(this._params.integration,this._params.openAssistantParams))this._params.gnar.gdocsSidebarGdocsSidebarShow(this._params.integration.isDocOwnedByCurrentUser(),"user",t.unmutedCapiAlerts,i,t.visibleInlineCapiAlerts,n,t.visibleNotInlineCapiAlerts,void 0,e,this._source,this._uiType);else{const s=this._params.position.get();this._params.gnar.assistantPopupShow("default",this._params.height.get(),s.left,s.top,t.unmutedCapiAlerts,n,t.visibleInlineCapiAlerts,t.filter((e=>Ce.S.isCapiAlert(e)&&"priority"===e.assistantView)).unmutedCapiAlerts,i,"sticky",this._getSessionUuid(),void 0,e,this._params.statisticsService.generalScore.get(),this._source,this._uiType)}}trackInteractionReady(e,t){Je(this._params.integration,this._params.openAssistantParams)?this._params.gnar.gdocsSidebarGdocsSidebarReady(this._getSessionUuid(),e.success,"gen-ai"===e.kind?"genai":"revision",t,this._source,this._uiType):this._params.gnar.assistantPopupReady(this._getSessionUuid(),e.success,"gen-ai"===e.kind?"genai":"revision",t,this._source,this._uiType)}trackClose(){const e=this._params.statisticsService.alertCounts.get(),t=e.filter((e=>Ce.S.isCapiAlert(e)&&e.outcome===W.TC.clarity)).visibleCapiAlerts;Je(this._params.integration,this._params.openAssistantParams)?this._params.gnar.gdocsSidebarGdocsSidebarClose(this._params.integration.isDocOwnedByCurrentUser(),"user",e.unmutedCapiAlerts,this._params.statisticsService.wordsCount.get(),e.visibleInlineCapiAlerts,t,e.visibleNotInlineCapiAlerts):this._params.gnar.assistantPopupCloseButtonClick("default",e.unmutedCapiAlerts,t,e.visibleInlineCapiAlerts,e.filter((e=>Ce.S.isCapiAlert(e)&&"priority"===e.assistantView)).unmutedCapiAlerts,void 0)}_startTrackingDrag(){const e=this._params.position.get();let t=e;this._subs.add(this._params.isDragging.pipe(T.G(),S.h((([e,t])=>e&&!t))).subscribe((()=>{const i=this._params.position.get();st.E9.l1Distance(i,t)<rt.MINIMAL_RECOGNIZABLE_DRAG_DISTANCE||(this._params.gnar.assistantPopupDrag(i.left,i.top,this._params.height.get(),e.left,e.top),t=i)})))}_getSessionUuid(){return(0,$.zG)(this._params.checkingService.get(),B.tS((e=>B.ij(e.sessionUuid))),B.g_((()=>""),(e=>e)))}dispose(){this._subs.unsubscribe()}}rt.MINIMAL_RECOGNIZABLE_DRAG_DISTANCE=10;var at=i(75114),ot=i(38508),lt=i(52467);function ct(e){var t;return"genAI"!==e.assistantMode&&"genAIAndWritingExpert"!==e.assistantMode&&"inlineCardSource"===e.source.kind&&null!==(t=e.source.alertId)&&void 0!==t?t:null}function ht(e,t,i,n){switch(e.genAISessionMode){case"ideation":return{mode:e.genAISessionMode,metadata:t,documentUrl:n};case"rewrite":case"quickRewrite":case"translate":case"compliance":return{mode:e.genAISessionMode,metadata:t};case"quickReply":return{mode:e.genAISessionMode,quickReplyContext:(0,a.zG)(i,B.g_((()=>at.H.empty),dt)),metadata:t};case"pushRewrite":return{mode:e.genAISessionMode,writingExpertContext:e.writingExpertContext};case"appActionDeeplink":return{mode:e.genAISessionMode,appActionDeeplinkContext:e.appActionDeeplinkContext};default:(0,Ie.L0)(e)}}function dt(e){var t,i,n,s,r,o,l,c,h,d,u,p,g,m,f,v,_;const b=e=>{var t;return null!==(t=null==e?void 0:e.reduce(((e,t)=>{var i;return t.email&&!e.has(t.email)&&e.set(t.email,{name:null!==(i=t.name)&&void 0!==i?i:"",email:t.email}),e}),new Map))&&void 0!==t?t:new Map},S=b(null===(n=null===(i=null===(t=e.parents)||void 0===t?void 0:t[0])||void 0===i?void 0:i.audience)||void 0===n?void 0:n.indirectRecipients),y=b(null===(o=null===(r=null===(s=e.parents)||void 0===s?void 0:s[0])||void 0===r?void 0:r.audience)||void 0===o?void 0:o.undisclosedRecipients),w=b(null===(d=null===(h=null===(c=null===(l=e.parents)||void 0===l?void 0:l[0])||void 0===c?void 0:c.audience)||void 0===h?void 0:h.recipients)||void 0===d?void 0:d.filter((({email:e})=>(0,lt.HD)(e)&&!S.has(e)&&!y.has(e)))),A=b(null===(u=e.audience)||void 0===u?void 0:u.indirectRecipients),I=b(null===(p=e.audience)||void 0===p?void 0:p.undisclosedRecipients),C=b(null===(m=null===(g=e.audience)||void 0===g?void 0:g.recipients)||void 0===m?void 0:m.filter((({email:e})=>(0,lt.HD)(e)&&!A.has(e)&&!I.has(e))));return{previousMessageInfo:(0,a.zG)(Me.YM(null!==(f=e.parents)&&void 0!==f?f:[]),B.g_((()=>at.H.PreviousMessageInfo.empty),(e=>{var t;return{author:(0,a.zG)(Me.YM(null!==(t=e.authors)&&void 0!==t?t:[]),B.g_((()=>at.H.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(w.values()),text:e.delta?(0,ot.l)(e.delta,""):""}}))),title:null!==(v=e.title)&&void 0!==v?v:"",author:(0,a.zG)(Me.YM(null!==(_=e.authors)&&void 0!==_?_:[]),B.g_((()=>at.H.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(C.values()),indirectRecipients:Array.from(A.values()),undisclosedRecipients:Array.from(I.values())}}var ut=i(25691),pt=i(98849),gt=i(46552),mt=i(69859),ft=i(97866),vt=i(77610),_t=i(30357),bt=i(37108),St=i(49601),yt=i(3199),wt=i(8867),At=i(18595),It=i(88613),Ct=i(4603),xt=i(81259),Et=i(94996),Rt=i(88555);class kt{constructor(e){this._experimentClient=e,this.gates=Rt.C,this.experiments=Rt.V}getTreatment(e){return r.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.getTreatment(e))),(e=>String(e)))}isGateEnabled(e){return r.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.isGateEnabled(e))),(e=>String(e)))}logTreatment(e,t){return r.Y3((async()=>{await this._experimentClient.logTreatment(e,t)}),(e=>String(e)))}peekTreatment(e){return r.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.peekTreatment(e))),(e=>String(e)))}}var Tt=i(21448);class Pt{constructor(e,t,i,n,s,r=!1){this._gnar=e,this._telemetry=t,this._alertProcessor=i,this._capiStartAckMessage=n,this._hasInProductDiscountSpecialOffer=s,this._isGdocs=r,this.isEligibleForFreeTrial=this._capiStartAckMessage.view((0,a.ls)(B.VS((e=>{var t;return B.ij(null===(t=e.featureData.upgradeHookData)||void 0===t?void 0:t.variant)})),B.UI((e=>"premiumTrial"===e)),B.fS((()=>!1)))),this.isEligibleForInProductDiscount=this._hasInProductDiscountSpecialOffer}trackUphookShown(e){const t={upgradeHookName:e.name,upgradeHookSlot:this._getUphookSlot(e),upgradeHookVariant:e.variant};switch(e.name){case"grammarlyGoPrompts":(0,Tt.nE)(this._gnar,{...t,placement:"grammarlyGoPrompts"});break;case"plagiarism":(0,Tt.nE)(this._gnar,{...t,placement:"plagiarismView"});break;case"toneDetector":(0,Tt.nE)(this._gnar,{...t,placement:"toneDetector"});break;default:(0,Ie.L0)(e.name)}return this._telemetry.upgradeHooks.showUpgradeHook(e.name,this._getUphookSlot(e),e.variant),Promise.resolve()}trackUphookClicked(e){const t={upgradeHookName:e.name,upgradeHookSlot:this._getUphookSlot(e),upgradeHookVariant:e.variant};switch(e.name){case"grammarlyGoPrompts":(0,Tt.Qi)(this._gnar,{...t,placement:"grammarlyGoPrompts"});break;case"plagiarism":(0,Tt.Qi)(this._gnar,{...t,placement:"plagiarismView"});break;case"toneDetector":(0,Tt.Qi)(this._gnar,{...t,placement:"toneDetector"});break;default:(0,Ie.L0)(e.name)}return this._telemetry.upgradeHooks.clickUpgradeHook(e.name,this._getUphookSlot(e),e.variant),Promise.resolve()}trackUphookDismissed(e){if("plagiarism"===e.name)return(0,Tt.jc)(this._gnar,{placement:"plagiarismView",upgradeHookName:e.name,upgradeHookSlot:this._getUphookSlot(e),upgradeHookVariant:e.variant}),Promise.resolve();(0,Ie.L0)(e.name)}executeUphook(e){const t="advancedIssues"===e.name?Array.from(this._alertProcessor.alerts.getAll()).filter(Ce.S.isCapiAlert).filter((e=>!e.isFree&&e.isHidden)):[];return(0,Ct.OB)().bgRpc.api.openSubscriptionPage({currentAlerts:t,utmCampaign:`%appName%_${e.name}_${this._getUphookSlot(e)}_${e.variant}`}),Promise.resolve()}_getUphookSlot(e){return"longFormAssistant"===e.slot&&this._isGdocs?"longFormAssistant_Gdocs":e.slot}}var Mt=i(59833),Ut=i(41274);const Ot={"Style/ToneImprovement/ConfidentRewrite/ToneAI":"1f91d","Style/ToneImprovement/PersonableRewrite/ToneAI":"1f917","Style/ToneImprovement/PositiveFraming/ToneAI":"1f64c"};function Ft(e){var t,i,n;const s=null!==(t=e.extraProperties.emoji_id)&&void 0!==t?t:e.extraProperties.emojiId,r=e.minicardTitle.match(Ut.V),a=r&&r[0]&&(null===(i=r[0].codePointAt(0))||void 0===i?void 0:i.toString(16)),o=Ot[e.patternName];return B.ij(null!==(n=null!=s?s:a)&&void 0!==n?n:o)}class Dt{constructor(e){this._alertProcessor=e}getToneAlertsSummary(){const e=Array.from(function*(e){for(const t of e)Ce.S.isCapiAlert(t)&&t.patternName.startsWith("Style/ToneImprovement")&&(yield t)}(this._alertProcessor.alerts.getAll())).map((e=>({title:e.minicardTitle.replace(Ut.V,"").trim(),emojiId:Ft(e)}))),t=new Set(e.map((({title:e})=>e)));return Promise.resolve((0,a.zG)(Mt.YM(e),B.UI((({title:e,emojiId:i})=>({title:t.size>1?"Strike the right tone":e,emojiId:i})))))}}var Bt=i(62549);function zt(e,t,i){const n="business"===i.previousUserType||"edu"===i.previousUserType||"ngo"===i.previousUserType;let s="free";return n?s="institution":"premium"===i.previousUserType&&(s="premium"),e.anonymous?{kind:"signed-out",institutionType:n?i.previousUserType:void 0,type:s}:{kind:"signed-in",id:e.id,isPremium:Bt.n.isPremium(e),dialect:t,email:e.email,institution:(0,a.zG)(B.ij(e.institutionInfo),B.UI((({id:e,name:t,voxInfo:i})=>({id:e,name:t,logoUrl:null==i?void 0:i.logoUrl,styleGuideEnabled:null==i?void 0:i.styleGuideEnabled}))))}}function Gt(e,t,i){return Q.z(Z.P((()=>ke.D(t()))).pipe(S.h(i)),e)}function Nt(e,t,i,n,s,o,l,d,u,p,g,v,b,w,A,T,P,M,U,O,D,G,N,j,H,L,V,Y,K,J,$,X){const Q=new f.x,Z=new ut.t({inboundCAPIMessages:Gt(t,i,pt.J4),sendCAPIMessage:({action:t,data:i,shouldInjectRev:n,shouldInjectSessionId:s})=>(0,a.zG)(r.Uo((0,a.zG)(e.get(),Oe.fromOption((()=>new Error("checking service not initialized"))))),r.tS((e=>e.sendMessage(t,i,s,n?{kind:"default"}:void 0))))}),ee={user:F.h.combine(n,o,s,zt),setDialect:l,signIn:()=>{const e=(0,Ct.OB)().browserApi;e.beginOAuth?e.beginOAuth():self.open((0,It.s7)("signedOutUI","toolbarMenu"),"_blank","noreferrer")}},ie=new gt.L(Z,F.h.combine(Y.view((e=>{var t;return!1===(null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.cheetahEnabled)})),p.view(B.tS((e=>B.ij(e.cheetahState)))),((e,t)=>(0,a.zG)(t,B.hX((()=>!e)),B.g_((()=>({enabled:!1})),(e=>({enabled:!0,userState:e}))))))),ne=g.pipe(bt.Q(St.E),yt.R(((e,t)=>{const i=e.filter(jt);return t&&jt(t)?[...i,t]:i}),[]),C.U(Me.Z$),te.d({bufferSize:1,refCount:!0})),se=I.a([ne,v,b]).pipe(C.U((([e,t,i])=>(0,a.zG)(e,B.hX((()=>t)),B.g_((()=>({})),(e=>({[mt.n.initialPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0,[mt.n.initialBTSPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0}))))))),re=e=>{null==X||X.debug(`Completing step [${e}]`);A.get()[e].extension.completed||T({[e]:{completed:!0,lastSeen:Date.now()}})},ae={flush:()=>r.fF((()=>new wt.y((t=>{const i=new m.w0;return M.empty.get()?t.next(void 0):(M.flush(),(0,a.zG)(e.get(),B.g_((()=>t.next(void 0)),(e=>{i.add(e.messages.pipe(S.h((e=>e._tag===W.J8.Type.submitOtAck)),At.L(500,E.of(null)),x.b((()=>t.next(void 0)))).subscribe())})))),()=>i.unsubscribe()})).pipe(y.q(1)).toPromise())),getText:e=>r.tD((()=>U(e))),insertText:e=>r.tD((()=>O(e))),copyText:e=>(0,Et.vQ)(e),setContextHighlight:(e,t)=>{N.set(B.G({range:e,visibility:t}))},selectedRange:D,textUpdated:G,trimmedTextLength:G.pipe(k.O(null),C.U((()=>U({start:0,end:Number.MAX_SAFE_INTEGER}).trim().length)),R.x(),te.d({refCount:!0,bufferSize:1}))},oe=new Pt(j,L,K,p,$),le={domain:E.of(H),submitFeedback:e=>r.Y3((()=>(0,a.zG)(e.source,(e=>e===vt.x.Source.resultCard?"cheetah-card":e===vt.x.Source.quickReplyInitialActions||e===vt.x.Source.intentCard?"cheetah-quick-reply":void(0,Ie.L0)(e)),(t=>j.feedbackFormSubmit(e.mood,t,e.domain,e.message)))),(e=>new Error(String(e))))},ce=new _t.j(F.h.create({contextUpdatesClient:V.isGateEnabled(q.K.CheetahSelectionContextUpdates)&&"test"===V.getTreatment(xt.p.CheetahSelectionContextUpdates),contextUpdatesServer:V.isGateEnabled(q.K.CheetahSelectionContextUpdatesServer)&&"test"===V.getTreatment(xt.p.CheetahSelectionContextUpdates)})),he=new Dt(K),de=new kt(V);return{capiService:Z,userService:ee,genAIAvailabilityService:ie,textEditorService:ae,feedbackService:le,uphookService:oe,selectionContextAvailabilityService:ce,toneDetectorService:he,experimentService:de,skillService:z.Fc(J),createOnboardingViewModels:()=>{const e=new Set;P.get().compose||e.add(h.T.StepName.initial),P.get().onboarding||(e.add(h.T.StepName.initial),e.add(h.T.StepName.initialBTS),e.add(h.T.StepName.prompts),e.add(h.T.StepName.review),e.add(h.T.StepName.knowledgeHub),e.add(h.T.StepName.references));const t=(0,a.zG)(p.get(),B.UI((e=>"ASSIGNMENT_WRITING"===e.defaultDocumentContext.writingIntent)),B.fS(a.jv));return P.get().onboardingBTS&&t||e.add(h.T.StepName.initialBTS),P.get().knowledgeHubIntegration||e.add(h.T.StepName.knowledgeHub),(0,ft.Q)({capiService:Z,upstreamOnboardingState:A,session:d.pipe(_.w(B.g_((()=>E.of(B.YP)),(e=>e.genAISession)))),textStats:u,forceDisabledOnboardingSteps:e,assistantUIActions:Q,externalElements:se,hideAssistantOnboardingTooltips:d.pipe(_.w(B.g_((()=>F.h.create(!1)),(e=>e.dragBehavior.pipe(C.U((e=>"draggable"===e.kind&&e.isDragging))))))),promptsAllocated:ie.availability.view(c._.getPromptsAllocated),client:"extension",disposed:w,completeOnboardingStep:re})},notifyAssistantUIAction:e=>Q.next(e),dispose:()=>{ie.dispose(),ce.dispose()}}}function jt(e){return e.isConnected&&null!==e.offsetParent}const Ht=(Lt=(0,Ct.OB)().experimentClient,function(e){if("mergedSharedAssistant"===e)return"genAIAndRevision";if("splitSharedAssistants"===e)return"genAI";{const e=Lt.isGateEnabled(q.K.WritingExpertPullMode),t=Lt.isGateEnabled(q.K.WritingExpertInAssistantInternal),i=Lt.isGateEnabled(q.K.WritingExpertInAssistantNative);return e&&(t||i)?"genAIAndWritingExpert":"genAI"}});var Lt;function Wt(e,t,i){const n={source:i,genAIParams:{genAISessionMode:t}};switch(e){case"genAIAndRevision":return{assistantMode:"genAIAndRevision",...n};case"genAI":return{assistantMode:"genAI",...n};case"genAIAndWritingExpert":return{assistantMode:"genAIAndWritingExpert",...n};default:(0,Ie.L0)(e)}}var Vt=i(8065),qt=i(55341),Yt=i(41847);class Kt extends Error{constructor(e,t){var i;super(`Failed to apply alert. Reason: ${null!==(i=null==t?void 0:t.toString())&&void 0!==i?i:"unknown"}. Alert ID: ${e.alertId}. Alternative index: ${e.alternativeIndex}. Feed form: ${e.feedForm}.`),this.name="ApplyAlertError"}}async function Jt(e,t,i,n,s,r){var o,l,c,h,d,u;const p=t(e.alertId);if(B.Wi(p))throw new Kt(e,"alert-not-found");if(!Ce.S.isCapiAlert(p.value))throw new Kt(e,"alert-not-supported");const g=function(e,t){if(L.$.isWithTransformJson(e)){const i=(0,a.zG)(e.transformJSON.alternatives,B.tS((e=>B.ij(e.alternatives[t.alternativeIndex]))),B.UI((e=>e.delta)),B.pF((()=>null)));if(null===i)throw new Kt(t,"alternative-not-found");return i}if(L.$.isWithSubAlerts(e)){const i=(0,a.zG)(e.subalerts.alternatives,B.tS((e=>B.ij(e.alternatives[t.alternativeIndex]))),B.UI((e=>e.delta)),B.pF((()=>null)));if(null===i)throw new Kt(t,"alternative-not-found");return i}if(L.$.isWithPosition(e))return(new Ue.i).retain(e.transformRange.start).delete(e.transformRange.end-e.transformRange.start).insert(e.transformText);(0,Ie.L0)(e)}(p.value,e),m=(0,Fe.g)(g),f=(0,Fe.B)(g);if(m.length||!(0,Ct.OB)().experimentClient.isGateEnabled(q.K.CheetahExecReplacementOnlyWhenItsExists)){let t;const n=new qt.t(1),a=s.contentChanges.immediate.pipe(M.b(0)).subscribe(n);try{t=await Promise.race([i.performBatchReplacements(m,{alert:p.value}),(0,qe.gw)(null!==(c=null===(l=null===(o=r.get().oggy)||void 0===o?void 0:o.alertService)||void 0===l?void 0:l.applyAlertsPerformBatchReplacementsTimeoutMs)&&void 0!==c?c:1e3,new Kt(e,"perform-batch-replacements-timeout")).then((()=>[]))])}catch(t){throw t instanceof Kt?t:new Kt(e,"perform-batch-replacements-critical-error")}const g=t.find(Yt.j.isFail);if(g&&Yt.j.isFail(g))throw new Kt(e,g.reason);await Promise.race([n.pipe(y.q(1)).toPromise(),(0,qe.gw)(null!==(u=null===(d=null===(h=r.get().oggy)||void 0===h?void 0:h.alertService)||void 0===d?void 0:d.applyAlertsWaitForTextMapContentChangesTimeoutMs)&&void 0!==u?u:1e3,new Kt(e,"wait-for-text-map-content-changes-timeout"))]),a.unsubscribe()}const v=n();if(B.pC(v)&&f.length>0)for(const t of f)try{await v.value.apply(t.range,t.formatting)}catch(t){throw new Kt(e,"apply-formatting-critical-error")}}var $t=i(57454);class Xt{constructor(e){var t;this._params=e,this._subs=new m.w0,this._logger=Y.Y.create("AlertServiceImpl"),this._replacementService=this._params.replacementServiceInjector.create(ge.P.oggyRevisionSequential),this._selectedAlertId=F.h.create(this._params.initialAlertId),this._applyAlertsSequentiallyRequests=new f.x,this.selectedAlertId=this._selectedAlertId.view(),this.alertCollectionChanges=(t=this._params.alertProcessor.alerts,Z.P((()=>t.changes.pipe(C.U((e=>{const t=new Set(e.addedAlerts.filter(Ce.S.isCapiAlert).map((e=>e.id))),i=new Set(e.removedAlerts.filter((e=>Ce.S.isCapiAlert(e.alert))).map((e=>e.id)));return[...e.addedAlerts.filter(Ce.S.isCapiAlert).filter((e=>!i.has(e.id))).map((e=>(0,$t.Tm)(e.id))),...e.removedAlerts.filter((e=>Ce.S.isCapiAlert(e.alert))).filter((e=>!t.has(e.id))).map((e=>(0,$t.qQ)(e.id,"textChange"===e.reason._tag?"textChange":"other")))]})),k.O(Array.from(t.getAll()).filter(Ce.S.isCapiAlert).map((e=>(0,$t.Tm)(e.id)))),S.h((e=>e.length>0)))))),this._subs.add(this._params.alertStateService.getActiveAlertByClick().pipe(C.U((e=>{var t;return null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null}))).subscribe(A.wW(this._selectedAlertId))),this._subs.add(this._applyAlertsSequentiallyRequests.pipe(Vt.b((({applyAlertsInfo:e,deferredPromise:t})=>ke.D(this._applyAlertsSequentially(e).then(t.resolve).catch(t.reject))))).subscribe())}async _applyAlertsSequentially(e){try{this._logger.debug("Applying alerts sequentially.",{applyAlertsInfo:e});const t=async function(e,t,i,n,s,r){for(const a of e)await Jt(a,t,i,n,s,r)}(e,(e=>B.ij(this._params.alertProcessor.alerts.getAlertById(e))),this._replacementService,this._params.getFormattingService,this._params.textObserver,this._params.dynamicConfig);this._params.experimentClient.isGateEnabled(q.K.SendChangesToCAPIAfterSequentialApply)&&this._params.requestAwaitService.addRequest(t),await t}catch(t){throw this._logger.warn("Error applying alerts sequentially.",{applyAlertsInfo:e,error:t}),t}}applyAlerts(e){this._logger.debug("Received apply alerts request.",{applyAlertsInfo:e});const t=(0,qe.II)();return this._applyAlertsSequentiallyRequests.next({applyAlertsInfo:e,deferredPromise:t}),t.promise}removeAlerts(e){try{return e.forEach((({alertId:e,removalReason:t})=>{this._params.alertProcessor.removeAlert(e,{_tag:"alertApplied"===t?Ge.i.alertAccepted:Ge.i.ignore})})),Promise.resolve()}catch(t){return this._logger.warn("Error removing alerts.",{removeAlertsInfo:e,error:t}),Promise.reject(t)}}scrollAlertIntoView(e){try{return this._params.highlightsScroller.scrollAlertIntoView(e),Promise.resolve()}catch(t){return this._logger.warn("Error scrolling alert into view.",{scrollAlertIntoViewInfo:e,error:t}),Promise.reject(t)}}setAlertsVisibility(e){try{return this._params.highlightsUpdater.setAlertsVisibility(e),Promise.resolve()}catch(t){return this._logger.warn("Error setting alerts visibility.",{alertsVisibilityInfo:e,error:t}),Promise.reject(t)}}updateAlertsVisibility(e){try{return this._params.highlightsUpdater.updateAlertsVisibility(e),Promise.resolve()}catch(t){return this._logger.warn("Error updating alerts visibility.",{alertsVisibilityInfo:e,error:t}),Promise.reject(t)}}dispose(){this._subs.unsubscribe()}}var Qt=i(39441),Zt=i(56215);function ei(e){const t={lifecycleService:e.lifecycleService,capiService:e.capiService,uphookService:e.uphookService,feedbackService:e.feedbackService,experimentService:e.experimentService,textEditorService:e.textEditorService,userService:e.userService,notifyAssistantUIAction:e.notifyAssistantUIAction,trackingService:e.trackingService,humanWritingReportService:e.hwrService,theme:void 0,deepLinkService:e.deepLinkService},i=()=>function(e){const t=F.h.create(e.initialAlertId),i=e.alertStateService.getActiveAlertByClick().pipe(C.U((e=>{var t;return null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null}))).subscribe(A.wW(t));return{sduiService:{supportedForms:e.supportedForms,sduiItemCollectionChanges:(n=e.getSDUIBuffer,s=e.inboundCAPIEvents,Q.z(Z.P((()=>E.of(n()))),s.pipe(S.h((0,D.Kg)(Zt.hX.is("sdui_add"),Zt.hX.is("sdui_update"),Zt.hX.is("sdui_remove"),(0,D.W9)(Zt.hX.is("session_started"),(e=>e.isNewSession)))),C.U((e=>[e])))).pipe(C.U(Me.UI((e=>{switch(e.kind){case"sdui_add":return(0,Qt.K5)(e.sduiRootId,e.sdui);case"sdui_update":return(0,Qt.FE)(e.sduiRootId,e.sdui);case"sdui_remove":return(0,Qt.Ul)(e.sduiRootId);case"session_started":return(0,Qt.Sq)();default:return(0,Ie.L0)(e)}}))),S.h((e=>e.length>0)),C.U((e=>({changes:e,pendingChangesCount:0})))))},alertService:new Xt({initialAlertId:e.initialAlertId,alertProcessor:e.alertProcessor,alertStateService:e.alertStateService,replacementServiceInjector:e.replacementServiceInjector,requestAwaitService:e.requestAwaitService,highlightsScroller:e.highlightsScroller,highlightsUpdater:e.highlightsUpdater,getFormattingService:e.getFormattingService,experimentClient:e.experimentClient,dynamicConfig:e.dynamicConfig,textObserver:e.textObserver}),dispose:()=>{e.highlightsUpdater.clearAll(),i.unsubscribe()}};var n,s}({getSDUIBuffer:e.getSDUIBuffer,inboundCAPIEvents:e.inboundCAPIEvents,alertProcessor:e.alertProcessor,initialAlertId:ct(e.openParams),highlightsUpdater:e.highlightsUpdater,highlightsScroller:e.highlightsScroller,replacementServiceInjector:e.replacementServiceInjector,getFormattingService:e.getFormattingService,requestAwaitService:e.requestAwaitService,alertStateService:e.alertStateService,supportedForms:e.supportedForms,experimentClient:e.experimentClient,dynamicConfig:e.dynamicConfig,textObserver:e.textObserver}),n=i=>({...t,kind:"genAI",genAIAvailabilityService:e.genAIAvailabilityService,genAIStartSessionOptions:ht(i,{disableKnowledgeEngine:!!e.disableKnowledgeEngine||void 0},e.getQuickReplyContext(),e.url),selectionContextAvailabilityService:e.selectionContextAvailabilityService,skillService:(0,B.FS)(e.skillService),notifyGenAISessionStateChanged:t=>e.genAISession.set(t),isTranslationAvailable:e.isTranslationAvailable});return{getGenAIDeps:n,getRevisionDeps:()=>(0,a.zG)(i(),(({alertService:i,sduiService:n,dispose:s})=>({...t,initialView:"genAI"!==e.openParams.assistantMode&&"genAIAndWritingExpert"!==e.openParams.assistantMode&&"emojiButtonSource"===e.openParams.source.kind?"toneReport":void 0,kind:"revision",alertService:i,sduiService:n,toneDetectorService:e.toneDetectorService,settingsOptions:{kind:"withView",getView:()=>e.settingsService.getView()},isPlagiarismEnabled:e.isPlagiarismEnabled,isWritingExpertEnabled:e.isWritingExpertEnabled,performanceScoreOptions:e.experimentClient.isGateEnabled(q.K.PerformanceScoreOggy)?{showEntryPoint:!0}:void 0,isAiDetectorEnabled:(0,a.zG)(e.capiStartAckMessage.view(B.UI((({allowedFeatures:e})=>e.includes("AI_DETECTOR"))))),isAiStudioEnabled:(0,a.zG)(e.capiStartAckMessage.view(B.UI((({allowedFeatures:e})=>e.includes("AI_STUDIO"))))),dispose:s}))),getGenAIAndWritingExpertDeps:e=>{const{alertService:t,sduiService:s}=i();return{...n(e),kind:"genAIAndWritingExpert",alertService:t,sduiService:s}}}}var ti=i(78285),ii=i(24858),ni=i(73204),si=i(24022),ri=i(49225),ai=i(71620),oi=i(96735);const li=X.ux.style({fontStyle:"normal",fontWeight:"normal",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif, Arial",$nest:{"button, input, textarea":{fontFamily:"inherit"}}}),ci=({children:e})=>{var t;const i=null===(t=o.useContext(fe.nS.Context))||void 0===t?void 0:t.host;return o.createElement(me.o,null,o.createElement(ti.Q,{remSize:E.of(16),setter:e=>ii.u.setRootCssVar(i||document.documentElement,e)},o.createElement(ni.G.DefaultProvider,null,o.createElement("div",{className:li},e,o.createElement(si.X,null)))))},hi=({children:e})=>{var t;const i=null===(t=o.useContext(fe.nS.Context))||void 0===t?void 0:t.host,{onMount:n,ref:s}=ri.P.useElWatcher();return o.createElement(me.o,null,o.createElement(ti.Q,{remSize:E.of(16),setter:e=>ii.u.setRootCssVar(i||document.documentElement,e)},o.createElement(ni.G.DefaultProvider,null,o.createElement("div",{className:li,ref:n,"data-role":"onboarding-tooltips",style:{position:"absolute",zIndex:oi.dl+1}},o.createElement(ai.l.Provider,{value:{portalContainer:s}},e),o.createElement(si.X,null)))))};var di=i(94381);const ui=({width:e,height:t,top:i,left:n,visibility:s})=>o.createElement("div",{"data-grammarly-part":"cheetah-highlight-rect",...(0,O.Sh)(di.highlightRect,"hidden"===s?di.hidden:null,"attention"===s?di.attention:null),style:{width:e,height:t,top:i,left:n}});var pi=i(60310),gi=i(19232),mi=i(51320),fi=i(30409);const vi=({referenceElement:e,placement:t,offset:i,disabled:n,onMagicRewriteClick:s,onOpenRewriteClick:r,onOpenTranslateClick:a})=>{const[l,c]=o.useState(null),{styles:h,attributes:d}=(0,gi.D)(e,l,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return s||r?o.createElement("div",{ref:c,style:h.popper,...d.popper,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-entry-button",className:fi.entryButton,"data-disabled":n},s?o.createElement(mi.u,{message:"Improve it"},o.createElement("button",{onClick:s,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:fi.entryButtonItem,"data-disabled":n},o.createElement("i",{className:fi.rewriteIcon}))):null,a?o.createElement(mi.u,{message:"Translate with Grammarly"},o.createElement("button",{onClick:a,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:fi.entryButtonItem,"data-disabled":n},o.createElement("i",{className:fi.translateIcon}))):null,r?o.createElement(mi.u,{message:"Rewrite with Grammarly"},o.createElement("button",{onClick:r,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:fi.entryButtonItem,"data-disabled":n},o.createElement("i",{className:fi.openIcon}))):null):null};var _i=i(68550);const bi=({referenceElement:e,placement:t,offset:i,disabled:n,onClick:s})=>{const[r,a]=o.useState(null),{styles:l,attributes:c}=(0,gi.D)(e,r,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return o.createElement("button",{ref:a,style:l.popper,...c.popper,onClick:s,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-reply-button",className:_i.replyButton,"data-disabled":n},o.createElement("div",{className:_i.icon}),o.createElement("span",null,"Reply quickly"))};var Si=i(44071),yi=i(93526);const wi=()=>o.createElement("svg",{className:yi.icon,viewBox:"0 0 16 16",fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round"},o.createElement("path",{d:"M8,16C12.418,16 16,12.418 16,8C16,3.582 12.418,0 8,0C3.582,0 0,3.582 0,8C0,12.418 3.582,16 8,16Z",fill:"#0A9A78"}),o.createElement("path",{d:"M4,8L12,8M8,4L8,12",fill:"none",fillRule:"nonzero",stroke:"white",strokeWidth:"1.5px"})),Ai=({overflow:e,...t})=>e?o.createElement(Ci,{...t}):o.createElement(Ii,{...t}),Ii=({left:e,top:t,height:i})=>o.createElement(o.Fragment,null,o.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:yi.quasiCaret,style:{left:e,top:t+i,height:i+8}},o.createElement(wi,null))),Ci=({left:e,top:t,height:i})=>{const{ref:s,onMount:r}=ri.P.useElWatcher(),l=o.useMemo((()=>F.h.create(B.YP)),[]),{rect:c,onMount:h}=ri.P.useRectWatcher(),d=o.useCallback((e=>{e.style.pointerEvents="all",l.set((0,a.zG)(n.Yt(B.Kw)({rect:B.G(e.getBoundingClientRect()),goodParent:(0,a.zG)(e.getBoundingClientRect(),(e=>({x:e.x+e.width/2,y:e.y+e.height/2})),(({x:e,y:t})=>{var i,n;return B.ij(null===(n=null===(i=document.elementFromPoint(e,t))||void 0===i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint(e,t))}),B.hX((t=>t===e||e.contains(t||null))))}),B.g_((()=>B.YP),(({rect:e})=>B.G({x:e.x,y:e.y}))))),e.style.pointerEvents="none"}),[]),u=o.useMemo((()=>Si.R(document,"scroll",{capture:!0}).pipe(k.O(null))),[]);return ri.P.useSubscriptionTo(I.a([s.pipe(v.oA),u,c]).pipe(x.b((([e])=>d(e))))),o.createElement(o.Fragment,null,o.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:yi.quasiCaret,style:{left:e,top:t+i,height:i+8},ref:e=>{r(e),h(e)}},o.createElement(ue.F.div,{style:l.pipe(C.U((e=>(0,a.zG)(e,B.g_((()=>({opacity:1})),(()=>({opacity:0})))))))},o.createElement(wi,null))),o.createElement(ue.F.Fragment,null,l.pipe(C.U((e=>(0,a.zG)(e,B.g_(a.gn,(e=>o.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret-fixed-bro",className:yi.quasiCaret,style:{transform:"none",position:"fixed",left:e.x,top:e.y,height:i+8}},o.createElement(wi,null))))))))))},xi=(0,O.xb)(pi.G),Ei=new Set(["loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","noPaymentMethodSubscription","grammarlyBusinessSigninPopup","gdocsFeedbackUI"]),Ri=new Set(["loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","grammarlyBusinessSigninPopup"]);function ki(e){return"opened"===e.kind}function Ti(e){return ki(e)&&"revision"!==e.assistantMode}class Pi{constructor(e){this._params=e,this._subs=new m.w0,this._log=Y.Y.create("CheetahFeatureImpl"),this._inlineButtonUI=F.h.create(null),this._ideateButtonUI=F.h.create(null),this._expandedIdeateButtonUI=F.h.create(null),this._assistantUI=F.h.create(null),this._highlightUI=F.h.create(null),this._quasiCaretUI=F.h.create(null),this._onboardingUI=F.h.create(null),this._nativeCursorHider=F.h.create(B.YP),this._contextHighlight=F.h.create(B.YP),this._highlightsUpdater=new it({getAlertById:e=>this._params.alertProcessor.alerts.getAlertById(e),aquaAlertsWiring:this._params.aquaAlertsWiring,alertStateService:this._params.alertStateService,logger:Y.Y.create("cheetah.revision.highlights")}),this._highlightsScroller=new Xe({integration:this._params.integration,getAlertById:e=>this._params.alertProcessor.alerts.getAlertById(e)}),this._ideateButtonTooltipNotificationState=F.h.create(B.YP),this._assistantFocused=F.h.create(!1),this._inlineButtonRecentlyPressed=F.h.create(!1),this._ideateButtonRecentlyHovered=F.h.create(!1),this._selectionRange=F.h.create(B.YP),this._isTranslationAvailable=F.h.create(!1),this._highlights=F.h.create([]),this._quasiCaretRect=F.h.create(B.YP),this._assistantUIState=F.h.create(B.YP),this._onboardingViewModels=F.h.create(B.YP),this._ideateButtonRefChange=new f.x,this._disposed=new f.x,this._initialOnboardingBlockedForSession=F.h.create(!1),this._inboundCAPIEvents=new f.x,this._assistantServices=Nt(this._params.checkingService,this._params.checkingService.pipe(v.oA,_.w((e=>e.capiMessages))),(()=>Object.values(this._params.latestCAPIMessages.get())),this._params.user,this._params.csPageState,this._params.dapiSettings.view((e=>{var t,i;return null!==(i=null!==(t=e.dialectStrong)&&void 0!==t?t:e.dialectWeak)&&void 0!==i?i:"american"})),(e=>r.fF((()=>this._params.dapiActions.changeStrongDialect(e)))),this._assistantUIState,this._params.textStats,this._params.capiStartAckMessage,this._ideateButtonRefChange,F.h.combine(this._params.integration.canShowIdeateButtonPopups,this._params.gButtonPopupState.view("type").view((e=>!Ei.has(e))),D.xD),F.h.combine(this._params.csPageState.view("cheetah").view((e=>(null==e?void 0:e.canShowInitialOnboarding)||(null==e?void 0:e.canShowInitialBTSOnboarding)||!1)),this._initialOnboardingBlockedForSession,((e,t)=>e&&!t)),b.T(this._params.csPageState.view("isActiveTab").pipe(S.h((e=>!e))),this._disposed).pipe(y.q(1)),this._params.dapiSettings.view((e=>{const t=function(e){const t=l.Z.State.toClientState(l.Z.decode(e.extension||""),"extension"),i=l.Z.State.toClientState(l.Z.decode(e.editor||""),"editor"),n=l.Z.State.toClientState(l.Z.decode(e.llamaMac||""),"llamaMac"),s=l.Z.State.toClientState(l.Z.decode(e.llamaWin||""),"llamaWin");return(0,a.zG)(l.Z.State.empty,l.Z.State.patch(t,"extension"),l.Z.State.patch(i,"editor"),l.Z.State.patch(n,"llamaMac"),l.Z.State.patch(s,"llamaWin"))}({extension:e["cheetah:onboardingState"],editor:e["cheetah:onboardingState:editor"],llamaMac:e["cheetah:onboardingState:llamaMac"],llamaWin:e["cheetah:onboardingState:llamaWin"]});return this._log.debug("DAPI onboarding state",t),t})),(e=>{this._params.dapiActions.modifyCheetahOnboardingState((0,a.ls)(l.Z.decode,(t=>(0,a.zG)(l.Z.State.toClientState(t,"extension"),(t=>({...t,...e})),(e=>l.Z.State.patch(e,"extension")(t)))),l.Z.encode))}),this._params.featureFlags,this._params.textChangeBuffer,(e=>this._params.integration.getText(e)),(e=>this._insertText(e)),this._selectionRange,this._params.integration.textUpdated,this._contextHighlight,this._params.gnar,this._params.domain,this._params.telemetry,this._params.experimentClient,this._params.csPageState.view("cheetah"),this._params.alertProcessor,this._params.skillService,this._params.hasInProductDiscountSpecialOffer,this._log),this._isOnboardingPopupVisible=F.h.create(!1),this._entryPointsEnabled=F.h.create(!1),this._openAssistantSubject=new f.x,this._assistantApplet=F.h.create(null),this._latestOpenAssistantParams=null,this.preloadUI=this._assistantApplet.view((e=>null==e?void 0:e.preloadUI)),this.inlineButtonUI=this._inlineButtonUI.view(),this.ideateButtonUI=this._ideateButtonUI.view(),this.expandedIdeateButtonUI=this._expandedIdeateButtonUI.view(),this.assistantUI=this._assistantUI.view(),this.highlightUI=this._highlightUI.view(),this.quasiCaretUI=this._quasiCaretUI.view(),this.onboardingUI=this._onboardingUI.view(),this.assistantState=this._assistantUI.view((0,a.ls)(B.ij,B.tS((()=>{var e;return B.ij(null===(e=this._latestOpenAssistantParams)||void 0===e?void 0:e.assistantMode)})),B.g_((()=>({kind:"closed"})),(e=>({kind:"opened",assistantMode:e}))))),this.isOnboardingPopupVisible=this._isOnboardingPopupVisible.view(),this.isTranslationAvailable=this._isTranslationAvailable.view(),this.isAvailable=F.h.combine(this._assistantServices.genAIAvailabilityService.availability.view((0,D.ff)(c._.isUnavailable)),this._params.csPageState.view("cheetah"),((e,t)=>{var i;return e&&!0===(null===(i=null==t?void 0:t.status)||void 0===i?void 0:i.cheetahEnabled)})),this.userSettings=this._assistantServices.genAIAvailabilityService.availability.view((e=>e.kind===c._.Kind.disabled||e.kind===c._.Kind.unavailable?{inlineQuickReplyEnabled:!1,inlineRewriteEnabled:!1}:e.userSettings)),this.assistantInjectionMode=this._params.integration.assistantInjectionMode,this._params.dapiActions.reloadPropsRateLimited(),this._subs.add(this._params.checkingService.pipe(v.oA,_.w((e=>e.capiEvents))).subscribe(this._inboundCAPIEvents)),this._subs.add(this._params.checkingService.pipe(v.oA,_.w((e=>e.readyState)),S.h((e=>e===W.kQ.ready||e===W.kQ.firstTextCheckCompleted)),y.q(1)).subscribe((()=>this._init()))),this._subs.add(this._setupIdeateTooltipStateObs());const t=this._onboardingViewModels.pipe(_.w(B.g_((()=>w.E),(e=>e.onboarding.uiActions))));this._subs.add(t.pipe(S.h(Oi)).subscribe((()=>{this._params.cheetahCSActions.cheetahInitialOnboardingShown()}))),this._subs.add(t.pipe(S.h(Fi)).subscribe((()=>{this._params.cheetahCSActions.cheetahInitialBTSOnboardingShown()}))),this._subs.add(this._getOnboardingVMStepActive([h.T.StepName.initial,h.T.StepName.initialBTS]).subscribe(A.wW(this._isOnboardingPopupVisible))),this._subs.add(this._params.gButtonPopupState.view("type").view((e=>Ri.has(e))).subscribe((e=>{e&&this._initialOnboardingBlockedForSession.set(!0)}))),this._subs.add(I.a([this._params.gButtonDisabledReason,this._params.integration.entryPointsEnabled]).pipe(C.U((([e,t])=>t&&!function(e){const t=new Set([V.P.DATA_CONTROL_ACTIVE,V.P.OFFLINE,V.P.STAND_WITH_UKRAINE,V.P.USER_CLAIMED,V.P.USER_EDC_BLOCKED,V.P.SIGNED_OUT_GB,V.P.INACTIVE_INTEGRATION]);return null!==e&&t.has(e)}(e)))).subscribe(A.wW(this._entryPointsEnabled))),this._subs.add(this._params.csPageState.view("cheetah").view((e=>{var t;return!1===(null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.cheetahEnabled)})).pipe(S.h((()=>{var e;return"genAI"===(null===(e=this._latestOpenAssistantParams)||void 0===e?void 0:e.assistantMode)}))).subscribe((()=>this._closeAssistant(J.jg.disposed)))),this._registerDebugHelpers(),this._setupAssistantAppletInstance(),this._hwrService=this._params.hwrService}_setupAssistantAppletInstance(){{if(!(0,H.X)(this._params.experimentClient))return;const e=()=>{const t=this._assistantApplet.get();this._assistantApplet.set(new $e(this._params,this._selectionRange,this._highlightsUpdater,this._highlightsScroller,(t=>{this._closeAssistant(t),e()}),this._contextHighlight)),null==t||t.dispose()};j.C.shared.onReady.then((()=>{e()}))}}closeAssistant(e){this._closeAssistant(e)}getHoveredStateBehavior(e){return this._highlightsUpdater.getHighlightVisualState(e)}getAlertsFilter(){return this._highlightsUpdater.alertsFilter}suggestStartSessionMode(){const e=this._params.featureFlags.get();return(0,a.zG)(this._params.integration.selectionRange.get(),B.hX((t=>Ui(t)&&e.rewrite)),B.g_((()=>"ideation"),(()=>"rewrite")))}_isMergedAssistantEnabled(){return"mergedSharedAssistant"===this._params.sharedAssistantTreatment}_init(){this._subs.add(this._assistantFocused.subscribe((e=>this._log.debug("Assistant "+(e?"focused":"blurred"))))),this._subs.add(this._openAssistantSubject.pipe(_.w((e=>(this._latestOpenAssistantParams=e,this._openAssistant(e))))).subscribe()),this._subs.add(this._params.openAssistant.subscribe(this._openAssistantSubject)),this._subs.add(this._getInlineButtonUI().subscribe(A.wW(this._inlineButtonUI))),this._subs.add(this._getIdeateButtonUI().subscribe(A.wW(this._ideateButtonUI))),this._subs.add(this._getExpandedIdeateButtonUI().subscribe(A.wW(this._expandedIdeateButtonUI))),this._subs.add(this._getHighlightUI().subscribe(A.wW(this._highlightUI))),this._subs.add(this._getQuasiCaretUI().subscribe(A.wW(this._quasiCaretUI))),this._subs.add(this._getOnboardingUI().subscribe(A.wW(this._onboardingUI))),this._subs.add(this._updateSelectionRange().subscribe(A.wW(this._selectionRange))),this._subs.add(this._updateHighlightRects().subscribe(A.wW(this._highlights))),this._subs.add(this._updateQuasiCaretRect().subscribe(A.wW(this._quasiCaretRect))),this._subs.add(this._updateNativeCursor().subscribe()),this._subs.add(this.assistantState.subscribe((e=>{ki(e)&&this._params.closeLegacyAssistant()}))),this._subs.add(this._createOnboardingViewModelWhenCheetahAvailable().subscribe()),this._subs.add(this._handleTryItOut().subscribe()),this._subs.add(this._updateTranslationIsAvailable().subscribe(A.wW(this._isTranslationAvailable)))}_handleTryItOut(){return this._onboardingViewModels.pipe(_.w(B.g_((()=>w.E),(e=>e.onboarding.uiActions))),S.h(d.l.is(d.l.Kind.tryItOut)),x.b((()=>this._openAssistantSubject.next({assistantMode:Ht(this._params.sharedAssistantTreatment),source:{kind:"onboardingSource"},genAIParams:{genAISessionMode:Mi(this._params.integration.quickReplyContext.get())&&this._params.featureFlags.get().quickReply?"quickReply":"ideation"}}))))}_getOnboardingVMStepActive(e){return this._onboardingViewModels.pipe(_.w(B.g_((()=>E.of(!1)),(t=>t.onboarding.activeStep.view((0,a.ls)(B.hX((e=>e.show)),B.UI((t=>e.includes(t.name))),B.fS(a.jv)))))),R.x())}_setupIdeateTooltipStateObs(){return this._assistantServices.genAIAvailabilityService.availability.pipe(k.O(null),T.G(),C.U((([e,t])=>e&&t&&c._.isPassive(e)&&c._.isActive(t)?B.G("You’ve got prompts!"):B.YP)),_.w(B.g_((()=>E.of(B.YP)),(e=>b.T(E.of(B.G(e)),E.of(B.YP).pipe(P.g(3e3))))))).subscribe(A.wW(this._ideateButtonTooltipNotificationState))}_registerDebugHelpers(){}_createOnboardingViewModelWhenCheetahAvailable(){return F.h.combine(this._params.featureFlags,this._assistantServices.genAIAvailabilityService.availability.view(c._.isUsable),((e,t)=>e.onboarding&&t)).pipe(x.b((e=>this._onboardingViewModels.modify((t=>((0,a.zG)(t,z.bw((e=>e.onboarding.dispose()))),e?B.G(this._assistantServices.createOnboardingViewModels()):B.YP))))))}_onClickIdeateButton(e){ki(this.assistantState.get())?this._closeAssistant(J.jg.closed):this._openAssistantSubject.next({assistantMode:Ht(this._params.sharedAssistantTreatment),source:{kind:"gButtonSource"},genAIParams:{genAISessionMode:e}})}_updateTranslationIsAvailable(){const{integration:e,textObserver:t,languageDetector:i,gnar:n,featureFlags:s}=this._params;return I.a([e.selectionRange,this.assistantState.view(ki),this._assistantServices.genAIAvailabilityService.availability]).pipe(C.U((([e,t,i])=>({selectionRange:e,assistantOpened:t,availability:i}))),S.h((({assistantOpened:e,availability:t})=>!e&&c._.isUsable(t)&&s.get().inlineTranslate)),C.U((({selectionRange:e})=>e)),v.oA,S.h((e=>Ui(e))),C.U((({start:e,end:i})=>t.getTextSource().getPlainText().slice(e,i))),_.w((e=>i.isEnglish(e))),C.U((({result:e})=>null!==e&&!e)),x.b((e=>{e&&n.appActionsInlineTranslateButtonShow()})))}_updateSelectionRange(){return I.a([this._params.integration.selectionRange,this.assistantState.view(ki)]).pipe(C.U((([e,t])=>({selectionRange:e,assistantIsFocused:this._assistantFocused.get(),inlineButtonRecentlyPressed:this._inlineButtonRecentlyPressed.get(),ideateButtonRecentlyHovered:this._ideateButtonRecentlyHovered.get(),initialPopupOnboardingStepIsActive:this.isOnboardingPopupVisible.get(),assistantOpened:t}))),x.b((({inlineButtonRecentlyPressed:e,ideateButtonRecentlyHovered:t})=>{e&&this._inlineButtonRecentlyPressed.set(!1),t&&this._ideateButtonRecentlyHovered.set(!1)})),S.h((({selectionRange:e,assistantIsFocused:t,inlineButtonRecentlyPressed:i,ideateButtonRecentlyHovered:n,initialPopupOnboardingStepIsActive:s,assistantOpened:r})=>!i&&!n&&(!r||(!B.Wi(e)||!t&&!s)))),C.U((({selectionRange:e})=>e)))}_updateHighlightRects(){return e=this._selectionRange,t=this._contextHighlight,i=this._params.integration,I.a([e.pipe(_.w(B.g_((()=>E.of([])),(e=>i.getHighlightRects(e).pipe(C.U((e=>e.map((e=>({rect:e,visibility:"visible"})))))))))),t.pipe(_.w(B.g_((()=>E.of([])),(e=>i.getHighlightRects(e.range).pipe(C.U((t=>t.map((t=>({rect:t,visibility:e.visibility}))))))))))]).pipe(C.U((([e,t])=>t.find((e=>"hidden"!==e.visibility))?t:e)));var e,t,i}_updateQuasiCaretRect(){return I.a([this._selectionRange,this._highlightsUpdater.hasHighlights]).pipe(_.w((([e,t])=>(0,a.zG)(e,B.hX((()=>!t)),B.hX(L.SV.isCollapsed),B.g_((()=>E.of([])),(e=>this._params.integration.getHighlightRects(e)))))),C.U((e=>(0,a.zG)(e,s.c2,B.UI((e=>e[e.length-1]))))))}_updateNativeCursor(){return F.h.combine(this._quasiCaretRect,this._params.experimentClient.isGateEnabled(q.K.UnfixFast570)?this.assistantState.view(ki):this.assistantState.view(Ti),((e,t)=>(0,a.zG)(n.Yt(B.Kw)({nativeUIHider:B.ij(this._params.integration.createNativeUIHider),quasiCaretRect:e}),B.hX((()=>t)),z.ew((()=>{this._nativeCursorHider.modify((e=>((0,a.zG)(e,z.bw((e=>e.dispose()))),B.YP)))})),z.bw((({nativeUIHider:e})=>{this._nativeCursorHider.modify((t=>((0,a.zG)(t,z.bw((e=>e.dispose()))),B.G(e()))))})))))}_closeAssistant(e){var t,i,n;this._assistantUIState.set(B.YP),this._assistantUI.set(null),e!==J.jg.closed&&e!==J.jg.assistantBlurred||this._params.integration.focusTextField(),(null===(t=this._latestOpenAssistantParams)||void 0===t?void 0:t.assistantMode)&&(null===(i=this._params.assistantDidClose)||void 0===i||i.next(null===(n=this._latestOpenAssistantParams)||void 0===n?void 0:n.assistantMode))}async _openAssistant(e){Ae.markOpenAttempt(),ki(this.assistantState.get())&&this._closeAssistant(J.jg.disposed),this._assistantFocused.set(!0),"revision"!==e.assistantMode&&"pushRewrite"===e.genAIParams.genAISessionMode&&this._selectionRange.set(B.G(e.genAIParams.transformRange));try{const t=await this._params.getHostInfo(),i=await this._params.integration.renderAssistant((({sizeBehavior:i,dragBehavior:n,readyToDrag:s})=>{{const t=this._assistantApplet.get();if(null!=t)return t.render(e,{sizeBehavior:i,dragBehavior:n,readyToDrag:s})}const r=(0,K.D)(n).pipe(C.U((e=>"draggable"===e.kind&&e.isDragging))),{assistantHeight:l,assistantPosition:c,isPlagiarismEnabled:h,isWritingExpertEnabled:d}=this._params.integration,{gnar:p,checkingService:g,statisticsService:m}=this._params,f=new rt({isDragging:r,height:l,position:c,gnar:p,checkingService:g,statisticsService:m,integration:this._params.integration,openAssistantParams:e,supportedForms:this._params.supportedForms}),v=new Ae({sizeBehavior:i,dragBehavior:n,hostInfo:t,gnarTracking:f,onFocusStateChanged:e=>this._assistantFocused.set(e.isFocused),onReadyToDrag:e=>s(e),onVisuallyReady:()=>{var t;return null===(t=this._params.assistantDidOpen)||void 0===t?void 0:t.next(e.assistantMode)},onClose:()=>this._closeAssistant(J.jg.closed)}),_=F.h.create(B.YP),b=function(e,t,i=!1){return{performanceScoreReportShown:t=>{e.assistantPerformanceScoreReportShow(t)},feedSuccessStateShown:(i,n)=>{e.assistantSuccessStateShow(i,n,nt(t))},feedFormChanged:(i,n,s)=>{switch(i){case"shortForm":e.assistantSwitchToShortFormClick(n||void 0,null===s?void 0:s,nt(t));break;case"longForm":e.assistantSwitchToLongFormClick(n||void 0,null===s?void 0:s,nt(t));break;default:(0,Ie.L0)(i)}},toneReportShown:({tones:i,brandTonesEnabled:n})=>{var s,r;e.emogenieReportShow(i.map((({name:e,confidence:t,prevalence:i})=>({name:e,confidence:t,prevalence:i}))),n,i.length,null!==(r=null===(s=B.WG(t.get()))||void 0===s?void 0:s.sessionUuid)&&void 0!==r?r:"")},feedLensShown:i=>{e.assistantLensShow(i,nt(t))},feedLensButtonClicked:i=>{e.assistantLensButtonClick(i,nt(t))},actionButtonClicked:(i,n,s,r,a)=>{e.assistantActionButtonClick(i,n,s,r,a,nt(t))},moreActionsButtonClicked:(i,n,s)=>{e.assistantMoreActionsButtonClick(i,n,s,nt(t))},actionButtonRendered:(n,s,r,a,o)=>{i&&e.assistantActionButtonRender(n,s,r,a,o,nt(t))},actionButtonShown:(n,s,r,a,o)=>{i&&e.assistantActionButtonImpression(n,s,r,a,o,nt(t))},plagiarismCitationsStyleChanged:i=>{e.assistantPlagiarismCitationsStyleChange(i,nt(t))},plagiarismCitationsStyleDropdownOpened:i=>{e.assistantPlagiarismCitationsStyleDropdownOpen(i,nt(t))},selectionContextHovered:()=>{e.assistantSelectionContextHover(nt(t))},selectionContextClicked:()=>{e.assistantSelectionContextClick(nt(t))},selectionContextRemoveButtonClicked:()=>{e.assistantSelectionContextRemoveButtonClick(nt(t))},partialPageModeNotificationDismissed:a.Q1}}(p,g,this._params.experimentClient.isGateEnabled(q.K.CheetahProfuseEventsTracking)),{getGenAIDeps:S,getRevisionDeps:y,getGenAIAndWritingExpertDeps:w}=ei({openParams:e,genAISession:_,lifecycleService:v,capiService:this._assistantServices.capiService,uphookService:this._assistantServices.uphookService,feedbackService:this._assistantServices.feedbackService,experimentService:this._assistantServices.experimentService,textEditorService:this._assistantServices.textEditorService,userService:this._assistantServices.userService,notifyAssistantUIAction:this._assistantServices.notifyAssistantUIAction,getSDUIBuffer:this._params.getSDUIBuffer,inboundCAPIEvents:this._inboundCAPIEvents,alertProcessor:this._params.alertProcessor,initialAlertId:ct(e),highlightsUpdater:this._highlightsUpdater,highlightsScroller:this._highlightsScroller,replacementServiceInjector:this._params.replacementServiceInjector,getFormattingService:this._params.getFormattingService,requestAwaitService:this._params.requestAwaitService,alertStateService:this._params.alertStateService,supportedForms:this._params.supportedForms,isSharedAssistantEnabled:null!==this._params.sharedAssistantTreatment,selectionContextAvailabilityService:this._assistantServices.selectionContextAvailabilityService,toneDetectorService:this._assistantServices.toneDetectorService,settingsService:this._params.settingsService,genAIAvailabilityService:this._assistantServices.genAIAvailabilityService,url:this._params.url,disableKnowledgeEngine:"disabled"===this._params.dapiSettings.get().serengetiState,getQuickReplyContext:()=>this._params.integration.quickReplyContext.get(),experimentClient:this._params.experimentClient,dynamicConfig:this._params.dynamicConfig,skillService:this._params.skillService,isPlagiarismEnabled:h,isWritingExpertEnabled:d,trackingService:b,textObserver:this._params.textObserver,hwrService:this._hwrService,isTranslationAvailable:this._isTranslationAvailable.get(),capiStartAckMessage:this._params.capiStartAckMessage,deepLinkService:this._params.deepLinkService}),A=(0,u.S)((0,a.zG)(e,(e=>{switch(e.assistantMode){case"genAI":return{dispose:a.Q1,...S(e.genAIParams)};case"revision":return y();case"genAIAndRevision":return(0,a.zG)(y(),(t=>({...S(e.genAIParams),...t,kind:"genAIAndRevision",capiService:this._assistantServices.capiService})));case"genAIAndWritingExpert":return{dispose:a.Q1,...w(e.genAIParams)}}}),(e=>({...e,theme:F.h.create({useIframeTextfieldWrapper:this._params.experimentClient.isGateEnabled(q.K.OggyIframeWrappers)}),dispose:()=>{var t;null===(t=e.dispose)||void 0===t||t.call(e),v.dispose(),this._assistantFocused.set(!1)}}))));return this._assistantUIState.set(B.G({genAISession:_,dragBehavior:(0,K.D)(n)})),o.createElement(A,null)}),e.assistantMode);this._assistantUI.set(o.createElement(ci,null,i))}catch(e){this._log.error("failed to open assistant",e),this._assistantUIState.set(B.YP),this._assistantUI.set(null)}}_getInlineButtonUI(){return(0,a.zG)(n.Yt(N.P)({inlineButtonInfo:this._params.integration.inlineButtonPlacement,selectionRange:this._selectionRange,selectionOngoing:b.T(this._params.integration.selectionRange.pipe(C.U((e=>(0,a.zG)(e,B.pC)))),this._params.integration.selectionRange.pipe(M.b(100),U.h(!1))),assistantOpened:this.assistantState.view(ki),textMapIsEmpty:this._params.integration.textMapIsEmpty,quickReplyContext:this._params.integration.quickReplyContext,availability:this._assistantServices.genAIAvailabilityService.availability,entryPointsEnabled:this._entryPointsEnabled,featureFlags:this._params.featureFlags})).pipe(C.U((({inlineButtonInfo:e,selectionRange:t,selectionOngoing:i,assistantOpened:n,textMapIsEmpty:s,quickReplyContext:r,availability:l,entryPointsEnabled:h,featureFlags:d})=>(0,a.zG)(e,B.hX((()=>h)),B.hX((()=>!n)),B.hX((()=>c._.isUsable(l))),B.g_(a.gn,(e=>(0,a.zG)(t,B.g_(a.gn,(t=>{if(s&&B.pC(r)&&d.inlineQuickReply)return o.createElement(bi,{disabled:!1,referenceElement:e.referenceElement,placement:e.placement,offset:B.WG(e.offset),onClick:()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(Wt(Ht(this._params.sharedAssistantTreatment),"quickReply",{kind:"inlineQuickReplySource"}))}});if(Ui(t)&&(d.inlineRewrite||d.magicRewrite)&&this._params.integration.enableInlineRewrites){const t=d.inlineTranslate&&this._isTranslationAvailable.get(),n=d.magicRewrite&&!t;return o.createElement(vi,{disabled:i,referenceElement:e.referenceElement,placement:e.placement,offset:B.WG(e.offset),onOpenRewriteClick:d.inlineRewrite?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(Wt(Ht(this._params.sharedAssistantTreatment),"rewrite",{kind:"inlineRewriteSource"}))}:void 0,onMagicRewriteClick:n?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(Wt(Ht(this._params.sharedAssistantTreatment),"quickRewrite",{kind:"inlineQuickRewriteSource"}))}:void 0,onOpenTranslateClick:t?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(Wt(Ht(this._params.sharedAssistantTreatment),"translate",{kind:"inlineTranslateSource"}))}:void 0})}return null})))))))))}_getOnboardingUI(){const e=this._params.featureFlags.get().externalOnboardingContextProviderFix?hi:ci;return this._onboardingViewModels.view(B.g_(a.gn,(t=>o.createElement(e,null,G.UI.mount(p.T,(0,g.A)(t))))))}_getHighlightUI(){return F.h.combine(this._highlights,this.assistantState.view(ki),this._assistantFocused,((e,t,i)=>t&&i?e.map((({rect:e,visibility:t},i)=>o.createElement(ui,{key:`cheetah-highlight-rect-${i}`,top:e.top,left:e.left,width:e.width,height:e.height,visibility:t}))):null))}_getQuasiCaretUI(){return F.h.combine(this._quasiCaretRect,this._params.experimentClient.isGateEnabled(q.K.UnfixFast570)?this.assistantState.view(ki):this.assistantState.view(Ti),((e,t)=>(0,a.zG)(e,B.hX((()=>t)),B.g_((()=>null),(e=>o.createElement(Ai,{left:e.left,top:e.top,height:e.height,overflow:this._params.integration.allowCustomCaretOverflow}))))))}_getButtionUI(e){return F.h.combine(this._params.featureFlags,this._inlineButtonUI,this._selectionRange,this._params.integration.quickReplyContext,this._assistantServices.genAIAvailabilityService.availability,this._entryPointsEnabled,((t,i,n,s,r,o)=>(0,a.zG)(i,B.DT((e=>null===e)),B.hX((()=>o&&t.ideateButton)),B.hX((()=>c._.isUsable(r))),B.g_(a.gn,(()=>e(n,s,t))))))}_getIdeateButtonUI(){return this._getButtionUI(this._getIdeateButtonForSelectionRange.bind(this))}_getExpandedIdeateButtonUI(){return this._isMergedAssistantEnabled()?F.h.create(null):F.h.combine(this._params.featureFlags,this._selectionRange,this._params.integration.quickReplyContext,this._assistantServices.genAIAvailabilityService.availability,this._entryPointsEnabled,((e,t,i,n,s)=>(0,a.zG)(n,B.DT((e=>c._.isVisible(e))),B.hX((()=>s&&e.ideateButton)),B.g_(a.gn,(()=>this._getIdeateButtonForSelectionRange(t,i,e))))))}_getIdeateButtonForSelectionRange(e,t,i){return this._isMergedAssistantEnabled()?null:(0,a.zG)(e,B.hX((e=>Ui(e)&&i.rewrite)),B.g_((()=>Mi(t)&&i.quickReply?"quickReply":i.compose?"ideation":null),(()=>"rewrite")),B.ij,B.g_(a.gn,(e=>o.createElement(xi,{onMouseEnter:()=>this._ideateButtonRecentlyHovered.set(!0),onMouseLeave:()=>this._ideateButtonRecentlyHovered.set(!1),onClick:()=>this._onClickIdeateButton(e),mount:e=>this._ideateButtonRefChange.next(e),forceTooltipMessage:this._ideateButtonTooltipNotificationState.view(B.FS)}))))}_insertText(e){""!==e?this._params.integration.insertText(e,this._selectionRange.get()):this._log.warn("insert() - attempting to insert empty response, skipping insert.")}dispose(){var e,t;this._disposed.next(null),this._highlightsUpdater.dispose(),this._closeAssistant(J.jg.disposed),null===(e=B.FS((0,a.zG)(this._onboardingViewModels.get(),B.UI((e=>e.onboarding)))))||void 0===e||e.dispose(),this._assistantServices.dispose(),null===(t=this._assistantApplet.get())||void 0===t||t.dispose(),this._subs.unsubscribe(),(0,a.zG)(this._nativeCursorHider.get(),z.bw((e=>e.dispose()))),this._params.integration.dispose()}}function Mi(e){return(0,a.zG)(e,B.Gg((e=>Object.values(e).filter((e=>void 0!==e)).length>0)))}function Ui(e){const t=e.end-e.start;return t>=10&&t<5e3}function Oi(e){return(0,D.W9)(d.l.is(d.l.Kind.mount),(e=>e.step===h.T.StepName.initial))(e)}function Fi(e){return(0,D.W9)(d.l.is(d.l.Kind.mount),(e=>e.step===h.T.StepName.initialBTS))(e)}},33535:(e,t,i)=>{var n;i.d(t,{M:()=>n}),function(e){e.overlay="overlay",e.inherit="inherit"}(n||(n={}))},8783:(e,t,i)=>{i.d(t,{B:()=>P});var n=i(86399),s=i(90023),r=i(76917),a=i(74822),o=i(29479),l=i(94592),c=i(84308),h=i(59179),d=i(3527),u=i(84178),p=i(44045),g=i(64271),m=i(954),f=i(20161),v=i(84714),_=i(13391),b=i(58303),S=i(52303),y=i(4603),w=i(1596),A=i(92570),I=i(74983),C=i(68485),x=i(4798),E=i(70932),R=i(33535),k=i(57291),T=i(96735);class P{constructor(e){var t;this._params=e,this._subs=new r.w.Keeper,this._activeSelectionRange=_.h.create(b.YP),this._activeSelectionBoundingClientRects=_.h.create(b.YP),this._gButtonRef=_.h.create(b.YP),this._textMapEmpty=_.h.create(!0),this._docContext=_.h.create(b.YP),this._canShowIdeateButtonPopups=_.h.create(!1),this._entryPointsEnabled=_.h.create(!1),this._disposed=new a.x,this._positionModel=(0,A.j)(this._params.textField,this._params.csState,this._params.fieldSettings,this._params.csActions),this._assistantHeight=_.h.create(0),this._replacementService=this._params.replacementServiceInjector.create(C.P.oggyGenAI),this._textFieldLayout=this._params.textFieldLayout,this._logger=null!==(t=this._params.logger)&&void 0!==t?t:E.Y.create("CheetahIntegrationBase"),this._enableKeyboardShortcut=(0,y.OB)().experimentClient.isGateEnabled(x.K.KeyboardShortcut),this.assistantInjectionMode=_.h.create(R.M.overlay),this.selectionRange=this._activeSelectionRange.view(),this.textMapIsEmpty=this._textMapEmpty.view(),this.allowCustomCaretOverflow=this._params.allowCustomCaretOverflow,this.enableInlineRewrites=this._params.featureFlags.inlineRewrites,this.canShowIdeateButtonPopups=this._canShowIdeateButtonPopups.view(),this.entryPointsEnabled=this._entryPointsEnabled.view(),this.textUpdated=this._params.textObserver.contentChanges.async.pipe(o.h(void 0)),this.appActionsConfig=this._params.csState.view((e=>b.ij(e.dynamicConfig.appActions))),this.gOSCustomizationConfig=this._params.csState.view((e=>b.ij(e.dynamicConfig.gOSCustomization))),this.assistantHeight=this._assistantHeight.view(),this.assistantPosition=this._positionModel.initialPositionOffset,this._subs.push(this._params.selectionOrCaretPosition.subscribe(l.wW(this._activeSelectionRange)),this._getActiveSelectionBoundingClientRects().subscribe(l.wW(this._activeSelectionBoundingClientRects)),this._getTextMapEmpty().subscribe(l.wW(this._textMapEmpty)),this._getGButtonReference().subscribe(l.wW(this._gButtonRef)),c.a([this._params.entryPointsEnabled,this._params.isActiveTextField]).pipe(h.U((([e,t])=>e&&t))).subscribe(l.wW(this._canShowIdeateButtonPopups)),this._params.entryPointsEnabled.subscribe(l.wW(this._entryPointsEnabled)),this._activeSelectionRange.subscribe((e=>this._logger.debug("Selection updated:",b.WG(e))))),(0,s.zG)(this._params.docContextUpdatedEvents,b.UI((e=>e.pipe(h.U((e=>e.docContextInfo))))),S.bw((e=>this._subs.push(e.subscribe((e=>this._docContext.modify((t=>b.pC(t)?(0,s.zG)(t,b.UI((t=>({...t,...e})))):b.G(e)))))))))}insertText(e,t){(0,s.zG)(t,b.g_((()=>{this._replacementService.insertAtCurrentSelection(e).catch((()=>{this._logger.debug("Could not insert text at current selection, will try to append at end of text"),this._replacementService.performReplacement({pos:I.SV.create(this._params.textObserver.getCurrentTextMap().getPlainText().length),value:e})}))}),(t=>this._replacementService.performReplacement({pos:t,value:e}))))}focusTextField(){this._params.focusTextField()}getText(e){return this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.start,e.end)}scrollHighlightIntoView(e){this.getHighlightRects(e).pipe(h.U(n.YM),d.oA,u.q(1),p.R(this._disposed)).subscribe((e=>(0,k.sK)(e,this._textFieldLayout)))}get inlineButtonPlacement(){return this._activeSelectionBoundingClientRects.view((e=>this._textRangeClientRectsToVisibleVirtualElement(e))).view((e=>(0,s.zG)(e,b.UI((e=>({referenceElement:e,placement:"bottom-start",offset:b.G([0,5])}))))))}get quickReplyContext(){return this._docContext.view((e=>(0,s.zG)(e,b.hX((e=>{var t;return(0,s.zG)(null!==(t=e.parents)&&void 0!==t?t:[],n.YM,b.hX((({delta:e})=>Boolean(e&&e.ops.length>0))),b.tS((e=>{var t;return(0,s.zG)(null!==(t=e.authors)&&void 0!==t?t:[],n.YM)})),b.hX((e=>!e.currentSessionUser)),b.pC)})))))}get isPlagiarismEnabled(){return!1}get isWritingExpertEnabled(){return!1}get isAiStudioEnabled(){return _.h.create(b.G(!1))}renderAssistant(e,t){return Promise.resolve((0,T.Hn)(e,this._params.gButtonLayout,this._positionModel,this._enableKeyboardShortcut,this._params.csState.view("page").view("keyboardShortcuts"),this._params.closeAssistant,this.focusTextField.bind(this)))}canResizeAssistant(e){return!0}getHighlightRects(e){return g.T(this._params.textObserver.contentChanges.async,this._textFieldLayout.rect.changes,(0,w.O)(this._params.textObserver,this._textFieldLayout)).pipe(m.O(null),h.U((()=>(0,k.FN)((()=>this._params.textObserver.getCurrentTextMap()),this._params.geometryProvider,this._params.geometryLayout,s.yR)(e))))}dispose(){this._subs.dispose(),this._disposed.next(void 0)}_getGButtonReference(){return c.a([this._params.gButtonLayout.positionBehavior,this._params.gButtonLayout.sizeBehavior]).pipe(h.U((([e])=>b.G({getBoundingClientRect:()=>new DOMRect(e.client.left,e.client.top-0,0,0)}))))}_getActiveSelectionBoundingClientRects(){return this._activeSelectionRange.pipe(f.w(b.g_((()=>v.of(b.YP)),(0,k.or)(this._params.textObserver,this._params.geometryProvider,this._params.geometryLayout,this._textFieldLayout))))}_getTextMapEmpty(){return this._params.textObserver.contentChanges.async.pipe(m.O(null),h.U((()=>this._params.textObserver.getCurrentTextMap().isEmpty())))}_textRangeClientRectsToVisibleVirtualElement(e){return(0,s.zG)(e,b.UI((0,k.d6)(this._params.textField)),b.hX((e=>(0,k.HZ)(e.getBoundingClientRect(),(0,s.zG)(this._textFieldLayout.rect.getCurrent(),(({client:e,size:t})=>({...e,...t})))))),b.UI((0,k.MF)(this._textFieldLayout)))}}},12776:(e,t,i)=>{if(i.d(t,{P:()=>M,l:()=>U}),3075==i.j)var n=i(90023);var s=i(20161),r=i(84178),a=i(59179),o=i(90572),l=i(44045);if(3075==i.j)var c=i(954);if(3075==i.j)var h=i(84714);if(3075==i.j)var d=i(24335);if(3075==i.j)var u=i(53976);var p=i(58303),g=i(4603);if(3075==i.j)var m=i(74983);var f=i(70874),v=i(30033);if(3075==i.j)var _=i(18300);var b=i(91901);class S{constructor(e,t=[b.$x]){this._doc=e,this._styleEl=this._doc.createElement("STYLE"),this._styleEl.innerHTML=t.map((e=>`${e}{opacity:0 !important;}`)).join("\n"),this._doc.head.appendChild(this._styleEl)}dispose(){this._styleEl.remove()}}var y=i(76193);if(3075==i.j)var w=i(22342);var A=i(49650),I=i(4798),C=i(70932),x=i(33535),E=i(8783),R=i(49231),k=i(47387),T=i(99469);const P=({position:e,beforeElement:t,children:i,enableKeyboardShortcut:n,keyboardShortcutsSetting:s,closeAssistant:r,focusTextField:a})=>{const o=(0,T.$)({enableKeyboardShortcut:n,keyboardShortcutsSetting:s,closeAssistant:r,focusTextField:a});return R.createElement("div",{"data-grammarly-part":"assistant-static-wrapper",style:{display:"flex",flexDirection:"column",position:"fixed",top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height,zIndex:e.zIndex},ref:o},t?R.createElement(t,null):void 0,R.createElement("div",{style:{flexGrow:1,minHeight:0}},i({sizeBehavior:h.of({heightBehavior:{kind:"fitContainer"},widthBehavior:{kind:"fitContainer"}}),dragBehavior:h.of({kind:"notDraggable"}),readyToDrag:()=>Promise.resolve(void 0)})))};class M extends E.B{constructor(e){super({...e,docContextUpdatedEvents:p.YP,allowCustomCaretOverflow:!1,focusTextField:()=>e.textField.click(),logger:C.Y.create("CheetahIntegrationGDocsCanvas")}),this._sidebarPosition=e.sidebarPosition;const t=e.experimentClient.isGateEnabled(I.K.GDocsAllowToDetectAssistantInjectionMode);this.assistantInjectionMode=this._sidebarPosition.view((({sidebarType:e})=>t&&e===y.X.modern?x.M.inherit:x.M.overlay)),this._scroller=(0,A.z)(e.textObserver,e.textFieldLayout,e.userInputShutOff),this._isDocOwnedByCurrentUser=e.isDocOwnedByCurrentUser}_scrollToRenderedRect(e){const t=v.Pf.create(e),i=this._textFieldLayout.visibleRect.getApproximate().client.top-this._textFieldLayout.rect.getApproximate().client.top;this._scroller.scrollToRect(t,i)}_scrollToUnrenderedHighlight(e){this._scroller.scrollToRange(e.start).pipe(s.w((t=>f.S.hz30.pipe(r.q(9),s.w((()=>this.getHighlightRects(e))),a.U((e=>null==e?void 0:e[0])),o.h((e=>!!e)),r.q(1)))),l.R(this._disposed)).subscribe((e=>{this._scrollToRenderedRect(e)}))}isDocOwnedByCurrentUser(){return this._isDocOwnedByCurrentUser}scrollHighlightIntoView(e){this.getHighlightRects(e).pipe(a.U((e=>null==e?void 0:e[0])),r.q(1),l.R(this._disposed)).subscribe((t=>{t?this._scrollToRenderedRect(t):this._scrollToUnrenderedHighlight(e)}))}createNativeUIHider(){return new S(document)}renderAssistant(e,t){return"genAI"===t||"genAIAndWritingExpert"===t?super.renderAssistant(e,t):Promise.resolve(((e,t,i,n,s,r,o)=>R.createElement(k.F.Fragment,null,t.pipe(a.U((t=>R.createElement(P,{key:"assistant-container",position:t,beforeElement:o,enableKeyboardShortcut:i,keyboardShortcutsSetting:n,closeAssistant:s,focusTextField:r},e))))))(e,this._sidebarPosition,this._enableKeyboardShortcut,this._params.csState.view("page").view("keyboardShortcuts"),this._params.closeAssistant,this.focusTextField.bind(this)))}canResizeAssistant(e){return"genAI"===e||"genAIAndWritingExpert"===e}get isPlagiarismEnabled(){return!0}get isWritingExpertEnabled(){return(0,g.OB)().experimentClient.isGateEnabled(I.K.WritingExpertPullMode)}dispose(){this._scroller.dispose(),super.dispose()}}function U(e,t,i,r){return r.data.behavior.pipe(c.O(null),s.w((()=>(0,n.zG)(i.getCurrentSelection(!0),_.Ls,p.ij,p.hX((0,n.ff)(m.SV.isCollapsed)),p.g_((()=>function(e,t){return e.contentChanges.async.pipe(c.O(null),u.c(t.offsetPosition.pipe(a.U((0,n.ls)(p.ij,p.tS((t=>{const i=e.getCurrentTextMap();if(i.isEmpty())return p.G(0);const s=2,r=1;return(0,n.zG)(p.ij(i.getPageContainingOffsetPoint(t)),p.tS((e=>p.ij((0,n.zG)((0,w.WR)({top:t.top-r/2-e.getPageRect().top,left:t.left-s/2-e.getPageRect().left,width:s,height:r},e.getPageInnerSize(),e.getPageRect()),(t=>{var i,n;return null===(n=null===(i=e.getTextRangeInInnerRect)||void 0===i?void 0:i.call(e,t))||void 0===n?void 0:n.startOffset}))))))})))))))}(e,t).pipe(a.U(p.UI(m.SV.create)))),(e=>h.of(p.G(e))))))),d.$f(p.Eh(m.SV.eq)))}},57291:(e,t,i)=>{i.d(t,{FN:()=>C,HZ:()=>k,MF:()=>R,Ti:()=>T,d6:()=>E,or:()=>x,sK:()=>P});var n=i(86399),s=i(92135),r=i(90023),a=i(64271),o=i(954),l=i(59179);if(6168!=i.j)var c=i(44071);if(6168!=i.j)var h=i(90572);if(6168!=i.j)var d=i(24335);if(6168!=i.j)var u=i(29416);if(6168!=i.j)var p=i(20161);if(6168!=i.j)var g=i(26156);if(6168!=i.j)var m=i(2613);if(6168!=i.j)var f=i(84178);var v=i(58303);if(6168!=i.j)var _=i(74983);var b=i(39390),S=i(30033),y=i(87234),w=i(10712);if(6168!=i.j)var A=i(18300);var I=i(40840);function C(e,t,i,a){return o=>(0,r.zG)(v.ij(t.create(o,e(),!0)),v.tS((e=>v.ij(t.getClientRects(e,!0)))),v.tS(s.nI),v.UI(a),v.g_((()=>[]),n.UI((e=>S.UL.setPosition(i.getApproximateConversionContext().clientToRelative(e),e)))))}function x(e,t,i,s){return c=>a.T(s.scroll.changes,s.rect.changes).pipe(o.O(null),l.U((()=>(0,r.zG)(c,C((()=>e.getCurrentTextMap()),t,i,(0,r.ls)((e=>(0,b.es)(e).map(S.Pf.create)),n.nI)),n.Z$,v.UI((e=>()=>(0,w.Z)(e,s.rect.getCurrent().client,s.scroll.getCurrent())))))))}function E(e){return t=>({contextElement:e,getBoundingClientRect:()=>(0,r.zG)(t(),(e=>new DOMRect(e.left,e.top,e.width,e.height)))})}function R(e){return t=>({...t,getBoundingClientRect:()=>{const i=t.getBoundingClientRect(),n=(0,r.zG)(e.rect.getCurrent(),(({client:e,size:t})=>({...e,...t}))),s=n.top+n.height,a=Math.max(n.top,Math.min(i.top,s)),o=Math.min(s,Math.max(i.bottom,n.top));return new DOMRect(i.left,a,i.width,o-a)}})}function k(e,t){return!(e.top+e.height<t.top||e.top>t.top+t.height)}function T(e,t){return function(e,t,i,n){return a.T(e.pipe(u.b(200)),t.pipe(p.w((()=>g.S(i.pipe(m.e(200)),n).pipe(f.q(1))))))}(c.R(t,"keyup").pipe(h.h((e=>"Backspace"===e.key))),c.R(t.ownerDocument,"selectionchange"),c.R(t,"keyup"),c.R(t.ownerDocument,"mouseup")).pipe(o.O(null),l.U((()=>e.getCurrentSelection())),l.U((0,r.ls)(A.qq,v.ij)),d.$f(v.Eh(_.SV.eq)))}function P(e,t){const i=t.visibleRect.getApproximate();if(0===i.size.height)return;const n=t.rect.getApproximate(),s=t.scroll.getApproximate(),r=S.Pf.create({...n.client,...n.size}),a=S.Wm.create(e),o=(0,I.Wb)(S.UL.setPosition(y.Ir.fromOffsetPoint(a,r,s),e));let l=54-i.client.top;(l<=0||l>=i.size.height)&&(l=i.size.height/2);const c=o.top-l-i.client.top;t.scroller.scrollBy({top:c})}},96735:(e,t,i)=>{i.d(t,{Hn:()=>M,dl:()=>k});var n=i(49231),s=i(43952),r=i(56424),a=i(95381),o=i(90572),l=i(63532),c=i(954),h=i(24666),d=i(84178),u=i(44071),p=i(59179),g=i(84308),m=i(62552),f=i(71050),v=i(27341),_=i(47387),b=i(99469),S=i(23684),y=i(47441),w=i(17806),A=i(50956),I=i(9843),C=i(54961),x=i(76517),E=i(90107),R=i(87110);const k=a.DY,T=({viewportRect:e,gButtonRect:t,postRepositioningOffset:i,enableKeyboardShortcut:s,keyboardShortcutsSetting:a,closeAssistant:o,focusTextField:l,children:c})=>{const{top:h,setTop:d,left:u,setLeft:p,width:g,height:m,positionerRef:_}=(0,w.G)(),{x:S,y:A,setDragState:I}=(0,y.f)(h,d,u,p),E=n.useCallback((e=>!(e.target instanceof Element&&e.target.closest("button"))),[]),{bottom:R,right:T}=function(e,t,i,n,s){const r=s.height-n,a=s.width-i;return{bottom:Math.max(0,Math.min(r,r-e)),right:Math.max(0,Math.min(a,a-t))}}(h,u,g,m,e),P=(0,b.$)({enableKeyboardShortcut:s,keyboardShortcutsSetting:a,closeAssistant:o,focusTextField:l});return n.createElement(C._,{hasDragHandle:!0,bounds:e,onChangeDragState:I,dragEventFilter:E},n.createElement(x.sX,{anchorOrigin:{horizontal:"right",vertical:"top"},elementOrigin:{horizontal:"right",vertical:"bottom"},anchorMargin:{top:4,bottom:4,left:0,right:0},repositioning:[{horizontal:"translate",vertical:"flip"}],anchorRect:t,viewportRect:e,stickToTarget:!1,viewportMargin:0,postRepositioningOffset:i,onChangePosition:e=>requestAnimationFrame((()=>_.current.next(e)))},n.createElement("div",{"data-grammarly-part":"assistant-draggable-wrapper",style:{position:"fixed",transform:`translate(${S}px, ${A}px)`,zIndex:k,bottom:R,right:T,boxShadow:f.q_.boxShadow,border:f.q_.border,borderRadius:r.ux.rem(v.ze)},ref:P},c)))},P=({dragHandle:e,onDragEnd:t,onIsDraggingChange:i,children:s})=>{const r=(0,A.IQ)(),a=(0,A.e8)(),u=n.useContext(A.Dg),p=n.useMemo((()=>u.state.pipe(o.h((e=>!e.dragging)),l.b((e=>t(e))),c.O(I.h.create()))),[t,u]),g=n.useMemo((()=>r.pipe(h.x(),l.b((e=>i(e))))),[i,r]),m=n.useMemo((()=>e.pipe(o.h((e=>null!==e)),d.q(1),l.b((e=>a(e))))),[a,e]);return(0,E.A)(p),(0,E.A)(g),(0,E.A)(m),n.createElement(n.Fragment,null,s)},M=(e,t,i,r,a,o,l)=>{const h=u.R(self,"resize").pipe(p.U((()=>(0,R.C7)())),c.O((0,R.C7)())),d=g.a([t.positionBehavior,t.sizeBehavior]).pipe(p.U((([e,t])=>{const i=t.heightAndWidth,n=t.heightAndWidth;return{top:e.client.top-n,left:e.client.left-i,width:i,height:n}}))),f=new m.X(!1),v=new m.X(null),b=e({sizeBehavior:h.pipe(p.U((e=>({heightBehavior:{kind:"fitContent",maxHeight:Math.min(e.height,s.Z3)},widthBehavior:{kind:"fitContent",minWidth:null,maxWidth:null}})))),dragBehavior:f.asObservable().pipe(p.U((e=>({kind:"draggable",isDragging:e})))),readyToDrag:({dragHandle:e})=>(v.next(e),Promise.resolve(void 0))});return n.createElement(_.F.Fragment,null,g.a([h,d]).pipe(p.U((([e,t])=>{const s=(0,S.W)(i);return n.createElement(T,{viewportRect:e,gButtonRect:t,postRepositioningOffset:{horizontal:s.initialPositionOffset.left,vertical:s.initialPositionOffset.top},enableKeyboardShortcut:r,keyboardShortcutsSetting:a,closeAssistant:o,focusTextField:l},n.createElement(P,{onDragEnd:e=>s.onDrag(e),onIsDraggingChange:e=>f.next(e),dragHandle:v.asObservable()},b))}))))}},55100:(e,t,i)=>{i.d(t,{t:()=>n});const n=e=>(e=>"Cheetah/_System/Push/SimplifyRewrite"===e)(e)||(e=>"Cheetah/_System/Push/ImproveParagraph"===e)(e)},99469:(e,t,i)=>{i.d(t,{$:()=>r});var n=i(49231),s=i(92393);function r({enableKeyboardShortcut:e,keyboardShortcutsSetting:t,closeAssistant:i,focusTextField:r}){const a=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let n,o;return e&&a.current&&(n=new s.J({textField:a.current,kind:"closeAssistant",settings:t,handler:i}),o=new s.J({textField:a.current,kind:"openAssistant",settings:t,handler:r})),()=>{null==n||n.dispose(),null==o||o.dispose()}}),[]),a}},60310:(e,t,i)=>{i.d(t,{G:()=>o,m:()=>a});var n=i(49231),s=i(51320),r=i(18471);const a=26,o=n.forwardRef((function({forceTooltipMessage:e,onClick:t,onMouseEnter:i,onMouseLeave:a},o){return n.createElement(s.u,{message:"Rewrite with Grammarly",forcedMessage:e},n.createElement("button",{onClick:t,"data-grammarly-part":"cheetah-ideate-button","aria-label":"Rewrite with Grammarly",className:r.ideateButton,ref:o,onMouseEnter:i,onMouseLeave:a},n.createElement("div",{className:r.ideateButtonIcon})))}))},50036:(e,t,i)=>{i.d(t,{K:()=>c});var n,s=i(21220);!function(e){e.postMessage="postMessage",e.setMessagePort="setMessagePort",e.setSource="setSource"}(n||(n={}));class r{constructor(e,t){this._didReceiveReadyMessage=!1,this._onMessageListeners=[],this._pendingOutgoingMessages=[],this._onMessageFromAnySource=e=>{null!=e.source&&e.source===this._iframe.contentWindow&&this._onMessage(e)},this._flushPendingOutgoingMessages=()=>{if(this._didReceiveReadyMessage&&0!==this._pendingOutgoingMessages.length&&null!=this._iframe.contentWindow){for(const e of this._pendingOutgoingMessages)this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin);this._pendingOutgoingMessages.length=0}},this._iframe=e,this._trustedSrcURL=t,self.addEventListener("message",this._onMessageFromAnySource)}setSrcURL(e){this._trustedSrcURL=e}get _iframeTargetOrigin(){const e=new URL(this._iframe.src,self.location.href).toString();if(!this._trustedSrcURL||!this._trustedSrcURL.startsWith(e))throw new Error("Invalid iframe target origin");return e}_onMessage(e){this._didReceiveReadyMessage=!0,this._onMessageListeners.forEach((t=>t(e.data))),this._flushPendingOutgoingMessages()}postMessage(e){null!=this._iframe.contentWindow&&this._didReceiveReadyMessage?(this._flushPendingOutgoingMessages(),this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin)):this._pendingOutgoingMessages.push(e)}onMessage(e){this._onMessageListeners.push(e)}dispose(){self.removeEventListener("message",this._onMessageFromAnySource),this._onMessageListeners.length=0,this._pendingOutgoingMessages.length=0}}class a extends r{_onMessage(e){if(!this._isMessagePortSet&&null!=this._iframe.contentWindow){const e={type:n.setMessagePort,port:this._channel.port2};this._isMessagePortSet=!0,this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin,[this._channel.port2])}return super._onMessage(e)}constructor(e,t){super(e,t),this._isMessagePortSet=!1,this._channel=new MessageChannel,this._channel.port1.onmessage=e=>{this._onMessage(e)}}dispose(){super.dispose(),this._channel.port1.close()}}class o{constructor(e,t){const i=null!=t?t:document.createElement("iframe"),n=e.baseUri+"src/gOS-sandbox.html";i.loading="eager",i.allow="clipboard-read *; clipboard-write *",i.src=n,i.width="100%",i.height="100%",i.style.border="none",i.setAttribute(s.MY,"applet-iframe"),this._frame=i,this._messenger=new a(i,n),this._shouldDetach=null==t}setSource(e){this._messenger.postMessage({type:n.setSource,url:e})}resize(e){}postMessage(e){this._messenger.postMessage({type:n.postMessage,data:e})}onMessage(e){this._messenger.onMessage(e)}dispose(){this._messenger.dispose(),this._shouldDetach&&this._frame.remove()}get frame(){return this._frame}}var l=i(4603);class c{constructor(e,t=(0,l.OB)().browserApi){this._usingFrame=e,this._api=t}createBackgroundSandbox(e,t){throw new Error("Not supported")}createUISandbox(e,t){return new o(this._api,this._usingFrame)}}},96601:(e,t,i)=>{i.d(t,{C:()=>x});var n=i(78498);var s=i(30646);class r extends s.Ic{constructor(e){super(),this._options=e,this.register({id:"assistant",kind:"ui",displayName:"Assistant",version:"0.0.0",entryPoint:"https://applet-bundles.grammarly.net/applets/assistant?responseType=redirect"})}get(e){const t=super.get(e);if(null!=t)return this._patchEntryPoint(t)}all(){return super.all().map((e=>this._patchEntryPoint(e)))}_patchEntryPoint(e){var t,i;const n=new URL(null!==(t="assistant"===e.id?this._getAssistantAppletUrl():null)&&void 0!==t?t:e.entryPoint);return n.searchParams.set("api",String(s.IS.version)),n.searchParams.set("channel",null!==(i=this._options.getChannel())&&void 0!==i?i:"stable"),{...e,entryPoint:n.toString()}}_getAssistantAppletUrl(){const e=this._options.getAssistantAppletUrl();if(null==e)return null;try{return new URL(e).toString()}catch(e){return null}}}var a=i(74722),o=i(33674),l=i(79992),c=i(18333),h=i(4603);class d extends o.X{constructor(){const e=l.iy.create();super(new a.rr(c.XI,(0,h.OB)().message,e)),this.id=e}}var u=i(4798),p=i(99836),g=i(70932);function m(e,t){const{bgRpc:i,experimentClient:n}=t,{buildInfo:s,bundleInfo:r}=t.config;let a=r.env.startsWith("dev")||!1;return e.get(["extensionSettings"]).then((({extensionSettings:e})=>{var t;a=null!==(t=null==e?void 0:e.common.gOSDebuggerEnabled)&&void 0!==t&&t})),{environment:f(r.env),async getContainerId(){var e;return null!==(e=await i.api.getContainerIdOrUndefined("gOS"))&&void 0!==e?e:""},async getUserId(){var t,i;return null!==(i=null===(t=(await e.get(["user"])).user)||void 0===t?void 0:t.id)&&void 0!==i?i:"-1"},clientName:r.extensionType,clientVersion:s.version,clientType:"extension",get isDebugMode(){return a},openURL(e){},makeLogger:e=>function(e,t,i){return{log(s,r,a,o,l,c,h){const d=l>0?`${r} (${h} at ${o}:${l}:${c})`:r;switch(s){case"debug":t.debug(d,a);break;case"info":t.info(d,a),n.isGateEnabled(u.K.GOSTelemetry)&&i.gOS.info(e,d,a);break;case"warn":t.warn(d,a),n.isGateEnabled(u.K.GOSTelemetry)&&i.gOS.warn(e,d,a);break;case"error":t.error(d,a),n.isGateEnabled(u.K.GOSTelemetry)&&i.gOS.error(e,d,a)}}}}(e,g.Y.create(`applet/${e}`),(0,p.Tb)()),makePerformanceTracker:()=>({})}}function f(e){return"dev-qa"===e||"qa"===e?"qa":"dev-preprod"===e?"preprod":"prod"}var v=i(8867),_=i(51777);function b(e,t){return JSON.stringify({clientId:e,instanceId:t})}class S extends _.S{constructor(e,t){super(new y(c.V,(0,h.OB)().message,e.id),{dispatchAction:({clientId:e},i,n,s)=>t.dispatchAction(b(e,i),n,s),dispose:({clientId:e},i)=>t.dispose(b(e,i))})}}class y{constructor(e,t,i){this._rpcMessageName=e,this._message=t,this._clientId=i,this.inbound=new v.y((e=>{const t=t=>{t.clientId===this._clientId&&e.next(t)};return this._message.on(this._rpcMessageName,t),()=>this._message.off(this._rpcMessageName,t)})),this.outbound=e=>{this._message.sendBackground(this._rpcMessageName,e)}}}class w{constructor(e){this._host=e}_getContainerFor(e){const t=this._host.getAppletContainer(e);if(null==t)throw new Error(`No applet container for context ${e}`);return t}async dispatchAction(e,t,i){const n=this._getContainerFor(e),s=t.split(".").slice(0,-1).join(".");return null==n.objects.get(s)?await n.rpc.call(t,i):await n.objects.execute(t,i)}async dispose(e){}}var A=i(50036);class I{constructor(e,t,i){this._container=e,this._delegates=t,this._logger=i}get _isResizable(){var e,t,i;return null===(i=null===(t=(e=this._delegates).canResize)||void 0===t?void 0:t.call(e))||void 0===i||i}async initialize(e){var t,i;const n=this._resize(e.initialSize),s=await this._container.createInitializeResponse(e);return null===(i=(t=this._delegates).onInit)||void 0===i||i.call(t,e),{...s,platform:"extension",frame:{...n,resizable:this._isResizable?"both":"none"}}}async visuallyReady(){var e,t;null===(t=(e=this._delegates).onVisuallyReady)||void 0===t||t.call(e)}async interactionReady(e){var t,i,n;null===(i=(t=this._delegates).onInteractionReady)||void 0===i||i.call(t,e.success,null!==(n=e.feature)&&void 0!==n?n:void 0)}async resizeFrame(e){this._isResizable&&this._resize(e)}async resize(e){return{frame:{...this._resize(e.size),resizable:this._isResizable?"both":"none"}}}_resize(e){var t,i,n,s,r,a,o;const{width:l,height:c}=null!==(n=null===(i=(t=this._delegates).handleResize)||void 0===i?void 0:i.call(t,e))&&void 0!==n?n:{width:Math.max(null!==(r=null===(s=this._container.view.frame.parentElement)||void 0===s?void 0:s.clientWidth)&&void 0!==r?r:0,e.width),height:0===e.height?null!==(o=null===(a=this._container.view.frame.parentElement)||void 0===a?void 0:a.clientHeight)&&void 0!==o?o:0:e.height};return this._container.view.resize({width:l,height:c}),{width:l,height:c}}async requestClose(){var e,t;this._container.manifest.id;null===(t=(e=this._delegates).onClose)||void 0===t||t.call(e),setTimeout((()=>{this._container.gracefullyUnloadApplet().finally((()=>{var e,t;return null===(t=(e=this._delegates).onTerminate)||void 0===t?void 0:t.call(e)}))})),this._container.view.frame.style.display="none"}async startDragMove(e){var t,i;await(null===(i=(t=this._delegates).onDragMove)||void 0===i?void 0:i.call(t,null==e?void 0:e.clickTarget))}async log(e){this._logger.log(e.level,e.message,e.data,"",-1,-1,"")}async openURL(e){if(null==self.open(e.url,"_blank","noopener"))throw new Error("Failed to open URL")}async triggerSettingsMenu(e){var t,i;null===(i=(t=this._delegates).onSettingsMenu)||void 0===i||i.call(t)}}class C{constructor(e,t,i){this.registry=i,this._nextInstanceId=0,this._running=new Map,this._logger=g.Y.create("GOSRuntimeHost"),this._root=new s._y(e,i).withContainerFactory(new A.K),this._background=t}createContext(){return new s._y(this._root)}getAppletContainer(e){return this._running.get(function(e){return JSON.parse(e)}(e).instanceId)}createUIAppletContainer(e,t={},i=this._root,n=!0){const r=this._nextInstanceId++;this._registerForwardingServices(i,((e,t)=>this._background.dispatchAction(r,e,t)));const a=i.createAppletView(e);this._running.set(r,a);const o=new s.GO(((e,t)=>a.rpc.call(e,t))),l=i.environment.makeLogger(e),c=new I(a,{...t,onVisuallyReady:()=>{var e;null===(e=t.onVisuallyReady)||void 0===e||e.call(t),n&&o.start({entryPoint:"ideation",entryPoint2:"ideation",assistantMode:"genAIAndRevision",theme:{flatUI:!0,logoVersion:"february2024"},partialPageModeEnabled:!1,showPartialPageModeNotification:!1}).catch((e=>this._logger.error(e)))}},l);return a.objects.register(s.xe.objectName,new s.xe(c)),a.onBeforeUnload((()=>{this._running.delete(r),this._background.dispose(r)})),{applet:a,host:c,start:async e=>await o.start(e)}}forceTerminate(e){this._logger.warn(`Force terminating applet: ${e.manifest.id}`),this._running.forEach(((t,i)=>{t===e&&this._running.delete(i)}));try{e.unloadApplet(),e.objects.dispose(),e.rpc.dispose()}catch(e){this._logger.error(`Failed to force terminate applet: ${e}`)}}_registerForwardingServices(e,t){e.registerObject(s.Wr.objectName,new s.Wr(new s.ik(t))),e.registerObject(s.Ng.objectName,new s.Ng(new s.c3(t))),e.registerObjectFactory(s.HF.objectName,(()=>new s.HF(new s._2(t))))}}class x{static get shared(){return null===this._instance&&(this._instance=new x(new n.h((0,h.OB)().browserApi.preferences))),this._instance}constructor(e){this.store=e,this._cache=null,this.onReady=e.get(["extensionSettings"]).then((({extensionSettings:e})=>{this._settings=e})).catch((()=>{}))}get _state(){return null===this._cache&&(this._cache=this._create()),this._cache}_create(){const e=new r({getChannel:()=>{var e,t;return null!==(t=null===(e=this._settings)||void 0===e?void 0:e.common.gOSAppletChannel)&&void 0!==t?t:"stable"},getAssistantAppletUrl:()=>{var e,t;return null!==(t=null===(e=this._settings)||void 0===e?void 0:e.common.gOSAssistantAppletUrl)&&void 0!==t?t:null}}),t=new d,i=new C(m(this.store,(0,h.OB)()),t.api,e);return{registry:e,client:t,host:i,server:new S(t,new w(i))}}get registry(){return this._state.registry}get host(){return this._state.host}dispose(){null!==this._cache&&(Object.values(this._cache).forEach((e=>"dispose"in e&&e.dispose())),this._cache=null)}}x._instance=null},15281:(e,t,i)=>{i.d(t,{wr:()=>l});var n=i(90023),s=i(3492),r=i(52303),a=i(58303);class o{constructor(e){this._options=e}partialPageModeNotificationDismissed(e){return Promise.resolve()}async getCapabilities(){var e;const t=JSON.parse(JSON.stringify(null!==(e=this._options.capabilities)&&void 0!==e?e:{}));switch(this._options.type){case"plaintext":return{insertText:"yes",insertTextWithFormatting:"no",insertTextWithImages:"no",insertTextWithLinks:"no",...t,pasteImages:"no"};case"richtext":return{insertText:"yes",insertTextWithFormatting:"unknown",insertTextWithImages:"unknown",insertTextWithLinks:"unknown",...t,pasteImages:"no"};case"gDocs":return{insertText:"yes",insertTextWithFormatting:"yes",insertTextWithImages:"yes",insertTextWithLinks:"yes",...t,pasteImages:"no"}}}async setSelection({range:e}){this._options.setSelection(e)}async getDocumentState({withSelection:e}){var t;let i;e&&(i=null!==(t=this._options.getSelection().find(Boolean))&&void 0!==t?t:{start:0,end:0});return{doc:{ops:this._options.getText().ops},selection:i}}async pasteImage(e){throw new Error("Not supported")}async _copyToClipboard(e){const t={};["image/png","text/html","text/plain"].includes(e.type)?t[e.type]=e:(t[`web ${e.type}`]=e,e.type.startsWith("image/")&&(t["text/html"]=new Blob([`<img src="${URL.createObjectURL(e)}">`],{type:"text/html"}))),await navigator.clipboard.write([new ClipboardItem(t)])}async copyImage({data:e,format:t}){const i=await async function(e,t){if(!["png","gif","jpeg"].includes(e))throw new Error(`Unsupported format: ${e}`);const i=await fetch(`data:image/${e};base64,${t}`);return await i.blob()}(t,e);await this._copyToClipboard(i)}async copyText({text:e}){await navigator.clipboard.writeText(e)}async insertText({text:e}){await this._options.replaceText(e)}async insertAtCaret({delta:e}){"gDocs"===this._options.type?await this._options.insertAtCaret(new s.i(e.ops)):await this._options.replaceText(new s.i(e.ops))}async applyDelta({delta:e,range:t}){await this._options.replaceText(new s.i(e.ops),t)}}function l(e){var t;const i=null!==(t=e.capabilities)&&void 0!==t?t:{};return new o({type:e.replacementService.capabilities,capabilities:{insertText:c(i.insertText),insertTextWithFormatting:c(i.insertTextWithFormatting),insertTextWithImages:c(i.insertTextWithImages),insertTextWithLinks:c(i.insertTextWithLinks),pasteImages:c(i.pasteImages)},getSelection:()=>(0,n.zG)(e.selectionRange.get(),r.dH((e=>[e]),[])),setSelection:async t=>{if("setSelectionAsync"in e.selectionService){const i=await e.selectionService.setSelectionAsync(t);if("selectionError"===i.kind)throw new Error(i.reason)}else e.selectionService.setSelection(t)},getText:()=>e.textObserver.getTextSource().getRichText(),insertAtCaret:async t=>e.replacementService.insertAtCurrentSelection(t,void 0,{gOS:{appletId:e.appletId}}),replaceText:async(t,i)=>{await e.replacementService.performReplacement({pos:null!=i?i:(0,n.zG)(e.selectionRange.get(),a.fS((()=>({start:0,end:0})))),value:t},{gOS:{appletId:e.appletId}})}})}function c(e){if("yes"===e||"no"===e||"unknown"===e)return e}},18333:(e,t,i)=>{i.d(t,{V:()=>s,XI:()=>n,xh:()=>r});const n="gOS-bg-d5ccc5edf7e1",s="gOS-fg-d5ccc5edf7e1",r="skills-bg-d5ccc5edf7e1"},92203:(e,t,i)=>{i.d(t,{V:()=>r,X:()=>a});var n=i(4798),s=i(81259);function r(e){return e.isGateEnabled(n.K.GOSRollout)||"test"===e.getTreatment(s.p.GOSRollout)}function a(e){return!!r(e)&&(e.isGateEnabled(n.K.OggyOnGOS)||"test"===e.getTreatment(s.p.OggyOnGOS))}},66608:(e,t,i)=>{i.d(t,{x:()=>r});var n=i(49231),s=i(97310);function r({node:e}){const t=n.useContext(s.nS.Context);return n.useEffect((()=>{if(t&&!e.isConnected)return t.prepend(e),()=>e.remove()}),[e]),null}},53829:(e,t,i)=>{i.d(t,{w:()=>l});var n=i(49231),s=i(80016),r=i(74514),a=i(50899),o=i(66608);function l(e){const t=n.useMemo((()=>{const e=document.createElement("div");e.style.position="absolute",e.style.zIndex=String(a.op);const t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=(0,r.n)("designSystem"),e.appendChild(t),e}),[]);return n.createElement(n.Fragment,null,n.createElement(s.D,{default:t},n.createElement(r.L,{chunkName:"designSystem"},e.children)),n.createElement(o.x,{node:t}))}},35063:(e,t,i)=>{i.d(t,{Zq:()=>s,qQ:()=>a,u1:()=>r});var n=i(31854);function s(e,t){return{type:n.lY.Type.sduiCardAction,actions:e,sourceId:t,cardId:"",scope:{alertRefs:[]}}}const r=e=>e.startsWith("Plagiarism/Plagiarism/UnoriginalContent"),a={enablePlagiarismSearch:()=>{throw new Error("Not implemented enablePlagiarismSearch")},disablePlagiarismSearch:()=>{throw new Error("Not implemented disablePlagiarismSearch")}}},24348:(e,t,i)=>{i.d(t,{u:()=>s,y:()=>n});var n,s,r=i(17613),a=i(56193),o=i(11456),l=i(68636);function c({id:e,touchTypistId:t,kind:i,replacement:n,previewDelta:s,revertDelta:r,highlightRanges:a,highlightTexts:l,transformRange:c,transformText:h,title:d}){return{_tag:o.b.touchTypist,id:e,touchTypistId:t,kind:i,replacement:n,previewDelta:s,revertDelta:r,revision:"",highlightRanges:a,highlightTexts:l,transformRange:c,transformText:h,transforms:[],extraProperties:{},title:d}}!function(e){e.Preview="Preview",e.RecentRevert="RecentRevert",e.Revert="Revert"}(n||(n={})),function(e){function t(e,t){const i=e=>""===e.trim();return i(e)||i(t)?i(t)?`Removed “${e}”`:`Added “${t}”`:e}e.is=function(e){return e._tag===o.b.touchTypist},e.equals=function(e,t){return o.S.ordering.areSame(e,t)},e.createHighlightsMeta=function(e,t){return{highlightId:t,alertId:e.id,...function(e){switch(e){case n.Preview:{const e=(0,a.Y)()?l.jk.underlineAndPersistentBackground:l.jk.underlineAndBackground;return{highlightColor:l.hE.Preset.create(l.al.red),highlightDisplayFormat:e}}case n.RecentRevert:return{highlightColor:l.hE.Preset.create(l.al.green),highlightDisplayFormat:l.jk.background};case n.Revert:return{highlightColor:l.hE.Preset.create(l.al.gray),highlightDisplayFormat:l.jk.dottedUnderlineAndBackground};default:(0,r.L0)(e)}}(e.kind),highlightDisappearOnHoverDelay:null,highlightLiveliness:null}},e.fromPreview=function(){return({id:e,touchTypistId:t,begin:i,end:s,original:r,highlight:a,replacement:o,delta:l,reverseDelta:h})=>{const d={start:a.s,end:a.e},u=a.text,p={start:i,end:s},g=r;return c({id:String(e),touchTypistId:t,kind:n.Preview,replacement:o,previewDelta:l,revertDelta:h,highlightRanges:[d],highlightTexts:[u],transformRange:p,transformText:g,title:""})}},e.fromRevert=function(){return({revertId:e,touchTypistId:i,highlightBegin:s,highlightEnd:r,highlightText:a,text:o,isRecent:l,correspondingPreview:h})=>{const d={start:s,end:r},u=d,p=a;return c({id:String(e),touchTypistId:i,kind:l?n.RecentRevert:n.Revert,replacement:o,previewDelta:h.delta,revertDelta:h.reverseDelta,highlightRanges:[d],highlightTexts:[a],transformRange:u,transformText:p,title:t(o,h.replacement)})}},e.createRevertTitle=t}(s||(s={}))},56193:(e,t,i)=>{i.d(t,{Y:()=>r});var n=i(81259),s=i(6986);function r(){return"test"===(0,s.OB)().experimentClient.getTreatment(n.p.TouchTypistFeatureParityFree)||"test"===(0,s.OB)().experimentClient.getTreatment(n.p.TouchTypistFeatureParityProAndPremium)}},21448:(e,t,i)=>{i.d(t,{Qi:()=>r,jc:()=>a,nE:()=>s});const n=e=>e.reduce(((e,t)=>{const i=t.lensType;return e[i]=e[i]?e[i]+1:1,e}),{}),s=(e,t)=>{const{placement:i,bannerType:s,advancedAlerts:r=[],inline:a=!1,numberOfAdvancedAlerts:o,numberOfCriticalAlerts:l,sessionUuid:c,upgradeHookName:h,upgradeHookSlot:d,upgradeHookVariant:u}=t,p=n(r);e.getPremiumButtonShow(i,s,p.clarity,p.correctness,p.delivery,p.engagement,a,(null!=o?o:r.length>0)?r.length:void 0,l,c,h,d,u)},r=(e,t)=>{const{placement:i,bannerType:s,advancedAlerts:r=[],inline:a=!1,numberOfAdvancedAlerts:o,numberOfCriticalAlerts:l,sessionUuid:c,upgradeHookName:h,upgradeHookSlot:d,upgradeHookVariant:u}=t,p=n(r);e.getPremiumButtonClick(i,s,p.clarity,p.correctness,p.delivery,p.engagement,a,(null!=o?o:r.length>0)?r.length:void 0,l,c,h,d,u)},a=(e,t)=>{const{placement:i,bannerType:s,advancedAlerts:r=[],inline:a=!1,numberOfAdvancedAlerts:o,numberOfCriticalAlerts:l,sessionUuid:c,upgradeHookName:h,upgradeHookSlot:d,upgradeHookVariant:u}=t,p=n(r);e.dismissUpHookButtonClick(i,s,p.clarity,p.correctness,p.delivery,p.engagement,a,(null!=o?o:r.length>0)?r.length:void 0,l,c,h,d,u)}},8923:(e,t,i)=>{var n;i.d(t,{i:()=>n}),function(e){e.textChange="textChange",e.reset="reset",e.alertAccepted="alertAccepted",e.alertUpdate="alertUpdate",e.capiRemove="capiRemove",e.ignore="ignore"}(n||(n={}))},1596:(e,t,i)=>{i.d(t,{M:()=>M,O:()=>U});var n=i(64271),s=i(93440),r=i(59179),a=i(10883),o=i(20161),l=i(14969),c=i(44045),h=i(29479),d=i(1747),u=i(90572),p=i(55100),g=i(43175),m=i(35063),f=i(24348),v=i(8923),_=i(11456),b=i(94525),S=i(52979),y=i(68636),w=i(99836),A=i(57935),I=i(70932),C=i(76667);var x=i(77432);function E(e){return e.isPremium&&e.isHidden}var R=i(84714),k=i(5588);var T=i(79992);function P(e){return(0,n.T)((t=e.textRevisionManager.revisionChanges,t.pipe((0,k.D)((e=>1===Math.abs(e.deltaChanges.length)?(0,s.H)(1e3).pipe((0,r.U)((()=>e))):(0,R.of)(e))))),U(e.textObserver,e.layout)).subscribe((t=>{!function(e,t,i,n,s){if(e){const e=(0,T.DV)((()=>t.processPendingTextRevisions()),(e=>(s.warn("alertProcessor: processing text revision failed",e),null)));try{const r=e&&e.transformedAlerts.map((e=>t.alerts.getAlertById(e.id))).filter((e=>null!==e))||[];try{const e=r.flatMap((e=>i.get(e.id)||[]));n.maintainConsistency(e,void 0,void 0,((e,t)=>r.some((e=>e.id===t.alertId))))}catch(e){s.error("error maintaining highlight consistency",e)}}catch(e){s.error("failed on update/maintain",e)}}try{n.recalculateAllHighlights()}catch(e){s.error("error recalculating highlights",e)}}(t,e.alertProcessor,e.alertIdToHighlightIds,e.highlights,e.log)}));var t}class M{constructor(e,t,i,s,a,o,l,c=I.Y.create("AquaAlertsWiring"),h,d,u,p,g){this._alertProcessor=e,this._highlights=t,this._alertFilter=i,this._textObserver=s,this._textRevisionManager=a,this._layout=o,this._felog=l,this._log=c,this._isAssistantOpened=h,this._showInlineYellowUnderlines=d,this._showInlineLockedUIUnderlines=u,this._showColoredLockedUIUnderlines=p,this._isLockedUIExperimentTreatmentGroup=g,this._subs=[],this._alertIdToHighlightIds=new Map,this._alertsToProcessOnFilterChange=this._alertFilter.pipe((0,r.U)((e=>{const t=[],i=[];for(const e of this._alertProcessor.alerts.getAll()){const n=this._alertIdToHighlightIds.get(e.id);n&&n.some((e=>this._highlights.hasHighlight(e)))?i.push(e):t.push(e)}return{addedAlerts:t,updatedAlerts:i,removedAlerts:[],transformedAlerts:[]}}))),this._subs.push(P({alertIdToHighlightIds:this._alertIdToHighlightIds,layout:this._layout,log:this._log,textRevisionManager:this._textRevisionManager,textObserver:this._textObserver,highlights:this._highlights,alertProcessor:this._alertProcessor})),this._subs.push(this._updateHighlightsOnAlertChange()),this._subs.push(function(e,t,i,s){let r=e.getTextSource().getPlainText().length;return(0,n.T)(i.revisionChanges,U(e,t)).subscribe((e=>{if(e){const t=e.deltaChanges.length;if(1===Math.abs(t)){const i=Math.min(...e.changes.map((e=>e.pos)));let n=0;n=r+t-1;const a={start:i,end:n};s.updateHighlightsForTextRange(a,t)}r+=t}}))}(this._textObserver,this._layout,this._textRevisionManager,this._highlights))}static getHighlightColor(e,t,i,n,s,r){const{ethical_ai_highlight_background_color:a,ethical_ai_highlight_underline_color:o,critical_mistake:l,reactivation_yellow_underlines:c}=e.extraProperties,h=x.p.shouldShowInlineYellowUnderlinesForInProductReactivation(c),u=M._shouldReplaceColorWithYellow(e,t,r,s,i,n,h);return h&&(0,w.Tb)().sendFemetricsRate("inProductReactivation.shown",{yellowOnClient:u}),"true"!==l||u?"false"!==l||u?a&&o?y.hE.Custom.create(a,o):u?y.hE.Preset.create(y.al.gold):(0,g.JD)(e.patternName)?y.hE.Preset.create(y.al.gray):(0,p.t)(e.patternName)?y.hE.Preset.create(y.al.green):(0,m.u1)(e.patternName)?y.hE.Preset.create(y.al.plagiarism):e.extraProperties.underline_with_teaser?y.hE.Preset.create(y.al.weHbar):e.impact===d.wQ.Impact.Critical?y.hE.Preset.create(y.al.red):M._outcomeToHighlightColor[e.outcome]:y.hE.Preset.create(y.al.blue):y.hE.Preset.create(y.al.red)}static getHighlightDisplayFormat(e){return e.belongsToKnowledgeHubTermDetails?y.jk.background:e.belongsToKnowledgeHubSuggestedTerm?y.jk.underline:e.isVbar?y.jk.vbar:e.isEnclosing?y.jk.enclosing:e.isEnclosed?e.isMain?y.jk.underline:e.isMainStart?y.jk.underlineStart:y.jk.underlineAndBackground:e.belongsToActiveAlert&&e.belongsToSuperAlert?e.isActive?y.jk.underlineAndBackground:y.jk.background:y.jk.underlineAndBackground}static _extractHighlightInfo(e,t){const i="enclosing"===t.type,n=e.highlightRanges.some((e=>"enclosing"===e.type));return{isEnclosing:i,isEnclosed:n,isMain:"main"===t.type,isMainStart:"main_start"===t.type,isVbar:Boolean(e.extraProperties.vbar),belongsToKnowledgeHubTermDetails:(0,g.Ed)(e),belongsToKnowledgeHubSuggestedTerm:(0,g.kK)(e)}}static getHighlightMeta(e,t,i,n,s,r,a,o){if(_.S.isTouchTypistAlert(e))return f.u.createHighlightsMeta(e,t);const{hColor:l,dFormat:c}=this._getHighlightColorAndFormat(e,i,n,s,r,a,o);return{highlightId:t,alertId:e.id,highlightColor:l,highlightDisplayFormat:c,highlightDisappearOnHoverDelay:null,highlightLiveliness:null}}static _getHighlightColorAndFormat(e,t,i,n,s,r,a){let o=_.S.isCapiAlert(e)?M.getHighlightColor({...e,isPremium:!e.isFree,isHidden:e.isHidden},i,n,s,r,a):null,l=_.S.isCapiAlert(e)?M.getHighlightDisplayFormat(M._extractHighlightInfo(e,t)):null;return e._tag===_.b.snippetsTemplate&&(o=y.hE.Preset.create(y.al.green),l=y.jk.background),{hColor:o,dFormat:l}}_addHighlightsFor(e,t){e.highlightRanges.forEach(((i,n)=>{const s=S.y$.Id.create(e.id,n),r=this._alertIdToHighlightIds.get(e.id)||[];this._alertIdToHighlightIds.set(e.id,[...r,s]),this._highlights.addHighlight(s,S.NC.expandIfNeeded(i,t),M.getHighlightMeta(e,s,i,this._isAssistantOpened.get(),this._showInlineYellowUnderlines.get(),this._showInlineLockedUIUnderlines.get(),this._showColoredLockedUIUnderlines.get(),this._isLockedUIExperimentTreatmentGroup.get()))}))}_updateHighlightsFor(e,t){const i=this._alertIdToHighlightIds.get(e.id);if(i&&i.length!==e.highlightRanges.length)this._clearHighlightsFor(e.id),this._addHighlightsFor(e,t);else{const n=[];e.highlightRanges.forEach(((s,r)=>{let a;const o=null==i?void 0:i[r];o?a=o:(a=S.y$.Id.create(e.id,r),n.push(a)),this._highlights.updateHighlight(a,S.NC.expandIfNeeded(s,t),M.getHighlightMeta(e,a,s,this._isAssistantOpened.get(),this._showInlineYellowUnderlines.get(),this._showInlineLockedUIUnderlines.get(),this._showColoredLockedUIUnderlines.get(),this._isLockedUIExperimentTreatmentGroup.get()))}));const s=this._alertIdToHighlightIds.get(e.id)||[];this._alertIdToHighlightIds.set(e.id,[...s,...n])}}_updateHighlightsOnAlertChange(){return(0,n.T)(this._alertProcessor.alerts.changes.pipe(C.d5.measure(this._felog.processAlerts.measure)),this._alertsToProcessOnFilterChange.pipe(C.d5.measure(this._felog.processFilterChange.measure))).pipe((0,a.M)(this._alertFilter),(0,r.U)((([{addedAlerts:e,removedAlerts:t,transformedAlerts:i,updatedAlerts:n},s])=>({addedAlerts:e.filter(s),updatedAlerts:n.filter(s),transformedAlerts:i.filter((e=>{const t=this._alertProcessor.alerts.getAlertById(e.id);return!!t&&s(t)})),removedAlerts:[...t.filter((e=>s(e.alert))),...n.filter((e=>!s(e))).map((e=>({id:e.id,alert:e,reason:{_tag:v.i.alertUpdate}})))]}))),u.h((e=>e.addedAlerts.length>0||e.updatedAlerts.length>0||e.transformedAlerts.length>0||e.removedAlerts.length>0))).subscribe((e=>{try{for(const t of e.removedAlerts)this._clearHighlightsFor(t.id)}catch(e){this._log.error("failed to remove highlights",e)}if(e.addedAlerts.length>0||e.updatedAlerts.length>0||e.transformedAlerts.length>0){const t=this._textObserver.getTextSource().getPlainText();for(const i of e.addedAlerts)try{this._addHighlightsFor(i,t)}catch(e){this._log.warn(`failed to add highlight for #${i.id}`,e)}for(const i of e.updatedAlerts)try{this._updateHighlightsFor(i,t)}catch(e){this._log.error(`failed to update highlight for #${i.id}`,e)}for(const i of e.transformedAlerts)try{const e=this._alertProcessor.alerts.getAlertById(i.id);e&&this._updateHighlightsFor(e,t)}catch(e){this._log.error(`failed to update highlight geometry for #${i.id}`,e)}}}))}_clearHighlightsFor(e){const t=this._alertIdToHighlightIds.get(e);t&&(this._highlights.removeHighlights(t),this._alertIdToHighlightIds.set(e,[]))}static _shouldReplaceColorWithYellow(e,t,i,n,s,r,a){if(function(e){const{free_premium:t}=e.extraProperties;return e.inline===d.wQ.Inline.inline&&E(e)&&"uphook"===t}(e))return!0;if(t){const t=!i||!n;return E(e)&&t||a}return!(!function(e){const{free_premium:t}=e.extraProperties;return e.inline===d.wQ.Inline.inline&&E(e)&&"locked"===t}(e)||!r||n)||(!(!function(e){const{free_premium:t}=e.extraProperties;return e.impact===d.wQ.Impact.Advanced&&"unlocked"!==t}(e)||!s)||!!a)}getHighlightsForAlert(e){return this._alertIdToHighlightIds.get(e)||[]}dispose(){this._subs.forEach((e=>e.unsubscribe()))}}function U(e,t){return e.contentChanges.async.pipe((0,o.w)((()=>t.scroll.changes.pipe((0,l.P)(),(0,c.R)((0,s.H)(A.E0)),(0,h.h)(null)))))}M._outcomeToHighlightColor={[b.TC.correctness]:y.hE.Preset.create(y.al.red),[b.TC.clarity]:y.hE.Preset.create(y.al.blue),[b.TC.engagement]:y.hE.Preset.create(y.al.green),[b.TC.tone]:y.hE.Preset.create(y.al.purple),[b.TC.vox]:y.hE.Preset.create(y.al.gray),[b.TC.knowledgeHub]:y.hE.Preset.create(y.al.lightGreen),[b.TC.other]:y.hE.Preset.create(y.al.gold)}},35947:(e,t,i)=>{i.d(t,{B:()=>c,g:()=>l});var n=i(93018),s=i(3492),r=i(70642),a=i(79992),o=i(52467);function l(e,t=!1){return e.reduce((({actions:e,index:i},r)=>{const o=e[0];return n.s.isInsertString(r)?(e.unshift({pos:{start:i,end:i},value:t&&r.attributes?(new s.i).insert(r.insert,r.attributes):r.insert}),{actions:e,index:i}):n.s.isInsertEmbed(r)?{actions:e,index:i+1}:n.s.isRetain(r)?(t&&r.attributes&&e.unshift({pos:{start:i,end:i+r.retain},value:(new s.i).retain(r.retain,r.attributes)}),{actions:e,index:i+r.retain}):n.s.isDelete(r)?(o&&o.pos.start===o.pos.end&&o.pos.end===i?o.pos={...o.pos,end:o.pos.end+r.delete}:e.unshift({pos:{start:i,end:i+r.delete},value:""}),{actions:e,index:i+r.delete}):void(0,a.vE)(r)}),{actions:[],index:0}).actions.reduce(((e,t)=>(e.length&&e[e.length-1].value&&e[e.length-1].pos.start===t.pos.start&&(0,o.HD)(t.value)&&(0,o.HD)(e[e.length-1].value)?e[e.length-1].value=`${String(t.value)}${String(e[e.length-1].value)}`:e.push(t),e)),[])}const c=e=>e.reduce((({formattings:e,index:t},i)=>r.m.hasFormatting(i)?n.s.isInsertString(i)?(e.push({range:{start:t,end:"\n"===i.insert?t:t+i.insert.length},formatting:i.attributes}),{formattings:e,index:t+i.insert.length}):n.s.isInsertEmbed(i)?{formattings:e,index:t+1}:n.s.isRetain(i)?(e.push({range:{start:t,end:t+i.retain},formatting:i.attributes}),{formattings:e,index:t+i.retain}):{formattings:e,index:t}:n.s.isInsertString(i)?{formattings:e,index:t+i.insert.length}:n.s.isInsertEmbed(i)?{formattings:e,index:t+1}:n.s.isRetain(i)?{formattings:e,index:t+i.retain}:n.s.isDelete(i)?{formattings:e,index:t}:void(0,a.vE)(i)),{formattings:[],index:0}).formattings},69706:(e,t,i)=>{i.d(t,{WT:()=>n,xR:()=>g});var n,s=i(49231);if(6168!=i.j)var r=i(20161);if(6168!=i.j)var a=i(84714);if(6168!=i.j)var o=i(13391);if(6168!=i.j)var l=i(47387);if(6168!=i.j)var c=i(4603);if(6168!=i.j)var h=i(79499);if(6168!=i.j)var d=i(99431);if(6168!=i.j)var u=i(74514);if(6168!=i.j)var p=i(70932);!function(e){e.gButton="gButton",e.card="card",e.sdui="sdui",e.emogenie="emogenie",e.proofitRequest="proofitRequest",e.proofitReview="proofitReview",e.getStartedChecklist="getStartedChecklist",e.snippetsAppAction="snippetsAppAction"}(n||(n={}));class g{constructor(e){this._params=e,this._dynamicAssistantService=new d._(["setCheckingService"]),this._dynamicAssistantController=new d._,this._openState=o.h.create("closed"),this._log=p.Y.create("AssistantDynamicService"),this._subs=[],this._handleAssistantOpenState=e=>{this._openState.set(e)},this.open=async e=>{if(this._dynamicAssistantController.instance)this._dynamicAssistantController.instance.open(e);else{const{assistantController:t}=await this.init();t.open(e)}},this._params.customizationsAssistantVisible&&this._subs.push(this._params.customizationsAssistantVisible.subscribe(this._handleAssistantOpenState))}get assistantOpenState(){return this._openState.view()}get view(){return this._dynamicAssistantController.viewInstance.view((e=>e?s.createElement(u.L,{chunkName:"assistant"},s.createElement(l.F.Fragment,null,e.view)):null))}get activeView(){return this._dynamicAssistantController.viewInstance.pipe(r.w((e=>e?e.activeView:a.of(null))))}async init(){if(this._dynamicAssistantController.instance&&this._dynamicAssistantService.instance)return{assistantService:this._dynamicAssistantService.instance,assistantController:this._dynamicAssistantController.instance};const e=this._params.toneAIDynamicService.get().initOnFirstAlert(),t=this._params.ethicalAIDynamicService.get().initOnFirstAlert(),n=this._params.snippetsFeatureDynamicService.get().viewFeatureOption;return Promise.all([i.e(3773),i.e(3590),i.e(8819),i.e(5689),i.e(5672),i.e(7118),i.e(9300),i.e(94),i.e(6887),i.e(2082),i.e(5876),i.e(4022),i.e(8640),i.e(2154),i.e(5120),i.e(1890),i.e(2913),i.e(1358),i.e(628),i.e(3089),i.e(5853),i.e(688),i.e(1740),i.e(4441),i.e(8721)]).then(i.bind(i,92105)).then((({AssistantService:i,AssistantControllerImpl:s,LocalAssistantHighlightCollection:r})=>{var a;const o=this._params.createServiceParams(),l=new i({...o,highlights:null!==(a=o.highlights)&&void 0!==a?a:new r(this._params.highlights.get())}),h=new s({...this._params.createControllerParams(),assistantService:l,toneAIFeature:e,ethicalAIFeature:t,snippetsFeature:n,cardEvents:this._params.cardEvents,envFactory:c.OB,dapiActions:this._params.dapiActions},this._params.felog);return this._params.customizationsAssistantVisible||this._subs.push(h.openState.subscribe(this._handleAssistantOpenState)),this._dynamicAssistantService.set(l),this._dynamicAssistantController.set(h),{assistantService:l,assistantController:h}}))}close(){this._dynamicAssistantController.instance?this._dynamicAssistantController.instance.close():this._log.warn("it's impossible to close assistant if it isn't open")}initCheckingService(e){const t=h.p.getLazyProxyWithState((()=>e));t.lazyCheckingService.get(),this._dynamicAssistantService.instanceProxy.setCheckingService(t)}getHoveredStateBehavior(e){return this._dynamicAssistantService.viewInstance.pipe(r.w((t=>{const{hoverProvider:i}=t||this._params.createServiceParams();return i.getHoveredStateBehavior(e)})))}dispose(){[this._dynamicAssistantController.instance,this._dynamicAssistantService.instance].forEach((e=>{try{null==e||e.dispose()}catch(t){this._log.error(`failed trying to dispose ${typeof e} instance`,t)}})),this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}}},79499:(e,t,i)=>{i.d(t,{p:()=>M});var n,s=i(59833),r=i(38538),a=i(39953),o=i(1747),l=i(70568),c=i(25766),h=i(31391),d=i(74822),u=i(64271),p=i(90572),g=i(59179),m=i(63532),f=i(17869),v=i(50750),_=i(84714),b=i(97767),S=i(94444),y=i(72106),w=i(12518),A=i(4025),I=i(58303),C=i(52303),x=i(79992),E=i(11456),R=i(94525),k=i(91778),T=i(70932),P=i(21409);!function(e){let t;!function(e){e.unsafeToCAPI=e=>e,e.unsafeFromCAPI=e=>e}(t=e.AlertChangedWithRevision||(e.AlertChangedWithRevision={}))}(n||(n={}));class M{constructor(e,t,i,n,o,l){this._checkingService=e,this._checkingServiceState=t,this._alertsTransformer=i,this._textRevisionManager=n,this._getCAPIAlertById=o,this._customEventsFilter=l,this._subs=new h.w.Keeper,this.checkingState="idle",this.asyncChecksState={plagiarism:"idle",writing_expert_check:"idle",ai_detector:"idle",ai_studio:"idle",audience_adapt:"idle"},this.events=new d.x,this._loadedAlerts=new d.x,this._logger=T.Y.create("CAPIProxy"),this.pushChanges=()=>y.t$(new Error("Not implemented")),this.requestWritingExpert=()=>y.t$(new Error("Not implemented")),this._toFeedbackAlert=e=>({id:e,text:""}),this.requestDocStats=y.Uo(w.left(new Error("Method not implemented."))),this.ping=y.Uo(w.left(new Error("Method not implemented."))),this.enablePlagiarismSearch=y.fj((()=>A.vM((()=>this._checkingService.enablePlagiarismCheck())))),this.disablePlagiarismSearch=y.fj((()=>A.vM((()=>this._checkingService.disablePlagiarismCheck())))),this.enableWritingExpert=y.fj((()=>A.vM((()=>this._checkingService.enableWritingExpertCheck())))),this.disableWritingExpert=y.fj((()=>A.vM((()=>this._checkingService.disableWritingExpertCheck())))),this.disableAudienceAdapt=y.fj((()=>A.vM((()=>this._checkingService.disableAudienceAdapt())))),this.disableAiStudio=y.fj((()=>A.vM((()=>this._checkingService.disableAiStudio())))),this.realtimeProofitCancel=y.Uo(w.left(new Error("Method not implemented."))),this.submitRecipients=e=>y.Uo(w.left(new Error("Method not implemented."))),this.sendUserAction=(e,t)=>y.Uo(A.vM((()=>this._checkingService.sendUserAction(e,t)))),this.submitScoreSurveyResult=(e,t)=>y.Uo(A.vM((()=>this._checkingService.submitScoreSurveyResult(e,t)))),this.submitSurvey=e=>y.Uo(A.vM((()=>this._checkingService.submitSurvey(e)))),this.setSessionOption=e=>y.Uo(A.vM((()=>this._checkingService.setSessionOption(e)))),this.setContext=e=>y.Uo(A.vM((()=>this._checkingService.setContext(e))));const c=M.capiMessageTransformer(this._alertsTransformer),S=M.capiMessageRebaser((e=>this._textRevisionManager.getSquashedChangesSinceRevision(e)));this._subs.push(this._checkingService.checkingStatus.subscribe((e=>{switch(e){case P.H.idle:this.checkingState="idle";break;case P.H.inProgress:this.checkingState="checking";break;default:(0,x.vE)(e)}})),u.T(this._loadedAlerts,this._checkingService.messages).pipe(p.h(l?(0,b.W9)(U,l):U),g.U(c),m.b(w.mapLeft((e=>{this._logger.error("Got non-parsable message",e)}))),p.h(w.isRight),g.U(A.MH),g.U((e=>(0,a.zG)(S(e),I.g_((()=>(this._logger.error("Message cannot be rebased, dropping",e),I.YP)),I.G)))),p.h(I.pC),g.U(C.MH),f.z((e=>"finish"===e.kind?v.D([{kind:"before_finish"},e]):_.of(e)))).subscribe(this.events)),setTimeout((()=>{(0,a.zG)({lastFinish:this._checkingServiceState.lastFinish,lastEmoginie:this._checkingServiceState.lastEmoginie,lastTextInfo:this._checkingServiceState.lastTextInfo},r.KM(((e,t)=>t)),s.oA,s.UI(c),s.oh,(e=>e.right),(e=>(this._logger.debug("loaded messages on CAPIProxy init",e),e)),s.UI((e=>this.events.next(e))))}),0)}dispose(){this._subs.dispose(),this.events.complete()}loadAlerts(e){e.forEach((e=>{this._loadedAlerts.next({_tag:R.J8.Type.add,alert:e})}))}reportSynonymFeedback(e,t,i){throw new Error("Method not implemented.")}reportSynonymDismissed(e,t){throw new Error("Method not implemented.")}reportWritingExpertFeedback(e){throw new Error("Method not implemented.")}reportAiStudioFeedback(e){throw new Error("Method not implemented.")}reportG2Feedback(e){throw new Error("Method not implemented.")}reportTouchTypistFeedback(e){throw new Error("Method not implemented.")}reportAlertIgnore(e,t,i,n){this._checkingService.onAlertIgnored(this._toFeedbackAlert(e),t,i,n)}reportAlertAcknowledged(e,t,i,n){this._checkingService.onAlertAcknowledged(e,t,i,n)}reportAlertAccepted(e,t,i,n,s){this._checkingService.onAlertApplied(this._toFeedbackAlert(e),t,i,n,s)}reportAlertWithTranformJsonAccepted(e,t,i,n,s,r,a){this._checkingService.onAlertWithTransformJsonApplied(this._toFeedbackAlert(e),t,i,n,s,r,a)}reportAlertFeedback(e,t,i){switch(t){case o.PZ.ADD_TO_DICTIONARY:(0,a.zG)(this._getCAPIAlertById(e),w.fold((e=>this._logger.warn("Cannot add to dictionary unknown alert",e)),(e=>(0,a.zG)(e,R.DD.match({withPosition:e=>this._checkingService.onAlertSimpleFeedback(o.wQ.Id.create(e.id),o.PZ.ADD_TO_DICTIONARY,i),withTransformJSON:e=>this._checkingService.onAlertSimpleFeedback(o.wQ.Id.create(e.id),o.PZ.ADD_TO_DICTIONARY,i),withSubAlerts:e=>this._logger.warn("Cannot add to dictionary with super alert")})))));break;case o.PZ.RENDERED:case o.PZ.LOOKED:case o.PZ.HIDE:case o.PZ.WRONG_SUGGESTION:case o.PZ.OFFENSIVE_CONTENT:case o.PZ.CLOSED:case o.PZ.LIKE:case o.PZ.DISLIKE:case o.PZ.EXPANDED:case o.PZ.IGNORE_BULK_ACCEPTED:case o.PZ.USER_SATISFACTION_FEEDBACK:case o.PZ.UNLOCK:this._checkingService.onAlertSimpleFeedback(e,t,i);break;default:(0,x.vE)(t)}}reportLensFeedback(e,t){}reportEmotionFeedback(e,t){throw new Error("Method not implemented.")}reportEmotionSentenceFeedback(e,t){this._checkingService.sendEmotionSentenceFeedback({kind:t,id:e})}reportSystemFeedback(e){throw new Error("Method not implemented.")}reportAutocorrectFeedback(e){throw new Error("Method not implemented.")}reportAutocompleteFeedback(e){throw new Error("Method not implemented.")}reportAlertsBatchFeedback(e,t){throw new Error("Method not implemented.")}reportMuteFeedback(e,t,i){this._checkingService.sendMutedFeedback({kind:i,userMuteCategories:t,userMuteScope:e})}reportSnippetFeedback(e,t){this._checkingService.onSnippetFeedback({kind:t,snippetUuid:e})}reportAssistantOpenedFeedback(e){this._checkingService.onAssistantFeedback(e)}reportAutoapplyFeedback(e){this._checkingService.onAutoapplyFeedback(e)}reportDrillDownFeedback(e,t,i,n){throw new Error("Method not implemented.")}sendFeedback(e){switch(e.kind){case o._l.ASSISTANT_OPENED:return y.fj((()=>A.vM((()=>this.reportAssistantOpenedFeedback(e)))));case o.PZ.IGNORE:return y.fj((()=>A.vM((()=>{this.reportAlertIgnore(e.id,o.e3.Sidebar,e.reason,e.pnameQualifier)}))));case o.PZ.ACKNOWLEDGED:return y.fj((()=>A.vM((()=>{this.reportAlertAcknowledged(e.id,o.e3.Sidebar,e.text,e.pnameQualifier)}))));case o.PZ.ACCEPTED:return y.fj((()=>A.vM((()=>{M.isTransformJsonAlertAcceptedFeedback(e)?this.reportAlertWithTranformJsonAccepted(e.id,o.e3.Sidebar,e.alternativeIndex,e.reason,e.gapValue,e.dismissedTransformGroups,e.gbPrompt):this.reportAlertAccepted(e.id,o.e3.Sidebar,e.replacementText,e.reason,e.gbPrompt)}))));case o.PZ.ADD_TO_DICTIONARY:case o.PZ.RENDERED:case o.PZ.LOOKED:case o.PZ.CLOSED:case o.PZ.LIKE:case o.PZ.DISLIKE:case o.PZ.WRONG_SUGGESTION:case o.PZ.OFFENSIVE_CONTENT:case o.PZ.EXPANDED:case o.PZ.IGNORE_BULK_ACCEPTED:case o.PZ.USER_SATISFACTION_FEEDBACK:case o.PZ.HIDE:case o.PZ.UNLOCK:return y.fj((()=>A.vM((()=>{var t;this.reportAlertFeedback(e.id,e.kind,null!==(t=e.subtype)&&void 0!==t?t:o.e3.Inline)}))));case o.at.SYNONYM_ACCEPTED:return y.fj((()=>A.vM((()=>this.reportSynonymFeedback(e.id,e.kind,e.replacementText)))));case o.at.SYNONYM_DISMISSED:return y.fj((()=>A.vM((()=>this.reportSynonymDismissed(e.id,e.kind)))));case o.y_.EMOTION_LIKE:case o.y_.EMOTION_DISLIKE:case o.y_.EMOTION_OFFENSIVE:return y.fj((()=>A.vM((()=>this.reportEmotionFeedback(e.emotionName,e.kind)))));case o.fA.EMOTION_SENTENCE_LIKE:case o.fA.EMOTION_SENTENCE_DISLIKE:return y.fj((()=>A.vM((()=>this.reportEmotionSentenceFeedback(e.id,e.kind)))));case o.KI.RECHECK_SHOWN:return y.fj((()=>A.vM((()=>this.reportSystemFeedback(e.kind)))));case o.KX.LENS_CLOSE:case o.KX.LENS_OPEN:case o.KX.DISMISS_BY_LENS:return y.fj((()=>A.vM((()=>this.reportLensFeedback(e.lensName,e.kind)))));case o.Mw.MUTE:case o.Mw.UNMUTE:return y.fj((()=>A.vM((()=>this.reportMuteFeedback(e.userMuteScope,e.userMuteCategories,e.kind)))));case o.VD.AUTOCORRECT_ACCEPT:case o.VD.AUTOCORRECT_DISMISS:case o.VD.AUTOCORRECT_REPLACE:return y.fj((()=>A.vM((()=>this.reportAutocorrectFeedback(e.kind)))));case o._Y.COMPLETION_ACCEPTED:case o._Y.COMPLETION_IGNORED:case o._Y.COMPLETION_REJECTED:case o._Y.COMPLETION_SHOWN:return y.fj((()=>A.vM((()=>this.reportAutocompleteFeedback(e.kind)))));case o.DI.BULK_ACCEPTED:return y.fj((()=>A.vM((()=>this.reportAlertsBatchFeedback(e.alertIds,e.kind)))));case o.JE.SNIPPET_ACCEPTED:return y.fj((()=>A.vM((()=>this.reportSnippetFeedback(e.snippetUuid,e.kind)))));case o.P2.DRILLDOWN:return y.fj((()=>A.vM((()=>this.reportDrillDownFeedback(e.id,e.alternativeIndex,e.drilldownSuggestionIds,e.subtype)))));case o.Fj.WritingExpert:return y.fj((()=>A.vM((()=>this.reportWritingExpertFeedback(e.kind)))));case o.dt.AiStudio:return y.fj((()=>A.vM((()=>this.reportAiStudioFeedback(e.kind)))));case o.Q1.AUTOAPPLY_LOOKED:case o.Q1.AUTOAPPLY_REVERTED:case o.Q1.AUTOAPPLY_TRIGGERED:case o.Q1.AUTOAPPLY_ACCEPT:case o.Q1.AUTOAPPLY_AFFECTED_BY_TEXTCHANGE:return y.fj((()=>A.vM((()=>this.reportAutoapplyFeedback(e)))));case o.r0.G2_UI:return y.fj((()=>A.vM((()=>this.reportG2Feedback(e.kind)))));case o.XN.IndividualPreviewApply:case o.XN.IndividualPreviewDismiss:case o.XN.IndividualPreviewLook:case o.XN.Appeared:case o.XN.Apply:case o.XN.CardPreviewLooked:case o.XN.Revert:case o.XN.RevertLook:return y.fj((()=>A.vM((()=>this.reportTouchTypistFeedback(e.kind)))));default:return(0,x.vE)(e)}}isClosed(){throw new Error("Method not implemented.")}getText(){throw new Error("Method not implemented.")}close(e){throw new Error("Method not implemented.")}requestSynonyms(e,t){throw new Error("Method not implemented.")}requestSnippets(e){throw new Error("Method not implemented.")}enableAudienceAdapt(e){return y.fj((()=>A.vM((()=>this._checkingService.enableAudienceAdapt(e)))))}enableAiStudio(e){return y.fj((()=>A.vM((()=>this._checkingService.enableAiStudio(e)))))}sendTouchTypistCommand(e){return y.fj((()=>A.vM((()=>this._checkingService.sendTouchTypistCommand(e)))))}realtimeProofitSubmit(e){return y.Uo(w.left(new Error("Method not implemented.")))}shortenItSubmit(e){return y.Uo(w.left(new Error("Method not implemented.")))}sendDebugReport(e,t){return y.Uo(A.vM((()=>{this._checkingService.sendDebugReport(e,t)})))}updateContextInfo(e){return y.Uo(A.vM((()=>{this._checkingService.updateContextInfo(e)})))}published(){return y.Uo(A.vM((()=>{this._checkingService.published()})))}resetReconnectInfo(){w.left(new Error("Method not implemented."))}sendMessage(...e){return this._checkingService.sendMessage(...e)}}const U=e=>{switch(e._tag){case R.J8.Type.add:case R.J8.Type.remove:case R.J8.Type.changed:case R.J8.Type.start:case R.J8.Type.finished:case R.J8.Type.emogenie:case R.J8.Type.textInfo:case R.J8.Type.feedback:return!0;case R.J8.Type.autocomplete:case R.J8.Type.proofitAvailability:case R.J8.Type.proofitCancelResponse:case R.J8.Type.proofitCompleted:case R.J8.Type.proofitProgress:case R.J8.Type.proofitProgressError:case R.J8.Type.proofitProgressRejected:case R.J8.Type.proofitSubmitResponse:case R.J8.Type.error:case R.J8.Type.publishedAck:case R.J8.Type.submitSurveyResultAck:case R.J8.Type.sduiAdd:case R.J8.Type.sduiUpdate:case R.J8.Type.sduiRemove:case R.J8.Type.showSurvey:case R.J8.Type.submitOtAck:case R.J8.Type.asyncCheckFinished:case R.J8.Type.setContextAck:case R.J8.Type.toggleChecksAck:case R.J8.Type.touchTypistTriggerResponse:return!1;default:return(0,x.vE)(e)}};!function(e){e.create=function(t,i,n,s,r,a){return new e(t,i.value,n,r,(e=>{const t=s.alerts.getAlertById(e);return t&&E.S.isCapiAlert(t)?w.right(t):w.left(new Error("Unknown alert"))}),a)},e.getLazyProxyWithState=e=>{let t=null;const i={lastStart:C.cS(),lastFinish:C.cS(),lastEmoginie:C.cS(),lastTextInfo:C.cS()};return{lazyCheckingService:(0,x.Vo)((()=>{const n=e();return t=n.messages.subscribe((e=>{e._tag===R.J8.Type.finished&&(i.lastFinish=I.G(e)),e._tag===R.J8.Type.emogenie&&(i.lastEmoginie=I.G(e)),e._tag===R.J8.Type.textInfo&&(i.lastTextInfo=I.G(e)),e._tag===R.J8.Type.start&&(i.lastStart=I.G(e))})),n})),state:{value:i,dispose:()=>t&&t.unsubscribe()}}},e.isTransformJsonAlertAcceptedFeedback=function(e){return void 0!==e.alternativeIndex},e.capiMessageTransformer=e=>t=>{switch(t._tag){case R.J8.Type.add:return(0,a.zG)(e(t.alert),w.map((e=>({kind:"alert_received",alert:e,rev:t.alert.revision}))));case R.J8.Type.changed:return w.right({kind:"alert_changed",alertId:t.changed.id,extraProperties:t.changed.extraProperties,transformJson:t.changed.transformJSON,muted:t.changed.muted,rev:t.changed.revision});case R.J8.Type.remove:return w.right({kind:"alert_removed",alertId:t.removedId,hint:I.YP,mergedIn:I.YP});case R.J8.Type.start:return w.right({kind:"session_started",defaultDocumentContext:S.R$.parseDefault(t.defaultDocumentContext),userMutedCategories:t.userMutedCategories||[],isEnterprise:t.isEnterprise,domainName:t.domainName,domainCategory:t.domainCategory,sessionUuid:t.sessionUuid,isNewSession:t.isNewSession,allowedFeatures:t.allowedFeatures,cheetahState:t.cheetahState,maxWsMessageSize:t.maxWsMessageSize});case R.J8.Type.finished:return w.right({kind:"finish",revision:k.Q.getRevisionNumber(t.finished.revision),score:(0,a.zG)(I.ij(t.finished.generalScore),I.hX((e=>e>=0)),I.UI((e=>({errorRateScore:0,rank:e})))),lowestScore:(0,a.zG)(I.ij(t.finished.lowestGeneralScore),I.hX((e=>e>=0)),I.UI((e=>({errorRateScore:0,rank:e})))),scoreStatus:I.ij(t.finished.scoreStatus),dialect:"undefined",removed:new Set,outcomeScores:l.v0.OutcomeScores.normalize(t.finished.outcomeScores),foreign:t.finished.nonEnglishText});case R.J8.Type.emogenie:return w.right({kind:"emotions",emotions:t.emogenieReport.emotions});case R.J8.Type.textInfo:return w.right({kind:"text_info",data:{wordsCount:t.wordsCount,charsCount:t.charsCount,readingTime:t.readingTime,speakingTime:t.speakingTime,readabilityScore:t.readabilityScore,sessionStats:t.sessionStats,messages:I.ij(t.messages)}});case R.J8.Type.feedback:return w.right({kind:"feedback_ack",outcomeScores:t.scores,scoreStatus:t.scoreStatus});case R.J8.Type.publishedAck:return w.right({kind:"published_ack",survey:t.survey});case R.J8.Type.submitSurveyResultAck:return w.right({kind:"submit_survey_result_ack"});case R.J8.Type.sduiAdd:case R.J8.Type.sduiUpdate:case R.J8.Type.sduiRemove:case R.J8.Type.asyncCheckFinished:case R.J8.Type.setContextAck:case R.J8.Type.toggleChecksAck:case R.J8.Type.touchTypistTriggerResponse:return w.right({...t.event});default:return(0,x.vE)(t)}},e.capiMessageRebaser=e=>t=>"alert_received"===t.kind?(0,a.zG)(e(t.rev),I.UI((({deltaChanges:e,revision:t})=>({delta:e.delta,revision:t}))),I.g_((()=>I.G(t)),(e=>(0,a.zG)(c.D.transformAlert(t.alert,e),I.UI((e=>({...t,alert:e}))))))):"alert_changed"===t.kind?(0,a.zG)(e(t.rev),I.UI((({deltaChanges:e,revision:t})=>({delta:e.delta,revision:t}))),I.g_((()=>I.G(t)),(e=>(0,a.zG)(c.D.transformAlertChanged(n.AlertChangedWithRevision.unsafeToCAPI(t),e),I.UI((e=>n.AlertChangedWithRevision.unsafeFromCAPI({...t,...e}))))))):I.G(t)}(M||(M={}))},92570:(e,t,i)=>{i.d(t,{j:()=>a});var n=i(13391),s=i(87234),r=i(89193);const a=(e,t,i,n)=>{const a=t.view("page","domain").get(),o=(0,r.U)(e,a),l=i.view((({widgetOffset:e})=>null!=e?e:s.E9.zero));return{initialPositionOffset:l,updateInitialPositionOffset:e=>{s.E9.equals(e,l.get())||n.field.patchFieldSettings({fieldId:o,fieldSettings:{widgetOffset:e}})}}};n.h.create({top:0,left:0})},23684:(e,t,i)=>{i.d(t,{W:()=>s});var n=i(87234);const s=e=>{const t=e.initialPositionOffset.get();return{initialPositionOffset:t,onDrag:i=>{e.updateInitialPositionOffset(n.E9.plus(t,n.E9.fromCartesian(i.translate)))}}}},47441:(e,t,i)=>{i.d(t,{f:()=>r});var n=i(49231),s=i(9843);const r=(e,t,i,r)=>{const[a,o]=n.useState(s.h.create()),[l,c]=n.useState(null),[h,d]=n.useState(null),u=null!=h?h:a.translate;return n.useEffect((()=>{!a.dragging&&a.dragEnd&&(t(e+u.y),r(i+u.x),c(a.translate),d({x:0,y:0}))}),[a]),n.useEffect((()=>{a.dragging&&h&&l&&d({x:a.translate.x-l.x,y:a.translate.y-l.y})}),[a]),{dragState:a,setDragState:o,x:u.x,y:u.y}}},17806:(e,t,i)=>{i.d(t,{G:()=>o});var n=i(49231),s=i(62552),r=i(78129),a=i(76517);const o=()=>{const[e,t]=n.useState(a.KC.top),[i,o]=n.useState(a.KC.left),[l,c]=n.useState(a.KC.height),[h,d]=n.useState(a.KC.width),u=n.useRef(new s.X(a.KC));return n.useEffect((()=>{const n=u.current.pipe(r.G()).subscribe((([n,s])=>{const r=((e,t,i)=>{if(e===a.KC.left||t.left!==i.left)return i.left})(i,n,s),l=((e,t,i)=>e===a.KC.top?i.top:t.height!==i.height?Math.max(e-(i.height-t.height),0):void 0)(e,n,s);void 0!==l&&t(l),void 0!==r&&o(r),d(s.width),c(s.height)}));return()=>n.unsubscribe()}),[e,i]),{top:e,setTop:t,left:i,setLeft:o,height:l,width:h,positionerRef:u}}},70874:(e,t,i)=>{i.d(t,{S:()=>n});var n,s=i(84766),r=i(32734),a=i(57935);!function(e){const t=e=>(0,s.F)(e).pipe((0,r.B)());e.sec5=t(a.m9(5)),e.sec2=t(a.m9(2)),e.sec1=t(a.m9(1)),e.hz4=t(a.Xd(4)),e.hz10=t(a.Xd(10)),e.hz30=t(a.Xd(30));const i=new Map;e.create=function(e){const n=i.get(e);if(n)return n;{const n=t(e);return i.set(e,n),n}}}(n||(n={}))},41274:(e,t,i)=>{i.d(t,{V:()=>n});i(97855);const n=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g},70642:(e,t,i)=>{i.d(t,{m:()=>n});var n,s=i(93018);!function(e){e.isInlineFormatting=function(e){return"bold"in e||"italic"in e||"underline"in e||"link"in e},e.isListFormatting=function(e){return"list"in e},e.isHeaderFormatting=function(e){return"header"in e},e.hasFormatting=function(t){return!s.s.isDelete(t)&&void 0!==t.attributes&&(e.isInlineFormatting(t.attributes)||e.isListFormatting(t.attributes)||e.isHeaderFormatting(t.attributes))}}(n||(n={}))},16703:(e,t,i)=>{i.d(t,{V:()=>n});var n,s=i(60310);!function(e){e.gbuttonInnerSize=22,e.gButtonPadding=2,e.gButtonGroupPadding=2,e.gButtonTopLeftMargin=1,e.gButtonMinimizedSize=12,e.getGButtonComponentSize=(t=e.gButtonMaxSize)=>e.gbuttonInnerSize*t/e.gButtonMaxSize,e.getEmogenieSize=e.getGButtonComponentSize,e.getTotalWidth=(t,i,n)=>{const r=[];i&&!n&&r.push(e.getEmogenieSize()+-1),n&&r.push(s.m);const a=r.reduce(((e,t)=>e+t),0);return(e.gButtonMaxSize+a)*t/e.gButtonMaxSize},e.gButtonMaxSize=e.gbuttonInnerSize+2*e.gButtonPadding+2*e.gButtonGroupPadding;e.getGButtonSize=(t,i)=>Math.max(Math.min(t,i,e.gButtonMaxSize),24)}(n||(n={}))},68942:(e,t,i)=>{var n;i.d(t,{P:()=>n}),function(e){e.OFFLINE="offline",e.POPUP_VISIBLE="popup_visible",e.POPUP_VISIBLE_ALLOW_HOVER="popup_visible_allow_hover",e.DATA_CONTROL_ACTIVE="data_control_active",e.USER_EDC_BLOCKED="user_edc_blocked",e.ASSISTANT_VISIBLE="assistant_visible",e.USER_CLAIMED="user_claimed",e.SIGNED_OUT_GB="signed_out_gb",e.STAND_WITH_UKRAINE="stand_with_ukraine",e.POPUP_VISIBLE_SDUI="popup_visible_sdui",e.INACTIVE_INTEGRATION="inactive_integration"}(n||(n={}))},52979:(e,t,i)=>{i.d(t,{NC:()=>a,WF:()=>u,pc:()=>c,qH:()=>r,y$:()=>o});var n=i(90023);if(6168!=i.j)var s=i(24666);var r,a,o,l,c,h=i(13391),d=i(79992);function u(e){return e.rect.map((e=>e.size)).behavior.pipe((0,s.x)(((e,t)=>e.height===t.height&&e.width===t.width)))}!function(e){let t;!function(e){e.invalidate="invalidate",e.preserve="preserve"}(t=e.ChangeType||(e.ChangeType={}))}(r||(r={})),function(e){e.everything=h.h.create({filter:e=>!0,type:e.ChangeType.preserve})}(r||(r={})),function(e){function t(e,t){const i=e.end-e.start==1,n="a"===t.slice(e.start,e.end);return i&&!n}e.is=function(e){const t=e;return(0,d.Nf)(t.increasedLeft)&&"number"==typeof t.increasedLeft&&(0,d.Nf)(t.increasedRight)&&"number"==typeof t.increasedRight},e.expandIfNeeded=function(e,i){if(t(e,i)){const t=e.start>0?1:0,n=e.end!==i.length?1:0;return{start:e.start-t,end:e.end+n,increasedLeft:t,increasedRight:n}}return{...e}},e.shouldExpand=t}(a||(a={})),function(e){let t;!function(e){let t=0;e.create=function(e,i){return t++,`${e}-${t}${void 0!==i?`|${i}`:""}`},e.createFromMark=function(e){return`${e}`}}(t=e.Id||(e.Id={}))}(o||(o={})),function(e){e.Mock=class{constructor(){this.addHighlight=n.W8,this.updateHighlight=n.W8,this.removeHighlights=n.Q1,this.removeAllHighlights=n.Q1,this.recalculateHighlight=n.Q1,this.recalculateAllHighlights=n.Q1,this.maintainConsistency=n.Q1,this.hasHighlight=n.W8,this.updateHighlightsForTextRange=n.Q1,this.dispose=n.Q1,this.geometry=h.h.create(new Map)}intersectingHighlightIDs(e){return[]}}}(l||(l={})),function(e){e.none="none",e.hovered="hovered",e.hoveredNeedsAttention="hovered_needs_attention"}(c||(c={}))},39390:(e,t,i)=>{function n(e,t=1.5,i=1.5){if(e.length<=0)return[];if(1===e.length)return e;{const n=[];let s=e[0];for(let r=1;r<e.length;r++){const a=e[r],o=a.top+a.height,l=o<s.top,c=o===s.top&&a.height>0&&s.height>0;if(l||c)continue;const h=Math.min(s.left,a.left),d=Math.min(s.top,a.top),u=Math.max(s.left+s.width,a.left+a.width)-h,p=Math.max(s.top+s.height,o)-d,g=u<=s.width+a.width+t,m=p<=s.height+a.height-i,f=p===s.height+a.height&&(0===a.height||0===s.height);a.width===s.width&&a.height===s.height&&a.left===s.left&&a.top===s.top||(g&&(m||f)?s={top:d,left:h,height:p,width:u}:(n.push(s),s=a))}return n.push(s),n}}function s(e,t=0,i=.5){if(e.length<=0)return[];{const n=[e[0]];for(let s=1;s<e.length;++s){const r=n[s-1],a=e[s],o=Math.min(r.top,a.top),l=Math.max(r.top+r.height,a.top+a.height)-o<r.height+a.height,c=a.top-(r.top+r.height),h=.5*(a.height+r.height);if(l||Math.abs(c)>i*h)n.push(a);else{const e=r.top+r.height+t*c;n[s-1]={top:r.top,left:r.left,width:r.width,height:e-r.top},n.push({top:e,left:a.left,width:a.width,height:a.top+a.height-e})}}return n}}function r(e){return e.reduce(((e,t)=>{if(null==e)return t;return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),width:Math.max(e.width,t.left+t.width-e.left),height:Math.max(e.height,t.top+t.height-e.top)}}),null)}i.d(t,{es:()=>n,jr:()=>r,yX:()=>s})},41767:(e,t,i)=>{i.d(t,{N1:()=>p,S3:()=>m,cN:()=>v,e9:()=>g,tJ:()=>u});var n=i(13391),s=i(36334),r=i(81259),a=i(4798);if(6168!=i.j)var o=i(62549);if(6168!=i.j)var l=i(70932);const c=n.h.create(!1),h=n.h.create(!1),d=n.h.create(!1),u=6168!=i.j?c:null,p=h,g=d,m=(e,t,i=l.Y.create("InlineLockedUIUnderlines.activateInlineUnderlines"))=>{i.debug("Trying to activate Inline locked underlines"),o.n.isFree(e.view("user").get())&&(v(t)&&(i.debug("Should show underlines for locked inline suggestions are activated"),c.set(!0),d.set(!0)),f(t)&&h.set(!0))},f=e=>{const t=e.peekTreatment(r.p.LockedUIWithNewUx);return null!==t&&"control"!==t},v=e=>(e=>!(0,s.Lu)()&&"unlimited_pool"===e.peekTreatment(r.p.LockedUIChrome))(e)||(e=>"unlimited_pool"===e.peekTreatment(r.p.LockedUIGDoc)&&(0,s.Lu)())(e)||(e=>e.isGateEnabled(a.K.LockedUIRollout))(e)},77432:(e,t,i)=>{i.d(t,{p:()=>n});var n,s=i(18117),r=i(90023),a=i(96991),o=i(84308),l=i(59179),c=i(90572),h=i(94592),d=i(13391),u=i(58303),p=i(69706),g=i(83895),m=i(81259),f=i(36334),v=i(62549),_=i(70932),b=i(41767);!function(e){e.showInlineYellowUnderlines=d.h.create(!1),e.dismissInlineYellowUnderlines=d.h.create(!1),e.inProductReactivationUnderlines=d.h.create(!1),e.activateInlineYellowUnderlines=(t,i,n,s,d,p,g,f,S,y,w,A,I,C=_.Y.create("InlineYellowUnderlines.activateInlineYellowUnderlines"))=>{var x;if((0,b.cN)(g))return;const E=a.pU,R=(null!==(x=t.get().page.dismissInlineYellowUnderlinesTimestamp)&&void 0!==x?x:0)>Date.now()-E;e.dismissInlineYellowUnderlines.set(R),C.debug(`Should dismiss inline yellow underlines: ${R}`),p(o.a([i.alertCounts,e.dismissInlineYellowUnderlines]).pipe(l.U((([e,i])=>v.n.isFree(t.view("user").get())&&e.hiddenCapiAlerts>4&&0===e.visibleInlineCapiAlerts&&"test"===g.getTreatment(m.p.InlineYellowUnderlinesV2)&&!i&&!I)),c.h(r.yR),c.h((t=>t&&!e.showInlineYellowUnderlines.get()))).subscribe((t=>{C.debug("Should show inline yellow underlines"),S.inlineYellowUnderlineShow((0,r.zG)(A(),u.fS((()=>"")))),h.wW(e.showInlineYellowUnderlines)(t)}))),p(o.a([s(),d,i.hiddenCapiAlertsFilter]).subscribe((([t,i,s])=>{if(null!=t&&e.showInlineYellowUnderlines.get()&&!e.dismissInlineYellowUnderlines.get()){const r=n(t.alertId);r&&s(r)&&e.handleYellowUnderlineClick(i,y,w,f,S,A)}})))},e.shouldShowInlineYellowUnderlinesForInProductReactivation=e=>"true"===e,e.handleYellowUnderlineClick=(t,i,n,a,o,l,c=_.Y.create("InlineYellowUnderlines.openAssistantAndFocusUphook"))=>{if(o.inlineYellowUnderlineClick((0,r.zG)(l(),u.fS((()=>"")))),c.debug("dismissInlineYellowUnderlines"),e.dismissInlineYellowUnderlines.set(!0),a.dismissInlineYellowUnderlines(),(0,f.Lu)())c.debug("Open GDocsSidebar"),i(!0);else{const e=g.D1.GButton.getPushAssistantFeedAction(t,g.D1.GButton.DEFAULT_GBUTTON_ID),i=g.D1.StrongAlertRef.findStrongAlertRefUpgradeHookSduiItem(t);(0,r.zG)(s.gz(u.Kw)(e,i),u.UI((([{feedId:e},{id:t}])=>[e,t.toString()])),u.g_((()=>{c.debug(`Open assistant: caller type ${p.WT.gButton}`),n({type:p.WT.gButton})}),(([e,t])=>{c.debug(`Open assistant: caller type ${p.WT.sdui}, feedId: ${e}, uphookId: ${t}`),n({type:p.WT.sdui,action:g.fr.create([g.D1.AssistantFeed.createPushAssistantFeedAction(e,t)])})})))}}}(n||(n={}))},50899:(e,t,i)=>{i.d(t,{BJ:()=>a,Eq:()=>l,U_:()=>c,gk:()=>h,lH:()=>s,oJ:()=>r,op:()=>n,wJ:()=>o});const n=2147483647,s=n-1,r=n-2,a=n-3,o=n-5,l=n-6,c=o,h=1350},87234:(e,t,i)=>{i.d(t,{Cv:()=>a,E9:()=>n,Ir:()=>r,p8:()=>s});var n,s,r,a,o=i(21589);!function(e){e.equals=function(e,t){return(0,o.M$)(e.left,t.left)&&(0,o.M$)(e.top,t.top)},e.fromCartesian=function({x:e,y:t}){return{top:t,left:e}},e.toCartesian=function({top:e,left:t}){return{x:t,y:e}},e.zero={top:0,left:0},e.minus=function(e,t){return{top:e.top-t.top,left:e.left-t.left}},e.plus=function(e,t){return{top:e.top+t.top,left:e.left+t.left}},e.ceil=function(e){return{left:Math.ceil(e.left),top:Math.ceil(e.top)}},e.floor=function(e){return{left:Math.floor(e.left),top:Math.floor(e.top)}},e.create=function(e){return{top:e.top,left:e.left}},e.l1Distance=function(e,t){return Math.abs(e.top-t.top)+Math.abs(e.left-t.left)}}(n||(n={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.fromClientPoint=function(e,i,n){return t({top:e.top-i.top+n.top,left:e.left-i.left+n.left})},e.zero={top:0,left:0}}(s||(s={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.fromOffsetPoint=function(e,i,n){return t({top:e.top+i.top-n.top,left:e.left+i.left-n.left})},e.fromPage=function(e,i){return t({top:e.top-i.top,left:e.left-i.left})}}(r||(r={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.getHighlightsPosition=function(e,i,n,s={top:0,left:0}){return t({top:e.top+i.top+n.top+s.top,left:e.left+i.left+n.left+s.left})},e.fromClient=function(e,i){return t({top:e.top+i.top,left:e.left+i.left})},e.fromOffset=function(e,t,i){return{top:e.top+t.top-i.top,left:e.left+t.left-i.left}}}(a||(a={}))},30033:(e,t,i)=>{i.d(t,{$u:()=>n,D1:()=>o,Pf:()=>a,UL:()=>s,Wm:()=>r});var n,s,r,a,o,l=i(21589),c=i(87234);!function(e){e.create=function(e){return{width:e.width,height:e.height}}}(n||(n={})),function(e){function t(e,t){const i=e.left<=t.left?e:t,n=i===e?t:e,s=e.top<=t.top?e:t,r=s===e?t:e;return i.left+i.width>=n.left&&s.top+s.height>=r.top}e.union=function(e){return t=>t.slice(1).reduce(((t,i)=>{const n=Math.min(i.top,t.top),s=Math.min(i.left,t.left),r=Math.max(t.left+t.width,i.left+i.width)-s,a=Math.max(t.top+t.height,i.top+i.height)-n;return e({top:n,left:s,width:r,height:a})}),t[0])},e.getIntersection=function(e,i){if(!t(e,i))return null;const n=e.left+e.width,s=e.top+e.height,r=i.left+i.width,a=i.top+i.height,o=Math.max(e.left,i.left),l=Math.max(e.top,i.top);return{left:o,top:l,width:Math.min(n,r)-o,height:Math.min(s,a)-l}},e.contains=function(e,t){return e.left>=t.left&&e.left<=t.left+t.width&&e.top>=t.top&&e.top<=t.top+t.height},e.doesRectContain=function(e,t){return t.left>=e.left&&t.left+t.width<=e.left+e.width&&t.top>=e.top&&t.top+t.height<=e.top+e.height},e.intersects=t,e.intersectsStrict=function(e,t){const i=e.left<=t.left?e:t,n=i===e?t:e,s=e.top<=t.top?e:t,r=s===e?t:e;return i.left+i.width>n.left&&s.top+s.height>r.top},e.setPosition=function(e,t){const i=n.create(t);return Object.assign({},e,n.create(t),{right:e.left+i.width,bottom:e.top+i.height})},e.area=function(e){return e.width*e.height},e.isEmpty=function(e){return 0===e.width&&0===e.height},e.shift=function(e,t){const i=c.E9.plus(e,t);return{...e,...i}},e.widen=function(e,t){return{...e,left:e.left-t,width:e.width+2*t}},e.equals=function(e,t,i){return(0,l.M$)(e.left,t.left,i)&&(0,l.M$)(e.top,t.top,i)&&(0,l.M$)(e.width,t.width,i)&&(0,l.M$)(e.height,t.height,i)},e.verticalOverlap=function(e,t){const i=e.top<=t.top?e:t,n=i===e?t:e,s=i.top+i.height-n.top;return s<0?0:s>n.height?1:s/Math.min(n.height,i.height)},e.midlineHorizontal=function(e){return{...e,top:e.top+e.height/2,height:0}},e.midlineVertical=function(e){return{...e,left:e.left+e.width/2,width:0}}}(s||(s={})),function(e){e.create=function(e){return{...e,kind:"offsetPoint"}},e.topLeftPoint=function({top:e,left:t}){return{kind:"offsetPoint",top:e,left:t}}}(r||(r={})),function(e){e.create=function(e){return{kind:"clientPoint",top:e.top,left:e.left,bottom:(null==e?void 0:e.bottom)||e.top+e.height,right:(null==e?void 0:e.right)||e.left+e.width,width:e.width,height:e.height}},e.empty={top:0,left:0,bottom:0,right:0,width:0,height:0,kind:"clientPoint"}}(a||(a={})),function(e){e.create=function(e){return e}}(o||(o={}))},65754:(e,t,i)=>{i.d(t,{N:()=>n});var n,s=i(8867),r=i(62552),a=i(36344),o=i(9642),l=i(93790),c=i(24666),h=i(8794),d=i(59179),u=i(79992);class p{constructor(e,t,i){this._getImmediateValue=e,this._source=t,this._compare=i,this._subject=null,this.behavior=new s.y((e=>{const t=this._source.subscribe(e);return{unsubscribe:()=>{t.unsubscribe(),this._subject=null}}})).pipe((0,o.O)((()=>(this._subject=new r.X(this._getImmediateValue()),this._subject))),(0,l.x)(),(0,c.x)(this._compare)),this.changes=this.behavior.pipe((0,h.T)(1)),this.getCurrent=this._getImmediateValue}getApproximate(){return this._subject?this._subject.getValue():this._getImmediateValue()}map(e,t=u.fS){return new p((()=>e(this._getImmediateValue())),this.changes.pipe((0,d.U)(e)),t)}}!function(e){function t(e,t,i){return new p(e,t.pipe((0,d.U)(e)),i)}e.create=t,e.createOptimized=function(e,t,i){return new p(e,t.pipe((0,d.U)((t=>void 0!==t?t:e()))),i)},e.constant=function(e){return t((()=>e),(0,a.c)(),(()=>!0))}}(n||(n={}))},72779:(e,t,i)=>{if(i.d(t,{Bi:()=>y,E6:()=>p,Jj:()=>l,Me:()=>o,Qf:()=>S,XQ:()=>h,Yd:()=>d,a9:()=>m,bp:()=>u,f0:()=>b,is:()=>g,kW:()=>v,o:()=>c,wr:()=>f}),6168!=i.j)var n=i(73104);const s=new Set(["absolute","relative","fixed","sticky"]),r=new Set(["strict","content","layout","paint"]),a=new Set(["flex","inline-flex"]);function o(e){const t=e.ownerDocument;if(t)return t;throw new Error("target does not have ownerDocument")}function l(e){const t=o(e).defaultView;if(t)return t;throw new Error("active document is detached from a window")}function c(e){return l(e).getComputedStyle(e)}function h(e){return s.has(c(e).position)}function d(e,t){const i=s.has(t.position);return!i&&null!==t.zIndex&&"auto"!==t.zIndex&&e.parentElement?a.has(c(e.parentElement).display):i}function u(e){const t=o(e).body;if(e===t)throw new Error("target is body");let i=e;do{if(i=i.parentElement,i&&h(i))return i}while(null!==i&&i!==t);return i||t}function p(e,t){var i,s,r,a;const l=o(e).body;if(e===l)throw new Error("target is body");const c=(0,n.Cq)(l.parentElement);let h=e;do{if(h=null!==(a=null!==(s=null!==(i=h.assignedSlot)&&void 0!==i?i:h.parentElement)&&void 0!==s?s:null===(r=h.getRootNode())||void 0===r?void 0:r.host)&&void 0!==a?a:null,h&&t(h))return h}while(null!==h&&h!==c);return h||c}function g(e){return p(e,(e=>{return h(e)||(t=e,r.has(c(t).contain));var t}))}function m(e){return function(e){const t=c(e);return"auto"===t.overflow||"scroll"===t.overflow||"auto"===t.overflowY||"scroll"===t.overflowY}(e)||function(e){const t=c(e);return"auto"===t.overflow||"scroll"===t.overflow||"auto"===t.overflowX||"scroll"===t.overflowX}(e)}function f(e,t){for(let i=e;null!=i;i=i.parentElement)if(t(i))return i;return null}function v(e){const t=e.ownerDocument,i=t&&t.defaultView;if(!t||!i)return;const n=t.body.scrollLeft,s=t.body.scrollTop,r=i.scrollY,a=i.scrollX;e.focus(),r===i.scrollY&&a===i.scrollX||i.scroll(a,r),s!==t.body.scrollTop&&(t.body.scrollTop=s),n!==t.body.scrollLeft&&(t.body.scrollLeft=n)}const _=e=>e?1/e:1,b=(e,t)=>{if(!e)return;const i=S(self.getComputedStyle(e));if(!i)return;const n=_(Number(i.x)),s=_(Number(i.y));return{transform:`translate(${t.left*(n-1)}px, ${t.top*(s-1)}px) scale(${n}, ${s})`,transformOrigin:e.style.transformOrigin}};function S(e){if(e.transform&&"none"!==e.transform){const t=/scale\(([\d.]+)(?:, ([\d.]))*\)|matrix\(([\d.]+), [\d.]+, [\d.]+, ([\d.]+), [\d.]+, [\d.]+\)/.exec(e.transform);if(t){const[e,i,n,s,r]=t;return{x:i||s,y:n||r||i}}}}function y(e){try{const t=new DOMMatrixReadOnly(e.transform);return{x:t.e,y:t.f}}catch(e){return}}},10712:(e,t,i)=>{i.d(t,{Z:()=>r});var n=i(87234),s=i(30033);function r(e,t,i){return s.UL.setPosition(n.Ir.fromOffsetPoint(e,t,i),e)}},57536:(e,t,i)=>{if(i.d(t,{By:()=>x,FJ:()=>v,RV:()=>w,Ti:()=>g,We:()=>_,Yq:()=>C,_i:()=>b,bk:()=>I,dk:()=>A,kP:()=>S,nX:()=>p,tQ:()=>f,x$:()=>y}),6168!=i.j)var n=i(44071);if(6168!=i.j)var s=i(64271);if(6168!=i.j)var r=i(59179);if(6168!=i.j)var a=i(24666);if(6168!=i.j)var o=i(16703);if(6168!=i.j)var l=i(87234);if(6168!=i.j)var c=i(91795);if(6168!=i.j)var h=i(79992);var d=i(70874);if(6168!=i.j)var u=i(65754);function p(e){return[(0,n.R)(e,"scroll"),(0,n.R)(e,"mousewheel"),(0,n.R)(e,"touchmove")]}function g(e){return(0,s.T)(...p(e),c.x.create(e,{attributes:!1,childList:!0,subtree:!0,characterData:!0}),(0,n.R)(e,"keydown"),(0,n.R)(e,"keyup"))}function m(e){const t=getComputedStyle(e).zIndex,i="auto"!==t&&parseInt(t||"0",10)||null;return null!==i?i:e.parentNode&&e.parentNode.nodeType===Node.ELEMENT_NODE?m(e.parentNode):null}function f(e){return{left:parseFloat(e.paddingLeft)||0,top:parseFloat(e.paddingTop)||0,right:parseFloat(e.paddingRight)||0,bottom:parseFloat(e.paddingBottom)||0}}const v=d.S.hz4,_=d.S.sec2,b=d.S.hz30;function S(e,t){const i=e.height-t.bottom-t.top,n=e.width-t.left-t.right;return o.V.getGButtonSize(n,i)}function y(e,t=0,i=e.container,n={top:0,left:0}){return{zIndex:e.zIndex.map((e=>e+1),h.fS),position:e.textFieldRect.behavior.pipe(r.U((e=>{const i=Math.max(e.padding.right,t),s=Math.max(e.padding.bottom,t);return{...l.Cv.create({top:e.position.top+e.height-s+n.top,left:e.position.left+e.width-i+n.left}),effectivePadding:{right:i,bottom:s,left:e.padding.left,top:e.padding.top},textFieldHeight:e.height,textFieldWidth:e.width}})),a.x(h.fS)),container:i}}function w(e){return u.N.create((()=>(m(e)||0)+1),_,h.fS)}function A(e,t){return I(e,t,(e=>e))}function I(e,t,i){const n=[];let s=0,r=e;for(;r.parentElement&&s!==t;)n.push(i(r.parentElement)),r=r.parentElement,s++;return n}function C(e,t){let i=0,n=e;for(;i<t&&n.parentElement;)n=n.parentElement,i++;return i<t?null:n}function x(e,t){return(0,s.T)(...A(e,t).map((e=>(0,n.R)(e,"scroll"))))}},41847:(e,t,i)=>{var n,s;i.d(t,{V:()=>n,j:()=>s}),function(e){e.success="success",e.fail="fail",e.applied="applied"}(n||(n={})),function(e){e.success=function(e){return{result:n.success,context:e}},e.fail=function(e,t){return{result:n.fail,reason:e,context:t}},e.applied=function(e){return{result:n.applied,context:e}},e.isFail=function(e){return e.result===n.fail},e.isSuccess=function(e){return e.result===n.success},e.isApplied=function(e){return e.result===n.applied},e.fromResult=function(t,i){return n=>n?e.applied(i):e.fail(t,i)}}(s||(s={}))},68485:(e,t,i)=>{var n,s,r,a;i.d(t,{G6:()=>a,Ly:()=>r,P:()=>n,gO:()=>s}),function(e){e.assistant="assistant",e.autoapply="autoapply",e.autocomplete="autocomplete",e.autocorrect="autocorrect",e.iframe="iframe",e.inlineCard="inlineCard",e.inlineCardValidation="inlineCardValidation",e.proofit="proofit",e.sidebar="sidebar",e.snippets="snippets",e.synonyms="synonyms",e.gOsSkillApplet="gOsSkillApplet",e.vbar="vbar",e.hbar="hbar",e.oggyGenAI="oggyGenAI",e.oggyRevision="oggyRevision",e.oggyRevisionDelayed="oggyRevisionDelayed",e.oggyRevisionSequential="oggyRevisionSequential",e.gOSAssistantApplet="gOSAssistantApplet",e.g2="g2",e.connector="connector",e.touchTypist="touchTypist",e.inkwell="inkwell"}(n||(n={})),function(e){e.validation="validation",e.execution="execution",e.afterApply="afterApply"}(s||(s={})),function(e){e.performReplacement="performReplacement",e.canPerformReplacement="canPerformReplacement",e.performBatchReplacements="performBatchReplacements",e.insertAtCurrentSelection="insertAtCurrentSelection"}(r||(r={})),function(e){e.single="single",e.batch="batch"}(a||(a={}))},21220:(e,t,i)=>{i.d(t,{Ks:()=>l,MY:()=>d,NR:()=>h,QC:()=>a,SS:()=>o,Sc:()=>u,Uo:()=>p,ck:()=>c,jw:()=>g});var n=i(4603),s=i(72779),r=i(4798);const a={ruleName:"isNotReadonly",match:(e,t)=>!t.field.hasAttribute("readonly")},o={ruleName:"isNotBlocked",match:(e,t)=>!t.field.hasAttribute("data-block-extension")},l={ruleName:"isNotDisabled",match:(e,t)=>!t.field.hasAttribute("disabled")},c={ruleName:"isNotRTL",match:(e,t)=>"rtl"!==(0,s.o)(t.field).direction},h={ruleName:"isNotSearchField",match:(e,t)=>!("search"===t.field.getAttribute("type")||(0,n.OB)().experimentClient.isGateEnabled(r.K.SkipRoleSearchbox)&&"searchbox"===t.field.role)},d="data-grammarly-part",u={ruleName:"isNotOurField",match:(e,t)=>null===t.field.closest(`[${d}]`)};function p(e=35,t=250){return{ruleName:"isMinSize",match:(i,n)=>n.field.clientHeight>=e&&n.field.clientWidth>=t}}function g(e){return{ruleName:"isMinHeight",match:(t,i)=>i.field.clientHeight>=e}}},83895:(e,t,i)=>{i.d(t,{D1:()=>r,Oe:()=>s,fr:()=>n});var n,s,r,a=i(86399),o=i(39953),l=i(31854),c=i(58303),h=i(32228),d=i(59060),u=i(39743);!function(e){e.create=function(e){return{type:l.lY.Type.sduiCardAction,sourceId:"native",cardId:"",actions:e,scope:{alertRefs:[]}}}}(n||(n={})),function(e){e.create=function(e,t,i="inline",n={alertRefs:[]}){return{type:l.lY.Type.sduiCardAction,sourceId:i,cardId:t,actions:e,scope:n}}}(s||(s={})),function(e){function t(e,t){return h.a.find((e=>e.id.toString()===t))(e)}function i(e,t){return h.a.find((e=>e.content.type===t))(e)}let n,s,r,l,p,g,m,f,v,_;e.getById=t,e.findAllByType=i,e.getByAlertId=function(e,t){return h.a.find((e=>{const i=d.ab.getAllAlertIds(e.content);return 1===i.length&&i[0]===t}))(e)},function(e){e.BulkDismiss="bulk_dismiss",e.BulkAccept="bulk_accept"}(n=e.Features||(e.Features={})),function(e){e.isInlineCard=e=>(0,o.zG)(d.ab.findFirst(e,"inlineCard",d.ab.TreeTraversal.PreOrder),c.pC)}(s=e.InlineCard||(e.InlineCard={})),function(e){e.isPopoverStack=e=>(0,o.zG)(d.ab.findFirst(e,"popoverStack",d.ab.TreeTraversal.PreOrder),c.pC)}(r=e.PopoverStack||(e.PopoverStack={})),function(e){function t(e){return"strongAlertRef"===e.type}function i(e){var i;return t(e)&&"known"===(null===(i=e.name)||void 0===i?void 0:i.kind)&&e.name.value===u.MU.StrongAlertRefBulkDismiss}function n(e){return h.a.find((e=>i(e.content)))(e)}function s(e){var i;return t(e)&&"known"===(null===(i=e.name)||void 0===i?void 0:i.kind)&&e.name.value===u.MU.StrongAlertRefUpgradeHook}e.isStrongAlertRefContent=t,e.isStrongAlertRefBulkDismissContent=i,e.isStrongAlertRefBulkAcceptContent=function(e){var i;return t(e)&&"known"===(null===(i=e.name)||void 0===i?void 0:i.kind)&&e.name.value===u.MU.StrongAlertRefBulkAccept},e.findStrongAlertRefBulkDismissSduiItem=n,e.getStrongAlertRefBulkDismissAlertIds=function(e){return(0,o.zG)(n(e),c.UI((e=>new Set(e.alertIds.map((e=>e.toString()))))),c.fS((()=>new Set)))},e.isStrongAlertRefUpgradeHookContent=s,e.findStrongAlertRefUpgradeHookSduiItem=function(e){return h.a.find((e=>s(e.content)))(e)}}(l=e.StrongAlertRef||(e.StrongAlertRef={})),function(e){function n(e){return"gButton"===e.type}function s(t){return t.type===e.PLAGIARISM_TYPE}function r(e,i){return(0,o.zG)(t(e,i),c.UI((e=>e.content)),c.hX(n))}e.DEFAULT_GBUTTON_ID="gButton-default",e.TONE_GBUTTON_ID="gButton-tone",e.GET_STARTED_GBUTTON_ID="gButton-get-started",e.PLAGIARISM_TYPE="gButton:plagiarism",e.isGButtonContent=n,e.isGButtonPlagiarismContent=s,e.getContent=r,e.getPlagiarismContent=function(t){return(0,o.zG)(i(t,e.PLAGIARISM_TYPE),c.UI((e=>e.content)),c.hX(s))},e.getPushAssistantFeedAction=function(e,t){return(0,o.zG)(r(e,t),c.UI((e=>e.actions)),c.tS((e=>c.ij(e.find(m.isPushAssistantFeedAction)))))}}(p=e.GButton||(e.GButton={})),function(e){e.isViewStackContent=function(e){return"viewStack"===e.type},e.getSelectedContent=function(e){return c.ij(e.views[e.selected])}}(g=e.ViewStack||(e.ViewStack={})),function(e){function i(e){return"assistantFeed"===e.type}let n;e.BULK_DISMISS_CARD_FEED_ID="bulk-dismiss-card-feed",e.BULK_DISMISS_REVIEW_FEED_ID="bulk-dismiss-review-feed",e.TONE_INSIGHTS_CARD_FEED_ID="tone-insights-card-feed",e.TONE_INSIGHTS_SUGGESTIONS_FEED_ID="tone-insights-suggestions-feed",e.PERFORMANCE_SCORE_FEED="performance-score-feed",e.isAssistantFeedContent=i,e.getContent=function(e,n){return(0,o.zG)(t(e,n),c.UI((e=>e.content)),c.hX(i))},e.createFocusAssistantCardAction=function(e){return{type:"focusAssistantCard",cardId:e}},e.createPopAssistantFeedAction=function(){return{type:"popAssistantFeed"}},e.createPushAssistantFeedAction=function(e,t){return{type:"pushAssistantFeed",feedId:e,cardId:t}},e.isPushAssistantFeedAction=function(e){return"pushAssistantFeed"===e.type},function(t){function i(e){return(0,o.zG)(c.G(d.ab.reduce(e,((e,t)=>"button"===t.type&&"back"===t.name.value?e.concat(t.actions):e),d.ab.TreeTraversal.PostOrder,[])),c.hX(a.Od))}function n(e,i){return(0,o.zG)(t.getContent(e,i),c.tS(g.getSelectedContent))}t.getContent=function(t,i){return(0,o.zG)(e.getContent(t,i),c.UI((e=>e.header)),c.hX(g.isViewStackContent))},t.getBackButtonActions=i,t.getSelectedViewContent=n,t.getSelectedViewBackButtonActions=function(e,t){return(0,o.zG)(n(e,t),c.tS(i))}}(n=e.Header||(e.Header={}))}(m=e.AssistantFeed||(e.AssistantFeed={})),function(e){function i(e){return"proofitButton"===e.type}e.ID="proofit-button",e.isProofitContent=i,e.getContent=function(e,n){return(0,o.zG)(t(e,n),c.UI((e=>e.content)),c.hX(i))}}(f=e.Proofit||(e.Proofit={})),function(e){e.ID="upgrade_hook",e.findUpgradeHookSduiItem=function(i){return t(i,e.ID)}}(v=e.NativeUpgradeHook||(e.NativeUpgradeHook={})),function(e){e.ID="success_report",e.SUCCESS_REPORT_CARD_ID="success_report@Short-known:card-assistantCard",e.SUCCESS_REPORT_WITH_PERFORMANCE_SCORE_CARD_ID="success-report-with-performance-score@Short-known:card-assistantCard",e.SUCCESS_REPORT_WITH_QUALITY_SCORE_CARD_ID="success-report-with-quality-score@Short-known:card-assistantCard",e.OPEN_PERFORMANCE_SCORE_INTERACTION_ID="success-state-known:open-performance-score",e.findSuccessReportSduiItem=function(i){return t(i,e.ID)}}(_=e.SuccessReport||(e.SuccessReport={}))}(r||(r={}))},18300:(e,t,i)=>{function n(e){return e.length>0?e[0]:null}function s(e){return 1===e.length?e[0]:null}function r(e){return 1===e.length?e[0]:e.length>0?e.reduce(((e,t)=>t.start===t.end?e:e.start===e.end?t:{start:Math.min(e.start,t.start),end:Math.max(e.end,t.end)})):null}i.d(t,{Ey:()=>n,Ls:()=>r,qq:()=>s})},94824:(e,t,i)=>{i.d(t,{H:()=>n});var n,s=i(56424),r=i(13391);!function(e){const t=r.h.create(""),i=new Proxy({textContent:""},{get:(e,i)=>"textContent"===i?t.get():Reflect.get(e,i),set:(e,i,n)=>"textContent"===i&&"string"==typeof n?(t.set(n),!0):Reflect.set(e,i,n)});e.init=function(){s.ux.setStylesTarget(i)},e.styles=t.view()}(n||(n={}))},97310:(e,t,i)=>{i.d(t,{YS:()=>f,mE:()=>g,nS:()=>n});var n,s=i(49231),r=i(32073),a=i(13391),o=i(37213),l=i(1208),c=i(94824),h=i(34967);!function(e){e.Context=s.createContext(null)}(n||(n={}));class d{constructor(){this._denaliStyleSheet=new CSSStyleSheet,this._globalStyleSheet=new CSSStyleSheet,this._globalStyleSheetLoaded=a.h.create(null),this._subscription=new r.w0}inject(e,t){const i=this._globalStyleSheetInitialized();i||this._initGlobalStyleSheet();const r=e.attachShadow({mode:"open"});r.adoptedStyleSheets=[this._denaliStyleSheet,this._globalStyleSheet];const a=(0,h.X3)(r,s.createElement(n.Context.Provider,{value:r},s.createElement(t,{viewLoaded:this._globalStyleSheetLoaded.view((e=>({...e,constructableStyleSheetInitialized:i})))})));return()=>{a(),this._subscription.unsubscribe()}}_globalStyleSheetInitialized(){return this._globalStyleSheet.cssRules.length>0}async _initGlobalStyleSheet(){try{if(!self.GR_INLINE_STYLES)throw new Error("No inline styles");await Promise.all([this._denaliStyleSheet.replace(c.H.styles.get()),this._globalStyleSheet.replace(self.GR_INLINE_STYLES)]),this._globalStyleSheetLoaded.set({stylesInjectionStrategy:"constructableStyleSheet"}),this._subscription.add(c.H.styles.subscribe((e=>this._denaliStyleSheet.replaceSync(e))))}catch(e){this._globalStyleSheetLoaded.set({error:`${e}`,stylesInjectionStrategy:"constructableStyleSheet"})}}}const u=(0,o.xb)(l.b);class p{inject(e,t){const i=a.h.create(null),r=e.attachShadow({mode:"open"});return(0,h.X3)(r,s.createElement(s.Fragment,null,s.createElement(u,null,c.H.styles),s.createElement(l.b,null,self.GR_INLINE_STYLES),s.createElement(n.Context.Provider,{value:r},s.createElement(t,{viewLoaded:i}))),(()=>i.set({stylesInjectionStrategy:"styleElement"})))}}class g{inject(e,t){const i=a.h.create(null),r=e.attachShadow({mode:"open"});return(0,h.X3)(r,s.createElement(s.Fragment,null,s.createElement(n.Context.Provider,{value:r},s.createElement(t,{viewLoaded:i}))),(()=>i.set({stylesInjectionStrategy:"noStyles"})))}}let m=null;function f(e=!1){return e&&function(){if(null===m)try{const e=new CSSStyleSheet;m=!!e&&!!e.replace&&!!e.replaceSync&&"adoptedStyleSheets"in Document.prototype}catch(e){m=!1}return!0===m}()?new d:new p}},34967:(e,t,i)=>{i.d(t,{G7:()=>f,X3:()=>g});var n=i(49231),s=i(64151),r=i(84714),a=i(2613),o=i(14969),l=i(29479),c=i(954),h=i(24666),d=i(59179),u=i(47387);function p(e){return!!e&&!e.error}function g(e,t,i){return(0,s.render)(t,e,i),()=>(0,s.unmountComponentAtNode)(e)}const m=({view:e,placeholder:t,viewLoaded:i,minDuration:s,forcePlaceholder:h})=>{const d=p(i.get())&&!h?(0,r.of)(e):i.pipe((0,a.e)(s),(0,o.P)(p),(0,l.h)(e),(0,c.O)(t));return n.createElement(u.F.Fragment,null,d)};var f;!function(e){e.showWhenLoaded=function(e){return function({viewLoaded:t}){return n.createElement(u.F.Fragment,null,t.pipe((0,h.x)(),(0,d.U)((t=>p(t)?e:null))))}},e.withPlaceholder=function(e,t,i,s){return function({viewLoaded:r}){return n.createElement(m,{view:e,placeholder:t,minDuration:i||0,viewLoaded:r,forcePlaceholder:s||!1})}}}(f||(f={}))},58454:(e,t,i)=>{if(i.d(t,{LJ:()=>f,Nd:()=>o,Ov:()=>m,TW:()=>S,Ur:()=>l,Xs:()=>y,e$:()=>_,eg:()=>b,fN:()=>d,k6:()=>p,kh:()=>h,lW:()=>v,lz:()=>u,qg:()=>a,uj:()=>r,uz:()=>g}),3075==i.j)var n=i(73104);if(6168!=i.j)var s=i(91901);function r(e){const t=(0,n.Cq)(e.querySelector(s.XG),"text buffer iframe");return(0,n.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function a(e){const t=o(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function o(e){return e.querySelector(s.Wp)}function l(e,t,i){return t?function(e,t){if(t&&c(t))return t;const i=e.querySelectorAll(s.Qy);for(const e of i)if(c(e))return e;return null}(e,i):e.querySelector(s.Qy)}const c=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function h(e){return e.querySelectorAll(s.gH)}function d(e){return e.querySelector(s.gH)}function u(e){return Boolean(e.querySelector(s.gH))}function p(e){let t=e.querySelector(s.os);return t||(t=document.querySelector(s.gH)),t?t.getBoundingClientRect():null}const g=e=>!!e.querySelector(s.Lq);function m(e){return e.querySelector(s.$x)}function f(e){return null==e?void 0:e.querySelector(s.y1)}function v(e){const t=e.querySelector(s.f);return!!t&&t.offsetHeight>0}function _(e){return!!e.querySelector(`${s.jW}, ${s.F8}`)}function b(){const e=document.querySelector(s.d0),t=(null==e?void 0:e.classList.contains(s.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(s._m))?"suggesting":void 0;return t||i||"other"}function S(e){return e.querySelector(s.QR)}function y(e){return e.querySelector(s.ij)}},91901:(e,t,i)=>{i.d(t,{$x:()=>a,F8:()=>m,Go:()=>s,Kt:()=>y,Lq:()=>c,QR:()=>E,Qy:()=>v,Vk:()=>w,Wp:()=>n,XG:()=>r,_m:()=>u,d0:()=>h,f:()=>l,gH:()=>f,gL:()=>A,ij:()=>x,j5:()=>S,jW:()=>g,l$:()=>p,lO:()=>C,os:()=>b,rx:()=>I,uj:()=>d,y1:()=>o,yw:()=>_});const n=".kix-appview-editor",s=".docos-input",r=".docs-texteventtarget-iframe",a=".kix-cursor",o=".kix-cursor-caret",l="#docs-revisions-sidebar",c='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',h="#docs-toolbar-mode-switcher",d="edit-mode",u="suggest-mode",p="titlebar-mode-indicator-container",g="#titlebar-mode-indicator-container .titlebar-request-access-button",m="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",v=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",_=".kix-page-paginated",b=".kix-page-paginated.canvas-first-page",S=".docs-horizontal-ruler",y=".docs-vertical-ruler",w="#fontSizeSelect input",A=".docs-ruler-background",I=".docs-ruler-background-inner",C=".docs-ruler-indent-first-line",x=".modal-dialog.docs-dialog .fatal-error-message",E='#docs-titlebar-share-client-button div[role="button"]'},76193:(e,t,i)=>{var n;i.d(t,{X:()=>n}),function(e){e.modern="modern",e.legacy="legacy"}(n||(n={}))},78285:(e,t,i)=>{i.d(t,{Q:()=>l});var n=i(49231),s=i(24858),r=i(68545),a=i(62552),o=i(58303);const l=({children:e,remSize:t,setter:i})=>(c+=1,n.useEffect((()=>{const e=t.subscribe((e=>{h.next(o.G(e)),i(o.G(e))}));return()=>{e.unsubscribe(),c-=1,0===c&&(h.next(o.YP),i(o.YP))}}),[t]),n.createElement(s.u.Context.Provider,{value:h.pipe(r.oA)},e));let c=0;const h=new a.X(o.YP)},22342:(e,t,i)=>{i.d(t,{WR:()=>b,th:()=>v});var n=i(18117),s=i(39953),r=i(58303),a=i(52303);if(3075==i.j)var o=i(59833);if(3075==i.j)var l=i(4603);if(3075==i.j)var c=i(39390);if(3075==i.j)var h=i(30033);if(3075==i.j)var d=i(87234);var u=i(58454);if(3075==i.j)var p=i(25079);if(3075==i.j)var g=i(4798);var m=i(91901);const f={getCursorRect:()=>(0,s.zG)(r.ij(document.querySelector(m.y1)),r.UI((e=>e.getBoundingClientRect())),r.WG),getCanvasRect:(e,t)=>t?(0,u.k6)(e):(0,s.zG)(r.ij(document.querySelector(m.os)),r.wp((()=>r.ij(document.querySelector(m.gH)))),r.UI((e=>e.getBoundingClientRect())),r.WG),getFirstLineIndentEl:e=>e.querySelector(m.lO),getFontSizeInputEl:()=>document.querySelector(m.Vk),getRulerBackgroundsRects:e=>(0,s.zG)(n.Yt(r.Kw)({backgroundRect:(0,s.zG)(r.ij(e.querySelector(m.gL)),r.UI((e=>e.getBoundingClientRect()))),innerBackgroundRect:(0,s.zG)(r.ij(e.querySelector(m.rx)),r.UI((e=>e.getBoundingClientRect())))}),r.WG),withVisibleRulers:e=>{const t=(0,s.zG)(n.Yt(r.Kw)({horizontalRuler:r.ij(document.querySelector(m.j5)),verticalRuler:r.ij(document.querySelector(m.Kt))}),r.UI((({horizontalRuler:e,verticalRuler:t})=>({horizontalRuler:{node:e,opacity:e.style.opacity,display:e.style.display},verticalRuler:{node:t,opacity:t.style.opacity,display:t.style.display}}))),a.bw((({horizontalRuler:e,verticalRuler:t})=>{"none"===e.display&&(e.node.style.opacity="0",e.node.style.removeProperty("display")),"none"===t.display&&(t.node.style.opacity="0",t.node.style.removeProperty("display"))})));try{return e((0,s.zG)(t,r.UI((({verticalRuler:e})=>e.node)),r.WG),(0,s.zG)(t,r.UI((({horizontalRuler:e})=>e.node)),r.WG))}finally{(0,s.zG)(t,a.bw((({horizontalRuler:e,verticalRuler:t})=>{e.node.style.display=e.display,e.node.style.opacity=e.opacity,t.node.style.display=t.display,t.node.style.opacity=t.opacity})))}}};class v{constructor(e,t,i=f){this._layoutRoot=e,this._telemetry=t,this._gDocsDOM=i,this._refactorGetCanvasRectEnabled=(0,l.OB)().experimentClient.isGateEnabled(g.K.GdocsRefactorDomQuery),this._returnAllRects=(0,l.OB)().experimentClient.isGateEnabled(g.K.GdocsReturnAllRects)}create(e,t){try{if(t.isEmpty()&&0===e.start&&0===e.end)return{rects:(0,s.zG)(r.ij(t.getPageContainingOffset(0)),r.tS((e=>(0,s.zG)(r.ij(this._gDocsDOM.getCursorRect()),r.hX((e=>e.left>0&&e.top>0&&e.height>0)),r.tS((e=>n.Yt(r.Kw)({rect:r.G(e),canvasRect:r.ij(this._gDocsDOM.getCanvasRect(this._layoutRoot,this._refactorGetCanvasRectEnabled))}))),r.UI((({rect:t,canvasRect:i})=>[h.Wm.create(h.UL.shift(h.UL.shift(h.Pf.create(t),d.E9.minus({left:0,top:0},i)),e.getPageRect()))])),r.wp((()=>r.ij(this._gDocsDOM.withVisibleRulers(((t,i)=>(0,s.zG)(n.Yt(r.Kw)({horizontalRuler:r.ij(i),verticalRuler:r.ij(t),lineHeight:(0,s.zG)(r.ij(this._gDocsDOM.getFontSizeInputEl()),r.UI((e=>parseInt(e.value,10))),r.hX((e=>!isNaN(e))),r.UI((e=>1.533*e)))}),r.tS((({horizontalRuler:e,verticalRuler:t,lineHeight:i})=>n.Yt(r.Kw)({firstLineIndent:(0,s.zG)(r.ij(this._gDocsDOM.getFirstLineIndentEl(e)),r.UI((e=>e.offsetLeft+e.offsetWidth/2))),topMargin:(0,s.zG)(r.ij(this._gDocsDOM.getRulerBackgroundsRects(t)),r.UI((({backgroundRect:e,innerBackgroundRect:t})=>t.top-e.top+i)))}))),r.UI((({firstLineIndent:t,topMargin:i})=>[h.Wm.create(h.UL.shift({left:t,top:i,height:0,width:0},e.getPageRect()))])),r.WG))))))))),r.fS((()=>[])))};const i=[];let a,o=e.start,l=!1;const c=t.getPlainText().length;do{const n=t.getFragmentAtOffset(o);if(n&&a!==o){a=o;const t=n.getFragmentInnerRect(o>n.startOffset?o-n.startOffset:0,e.end<n.endOffset?e.end-n.startOffset:void 0),s=n.getPage(),r=s.getPageRect(),l=h.Wm.create(h.UL.shift(_(t,s.getPageInnerSize(),r),r));i.push(l),o=n.endOffset}else this._returnAllRects?(o++,l=o>=c):l=!0}while(o<e.end&&!l);return{rects:i}}catch(e){throw this._telemetry.error("geometryProvider","exception in create method",e),e}}getClientRects(e){try{const t=this._layoutRoot.getClientRects().item(0);if(t){const i={top:this._layoutRoot.scrollTop,left:this._layoutRoot.scrollLeft};return(0,s.zG)(e.rects,c.es,c.yX,o.UI((e=>h.UL.setPosition(d.Ir.fromOffsetPoint(d.p8.create(e),d.Ir.create(t),i),e))))}return null}catch(e){return this._telemetry.error("geometryProvider","exception in getClientRects method",e),null}}getIsInvalid(e){return!1}getIsConsistent(e,t,i){return!0}dispose(e){}}function _(e,t,i){const n=i.width/t.width,s=i.height/t.height;return{left:e.left*n,top:e.top*s,width:e.width*n,height:e.height*s}}function b(e,t,i){const n=t.width/i.width,s=t.height/i.height;return(0,p.cl)({left:e.left*n,top:e.top*s,width:e.width*n,height:e.height*s})}},49650:(e,t,i)=>{i.d(t,{z:()=>m});var n=i(74822),s=i(50750),r=i(63532),a=i(20161),o=i(84178),l=i(90572),c=i(44045),h=i(29479),d=i(36344),u=i(954),p=i(59179),g=i(24335);function m(e,t,i,m=3e3){const f=new n.x,v=new n.x;const _=f.pipe(a.w((t=>null==t?d.E:e.contentChanges.async.pipe(u.O(0),c.R(v.pipe(p.U((e=>e===t)))),c.R(i),h.h(t),c.R(g.HT(m).pipe(r.b((e=>{})))))))).subscribe((i=>{const n=e.getCurrentTextMap(),s=n.getNearestPageFragmentAtOrBeforeOffset(i);if(s){if(s.startOffset<=i&&s.endOffset>=i)return void v.next(i);if(s.endOffset<i){const e=s.getPageRect(),i=t.visibleRect.getApproximate(),n=t.rect.getApproximate().client.top+e.top+e.height-i.client.top-i.size.height;if(n>0)return void requestAnimationFrame((()=>{t.scroller.scrollBy({left:0,top:n})}))}}const r=n.getNearestPageFragmentAfterOffset(i);if(r&&r.startOffset>i){const e=r.getPageRect(),i=t.visibleRect.getApproximate(),n=t.rect.getApproximate().client.top+e.top-i.client.top;if(n<0)return void requestAnimationFrame((()=>{t.scroller.scrollBy({left:0,top:n})}))}}));return{scrollToRect:function(e,i){f.next(null);const n=t.visibleRect.getApproximate();i<=e.top&&e.bottom<=i+n.size.height||t.scroller.scrollBy({top:e.top-i-100})},scrollToRange:function(e){return s.D([0]).pipe(r.b((()=>f.next(e))),a.w((e=>v)),o.q(1),l.h((t=>t===e)),c.R(f.pipe(l.h((t=>t!==e)))),h.h(void 0))},dispose:function(){_.unsubscribe(),f.complete(),v.complete()}}}},89193:(e,t,i)=>{i.d(t,{U:()=>h});var n=i(57536);function s(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function r(e,t){return e<<t|e>>>32-t}const a=3432918353,o=461845907;class l{getHash(e,t=0){const i=(new TextEncoder).encode(e),n=i.length%4,l=i.length-n;let c,h=t,d=0;for(c=0;c<l;c+=4)h=s(r(h^s(r(s(i[c]|i[c+1]<<8|i[c+2]<<16|i[c+3]<<24,a),15),o),13),5)+3864292196;switch(d=0,n){case 3:d^=i[c+2]<<16;case 2:d^=i[c+1]<<8;case 1:d^=i[c],h^=s(r(s(d,a),15),o)}return u=s((u=h^i.length)^u>>>16,2246822507),((u=s(u^u>>>13,3266489909))^u>>>16)>>>0;var u}}var c;!function(e){e.preferred=l}(c||(c={}));const h=(e,t)=>{const i=(0,n.bk)(e,-1,(e=>e.nodeName)),s=`${t},${e.nodeName},${i.join()}`;return(new c.preferred).getHash(s).toString()}},82935:(e,t,i)=>{i.d(t,{J:()=>s});var n=i(6986);const s=new Proxy({},{get:(e,t)=>(...e)=>(0,n.OB)().bgRpc.api.trackGnar(t,e)})},50956:(e,t,i)=>{i.d(t,{Dg:()=>c,IQ:()=>u,e8:()=>h,fW:()=>d});var n=i(49231),s=i(63532),r=i(84714),a=i(90517),o=i(90107),l=i(9843);const c=n.createContext({state:r.of(l.h.create()),onMount:()=>{}});function h(){return n.useContext(c).onMount}function d(){const e=n.useContext(c).state,[t,i]=n.useState(l.h.create());return(0,o.A)(e.pipe((0,s.b)((e=>i(e))))),t}function u(){return n.useContext(c).state.pipe(a.j("dragging"))}},9843:(e,t,i)=>{var n;i.d(t,{h:()=>n}),function(e){e.create=function(){return{translate:{x:0,y:0},lastTranslate:{x:0,y:0},dragging:!1,dragStart:!1,dragEnd:!1}}}(n||(n={}))},54961:(e,t,i)=>{i.d(t,{_:()=>P});var n=i(49231),s=i(63532),r=i(26573),a=i(90107),o=i(48667),l=i(9843),c=i(50956),h=i(90023),d=i(62552),u=i(84308),p=i(59179),g=i(90572),m=i(74081),f=i(92242),v=i(84714),_=i(55341),b=i(32734),S=i(24666),y=i(20161),w=i(44071),A=i(44045),I=i(84908),C=i(10883),x=i(17610),E=i(3199),R=i(72779),k=i(79992);function T(e=v.of((e=>e)),t){const i=n.useRef(new _.t(1)),r=n.useRef(i.current.pipe(function(e=v.of(h.yR),t=(()=>!0)){return(0,h.ls)(g.h(k.fQ),S.x(),y.w((i=>w.R(i,"mousedown").pipe(g.h((e=>!e.button)),g.h((e=>t(e))),s.b((e=>e.preventDefault())),p.U((e=>({element:i,startPos:{x:e.clientX,y:e.clientY}}))),y.w((t=>w.R((0,R.Jj)(t.element),"mousemove").pipe(A.R(w.R((0,R.Jj)(t.element),"mouseup",{capture:!0})),I.p(10),p.U((({clientX:e,clientY:i})=>({kind:"dragInProgress",element:t.element,startPos:t.startPos,delta:{x:e-t.startPos.x,y:i-t.startPos.y}}))),C.M(e),p.U((([e,t])=>({...e,delta:t(e.delta)}))),x.l({kind:"dragDone"}))))))),E.R(((e,t)=>"dragDone"===t.kind?{translate:e.translate,lastTranslate:e.translate,dragging:!1,dragStart:!1,dragEnd:e.dragging}:{dragging:!0,dragStart:!e.dragging,dragEnd:!1,lastTranslate:e.lastTranslate,translate:{x:t.delta.x+e.lastTranslate.x,y:t.delta.y+e.lastTranslate.y}}),l.h.create()))}(e,t),b.B())),a=n.useCallback((e=>i.current.next(e)),[i.current]);return[r.current,a]}const P=n.forwardRef((function({children:e,hasDragHandle:t,bounds:i,dragEventFilter:v,onChangeDragState:_},b){const S=n.useRef(null),y=(0,r.K)(i),[w,A]=function(e,t,i){const r=n.useRef(null),o=n.useRef(new d.X(null)),l=n.useRef(u.a([e,o.current]).pipe(p.U((([e,t])=>t&&e?(0,f.N)(t,e):h.yR)))),[c,v]=T(l.current,i);(0,a.A)(c.pipe(g.h((e=>e.dragStart)),s.b((()=>_())))),n.useEffect((()=>{var e;return t.current&&(null===(e=r.current)||void 0===e||e.disconnect(),r.current=m.N.getResizeObserver(_),r.current.observe(t.current)),()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.disconnect()}}),[t.current]);const _=()=>{t.current&&o.current.next(t.current.getBoundingClientRect())};return[c,v]}(y,S,v),[I,C]=n.useState(l.h.create()),x=n.useRef({state:w,onMount:A});(0,a.A)(w.pipe((0,s.b)((e=>{C(e),null==_||_(e)}))));const E={ref:(0,o.l)([b,S,...(0,o.O)(e)?[e.ref]:[]],t?void 0:A)};return n.createElement(c.Dg.Provider,{value:x.current},n.cloneElement("function"==typeof e?e(I):e,E))}))},92242:(e,t,i)=>{function n(e,t){const i=e.left<t.left?t.left:e.left+e.width>t.left+t.width?t.left+t.width-e.width:e.left,n=e.top<t.top?t.top:e.top+e.height>t.top+t.height?t.top+t.height-e.height:e.top;return{...e,left:i,top:n}}function s(e,t){return i=>{const s=n({left:e.left+i.x,top:e.top+i.y,width:e.width,height:e.height},t);return{x:s.left-e.left,y:s.top-e.top}}}i.d(t,{N:()=>s,m:()=>n})},92393:(e,t,i)=>{i.d(t,{J:()=>o});var n=i(44071),s=i(82935),r=i(51354),a=i(76271);class o{constructor({textField:e,kind:t,settings:i,handler:n}){this._subs=[],this._textField=e,this._kind=t,this._handler=n,this._initSettingSubscription(i),this._initKeydownListener()}_initSettingSubscription(e){e.subscribe((e=>{this._shortcut=e?e[this._kind]:(0,a.e)(this._kind)}))}_initKeydownListener(){this._subs.push((0,n.R)(this._textField,"keydown").subscribe((e=>{const t=this._shortcut;e.code===t.key&&r.uU.every((i=>t.modifiers.includes(i)===e.getModifierState(i)))&&r.QO.every((t=>!e.getModifierState(t)))&&(e.preventDefault(),this._handler(),s.J.keyboardShortcutShortcutTriggered(this._kind))})))}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}}},51354:(e,t,i)=>{i.d(t,{Hz:()=>r,O0:()=>a,OR:()=>o,QO:()=>s,uU:()=>n,wl:()=>l});const n=["Alt","AltGraph","CapsLock","Control","Meta","NumLock","ScrollLock","Shift"],s=["Fn","FnLock","Hyper","Super","Symbol","SymbolLock"],r={openAssistant:{mac:{key:"KeyG",modifiers:["Shift","Control","Meta"]},other:{key:"KeyG",modifiers:["Shift","Control","Alt"]}},closeAssistant:{mac:{key:"Escape",modifiers:[]},other:{key:"Escape",modifiers:[]}}},a='[data-grammarly-part="assistant-draggable-wrapper"],[data-grammarly-part="assistant-static-wrapper"]',o='[data-focus-id="empty-state"], button[data-name^="button:"]',l="button, [href], input, select, textarea"},76271:(e,t,i)=>{i.d(t,{e:()=>r});var n=i(6986),s=i(51354);function r(e){return s.Hz[e][(0,n.nD)()?"mac":"other"]}},76517:(e,t,i)=>{i.d(t,{KC:()=>h,Y4:()=>d,sX:()=>u});var n=i(49231),s=i(62552),r=i(24666),a=i(48667),o=i(74081),l=i(84714),c=i(87110);const h={top:-1e4,left:-1e4,flippedHorizontal:!1,flippedVertical:!1,width:0,height:0},d=n.createContext(l.of(h)),u=n.forwardRef((({children:e,anchorRect:t,anchorOrigin:i={vertical:"bottom",horizontal:"left"},elementOrigin:l={vertical:"top",horizontal:"left"},offset:u={horizontal:0,vertical:0},postRepositioningOffset:p,repositioning:g={horizontal:"translate",vertical:"flip"},anchorMargin:m={top:0,left:0,bottom:0,right:0},viewportMargin:f=16,viewportRect:v=(0,c.C7)(),stickToTarget:_=!0,onChangePosition:b},S)=>{const y=n.useRef(null),w=n.useRef(null),A=n.useRef(new s.X(h)),[I,C]=n.useState(A.current.value),x=[v.top,v.left,v.width,v.height,t.top,t.left,t.width,t.height,i.horizontal,i.vertical,l.horizontal,l.vertical,u.horizontal,u.vertical,null==p?void 0:p.horizontal,null==p?void 0:p.vertical,m.top,m.right,m.bottom,m.left,f,_];n.useEffect((()=>{const e=A.current.pipe((0,r.x)(((e,t)=>function(e,t){return Math.floor(e.top)===Math.floor(t.top)&&Math.floor(e.left)===Math.floor(t.left)&&Math.floor(e.width)===Math.floor(t.width)&&Math.floor(e.height)===Math.floor(t.height)}(e,t)))).subscribe((e=>{C(e),null==b||b(e)}));return()=>e.unsubscribe()}),[]);const E=()=>{var e,n;const s=null===(e=y.current)||void 0===e?void 0:e.clientWidth,r=null===(n=y.current)||void 0===n?void 0:n.clientHeight,a=(0,c.C7)();if(s&&r){const e=(0,c.kl)(s,r,a,t,i,l,m,{top:f,bottom:f,left:f,right:f},u,p,g,_);A.current.next({...e,width:s,height:r})}};n.useEffect((()=>{var e;return y&&y.current&&(null===(e=w.current)||void 0===e||e.disconnect(),w.current=o.N.getResizeObserver(E),w.current.observe(y.current)),()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.disconnect()}}),[y.current,...x]),n.useLayoutEffect((()=>{E()}),x);const R={ref:(0,a.l)([S,y,...(0,a.O)(e)?[e.ref]:[]])};return n.createElement(d.Provider,{value:A.current},n.cloneElement("function"==typeof e?e(I):e,R))}));u.displayName="Positioner"},77365:(e,t,i)=>{i.d(t,{o:()=>a});var n=i(49231),s=i(37213),r=i(7987);const a=n.forwardRef((function({children:e,className:t,...i},a){return n.createElement("div",{...i,...(0,s.Sh)(r.fontWrapper,t),ref:a},e)}))},47204:(e,t,i)=>{i.d(t,{d:()=>r,p:()=>a});var n=i(49231),s=i(94288);const r=n.createContext(s.Q),a=({children:e})=>n.createElement(r.Provider,{value:s.Q},e)},94288:(e,t,i)=>{i.d(t,{Q:()=>s});var n=i(62552);const s=new class{constructor(){this._currentRef=0,this._tooltipsSubject=new n.X(null),this.tooltips=this._tooltipsSubject.asObservable()}show(e){this.hide(this._currentRef);const t=e.showDelay||0;return this._timeoutHandler=setTimeout((()=>{this._tooltipsSubject.next(e)}),t),++this._currentRef}hide(e){e===this._currentRef&&(this.clearTimeout(),this._tooltipsSubject.next(null))}clearTimeout(){null!==this._timeoutHandler&&(clearTimeout(this._timeoutHandler),this._timeoutHandler=null)}}},51320:(e,t,i)=>{i.d(t,{u:()=>p});var n=i(49231),s=i(84308),r=i(954),a=i(29416),o=i(63532),l=i(88272),c=i(26573),h=i(90107),d=i(48667),u=i(47204);const p=n.forwardRef((function({children:e,message:t,position:i="top",showDelay:p=100,style:g,offset:m,disabled:f=!1,withGrammarlyIcon:v=!1,withCenteredGrammarlyIcon:_=!1,forcedMessage:b,onHideTooltip:S},y){const[w,A]=(0,l.Y)(),I=n.useRef(null),C=n.useContext(u.d),x=n.useRef(null),E=(0,c.K)(b),R=(0,c.K)(f),k=(0,c.K)(t),T=n.useCallback((()=>{x.current&&(C.hide(x.current),x.current=null,null==S||S())}),[]);n.useEffect((()=>{var e,t,i;return null===(i=null===(t=null===(e=I.current)||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i||i.addEventListener("scroll",T),()=>{var e,t,i;return null===(i=null===(t=null===(e=I.current)||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i?void 0:i.removeEventListener("scroll",T)}}),[I]);const P=(0,s.a)([w.pipe((0,r.O)(!1)),E,R,k]);(0,h.A)(P.pipe((0,a.b)(p),(0,o.b)((([e,t,n,s])=>{(e||t)&&!n&&null===x.current&&I.current&&s&&(x.current=C.show({message:null!=t?t:s,position:i,style:g,offset:m,anchor:I.current.getBoundingClientRect(),withGrammarlyIcon:v,withCenteredGrammarlyIcon:_}))})))),(0,h.A)(P.pipe((0,o.b)((([e,t,i,n])=>{(e||t)&&!i&&null===x.current&&I.current&&n||T()})))),(0,h.A)(R.pipe((0,o.b)((e=>e&&T())))),n.useEffect((()=>()=>T()),[]);const M={ref:(0,d.l)([y,I,...(0,d.O)(e)?[e.ref]:[]],A)};return n.cloneElement(e,M)}))},1208:(e,t,i)=>{i.d(t,{b:()=>s});var n=i(49231);const s=({children:e})=>{const t="string"==typeof e?e:"";return t?n.createElement("style",{dangerouslySetInnerHTML:{__html:t}}):null}},88272:(e,t,i)=>{i.d(t,{Y:()=>g});var n=i(49231),s=i(55341),r=i(44071),a=i(90572),o=i(24666),l=i(20161),c=i(21070),h=i(14969),d=i(29479),u=i(954),p=i(79992);function g(){const e=n.useRef(new s.t(1)),t=n.useRef(e.current.pipe((0,a.h)(p.fQ),(0,o.x)(),(0,l.w)((e=>(0,r.R)(e,"mouseover").pipe((0,c.z)((()=>(0,r.R)(e,"mouseleave").pipe((0,h.P)(),(0,d.h)(!1),(0,u.O)(!0))))))))),i=n.useCallback((t=>e.current.next(t)),[e.current]);return[t.current,i]}},26573:(e,t,i)=>{i.d(t,{K:()=>r});var n=i(49231),s=i(62552);function r(e){const t=n.useRef(new s.X(e));return n.useEffect((()=>{t.current.next(e)}),[e]),t.current}},90107:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(49231);function s(e){n.useEffect((()=>{const t=e.subscribe();return()=>t.unsubscribe()}),[])}},87110:(e,t,i)=>{i.d(t,{C7:()=>g,jJ:()=>p,kl:()=>o});var n=i(4798),s=i(79992),r=i(6986),a=i(92242);function o(e,t,i,n,s,r,a,o,h,d,u,p){const g={top:i.top+o.top,left:i.left+o.left,width:i.width-o.left-o.right,height:i.height-o.top-o.bottom},_=function(e,t,i,n,s,r,a,o,l){const c=v(e,t,i,n,l,r,a);return[{...c,flippedHorizontal:!1,flippedVertical:!1}].concat((Array.isArray(s)?s:[s]).map((s=>({...v(e,f(t,s),f(i,s),m(n,c.overlap,s,r,a,o),l,r,a),flippedHorizontal:"flip"===s.horizontal,flippedVertical:"flip"===s.vertical}))))}({top:n.top-a.top,left:n.left-a.left,width:n.width+a.left+a.right,height:n.height+a.top+a.bottom},s,r,h,u,e,t,p,g),b=_.reduce(((e,t)=>e.overlap.vertical<=t.overlap.vertical?e:t)),S=_.reduce(((e,t)=>e.overlap.horizontal<=t.overlap.horizontal?e:t)),y=c({top:b.position.top,left:S.position.left,flippedHorizontal:S.flippedHorizontal,flippedVertical:b.flippedVertical},d,i,e,t);return l(y,e,t,g)}const l=(e,t,i,n)=>{const{top:s,left:r}=(0,a.m)({top:e.top,left:e.left,width:t,height:i},n);return{...e,top:s,left:r}},c=(e,t,i,n,s)=>{if(void 0===t)return e;const r=m(t,h(d({top:e.top+t.vertical,left:e.left+t.horizontal,width:n,height:s},i)),{horizontal:"translate",vertical:"translate"},n,s,!1);return{...e,top:e.top+r.vertical,left:e.left+r.horizontal}};function h(e){const t=Math.abs(Math.min(e.left,0)),i=Math.abs(Math.min(e.right,0)),n=Math.abs(Math.min(e.top,0)),s=Math.abs(Math.min(e.bottom,0));return{horizontal:t+i,vertical:n+s,top:n,bottom:s,left:t,right:i}}function d(e,t){return{top:e.top-t.top,bottom:t.top+t.height-(e.top+e.height),left:e.left-t.left,right:t.left+t.width-(e.left+e.width)}}const u=(0,s.Vo)((()=>(0,r.OB)().experimentClient.isGateEnabled(n.K.UseBodyToGetViewportDimentions)));function p(e=document){return!e.doctype&&u.get()?{top:e.body.scrollTop,left:e.body.scrollLeft,height:e.body.clientHeight,width:e.body.clientWidth}:{top:e.documentElement.scrollTop,left:e.documentElement.scrollLeft,height:e.documentElement.clientHeight,width:e.documentElement.clientWidth}}function g(e=document){return{top:0,left:0,height:!e.doctype&&u.get()?e.body.clientHeight:e.documentElement.clientHeight,width:e.documentElement.clientWidth}}function m(e,t,i,n,s,r){const a=t.left&&t.right?0:0!==t.left?Math.min(t.left,r?n:1/0):-Math.min(t.right,r?n:1/0),o=t.top&&t.bottom?0:0!==t.top?Math.min(t.top,r?s:1/0):-Math.min(t.bottom,r?s:1/0);return{horizontal:"translate"===i.horizontal?e.horizontal+a:-e.horizontal,vertical:"translate"===i.vertical?e.vertical+o:-e.vertical}}function f(e,t){return{vertical:"translate"===t.vertical?e.vertical:"top"===e.vertical?"bottom":"top",horizontal:"translate"===t.horizontal?e.horizontal:"left"===e.horizontal?"right":"left"}}function v(e,t,i,n,s,r,a){const{top:o,left:l}=function(e,t,i,n,s){return{top:e.top+s.vertical+("bottom"===i.vertical?e.height:"center"===i.vertical?e.height/2:0)-("bottom"===n.vertical?t.height:"center"===n.vertical?t.height/2:0),left:e.left+s.horizontal+("right"===i.horizontal?e.width:"center"===i.horizontal?e.width/2:0)-("right"===n.horizontal?t.width:"center"===n.horizontal?t.width/2:0)}}(e,{width:r,height:a},t,i,n);return{position:{top:o,left:l},overlap:h(d({top:o,left:l,width:r,height:a},s))}}},48667:(e,t,i)=>{function n(e,t){return i=>{e.forEach((e=>{"function"==typeof e?e(i):e&&(e.current=i),null==t||t(i)}))}}function s(e){return"ref"in e&&(null===e.ref||"function"==typeof e.ref||"object"==typeof e.ref&&"current"in e.ref)}i.d(t,{O:()=>s,l:()=>n})},91795:(e,t,i)=>{i.d(t,{x:()=>n});var n,s=i(49601),r=i(8867),a=i(32734),o=i(37108),l=i(8065),c=i(59179);!function(e){function t(e,t){return i(e,t).pipe((0,a.B)(),(0,o.Q)(s.E))}function i(e,t){return new r.y((i=>{const n=new MutationObserver((e=>i.next(e)));return n.observe(e,t),()=>n.disconnect()}))}e.create=t,e.createUnsafe=i,e.createFlattenHot=function(e,t){return i(e,t).pipe((0,l.b)((e=>e)),(0,a.B)())},e.observeAttribute=function(e,i){return t(e,{attributes:!0,attributeFilter:[i],subtree:!1,childList:!1}).pipe((0,c.U)((t=>e.getAttribute(i))))},e.observeStyle=function(e){return t(e,{attributes:!0,attributeFilter:["style"],subtree:!1,childList:!1}).pipe((0,c.U)((t=>e.style)))},e.observeChildList=function(e){return t(e,{attributes:!1,subtree:!1,childList:!0}).pipe((0,c.U)((t=>e.childNodes)))}}(n||(n={}))},74081:(e,t,i)=>{i.d(t,{N:()=>n});var n,s=i(49601),r=i(8867),a=i(32734),o=i(37108),l=i(17705),c=i(954),h=i(70874),d=i(91795);!function(e){function t(e){return function(e){return new r.y((t=>{const n=i((()=>t.next(void 0)));return e.forEach((e=>n.observe(e))),()=>n.disconnect()}))}(e).pipe((0,a.B)(),(0,o.Q)(s.E))}function i(e){return new n(e)}e.observeSizeChanges=function(e){return t(e)},e.getResizeObserver=i;class n{constructor(e){this._af=null,this._callbackWasInvoked=!1;const t=()=>{this._callbackWasInvoked?(null!==this._af&&cancelAnimationFrame(this._af),this._af=requestAnimationFrame((()=>{e()}))):(e(),this._callbackWasInvoked=!0)};try{this._resizeObserver=new ResizeObserver(t)}catch(e){this._resizeObserver=new u(t)}}observe(e){this._clearAnimationFrame(),this._resizeObserver.observe(e)}unobserve(e){this._resizeObserver.unobserve(e),this._clearAnimationFrame()}disconnect(){this._resizeObserver.disconnect(),this._clearAnimationFrame()}_clearAnimationFrame(){this._af&&(cancelAnimationFrame(this._af),this._af=null),this._callbackWasInvoked=!1}}class u{constructor(e){this._callback=e,this._sub=null}observe(e){this._sub=d.x.create(e,{attributes:!0,childList:!0,subtree:!0}).pipe((0,l.T)(h.S.hz4),(0,c.O)(null)).subscribe((()=>{this._callback()}))}unobserve(){this._sub&&(this._sub.unsubscribe(),this._sub=null)}disconnect(){this.unobserve()}}}(n||(n={}))},40840:(e,t,i)=>{i.d(t,{Wb:()=>o,mp:()=>l,rX:()=>c});var n=i(39953),s=i(27145),r=i(12518),a=i(52979);function o(e){return{x:e.left,y:e.top,top:e.top,left:e.left,width:e.width,height:e.height,bottom:e.top+e.height,right:e.left+e.width,toJSON:()=>e}}function l(e){return(0,n.zG)(e(),r.fold((e=>e),(e=>e)))}function c(e,t){const i=s.bv.is(e)?e.meta:{};return a.NC.expandIfNeeded({start:e.start,end:e.end,...i},t)}},25079:(e,t,i)=>{function n(e){return e}i.d(t,{cl:()=>n})},37285:(e,t,i)=>{i.d(t,{UQ:()=>p,tI:()=>u,zD:()=>d});var n=i(39953),s=i(56166),r=i(52303),a=i(94525),o=i(99836);function l(e,t){return{re:new RegExp(`^(${e})(.*)$`),createResult:t}}const c=[l("(?:\\<span class='gr_grammar_del'\\>([\\S\\s]*?)\\</span\\>)",(e=>({type:"delete",text:e[2]}))),l("(?:\\<span class='gr_grammar_ins'\\>([\\S\\s]*?)\\</span\\>)",(e=>({type:"insert",text:e[2]}))),l("(→)",(e=>({type:"arrow"}))),l("([^<>→]+)",(e=>({type:"text",text:e[1]})))];function h(e){function t(e){for(const t of c){const i=e.match(t.re);if(null!==i)return[t.createResult(i),i[i.length-1]]}}function i(t){let i=["<span class='gr_grammar_del'>","<span class='gr_grammar_ins'>","→"].map((e=>t.indexOf(e)));if(i.findIndex((e=>0===e))>0)throw(0,o.Tb)().couldNotParseTransform(e,!1),new Error(`Couldn't parse transform: ${e}`);if(i=i.filter((e=>e>0)),i.length>0){const e=Math.min(...i);return[{type:"text",text:t.substring(0,e)},t.substring(e)]}return[{type:"text",text:t},""]}let n=e;const s=[];let r=!1;for(;n.length>0;){let a=t(n);if(void 0===a&&(r=!0),a=a||i(n),void 0!==a){if("insert"===a[0].type){const e=s[s.length-1];e&&"delete"===e.type&&s.push({type:"arrow"})}s.push(a[0]),n=a[1]}(r||void 0===a)&&(0,o.Tb)().couldNotParseTransform(e,void 0===a)}return s}function d(e,t){return{newText:e,transform:[{type:"insert",text:e}],alternativeIndex:t}}function u(e,t,i,n){const r=Array.from(e.ops).reduce(((e,t)=>{let i=e[e.length-1];return!i||s.JU.isOptionalContextRetain(i)||s.JU.isOptionalContextRetain(t)||s.JU.isSignificant(i)!==s.JU.isSignificant(t)?e.push(t):s.JU.isRetain(i)&&s.JU.isRetain(t)?(i={...i,retain:i.retain+t.retain},e[e.length-1]=i):s.JU.isDelete(i)&&s.JU.isDelete(t)?(i={...i,delete:i.delete+t.delete},e[e.length-1]=i):s.JU.isInsertString(i)&&s.JU.isInsertString(t)?(i={...i,insert:i.insert+t.insert},e[e.length-1]=i):e.push(t),e}),[]);let a=t,o=0;const l=[];return r.forEach(((e,i)=>{if(s.JU.isOptionalContextRetain(e))a=t.slice(e.retain);else if(s.JU.isRetain(e))s.JU.isOptionalType(e.type)&&0===l.length||l.push({type:"text",text:a.slice(o,o+e.retain)}),o+=e.retain;else if(s.JU.isDelete(e)){const t=r[i-1],n=r[i+1];t&&s.JU.isInsertString(t)&&s.JU.isSignificant(t)||n&&s.JU.isInsertString(n)&&s.JU.isSignificant(n)||l.push({type:"delete",text:a.slice(o,o+e.delete)}),o+=e.delete}else s.JU.isInsertString(e)&&l.push({type:"insert",text:e.insert})})),{newText:i,transform:l,alternativeIndex:n}}function p(e,t){var i;let s=[];return s=a.DD.isWithTransformJson(e)?(0,n.zG)(e.transformJSON.alternatives,r.dH((i=>i.alternatives.map(((i,n)=>u(i,t,e.replacements[n],n)))),[])):(null!==(i=e.transforms)&&void 0!==i?i:[]).map(((t,i)=>function(e,t,i){return{newText:t,transform:h(e),alternativeIndex:i}}(t,e.replacements[i],i))),s}},94996:(e,t,i)=>{if(i.d(t,{Sz:()=>r,vQ:()=>s}),6168!=i.j)var n=i(12518);async function s(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function r(e,t=self){return s(e,t).then((()=>n.right(void 0))).catch((e=>n.left(e instanceof Error?e:new Error(String(e)))))}},37717:e=>{e.exports={spin:"qa6XN"}},94381:e=>{e.exports={highlightRect:"XWxTA",hidden:"o979x",attention:"bHjcD",blink:"oy7wj"}},18471:e=>{e.exports={ideateButton:"_ErYR",ideateButtonIcon:"i8HXG",spin:"CSZH1"}},30409:e=>{e.exports={entryButton:"cDocn",entryButtonItem:"dJCJe",rewriteIcon:"wGNWN",openIcon:"vIUqu",translateIcon:"xpU4I",spin:"A8MjA"}},68550:e=>{e.exports={replyButton:"ZfD1U",icon:"BdxRh",spin:"MBS28"}},93526:e=>{e.exports={quasiCaret:"WhbAl",icon:"Yd_W5"}},97855:e=>{e.exports={priority:"Eg8pv",emoji:"Ls_xS",cardEmoji:"ZVWqH",emojiButtonWrapper:"cenoh",emojiContainer:"Bg2tI",emojiButtonShow:"C3ro0",emojiButtonHide:"nul4w"}},7987:e=>{e.exports={fontWrapper:"amkYk"}}}]);