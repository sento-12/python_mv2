var V=Object.defineProperty;var N=i=>{throw TypeError(i)};var q=(i,e,s)=>e in i?V(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var c=(i,e,s)=>q(i,typeof e!="symbol"?e+"":e,s),R=(i,e,s)=>e.has(i)||N("Cannot "+s);var t=(i,e,s)=>(R(i,e,"read from private field"),s?s.call(i):e.get(i)),r=(i,e,s)=>e.has(i)?N("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),l=(i,e,s,o)=>(R(i,e,"write to private field"),o?o.call(i,s):e.set(i,s),s),p=(i,e,s)=>(R(i,e,"access private method"),s);var O=(i,e,s,o)=>({set _(b){l(i,e,b,s)},get _(){return t(i,e,o)}});import{u as H,S as m,l as Q,W as T,C as F,t as w,Q as $,f as K}from"./index-DbtAbjfk.js";const D={NormalClosure:1e3,GoingAway:1001,ProtocolError:1002,UnsupportedData:1003,NoStatusReceived:1005,AbnormalClosure:1006,InvalidFramePayloadData:1007,PolicyViolation:1008,MessageTooBig:1009,MandatoryExtension:1010,InternalServerError:1011,TLSHandshake:1015};var x,E,P,u,a,h,C,v,I,S,g,B,U,z;class X{constructor(e){r(this,g);r(this,x,new m);r(this,E,new m);r(this,P,new m);r(this,u);r(this,a);r(this,h,Promise.withResolvers());r(this,C);r(this,v,"");r(this,I,0);r(this,S,!1);c(this,"didClose",w(t(this,x)));c(this,"didReceive",w(t(this,E)));c(this,"didError",w(t(this,P)));l(this,u,e),l(this,C,t(this,u).getMessageSanitizer()),l(this,a,new WebSocket(t(this,u).getURL(t(this,u).documentId)));const s=new AbortController;t(this,a).onopen=async()=>{for(const o of[()=>p(this,g,B).call(this),()=>t(this,h).resolve(this)]){if(s.signal.aborted)return;try{await o()}catch(b){Q.error(T(b))}}l(this,S,!0)},t(this,a).onerror=o=>{s.abort(),t(this,h).reject(o),t(this,P).next(T(o))},t(this,a).onmessage=async o=>{t(this,S)||await t(this,h).promise,!s.signal.aborted&&p(this,g,U).call(this,p(this,g,z).call(this,o))},t(this,a).onclose=o=>{s.abort(),t(this,h).reject(new F("WebSocket closed")),t(this,x).next({webSocket:{code:o.code,reason:o.reason,wasClean:o.wasClean}})}}get sessionId(){return t(this,h).promise.then(()=>t(this,v))}get waitForConnection(){return t(this,h).promise}send(e){const s=O(this,I)._++;return Reflect.set(e,"id",s),t(this,a).send(JSON.stringify(e,(o,b)=>typeof b=="string"?t(this,C).sanitize(b):b)),s}[Symbol.dispose](){switch(t(this,a).readyState){case WebSocket.CONNECTING:t(this,a).close(D.GoingAway);break;case WebSocket.OPEN:t(this,a).close(D.NormalClosure);break}}}x=new WeakMap,E=new WeakMap,P=new WeakMap,u=new WeakMap,a=new WeakMap,h=new WeakMap,C=new WeakMap,v=new WeakMap,I=new WeakMap,S=new WeakMap,g=new WeakSet,B=async function(){this.send({id:0,docid:t(this,u).documentId,action:"start",clientSupports:["free_clarity_alerts","readability_check","filler_words_check","sentence_variety_check","vox_check","full_sentence_rewrite_card","free_occasional_premium_alerts","emogenie_check","tone_cards","ethical_ai_card","alerts_update","locked_ui_debounced_unlock_on_focus","text_actions:3.1.0","enclosing_highlight","g_debugger"],client:"extension_windows",clientSubtype:"general",clientVersion:"1.0.0",sdui:{dslSchema:"4.49.1",protocol:"2",supportedComponents:["alternativeChoice","alternativeSlider","applyAlerts","block","box","button","closeCard","column","count","icon","image","nextCard","notify","openFeedback","openLink","openPerformanceScore","openSettings","prevCard","removeAlerts","removeRoot","row","selectAlternative","strongAlertRef","text","clickableText","transition","upgradeToPremium","copyToClipboard","longFormCard","collapsedCard","progressBar","horizontalRule","enablePlagiarismCheck","disablePlagiarismCheck","enableWritingExpertCheck","disableWritingExpertCheck","globalPart","globalPartPlaceholder","sticker","selectableDropDownMenu","openGrammarlyGo","inlineCard","nativeInlineCardContent","nativeOpenAssistant","list","gButton","gButton:plagiarism","gButton:writingExpert","dropDownMenuButton","switchView","viewStack","scroll","assistantFeed","assistantCard","gButton","pushAssistantFeed","popAssistantFeed","focusAssistantCard","nativeLearnMoreModal","nativeToneInsightsModal","overlay","lensesSwitchPanel","count","behavior:animation:fadeIn","behavior:animation:fadeOut"]}})},U=function(e){e.action==="start"&&(l(this,v,e.sessionUuid),l(this,S,!0)),t(this,E).next(e)},z=function(e){if(typeof e.data!="string")throw new Y(t(this,a).binaryType,e.data);try{return JSON.parse(e.data,(s,o)=>typeof o=="string"?t(this,C).unsanitize(o):o)}catch(s){throw new Z(e.data,s)}};var A;class se{constructor(e){r(this,A);l(this,A,e)}create(e){return H(()=>new X({...e,...t(this,A)}).waitForConnection)}[Symbol.dispose](){}}A=new WeakMap;class Y extends F{constructor(s,o){super("Unsupported message data");c(this,"binaryType");c(this,"data");this.binaryType=s,this.data=o}}class Z extends F{constructor(s,o){super("Failed to parse JSON message",T(o));c(this,"data");this.data=s}}var W,n,M,f,y,k,_,d,G,J,L,j;class ie{constructor(e){r(this,d);r(this,W,new DisposableStack);r(this,n,null);r(this,M);r(this,f,new m);r(this,y,new m);r(this,k,new m);r(this,_,new m);c(this,"messageReceived",w(t(this,_)));c(this,"didClose",w(t(this,y)));c(this,"didError",w(t(this,k)));c(this,"didOpen",w(t(this,f)));l(this,M,e),t(this,W).defer(()=>{t(this,f).complete(),t(this,y).complete(),t(this,k).complete(),t(this,_).complete()})}[Symbol.dispose](){t(this,W).dispose()}connect(){l(this,n,new WebSocket(t(this,M))),t(this,n).onmessage=p(this,d,G).bind(this),t(this,n).onclose=p(this,d,J).bind(this),t(this,n).onerror=p(this,d,L).bind(this),t(this,n).onopen=p(this,d,j).bind(this)}send(e){return t(this,n)?$(()=>{var s;return(s=t(this,n))==null?void 0:s.send(e)}):K(new Error("WebSocket does not exist"))}close(){var e;(e=t(this,n))==null||e.close()}}W=new WeakMap,n=new WeakMap,M=new WeakMap,f=new WeakMap,y=new WeakMap,k=new WeakMap,_=new WeakMap,d=new WeakSet,G=function(e){t(this,_).next(e)},J=function(e){t(this,n)&&(t(this,n).onmessage=null,t(this,n).onclose=null,t(this,n).onerror=null,t(this,n).onopen=null),t(this,y).next(e)},L=function(e){t(this,k).next(e)},j=function(e){t(this,f).next(e)};export{ie as D,se as W};
//# sourceMappingURL=CAPIWebSocketTransport-BECrZbf6-DxXm2fku.js.map
